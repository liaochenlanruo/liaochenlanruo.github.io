{"total":142,"pageSize":10,"pageCount":15,"data":[{"title":"原核生物基因岛预测","slug":"原核生物基因岛预测","date":"2021-10-08T11:27:05.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/原核生物基因岛预测.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-1.jpg","content":"<h1 id=\"软件-Software-needed\"><a href=\"#软件-Software-needed\" class=\"headerlink\" title=\"软件 (Software needed)\"></a>软件 (Software needed)</h1><ul>\n<li><a href=\"https://github.com/brinkmanlab/islandpath\">IslandPath-DIMOB</a></li>\n<li><a href=\"https://bioperl.org/\">BioPerl</a></li>\n</ul>\n<h1 id=\"安装-Installation\"><a href=\"#安装-Installation\" class=\"headerlink\" title=\"安装 (Installation)\"></a>安装 (Installation)</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conda install islandpath</span><br><span class=\"line\">conda install perl-bioperl</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"输入文件-Input-Files\"><a href=\"#输入文件-Input-Files\" class=\"headerlink\" title=\"输入文件 (Input Files)\"></a>输入文件 (Input Files)</h1><ul>\n<li>GenBank (.gbk) or an embl (.embl) file</li>\n<li><font color='#ff0000'><strong>注意:</strong> 输入文件中只允许包含一条序列，否则会报错！(Please make sure you are running islandpath on a genbank file with only one contig)。</font>如果一个文件中含有多个序列，那么就要将其分割成为多个文件，然后逐个作为输入文件进行预测。切割方法见我的另一篇文章<a href=\"https://liaochenlanruo.github.io/post/d9f9.html\">按照Contig切割GenBank文件</a>。</li>\n</ul>\n<h1 id=\"运行软件-Run\"><a href=\"#运行软件-Run\" class=\"headerlink\" title=\"运行软件 (Run)\"></a>运行软件 (Run)</h1><h2 id=\"常规运行\"><a href=\"#常规运行\" class=\"headerlink\" title=\"常规运行\"></a>常规运行</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># gbk file</span></span><br><span class=\"line\">islandpath example/NC_003210.gbk NC_003210_GIs.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># embl file</span></span><br><span class=\"line\">islandpath example/NC_000913.embl NC_000913_GIs.txt</span><br></pre></td></tr></table></figure>\n\n<p>输出结果如下图所示：</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"示例输出结果展示\"></p>\n<h2 id=\"批处理\"><a href=\"#批处理\" class=\"headerlink\" title=\"批处理\"></a>批处理</h2><p>在得到大量基因组的时候，手动提交并不像打游戏那样让人渴望敲击键盘和鼠标，为了避免烦躁，我们来写脚本“run_islandpath.pl”，然后让机器做剩下的事情。该脚本可以实现GenBank文件的切割，基因岛预测，以及结果的整合，实现了IslandPath-DIMOB所无法完成的分析。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"keyword\">use</span> Bio::SeqIO;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Oct 8, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Split GenBank files</span></span><br><span class=\"line\"><span class=\"keyword\">my</span> @gbk = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.gbk&quot;</span>);<span class=\"comment\"># 批处理所有后缀为.gbk的文件</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@gbk) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).gbk/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $str = $1;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">local</span> $/ = <span class=\"string\">&quot;LOCUS&quot;</span>;</span><br><span class=\"line\">\t&lt;IN&gt;;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">/\\s+(\\S+)/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $scaf = $1;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $out = $str . <span class=\"string\">&quot;_&quot;</span> . $scaf . <span class=\"string\">&quot;.gb&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $assession = $str . <span class=\"string\">&quot;_&quot;</span> . $scaf;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/ACCESSION.+/ACCESSION   $assession/g</span>;<span class=\"comment\"># 添加ACCESSION number</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;$out&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;LOCUS$_&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">close</span> OUT;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># predict Gene Islands</span></span><br><span class=\"line\">$/ = <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @gb = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.gb&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@gb) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).gb/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;.island&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">system</span>(<span class=\"string\">&quot;islandpath $_ $out&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Get features from GenBank files</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> <span class=\"keyword\">my</span> $gb (@gb) &#123;</span><br><span class=\"line\">\t$gb=~<span class=\"regexp\">/(.+).gb/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $str = $1;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $str . <span class=\"string\">&quot;.list&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $seqin = Bio::SeqIO-&gt;new( <span class=\"string\">-format =&gt;</span> <span class=\"string\">&#x27;genbank&#x27;</span>, <span class=\"string\">-file =&gt;</span> <span class=\"string\">&quot;$gb&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;$out&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>( (<span class=\"keyword\">my</span> $seq = $seqin-&gt;next_seq) ) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> <span class=\"keyword\">my</span> $sf ( $seq-&gt;get_SeqFeatures ) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>( $sf-&gt;primary_tag eq <span class=\"string\">&#x27;CDS&#x27;</span> ) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">my</span> @tags = $sf -&gt;get_all_tags();</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print join(&quot;\\t&quot;, @tags) . &quot;\\n&quot;;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">print</span> OUT $sf-&gt;get_tag_values(<span class=\"string\">&#x27;locus_tag&#x27;</span>), <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;start, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;end, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;strand, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;get_tag_values(<span class=\"string\">&#x27;product&#x27;</span>), <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;get_tag_values(<span class=\"string\">&#x27;translation&#x27;</span>),<span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Parser the results</span></span><br><span class=\"line\"><span class=\"keyword\">my</span> (%hash, %gi, %list, %gif);</span><br><span class=\"line\"><span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;All_island.txt&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"><span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;Sequence IDs\tPredictor\tCategory\tGI Start\tGI End\t.\tStrand\t.\tIsland IDs\tGene IDs\tGene Start\tGene End\tStrand\tProducts\tProtein Sequences\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">open</span> LIST, <span class=\"string\">&quot;&gt;All_island.list&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"><span class=\"keyword\">print</span> LIST <span class=\"string\">&quot;Island IDs\\tGI Start\\tGI End\\tGI Length\\tGene Number\\tGene IDs\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @GI = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.island&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@GI) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).island/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $list = $1 . <span class=\"string\">&quot;.list&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t&lt;IN&gt;;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $start = $lines[<span class=\"number\">3</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $end = $lines[<span class=\"number\">4</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $id = $lines[-<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $gilen = $end - $start + <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t$hash&#123;$id&#125; = $start . <span class=\"string\">&quot;-&quot;</span> . $end . <span class=\"string\">&quot;-&quot;</span> . $id;</span><br><span class=\"line\">\t\t$gi&#123;$id&#125; = $_;</span><br><span class=\"line\">\t\t$gif&#123;$id&#125; = $start . <span class=\"string\">&quot;\\t&quot;</span> . $end . <span class=\"string\">&quot;\\t&quot;</span> . $gilen;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> GB, <span class=\"string\">&quot;$list&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;GB&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @line = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">foreach</span> <span class=\"keyword\">my</span> $ids (<span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %hash) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> ($start2, $end2, $gi) = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\-/</span>, $hash&#123;$ids&#125;;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (($line[<span class=\"number\">1</span>] &gt;= $start2) &amp;&amp; ($line[<span class=\"number\">2</span>] &lt;= $end2)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">print</span> OUT $gi&#123;$gi&#125; . <span class=\"string\">&quot;\\t&quot;</span> . $_ . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">push</span> @&#123;$list&#123;$gi&#125;&#125;, $line[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> GB;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> OUT;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (<span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %list) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> LIST $_ . <span class=\"string\">&quot;\\t&quot;</span> . $gif&#123;$_&#125; . <span class=\"string\">&quot;\\t&quot;</span> . @&#123;$list&#123;$_&#125;&#125; . <span class=\"string\">&quot;\\t&quot;</span> . <span class=\"keyword\">join</span> (<span class=\"string\">&quot; &quot;</span>, @&#123;$list&#123;$_&#125;&#125;) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> LIST;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>将“run_islandpath.pl”与GenBank文件放在同一目录下，在终端里运行如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl run_islandpath.pl</span><br></pre></td></tr></table></figure>\n\n<p>结果汇总于<strong>All_island.txt</strong>和<strong>All_island.list</strong>中，内容如下面二图所示。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"All_island.txt\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-3.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/5324-3.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"All_island.list\"></p>\n<h1 id=\"脚本获取\"><a href=\"#脚本获取\" class=\"headerlink\" title=\"脚本获取\"></a>脚本获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“5324”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"Functional genomics","path":"api/tags/Functional genomics.json"},{"name":"WGS","path":"api/tags/WGS.json"},{"name":"生信软件","path":"api/tags/生信软件.json"},{"name":"基因岛","path":"api/tags/基因岛.json"}]},{"title":"预测前噬菌体prophages","slug":"预测前噬菌体prophages","date":"2021-10-08T07:54:24.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/预测前噬菌体prophages.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/53f4_1.jpg","content":"<p>本文介绍如何从细菌&#x2F;古菌中预测前噬菌体。</p>\n<h1 id=\"软件选择\"><a href=\"#软件选择\" class=\"headerlink\" title=\"软件选择\"></a>软件选择</h1><ul>\n<li><a href=\"https://github.com/linsalrob/PhiSpy\">PhiSpy</a></li>\n<li><a href=\"https://bioperl.org/\">BioPerl</a></li>\n</ul>\n<h1 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h1><h2 id=\"安装主程序\"><a href=\"#安装主程序\" class=\"headerlink\" title=\"安装主程序\"></a>安装主程序</h2><ul>\n<li><p>推荐使用conda</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conda install phispy</span><br><span class=\"line\">conda install perl-bioperl</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"下载模型\"><a href=\"#下载模型\" class=\"headerlink\" title=\"下载模型\"></a>下载模型</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://ftp.ncbi.nlm.nih.gov/pub/kristensen/pVOGs/downloads/All/AllvogHMMprofiles.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf AllvogHMMprofiles.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> AllvogHMMprofiles/* &gt; pVOGs.hmm</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h1><ul>\n<li>需要GenBank格式的文件，可通过<a href=\"http://rast.nmpdr.org/rast.cgi\">RAST server</a>或<a href=\"https://github.com/tseemann/prokka\">PROKKA</a>获得。</li>\n</ul>\n<h1 id=\"运行软件\"><a href=\"#运行软件\" class=\"headerlink\" title=\"运行软件\"></a>运行软件</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhiSpy.py genbank_file -o output_directory --phage_genes 1 --color --threads 6 --phmms pVOGs.hmm --min_contig_size 5000 --output_choice 1</span><br></pre></td></tr></table></figure>\n<ul>\n<li>genbank file: 输入文件</li>\n<li>output directory: 输出目录</li>\n<li>--phage_genes: 区域内含有的被鉴定为噬菌体基因的最小数量。默认采用严格模式，即在每个前噬菌体区域必须鉴定得到两个或更多个phage基因。调高该参数的值将会减少预测到的前噬菌体的数量，反之，减小参数值，将会得到更多的移动元件。如果该参数设置为0，将会预测plasmids, integrons, and pathogenicity islands. Somewhat unexpectedly, it will also identify the ribosomal RNA operons as likely being mobile since they are unlike the host’s backbone!</li>\n<li>--color: 根据CDs的功能对其着色，使用<a href=\"https://www.sanger.ac.uk/science/tools/artemis\">Artemis</a>查看</li>\n<li>--threads: 线程数</li>\n<li>--min_contig_size: 低于阈值的序列将被忽略，不对其进行预测</li>\n<li>--output_choice: 控制输出的文件类型，详见<a href=\"https://github.com/linsalrob/PhiSpy\">官网</a></li>\n</ul>\n<h1 id=\"报错处理\"><a href=\"#报错处理\" class=\"headerlink\" title=\"报错处理\"></a>报错处理</h1><ul>\n<li><p>由于序列ID引发的错误</p>\n<ul>\n<li>错误信息如下：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/bin/PhiSpy.py&quot;, line 10, in &lt;module&gt;</span><br><span class=\"line\">  sys.exit(run())</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/PhiSpyModules/main.py&quot;, line 122, in run</span><br><span class=\"line\">  main(sys.argv)</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/PhiSpyModules/main.py&quot;, line 44, in main</span><br><span class=\"line\">  args<span class=\"built_in\">_</span>parser.record = PhiSpyModules.SeqioFilter(filter(lambda x: len(x.seq) &gt; args<span class=\"built_in\">_</span>parser.min<span class=\"built_in\">_</span>contig<span class=\"built_in\">_</span>size, SeqIO.parse(handle, &quot;genbank&quot;)))</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/PhiSpyModules/seqio<span class=\"built_in\">_</span>filter.py&quot;, line 33, in <span class=\"built_in\">_</span><span class=\"built_in\">_</span>init<span class=\"built_in\">_</span><span class=\"built_in\">_</span></span><br><span class=\"line\">  for n, item in enumerate(content):</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/Bio/SeqIO/Interfaces.py&quot;, line 74, in <span class=\"built_in\">_</span><span class=\"built_in\">_</span>next<span class=\"built_in\">_</span><span class=\"built_in\">_</span></span><br><span class=\"line\">  return next(self.records)</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/Bio/GenBank/Scanner.py&quot;, line 516, in parse<span class=\"built_in\">_</span>records</span><br><span class=\"line\">  record = self.parse(handle, do<span class=\"built_in\">_</span>features)</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/Bio/GenBank/Scanner.py&quot;, line 499, in parse</span><br><span class=\"line\">  if self.feed(handle, consumer, do<span class=\"built_in\">_</span>features):</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/Bio/GenBank/Scanner.py&quot;, line 465, in feed</span><br><span class=\"line\">  self.<span class=\"built_in\">_</span>feed<span class=\"built_in\">_</span>first<span class=\"built_in\">_</span>line(consumer, self.line)</span><br><span class=\"line\">File &quot;/home/liu/miniconda3/envs/component/lib/python3.7/site-packages/Bio/GenBank/Scanner.py&quot;, line 1571, in <span class=\"built_in\">_</span>feed<span class=\"built_in\">_</span>first<span class=\"built_in\">_</span>line</span><br><span class=\"line\">  raise ValueError(&quot;Did not recognise the LOCUS line layout:<span class=\"keyword\">\\n</span>&quot; + line)</span><br><span class=\"line\">ValueError: Did not recognise the LOCUS line layout:</span><br><span class=\"line\">LOCUS       NODE<span class=\"built_in\">_</span>52<span class=\"built_in\">_</span>length<span class=\"built_in\">_</span>15591<span class=\"built_in\">_</span>cov<span class=\"built_in\">_</span>14.37480715591 bp</span><br></pre></td></tr></table></figure>\n<ul>\n<li>解决方案<ul>\n<li>将sequence ID缩短</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"批处理并整合结果\"><a href=\"#批处理并整合结果\" class=\"headerlink\" title=\"批处理并整合结果\"></a>批处理并整合结果</h1><p>撰写脚本“run_PhiSpy.pl”。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"keyword\">use</span> Bio::SeqIO;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Oct 12, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @gbk = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.gbk&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@gbk) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).gbk/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;_prophage&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">system</span>(<span class=\"string\">&quot;PhiSpy.py $_ -o $out --phage_genes 1 --min_contig_size 5000 --output_choice 1 --color --phmms pVOGs.hmm --threads 8&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;All.prophages.txt&quot;</span> || <span class=\"keyword\">die</span>;<span class=\"comment\"># print prophages informations</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;Strain\\tPhage ID\\tContig ID\\tStart location of the prophage\\tStop location of the prophage\\tStart of attL\\tEnd of attL\\tStart of attR\\tEnd of attR\\tsequence of attL\\tSequence of attR\\tWhy this att site was chosen for this prophage\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\"># attachment (att) sites</span></span><br><span class=\"line\"><span class=\"keyword\">open</span> SEQ, <span class=\"string\">&quot;&gt;All.prophages.seq&quot;</span> || <span class=\"keyword\">die</span>;<span class=\"comment\"># print prophages sequences</span></span><br><span class=\"line\"><span class=\"keyword\">print</span> SEQ <span class=\"string\">&quot;Strain\\tPhage ID\\tContig ID\\tGene Start\\tGene End\\tStrand\\tAnnotation\\tProtein sequences\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @result = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*_prophage&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@result) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+)_prophage/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $str = $1;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $prophage = $_ . <span class=\"string\">&quot;/prophage_coordinates.tsv&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (! -z $prophage) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$prophage&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> $contig = $lines[<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> $gbk = $str . <span class=\"string\">&quot;.gbk&quot;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> $seqin = Bio::SeqIO-&gt;new( <span class=\"string\">-format =&gt;</span> <span class=\"string\">&#x27;genbank&#x27;</span>, <span class=\"string\">-file =&gt;</span> <span class=\"string\">&quot;$gbk&quot;</span>);<span class=\"comment\">#需要在gbk文件所在的目录中运行命令!</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span>( (<span class=\"keyword\">my</span> $seq = $seqin-&gt;next_seq) ) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">foreach</span> <span class=\"keyword\">my</span> $sf ( $seq-&gt;get_SeqFeatures ) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> ($seq-&gt;display_name eq $contig) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>( $sf-&gt;primary_tag eq <span class=\"string\">&#x27;CDS&#x27;</span> ) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"comment\">#print SEQ $str, &quot;\\t&quot;, $lines[0], &quot;\\t&quot;, $seq-&gt;display_name, &quot;\\t&quot;, $sf-&gt;start, &quot;\\t&quot;, $sf-&gt;end, &quot;\\t&quot;, $sf-&gt;strand, &quot;\\t&quot;, $sf-&gt;get_tag_values(&#x27;product&#x27;), &quot;\\t&quot;, $sf-&gt;get_tag_values(&#x27;translation&#x27;), $seq-&gt;seq,&quot;\\n&quot;;# Also print contig sequences</span></span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">print</span> SEQ $str, <span class=\"string\">&quot;\\t&quot;</span>, $lines[<span class=\"number\">0</span>], <span class=\"string\">&quot;\\t&quot;</span>, $seq-&gt;display_name, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;start, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;end, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;strand, <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;get_tag_values(<span class=\"string\">&#x27;product&#x27;</span>), <span class=\"string\">&quot;\\t&quot;</span>, $sf-&gt;get_tag_values(<span class=\"string\">&#x27;translation&#x27;</span>),<span class=\"string\">&quot;\\n&quot;</span>;<span class=\"comment\"># Only print Protein sequences</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT $str . <span class=\"string\">&quot;\\t&quot;</span> . $_ . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> OUT;</span><br><span class=\"line\"><span class=\"keyword\">close</span> SEQ;</span><br></pre></td></tr></table></figure>\n\n<p>将“run_PhiSpy.pl”和后缀名为“.gbk”的GenBank格式的文件，以及“pVOGs.hmm”放在同一目录下，运行如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl run_PhiSpy.pl</span><br></pre></td></tr></table></figure>\n\n<p>得到两个汇总文件：</p>\n<ul>\n<li><strong>All.prophages.txt</strong>: 包含prophage信息的文件</li>\n<li><strong>All.prophages.seq</strong>: 包含prophage序列的文件</li>\n</ul>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/53f4_1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/53f4_1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"All.prophages.txt\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/53f4_2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/53f4_2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"All.prophages.seq\"></p>\n<h1 id=\"脚本获取\"><a href=\"#脚本获取\" class=\"headerlink\" title=\"脚本获取\"></a>脚本获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“53f4”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/linsalrob/PhiSpy\">https://github.com/linsalrob/PhiSpy</a></li>\n</ul>\n","raw":null,"categories":[],"tags":[]},{"title":"Hexo渲染异常","slug":"Hexo渲染异常","date":"2021-09-30T10:47:14.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Hexo渲染异常.json","excerpt":null,"keywords":null,"cover":null,"content":"<h1 id=\"代码渲染问题\"><a href=\"#代码渲染问题\" class=\"headerlink\" title=\"代码渲染问题\"></a>代码渲染问题</h1><h2 id=\"代码块中的花括号-被渲染为’-123-’和’-125-’\"><a href=\"#代码块中的花括号-被渲染为’-123-’和’-125-’\" class=\"headerlink\" title=\"代码块中的花括号{}被渲染为’&amp;#123;’和’&amp;#125;’\"></a>代码块中的花括号{}被渲染为’&amp;#123;’和’&amp;#125;’</h2><ul>\n<li><p>原因</p>\n<p>  安装了代码高亮插件(hexo-prism-plugin)导致的错误</p>\n</li>\n<li><p>解决方案</p>\n<p>  卸载该插件，然后重新渲染。</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall hexo-prism-plugin</span><br></pre></td></tr></table></figure></li>\n</ul>\n","raw":null,"categories":[{"name":"网站建设","path":"api/categories/网站建设.json"}],"tags":[{"name":"Hexo","path":"api/tags/Hexo.json"}]},{"title":"CAZy碳水化合物活性酶预测","slug":"CAZy碳水化合物活性酶预测","date":"2021-09-30T01:18:19.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/CAZy碳水化合物活性酶预测.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_1.jpg","content":"<h1 id=\"CAZy数据库简介\"><a href=\"#CAZy数据库简介\" class=\"headerlink\" title=\"CAZy数据库简介\"></a>CAZy数据库简介</h1><p><a href=\"http://www.cazy.org/Home.html\">CAZy</a> 全称为Carbohydrate-Active enZYmes Database，碳水化合物酶相关的专业数据库，内容包括能催化碳水化合物降解、修饰、以及生物合成的相关酶系家族。其包含五个主要分类：糖苷水解酶（Glycoside Hydrolases, GHs）、糖基转移酶（GlycosylTransferases, GTs）、多糖裂解酶（Polysaccharide Lyases, PLs）、糖酯酶（Carbohydrate Esterases, CEs）和氧化还原酶（Auxiliary Activities, AAs）。此外，还包含与碳水化合物结合结构域（Carbohydrate-Binding Modules， CBMs）。五大分类和一个结构域下，都分别建立了多个Family。</p>\n<ul>\n<li><p><a href=\"http://www.cazy.org/Glycoside-Hydrolases.html\">GHs</a>：糖苷键的水解和&#x2F;或重排</p>\n</li>\n<li><p><a href=\"http://www.cazy.org/GlycosylTransferases.html\">GTs</a>：糖苷键的形成</p>\n</li>\n<li><p><a href=\"http://www.cazy.org/Polysaccharide-Lyases.html\">PLs</a>：糖苷键的非水解裂解</p>\n</li>\n<li><p><a href=\"http://www.cazy.org/Carbohydrate-Esterases.html\">CEs</a>：水解碳水化合物的酯类</p>\n</li>\n<li><p><a href=\"http://www.cazy.org/Auxiliary-Activities.html\">AAs</a>：与 CAZymes 协同作用的氧化还原酶</p>\n</li>\n<li><p><a href=\"http://www.cazy.org/Carbohydrate-Binding-Modules.html\">CBMs</a>：与碳水化合物结合</p>\n</li>\n</ul>\n<h1 id=\"CAZy数据库的准备\"><a href=\"#CAZy数据库的准备\" class=\"headerlink\" title=\"CAZy数据库的准备\"></a>CAZy数据库的准备</h1><p>在进行预测之前需要准备数据库，CAZy貌似没有提供FASTA格式的序列数据库，而仅提供了序列的Assenssion number，需要我们自己从NCBI数据库中下载序列。下载方法参照我之前的文章《<a href=\"https://liaochenlanruo.github.io/post/e7e9.html\">根据assession number批量从NCB下载数据</a>》，在文章中提供了下载CAZy序列的方法和脚本，此处不再赘述。</p>\n<p>在上一篇文章结尾获得的“All.sequences.fas”文件包含了所有的CAZy数据库序列，在正式预测之前需要完成数据库的格式化。后面我们将通过Diamond软件从基因组中预测CAZy蛋白，因此采用Diamond格式化数据库。</p>\n<ul>\n<li><p>序列预处理</p>\n<p>  不知道什么原因，下载的序列存在两个问题，其一，下一条序列的ID连接着上一条序列的末尾，没有断行；其二，序列中存在着一段网页代码。因此，需要分两步进行修正。</p>\n<ul>\n<li><p>解决断行问题</p>\n<p>  撰写脚本“add_linebreak.pl”，内容如下：</p>\n  <figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 30, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> $/=<span class=\"string\">&quot;&gt;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;All.sequences.fas&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"><span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;CAZy.fas&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">&lt;IN&gt;;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;&gt;$_\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> IN;</span><br><span class=\"line\"><span class=\"keyword\">close</span> OUT;</span><br></pre></td></tr></table></figure>\n<p>  将脚本与”All.sequences.fas”放在同一目录下，在终端或者命令行中运行如下命令，得到“CAZy.fas”。</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl add_linebreak.pl</span><br></pre></td></tr></table></figure></li>\n<li><p>删除无关内容</p>\n<p>  用EmEditor软件打开CAZy.fas，Ctrl+F调出查找功能，搜索“www.” 可以看到如下内容，手动将其删除，并保存文件。</p>\n<p>  <img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"数据库中需要手动删除的网页信息\"></p>\n</li>\n</ul>\n</li>\n<li><p>构建Diamond数据库</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">diamond makedb --<span class=\"keyword\">in</span> CAZy.fas -d CAZy</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"开始序列比对\"><a href=\"#开始序列比对\" class=\"headerlink\" title=\"开始序列比对\"></a>开始序列比对</h1><p>当然，我们选择用Perl进行批量比对</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 30, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @faa = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.faa&quot;</span>);<span class=\"comment\"># 读取所有后缀为“.faa”的文件，可以自己更改</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@faa) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).faa/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;.CAZy.diamond&quot;</span>;</span><br><span class=\"line\">\t<span class=\"comment\"># -p表示线程数，在笔记本上用6个即可</span></span><br><span class=\"line\">\t<span class=\"keyword\">system</span>(<span class=\"string\">&quot;diamond blastp -d CAZy -q $_ -e 1e-5 -f 6 -o $out -k 1 --sensitive -p 30 --query-cover 50&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将上述代码复制到文件中，命名为“run_diamond_CAZy.pl”，将其和序列文件放在同一目录下，并在终端中输入如下命令，完成分析，得到“*.CAZy.diamond”：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl run_diamond_CAZy.pl</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"比对结果过滤\"><a href=\"#比对结果过滤\" class=\"headerlink\" title=\"比对结果过滤\"></a>比对结果过滤</h1><p>在比对过程中我们控制了evalue和query coverage，但是没有控制identity。但是很多时候，需要设定一个identity的阈值，低于阈值的比对将会被删除，该步骤可以将比对结果拷贝到Excel中根据identity排序，手动删除阈值以下的行，然而我选择用Perl批处理。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 30, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @cazy = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.CAZy.diamond&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@cazy) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).CAZy.diamond/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;.CAZy.diamond.filtered&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;$out&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($lines[<span class=\"number\">2</span>] &gt;= <span class=\"number\">40</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT $_ . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> OUT;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>将上述代码复制到文件中，命名为“filter_cazy_diamond.pl”，将其和上一步产生的文件放在同一目录下，并在终端中输入如下命令，完成过滤，保留identity &gt;&#x3D; 40% 的行，得到“*.CAZy.diamond.filtered”。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl filter_cazy_diamond.pl</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"你以为完了？还得mapping！\"><a href=\"#你以为完了？还得mapping！\" class=\"headerlink\" title=\"你以为完了？还得mapping！\"></a>你以为完了？还得mapping！</h1><p>得到的结果如下图所示，第二列的Hits是NCBI的Assession number，我们根本只知道这是什么CAZy家族，因此需要mapping！</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"Diamond比对结果\"></p>\n<p>回头找到我们下载的<a href=\"http://www.cazy.org/IMG/cazy_data/cazy_data.zip\">cazy_data.txt</a>，里面保存的是CAZy家族与Assession number的对应关系。比较闲的兄弟可以用查找-复制-粘贴的方法将“*.CAZy.diamond.filtered”中的Assession number替换为CAZy家族。我为比较忙的兄弟准备了下面的代码，批处理。不过我输出的是一个矩阵。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 30, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> %cazy;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;cazy_data.txt&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t$cazy&#123;$lines[<span class=\"number\">2</span>]&#125; = $lines[<span class=\"number\">0</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> IN;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> %hash;</span><br><span class=\"line\"><span class=\"keyword\">my</span> %samples;</span><br><span class=\"line\"><span class=\"keyword\">my</span> %ids;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @filtered = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.CAZy.diamond.filtered&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@filtered) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).CAZy.diamond.filtered/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $sample = $1;</span><br><span class=\"line\">\t$samples&#123;$1&#125;++;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @line = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">exists</span> $cazy&#123;$line[<span class=\"number\">1</span>]&#125;) &#123;</span><br><span class=\"line\">\t\t\t$ids&#123;$cazy&#123;$line[<span class=\"number\">1</span>]&#125;&#125;++;</span><br><span class=\"line\">\t\t\t$hash&#123;$sample&#125;&#123;$cazy&#123;$line[<span class=\"number\">1</span>]&#125;&#125;++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;CAZy.Matrix.txt&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @samples = <span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %samples;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @ids = <span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %ids;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t&quot;</span> . <span class=\"keyword\">join</span>(<span class=\"string\">&quot;\\t&quot;</span>, @samples) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $i=<span class=\"number\">0</span>; $i&lt;@ids ;$i++) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT $ids[$i];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $j=<span class=\"number\">0</span>; $j&lt;@samples ;$j++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">exists</span> $hash&#123;$samples[$j]&#125;&#123;$ids[$i]&#125;) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t$hash&#123;$samples[$j]&#125;&#123;$ids[$i]&#125;&quot;</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t0&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> OUT;</span><br></pre></td></tr></table></figure>\n\n\n<p>将上述代码复制到文件中，命名为“assession2cazy.pl“，将其和”cazy_data.txt“，及上一步产生的文件“*.CAZy.diamond.filtered”放在同一目录下，并在终端中输入如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl assession2cazy.pl</span><br></pre></td></tr></table></figure>\n\n<p>得到一个矩阵“CAZy.Matrix.txt”，内容如下，行为CAZy家族，列为基因组&#x2F;样本名。拿到本文件后，可以做热图看CAZy家族在各样本中的分布情况，然而这个热图将会比鞋帮子脸还要长，可读性不高，因此我选择将这些family合并为大类，生成一个新的矩阵。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_3.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_3.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"Mapping后的矩阵\"></p>\n<p>二话不说，上代码。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 30, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> %category;</span><br><span class=\"line\"><span class=\"keyword\">my</span> %hash;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @samples;</span><br><span class=\"line\"><span class=\"keyword\">my</span> $count = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;CAZy.Matrix.txt&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t$count++;</span><br><span class=\"line\">\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ($count == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t@samples = <span class=\"keyword\">split</span>;</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span>;</span><br><span class=\"line\">\t\t$lines[<span class=\"number\">0</span>]=~<span class=\"regexp\">/(.+?)\\d+/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> $cate = $1;</span><br><span class=\"line\">\t\t$category&#123;$cate&#125;++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $i=<span class=\"number\">0</span>; $i&lt;@samples; $i++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> $j = $i + <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t$hash&#123;$samples[$i]&#125;&#123;$cate&#125; += $lines[$j];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> IN;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;CAZy.Category.Matrix.txt&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @category = <span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %category;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t&quot;</span> . <span class=\"keyword\">join</span>(<span class=\"string\">&quot;\\t&quot;</span>, @samples) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $i=<span class=\"number\">0</span>; $i&lt;@category ;$i++) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT $category[$i];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $j=<span class=\"number\">0</span>; $j&lt;@samples ;$j++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">exists</span> $hash&#123;$samples[$j]&#125;&#123;$category[$i]&#125;) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t$hash&#123;$samples[$j]&#125;&#123;$category[$i]&#125;&quot;</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t0&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> OUT;</span><br></pre></td></tr></table></figure>\n\n<p>将上述代码复制到文件中，命名为“cazyfamily2categories.pl”，将其和上一步产生的文件“CAZy.Matrix.txt”放在同一目录下，并在终端中输入如下命令，得到文件“CAZy.Category.Matrix.txt”。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl cazyfamily2categories.pl</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_4.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/9052_4.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"CAZy.Category.Matrix.txt内容概览\"></p>\n<p>接下来是要做柱状图还是heatmap，就随便了。</p>\n<h1 id=\"脚本获取\"><a href=\"#脚本获取\" class=\"headerlink\" title=\"脚本获取\"></a>脚本获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“9052”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"Functional genomics","path":"api/tags/Functional genomics.json"},{"name":"CAZy","path":"api/tags/CAZy.json"},{"name":"SY179","path":"api/tags/SY179.json"}]},{"title":"构建样本vs基因矩阵","slug":"构建样本vs基因矩阵","date":"2021-09-29T04:17:04.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/构建样本vs基因矩阵.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/412a_1.jpg","content":"<p>承接上一篇文章<a href=\"https://liaochenlanruo.github.io/post/e922.html\">Swissprot数据库的本地化与序列比对</a>。</p>\n<h1 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h1><p>分别预测了多个样本&#x2F;基因组中某些基因的存在与否即数量，需要将这些样本&#x2F;基因组中的基因数量情况合并在一起构建矩阵，此时，手动是非常困难和无趣的。又该请出Perl神了。</p>\n<h1 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h1><p>在上一篇文章中，我们将多个宏基因组蛋白序列与SwissProt数据库做了比对，并根据比对到的ID与其他数据库做了mapping，得到了多个输出文件，保存为“sample.mapped”。其中“sample”可以是样本名，也可以是基因组名，它将出现在最后构建的矩阵中。这些文件既可作为本例的输入文件，其内容大概是下面酱紫的，各列以制表符分隔。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/412a_1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/412a_1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"输入文件长酱紫\"></p>\n<h1 id=\"写脚本\"><a href=\"#写脚本\" class=\"headerlink\" title=\"写脚本\"></a>写脚本</h1><p>上图是其中一个文件的内容的一部分，接下来我们将提取第19列的GO number来构建矩阵。将以下代码保存到文件中，命名为“get_matrix.pl”。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 29, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> %hash;</span><br><span class=\"line\"><span class=\"keyword\">my</span> %ids;</span><br><span class=\"line\"><span class=\"keyword\">my</span> %samples;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @files = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.mapped&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@files) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).mapped/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $sample = $1;</span><br><span class=\"line\">\t$samples&#123;$1&#125;++;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t&lt;IN&gt;;<span class=\"comment\"># 忽略第一行，如果第一行不是标题行，请将该行注释掉</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($lines[<span class=\"number\">18</span>]=~<span class=\"regexp\">/.+\\; /</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> @terms = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\; /</span>, $lines[<span class=\"number\">18</span>];<span class=\"comment\"># 18代表文件的第19列，若想提取其他列，可以自行修改该数字为“列号-1”，因为第一列代号为0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">foreach</span>  (@terms) &#123;</span><br><span class=\"line\">\t\t\t\t$ids&#123;$_&#125;++;</span><br><span class=\"line\">\t\t\t\t$hash&#123;$sample&#125;&#123;$_&#125;++;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">elsif</span> ($lines[<span class=\"number\">18</span>]=~<span class=\"regexp\">/\\S+/</span>) &#123;</span><br><span class=\"line\">\t\t\t$ids&#123;$lines[<span class=\"number\">18</span>]&#125;++;</span><br><span class=\"line\">\t\t\t$hash&#123;$sample&#125;&#123;$lines[<span class=\"number\">18</span>]&#125;++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;Matrix.txt&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @samples = <span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %samples;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @ids = <span class=\"keyword\">sort</span> <span class=\"keyword\">keys</span> %ids;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t&quot;</span> . <span class=\"keyword\">join</span>(<span class=\"string\">&quot;\\t&quot;</span>, @samples) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $i=<span class=\"number\">0</span>; $i&lt;@ids ;$i++) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT $ids[$i];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">my</span> $j=<span class=\"number\">0</span>; $j&lt;@samples ;$j++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">exists</span> $hash&#123;$samples[$j]&#125;&#123;$ids[$i]&#125;) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t$hash&#123;$samples[$j]&#125;&#123;$ids[$i]&#125;&quot;</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t0&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">close</span> OUT;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"构建矩阵\"><a href=\"#构建矩阵\" class=\"headerlink\" title=\"构建矩阵\"></a>构建矩阵</h1><p>将脚本与输入文件放在同一目录下，在终端或Windows命令行中运行如下命令，得到的“Matrix.txt”即为输出文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl get_matrix.pl</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/412a_2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/412a_2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"输出文件长酱紫\"></p>\n<h1 id=\"脚本获取\"><a href=\"#脚本获取\" class=\"headerlink\" title=\"脚本获取\"></a>脚本获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“412a”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"SY179","path":"api/tags/SY179.json"},{"name":"perl","path":"api/tags/perl.json"},{"name":"编程","path":"api/tags/编程.json"}]},{"title":"Swissprot数据库的本地化与序列比对并与其他数据库快速mapping","slug":"Swissprot数据库的本地化与序列比对","date":"2021-09-28T08:13:44.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Swissprot数据库的本地化与序列比对.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-1.jpg","content":"<h1 id=\"数据库下载与构建\"><a href=\"#数据库下载与构建\" class=\"headerlink\" title=\"数据库下载与构建\"></a>数据库下载与构建</h1><h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/complete/uniprot_sprot.fasta.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构建\"><a href=\"#构建\" class=\"headerlink\" title=\"构建\"></a>构建</h2><ul>\n<li><p>解压缩</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gunzip -d uniprot_sprot.fasta.gz</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>构建blast+数据库</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">makeblastdb -<span class=\"keyword\">in</span> uniprot_sprot.fasta -dbtype prot -out uniprot_sprot -parse_seqids</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>构建DIAMOND数据库</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">diamond makedb --<span class=\"keyword\">in</span> uniprot_sprot.fasta -d uniprot_sprot_diamond</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"比对\"><a href=\"#比对\" class=\"headerlink\" title=\"比对\"></a>比对</h1><ul>\n<li><p>blastp蛋白比对</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blastp -query F01.faa -out F01.swissprot -db /new_data/hualin/db/uniprot_sprot -outfmt 6 -num_threads 30 -evalue 1e-5</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>diamond蛋白比对</p>\n<ul>\n<li><p>单个基因组对比</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">diamond blastp -d /new_data/hualin/db/uniprot_sprot_diamond -q F01.faa -e 1e-5 -f 6 -o F01.diamond -k 1 --sensitive -p 30 --query-cover 50</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>多个个基因组对比</p>\n<p>不会shell没办法，写Perl脚本(run_diamond.pl)来完成。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\">   <span class=\"keyword\">use</span> strict;</span><br><span class=\"line\">   <span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 28, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">my</span> @faa = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.faa&quot;</span>);<span class=\"comment\"># 读取所有后缀为“.faa”的文件，可以自己更改</span></span><br><span class=\"line\">   <span class=\"keyword\">foreach</span>  (@faa) &#123;</span><br><span class=\"line\">    $_=~<span class=\"regexp\">/(.+).faa/</span>;</span><br><span class=\"line\">    <span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;.diamond&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\"># 将/new_data/hualin/db/uniprot_sprot_diamond换成自己的数据库路径; -p表示线程数，在笔记本上用6个即可</span></span><br><span class=\"line\">    <span class=\"keyword\">system</span>(<span class=\"string\">&quot;diamond blastp -d /new_data/hualin/db/uniprot_sprot_diamond -q $_ -e 1e-5 -f 6 -o $out -k 1 --sensitive -p 30 --query-cover 50&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>将上述代码复制到文件中，命名为“run_diamond.pl”，将其和序列文件放在同一目录下，并在终端中输入如下命令，完成分析：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl run_diamond.pl</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"将比对结果mapping至其他数据库\"><a href=\"#将比对结果mapping至其他数据库\" class=\"headerlink\" title=\"将比对结果mapping至其他数据库\"></a>将比对结果mapping至其他数据库</h1><ul>\n<li><p>打开网址<a href=\"https://www.uniprot.org/uploadlists/\">https://www.uniprot.org/uploadlists/</a>, 上传比对上的swissprot ID，可以将比对结果转换为诸如KEGG等其他数据库的ID。个人感觉不是很好用。</p>\n</li>\n<li><p>我们可以把mapping文件下载下来，自己写脚本来提取信息，虽然麻烦些，但得到的更多。</p>\n<ul>\n<li><p>下载mapping文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/idmapping_selected.tab.gz</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>解压缩</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gunzip -d idmapping_selected.tab.gz</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>写脚本提取对应信息</p>\n<p> Diamond比对的结果文件内容如下，第一列是自己的氨基酸序列ID，第二列是SwissProt数据库中序列的ID，而我们真正需要的是第二列中两个竖线中间的内容，在稍后的脚本中将通过正则表达式把它给揪出来。</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F01<span class=\"built_in\">_</span>00001\tsp|Q73G44|MDH<span class=\"built_in\">_</span>WOLPM\t47.2\t72\t38\t0\t10\t81\t243\t314\t9.55e-16\t72.8</span><br><span class=\"line\">   F01<span class=\"built_in\">_</span>00003\tsp|D9PU00|TFRA<span class=\"built_in\">_</span>METTM\t41.3\t569\t301\t7\t7\t574\t4\t540\t4.89e-131\t397</span><br><span class=\"line\">   F01<span class=\"built_in\">_</span>00004\tsp|P9WN88|FRDB<span class=\"built_in\">_</span>MYCTO\t32.7\t208\t118\t6\t19\t215\t23\t219\t3.84e-28\t110</span><br><span class=\"line\">   F01<span class=\"built_in\">_</span>00005\tsp|Q021N6|SUCC<span class=\"built_in\">_</span>SOLUE\t62.8\t384\t141\t2\t1\t383\t1\t383\t1.45e-155\t446</span><br></pre></td></tr></table></figure>\n\n<p>开始写脚本，保存为“run_mapping.pl”。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 28, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> %maps;</span><br><span class=\"line\"><span class=\"keyword\">my</span> @diaout = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.diamond&quot;</span>);<span class=\"comment\"># 读取所有的diamond比对后的输出文件</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@diaout) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(\\S+).diamond/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> %hash;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span>;</span><br><span class=\"line\">\t\t$lines[<span class=\"number\">1</span>]=~<span class=\"regexp\">/.+\\|(.+)\\|.+/</span>;</span><br><span class=\"line\">\t\t$hash&#123;$1&#125;++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;idmapping_selected.tab&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">exists</span> $hash&#123;$lines[<span class=\"number\">0</span>]&#125;) &#123;</span><br><span class=\"line\">\t\t\t$maps&#123;$lines[<span class=\"number\">0</span>]&#125; = $_;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @diaout2 = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.diamond&quot;</span>);<span class=\"comment\"># 读取所有的diamond比对后的输出文件</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@diaout2) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(\\S+).diamond/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;.mapped&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;$out&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;qseqid\\tsseqid\\tpident\\tlength\\tmismatch\\tgapopen\\tqstart\\tqend\\tsstart\\tsend\\tevalue\\tbitscore\\tUniProtKB-AC\tUniProtKB-ID\tGeneID (EntrezGene)\tRefSeq\tGI\tPDB\tGO\tUniRef100\tUniRef90\tUniRef50\tUniParc\tPIR\tNCBI-taxon\tMIM\tUniGene\tPubMed\tEMBL\tEMBL-CDS\tEnsembl\tEnsembl_TRS\tEnsembl_PRO\tAdditional PubMed\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span>;</span><br><span class=\"line\">\t\t$lines[<span class=\"number\">1</span>]=~<span class=\"regexp\">/.+\\|(.+)\\|.+/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">exists</span> $maps&#123;$1&#125;) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT $_ . <span class=\"string\">&quot;\\t&quot;</span> . $maps&#123;$1&#125; . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT $_ . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> OUT;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将脚本与diamond比对的结果文件以及下载的mapping文件放在同一目录下，在终端里输入如下命令即可得到mapping后的结果：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl run_mapping.pl</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"GO-注释\"><a href=\"#GO-注释\" class=\"headerlink\" title=\"GO 注释\"></a>GO 注释</h1><ul>\n<li><p>从map后的文件中提取基因ID和GO number，各列以制表符分隔，没有GO注释的只输出gene ID。</p>\n<p>  准备脚本，命名为“get_GO.pl”，与上一步生成的“*.mapped”文件放在同一目录下。</p>\n  <figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 28, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @mapped = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;*.mapped&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@mapped) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/(.+).mapped/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, <span class=\"string\">&quot;$_&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = $1 . <span class=\"string\">&quot;.GO&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> OUT, <span class=\"string\">&quot;&gt;$out&quot;</span> || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t&lt;IN&gt;;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">my</span> @lines = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\t/</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> OUT $lines[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ($lines[<span class=\"number\">18</span>]=~<span class=\"regexp\">/.+\\; /</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">my</span> @terms = <span class=\"keyword\">split</span> <span class=\"regexp\">/\\; /</span>, $lines[<span class=\"number\">18</span>];<span class=\"comment\"># 18代表文件的第19列</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t&quot;</span> . <span class=\"keyword\">join</span>(<span class=\"string\">&quot;\\t&quot;</span>, @terms) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">elsif</span> ($lines[<span class=\"number\">18</span>]=~<span class=\"regexp\">/\\S+/</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\t&quot;</span> . $lines[<span class=\"number\">18</span>] . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">print</span> OUT <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> OUT;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  在终端或者Windows命令行中运行如下命令，得到的“*.GO”为输出文件。</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl get_GO.pl</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>GO注释与可视化</p>\n</li>\n</ul>\n<p>访问网页<a href=\"https://wego.genomics.cn/\">WEGO 2.0</a>，在网页中间位置是数据传输接口，将刚刚得到的所有结果文件拖拽上传，<strong>File format</strong>选择<u>Native Format</u>，如果自己的数据是模式物种，可以在<strong>Reference</strong>中选择对应的物种，点击<strong>Submit</strong>即可。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"在WEGO 2.0网页提交数据\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"WEGO 2.0分析结果一览表\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-3.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/e922-3.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"WEGO 2.0分析结果柱状图\"></p>\n<h1 id=\"脚本获取\"><a href=\"#脚本获取\" class=\"headerlink\" title=\"脚本获取\"></a>脚本获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“e922”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"Functional genomics","path":"api/tags/Functional genomics.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"生信软件","path":"api/tags/生信软件.json"}]},{"title":"根据assession number批量从NCB下载数据","slug":"根据assession-number批量从NCB下载数据","date":"2021-09-28T03:26:24.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/根据assession-number批量从NCB下载数据.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","content":"<p>有时候我们手里会得到一些NCBI的assession number，且数量比较多，而我们真正需要的是序列，这时候手动挨个搜索和下载是不太现实的，除非是你闲得无事可做。其实有一个网页是可以批量下载序列的，即<a href=\"https://www.ncbi.nlm.nih.gov/sites/batchentrez\">https://www.ncbi.nlm.nih.gov/sites/batchentrez</a> ，下面演示一下其用法。<strong>请就着文末视频食用。</strong></p>\n<ul>\n<li><p>首先，<u>准备一份列表文件，其中包含需要下载序列的IDs，每行一个ID</u>。这里有一个从网上下载的CaZY数据库，本以为是序列文件，下载后才发现里面没有序列。这个文件包含三列，以制表符分隔各列，最后一列是Assession number，因此前两列可以删掉。可以将文件内容复制到Excel中，删除前两列，将最后一列复制到一个新的文本文档中。也可以在支持正则表达式的文本编辑器中直接查找替换。<strong>刚刚的示例文件可以从<a href=\"http://www.cazy.org/IMG/cazy_data/cazy_data.zip\">这里</a>下载</strong>。正则表达式查找的公式为“.+\\t(.+)”，其中“.+”代表的是任意多个字符，“\\t”匹配的是制表符，+是贪婪的，一直遇到最后一个“\\t”才终止匹配。即“.+\\t”匹配的是前两列以及第二列后面的制表符，最后的“(.+)”匹配的是第三列。小括号的作用是捕获匹配的内容。替换的公式为“$1”，表示第一个小括号内的内容，即第三列。</p>\n</li>\n<li><p>接下来将得到的列表文件提交至网站上以下载序列，需要选择对应的数据库，这里选择protein，点击“Retrieve”开始下载。由于序列较多，因此反应比较慢，需要耐心等待。估计是崩了，再试一遍，文件包含2650471个ID，估计服务器吃不消，实在不行就拆分成几个文件，分批次下载。我这里用的是EmEditor软件，按照10000行每个文件对整个文件进行了拆分，得到了266个文件，现在拿其中的一个做演示，看看服务器是否吃得消。看来一万个也太多，二十几个试了一下，莫得问题。方法就是酱紫的，至于可以一次性下载多少，各位自己去试吧。搞定！</p>\n</li>\n<li><p><strong>兄弟们不用试了，我已经试过了，一次只能搞几百个</strong>，对于几十万行的列表来说，手动逐个提交也是要命的，因此我写了一个Perl脚本(download_NCBI.pl)来完成该任务，<u>不过只能在Linux下运行</u>，代码如下：</p>\n</li>\n</ul>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/perl</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> strict;</span><br><span class=\"line\"><span class=\"keyword\">use</span> warnings;</span><br><span class=\"line\"><span class=\"keyword\">use</span> LWP::Simple;</span><br><span class=\"line\"><span class=\"comment\"># Author: Liu hualin</span></span><br><span class=\"line\"><span class=\"comment\"># Date: Sep 28, 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Usage: perl download_NCBI.pl 列表文件 序列类型（参照https://www.ncbi.nlm.nih.gov/sites/batchentrez数据库填写，常用的包括nucleotide, protein）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @ids;</span><br><span class=\"line\"><span class=\"keyword\">my</span> $dbtype = $ARGV[<span class=\"number\">1</span>];<span class=\"comment\"># nucleotide, protein</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">system</span>(<span class=\"string\">&quot;split -l 300 $ARGV[0] splited_&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">my</span> @splited = <span class=\"keyword\">glob</span>(<span class=\"string\">&quot;splited_*&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>  (@splited) &#123;</span><br><span class=\"line\">\t$_=~<span class=\"regexp\">/splited_(.+)/</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">my</span> $out = <span class=\"string\">&quot;seqs.$1.fasta&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">open</span> IN, $_ || <span class=\"keyword\">die</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (&lt;IN&gt;) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">chomp</span>;</span><br><span class=\"line\">\t\t$_=~<span class=\"regexp\">s/[\\r\\n]+//g</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">push</span> @ids, $_;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tgetstore(<span class=\"string\">&quot;http://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=$dbtype&amp;rettype=fasta&amp;retmode=text&amp;id=&quot;</span>.join(<span class=\"string\">&quot;,&quot;</span>, @ids),<span class=\"string\">&quot;$out&quot;</span>);</span><br><span class=\"line\">\t@ids = ();</span><br><span class=\"line\">\t<span class=\"keyword\">close</span> IN;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">system</span>(<span class=\"string\">&quot;cat seqs.* &gt; All.sequences.fas&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">system</span>(<span class=\"string\">&quot;rm splited_* seqs.*&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>运行方法也贼简单，将脚本和列表文件放在同一目录下，然后在Linux终端里输入如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">perl download_NCBI.pl cazy_ids.txt protein</span><br></pre></td></tr></table></figure>\n\n<p>其中cazy_ids.txt为包含assession number的列表文件，protein表示列表里的ID是蛋白。最后面的这个参数可以在<a href=\"https://www.ncbi.nlm.nih.gov/sites/batchentrez\">https://www.ncbi.nlm.nih.gov/sites/batchentrez</a> 左上角的Database查询，<strong>但是要全部小写</strong>。</p>\n<p>运行一下，看看效果！</p>\n<p><font color=\"#FF0000\">2000 years later…</font></p>\n<p>2650471&#x2F;300&#x3D;8835个文件，最终生成的序列文件名称为“All.sequences.fas”，中间过程文件会被自动删除。千年以后拿结果，不管怎么说，总算解放了双手，让电脑慢慢去跑吧！</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=378319348&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<h1 id=\"脚本获取\"><a href=\"#脚本获取\" class=\"headerlink\" title=\"脚本获取\"></a>脚本获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“e7e9”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"CAZy","path":"api/tags/CAZy.json"},{"name":"NCBI","path":"api/tags/NCBI.json"},{"name":"下载","path":"api/tags/下载.json"}]},{"title":"Perl处理可恶的Windows换行符","slug":"Perl处理可恶的Windows换行符","date":"2021-09-27T12:13:15.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Perl处理可恶的Windows换行符.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>每次在Windows下运行Perl，或者通过Perl处理Windows系统生成的文件时，行尾总会有隐藏的换行符删不掉，chomp毛用都没有。处理后的文件在文本阅读器如TXT、EditPlus等中是看不到换行符的，然而当将文本内容拷贝到Excel表格中时，明明应该在一行的内容却变成了两行，这便是隐藏的换行符在捣鬼。疑惑、愤怒、迷茫的情绪交织在一起，伴随着一声声的“哪儿错了”却不知所措，其实只要通过下面一句代码干掉那些隐藏的换行符就万事大吉了。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$_=~<span class=\"regexp\">s/[\\n\\r]+$//</span>;</span><br></pre></td></tr></table></figure>\n\n<p>上述命令表示通过查找替换的方式去除当前行末尾的所有换行符。</p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"perl","path":"api/tags/perl.json"},{"name":"编程","path":"api/tags/编程.json"}]},{"title":"扩增子系之绘制物种分类堆叠图","slug":"扩增子系之绘制物种分类堆叠图","date":"2021-09-27T09:09:53.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子系之绘制物种分类堆叠图.json","excerpt":null,"keywords":null,"cover":null,"content":"<p><strong>为何要手绘堆叠图？</strong><br>QIIME2虽然可以生成堆叠图，然而图片只能在网页上查看，无法下载。此外，QIIME2的图有几分丑，且不可个性化修改，因此，手绘最靠谱。手绘当然不是用手画，而是用手敲代码。</p>\n<h1 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h1><ul>\n<li>各级别的物种分布文件，可以直接从QIIME2 生成的taxa_barplot.qzv文件提交至 <a href=\"https://view.qiime2.org/\">https://view.qiime2.org</a> ，随后从网页左上角“CSV”按钮处导出各分类级别的丰度表，但是要删除风度表最后几列的元数据信息，只保留丰度信息，各列之间以逗号分隔，内容如下所示，该文件是LEVEL-2（Phylum）水平的物种丰度分布：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index,Bacteria;Chloroflexi,Bacteria;Planctomycetota,Archaea;Nanoarchaeota,Bacteria;Patescibacteria,Bacteria;Proteobacteria,Bacteria;Actinobacteriota,Archaea;Aenigmarchaeota,Bacteria;Acidobacteriota,Archaea;Altiarchaeota,Bacteria;Firmicutes,Bacteria;Bdellovibrionota,Bacteria;Dependentiae,Bacteria;Spirochaetota,Bacteria;Margulisbacteria,Bacteria;Myxococcota,Archaea;Halobacterota,Archaea;Crenarchaeota,Bacteria;Latescibacterota,Bacteria;NB1-j,Bacteria;Desulfobacterota,Bacteria;Verrucomicrobiota,Archaea;Iainarchaeota,Bacteria;DTB120,Bacteria;Elusimicrobiota,Eukaryota;SAR,Archaea;Asgardarchaeota,Archaea;Euryarchaeota,Bacteria;CK-2C2-2,Bacteria;Sva0485,Archaea;Thermoplasmatota,Bacteria;Bacteroidota,Bacteria;Marinimicrobia (SAR406 clade),Bacteria;MBNT15,Bacteria;Nitrospinota,Bacteria;Zixibacteria,Bacteria;Nitrospirota,Archaea;Micrarchaeota,Bacteria;LCP-89,Bacteria;Armatimonadota,Bacteria;WOR-1,Bacteria;Gemmatimonadota,Bacteria;Fibrobacterota,Bacteria;Calditrichota,Bacteria;Sumerlaeota,Bacteria;Aerophobota,Bacteria;WS1,Bacteria;NKB15,Bacteria;SAR324 clade(Marine group B),Bacteria;Dadabacteria,Bacteria;BHI80-139,Bacteria;Desantisbacteria,Bacteria;Schekmanbacteria,Archaea;Hadarchaeota,Archaea;Hydrothermarchaeota,Bacteria;Caldatribacteriota,Bacteria;TA06,Bacteria;WS2,Eukaryota;Amorphea,Bacteria;Cyanobacteria,Bacteria;Hydrogenedentes,Bacteria;Cloacimonadota,Bacteria;WPS-2,Bacteria;Modulibacteria,Eukaryota;Archaeplastida,Bacteria;10bav-F6,Bacteria;Methylomirabilota,Bacteria;Deferrisomatota,Bacteria;Fusobacteriota,Bacteria;Fermentibacterota,Bacteria;Entotheonellaeota,Eukaryota;Discoba,Bacteria;Campylobacterota,Bacteria;PAUC34f,Bacteria;Poribacteria,Bacteria;AncK6,Bacteria;GN01,Bacteria;Acetothermia,Bacteria;FCPU426</span><br><span class=\"line\">B01,383,1058,157,274,7755,1317,0,1025,0,39,22,16,0,0,71,0,6841,20,633,49,145,0,0,0,247,13,0,0,0,13,1012,0,0,53,0,137,0,0,39,0,271,7,17,4,0,0,0,7,471,0,0,0,0,0,3,0,0,69,3,53,0,0,0,0,0,46,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B02,225,507,98,27,3279,228,0,522,0,10,4,0,0,0,25,0,7995,8,336,6,54,0,0,0,9,4,0,0,0,0,259,0,12,65,0,29,0,0,0,0,163,0,16,0,0,0,0,22,106,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,71,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B03,196,360,246,38,2605,119,0,587,0,8,5,0,0,0,172,0,11619,16,370,11,0,3,0,0,13,0,0,0,0,0,206,5,0,83,8,67,0,0,0,0,130,0,5,0,0,0,0,27,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B04,437,922,636,61,4209,195,0,1051,0,9,5,6,0,0,274,0,14573,22,628,5,88,9,0,0,17,8,0,0,0,26,271,14,0,129,7,95,0,0,0,0,219,0,20,0,0,0,0,84,145,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,467,0,0,0,5,0,0,12,0,0,0,0,0</span><br><span class=\"line\">B05,240,1159,187,26,2929,149,0,778,0,8,0,0,0,0,204,0,10918,26,473,0,20,0,0,7,10,8,0,0,0,0,193,9,0,209,0,96,0,0,2,0,244,3,19,0,0,0,0,131,125,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,532,0,0,0,12,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B06,211,2003,1380,168,2469,188,12,617,3,13,4,15,7,2,196,0,7802,16,383,47,94,0,0,22,7,43,25,0,0,84,223,33,0,244,5,112,0,0,0,0,204,8,28,8,0,0,0,69,105,0,5,0,0,8,0,0,0,0,0,0,0,0,0,0,0,639,0,0,0,9,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B07,231,2607,4129,694,2667,231,20,399,12,36,10,21,37,0,156,0,5611,47,453,76,93,112,0,16,21,187,53,0,0,267,196,73,0,106,0,74,0,0,0,24,169,8,37,6,6,0,5,82,118,0,7,0,0,0,0,0,0,4,0,0,0,0,0,0,0,399,0,0,0,8,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B08,228,2573,4942,604,2084,150,51,507,7,14,0,22,32,2,109,0,6026,28,269,58,156,94,0,31,7,193,21,0,0,264,220,11,4,212,0,67,4,0,0,65,113,3,26,0,0,0,0,81,108,0,0,5,0,0,0,0,0,0,0,13,0,0,0,0,0,468,0,0,0,21,0,0,7,0,0,0,0,0</span><br><span class=\"line\">B09,606,3235,2950,1247,1922,696,52,487,16,21,20,84,12,0,107,0,1559,80,341,478,198,148,0,34,63,131,6,3,9,144,141,30,6,106,13,87,42,0,4,0,205,6,76,5,8,11,8,142,70,9,0,3,0,15,0,0,0,0,0,7,0,0,0,0,0,508,0,0,0,18,0,5,0,0,0,0,0,0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>样本元数据，描述各样本特征的文件，以制表符分隔各列，内容如下：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ID\tSamples\tLayer\tDepth\tLocation\tPosition\tSite</span><br><span class=\"line\">B01\tB01\t0-1\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B02\tB02\t1-2\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B03\tB03\t2-3\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B04\tB04\t3-4\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B05\tB05\t4-5\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B06\tB06\t5-6\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B07\tB07\t6-7\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B08\tB08\t7-8\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B09\tB09\t8-9\t10\tRight\tDownstream\tB</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><p><strong>建议在Rstudio中运行。</strong></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先需要安装依赖包“amplicon”，如果没有安装“devtools”需要先安装，命令如下：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装依赖包“amplicon”，我对原作者的程序做了些许的优化，所以，可以从我的GitHub进行安装，命令如下：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，视自己的具体情况而定，工作目录中当包含输入文件：</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;E:/Researches/Xiaqian/NGS/CleanData/ALL/细菌V6V8-1/Analysis_20210624/barplot&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制堆叠柱状图，颜色自定义。界水平物种组成表和元数据作为输入，分组列名为Group，显示前4个分类，其余归类为其他(Other)，按丰度排序。</span></span><br><span class=\"line\">otutab1<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-1.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab1<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组，通过“groupID”参数设置分组信息，这里我选择根据站位（Site）分组，用户当根据自己的实际情况来设置。</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ds<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ds2 <span class=\"operator\">=</span> ds <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 出图</span></span><br><span class=\"line\">ds2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>dd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dd2 <span class=\"operator\">=</span> dd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>pd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pd2 <span class=\"operator\">=</span> pd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 纲水平物种组成表和元数据作为输入，分组列名为Group，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab3<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-3.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;\\&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab3<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>cs<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cs2 <span class=\"operator\">=</span> cs <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cs2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>cd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd2 <span class=\"operator\">=</span> cd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 属水平物种组成表和元数据作为输入，分组列名为Site，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab6<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-6.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab6<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>gs<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs2 <span class=\"operator\">=</span> gs <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>gd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gd2 <span class=\"operator\">=</span> gd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gd2</span><br></pre></td></tr></table></figure>\n\n<p>最后的图可以在Rstudio中手动导出。</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=378319348&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]},{"title":"扩增子可视化专题","slug":"扩增子可视化专题","date":"2021-09-15T03:23:28.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子可视化专题.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>扩增子分析较常用的软件是QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将QIIME2生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a href=\"#准备数据\" class=\"headerlink\" title=\"准备数据\"></a>准备数据</h1><ul>\n<li>特征表（Feature table），或者叫做OTU表，本教程中文件名为<strong>feature-table.tsv</strong>。该文件可由QIIME2生成，由biome格式转换而来。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>6</span><br><span class=\"line\">3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">d2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">b624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0</span><br><span class=\"line\">60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong>sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite</span><br><span class=\"line\">F01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>6\tH2<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>分类信息，本教程中文件名为<strong>taxonomy.tsv</strong>。该文件可由QIIME2生成。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature ID\tTaxon\tConfidence</span><br><span class=\"line\">9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045</span><br><span class=\"line\">2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394</span><br><span class=\"line\">5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067</span><br><span class=\"line\">cc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506</span><br><span class=\"line\">5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154</span><br><span class=\"line\">d62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316</span><br><span class=\"line\">920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409</span><br><span class=\"line\">b5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555</span><br><span class=\"line\">43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367</span><br><span class=\"line\">0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901</span><br><span class=\"line\">430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459</span><br><span class=\"line\">0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>进化树，本教程中文件名为<strong>tree.nwk</strong>。该文件可由QIIME2生成，Newick格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr>\n<h1 id=\"Alpha-diversity\"><a href=\"#Alpha-diversity\" class=\"headerlink\" title=\"Alpha diversity\"></a>Alpha diversity</h1><h2 id=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\"><a href=\"#Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\" class=\"headerlink\" title=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化\"></a>Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化</h2><h3 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步：计算多样性\"><a href=\"#第一步：计算多样性\" class=\"headerlink\" title=\"第一步：计算多样性\"></a>第一步：计算多样性</h3><p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\">#定义函数</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span>       <span class=\"comment\">#picante 包加载时默认同时加载 vegan</span></span><br><span class=\"line\"> </span><br><span class=\"line\">alpha <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"built_in\">exp</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        est <span class=\"operator\">&lt;-</span> estimateR<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Richness <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Chao1 <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        ACE <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Shannon <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;shannon&#x27;</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Simpson <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;simpson&#x27;</span><span class=\"punctuation\">)</span>    <span class=\"comment\">#Gini-Simpson 指数</span></span><br><span class=\"line\">        Pielou <span class=\"operator\">&lt;-</span> Shannon <span class=\"operator\">/</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        goods_coverage <span class=\"operator\">&lt;-</span> 1 <span class=\"operator\">-</span> rowSums<span class=\"punctuation\">(</span>x <span class=\"operator\">==</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">/</span> rowSums<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        result <span class=\"operator\">&lt;-</span> data.frame<span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> Shannon<span class=\"punctuation\">,</span> Simpson<span class=\"punctuation\">,</span> Pielou<span class=\"punctuation\">,</span> Chao1<span class=\"punctuation\">,</span> ACE<span class=\"punctuation\">,</span> goods_coverage<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                PD_whole_tree <span class=\"operator\">&lt;-</span> pd<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> include.root <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">                <span class=\"built_in\">names</span><span class=\"punctuation\">(</span>PD_whole_tree<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"string\">&#x27;PD_whole_tree&#x27;</span></span><br><span class=\"line\">                result <span class=\"operator\">&lt;-</span> cbind<span class=\"punctuation\">(</span>result<span class=\"punctuation\">,</span> PD_whole_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        result</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#加载 OTU 丰度表和进化树文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&#x27;feature-table.tsv&#x27;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&#x27;\\t&#x27;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> check.names <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\">tree <span class=\"operator\">&lt;-</span> read.tree<span class=\"punctuation\">(</span><span class=\"string\">&#x27;tree.nwk&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\"><span class=\"comment\">##alpha_all &lt;- alpha(otu, base = 2)</span></span><br><span class=\"line\"><span class=\"comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\">alpha_all <span class=\"operator\">&lt;-</span> alpha<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#输出保存在本地</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>alpha_all<span class=\"punctuation\">,</span> <span class=\"string\">&#x27;alpha.txt&#x27;</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第二步：制图\"><a href=\"#第二步：制图\" class=\"headerlink\" title=\"第二步：制图\"></a>第二步：制图</h3><p>这一步需要在Rstudio中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出7个PDF图形文件。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载github包安装工具</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测amplicon包是否安装，没有从源码安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># library加载包，suppress不显示消息和警告信息</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，根据实际情况设定</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span></span><br><span class=\"line\">metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#alpha_div = read.table(&quot;alpha.txt&quot;, header=T, row.names=1, sep=&quot;\\t&quot;, comment.char=&quot;&quot;)</span></span><br><span class=\"line\">alpha_div <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha.txt&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p1 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Shannon&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##物种丰富度 Richness 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p2 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Richness&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p3 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Simpson&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Chao1 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p4 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ACE 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p5 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;ACE&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Shannon 均匀度（Pielou 均匀度）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p6 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Pielou&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##谱系多样性</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p7 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;PD_whole_tree&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_shannon.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p1<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Richness.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p2<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Simpson.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p3<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Chao1.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p4<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_ACE.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p5<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Pielou.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p6<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_PD_whole_tree.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p7<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"演示视频\"><a href=\"#演示视频\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h2 id=\"物种多样性条形图的绘制\"><a href=\"#物种多样性条形图的绘制\" class=\"headerlink\" title=\"物种多样性条形图的绘制\"></a>物种多样性条形图的绘制</h2><h3 id=\"输入文件-1\"><a href=\"#输入文件-1\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>处理后的Feature Table</li>\n</ul>\n<p>从QIIME2可视化网站上下载的各level的物种丰度表，此处以level-2（Phylum水平）为例，命名为“level-2.csv”。该文件可以用excel或WPS打开，然后复制所有内容至一个新建的名字为“level-2.txt”的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index\tspecies1\tspecies2\tspecies3\tspecies4</span><br><span class=\"line\">Sample1\t0\t8152\t11\t65</span><br><span class=\"line\">Sample2\t12\t97\t1097\t1315</span><br><span class=\"line\">...</span><br><span class=\"line\">Samplex\t15\t46\t2928\t1011</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a href=\"#绘图\" class=\"headerlink\" title=\"绘图\"></a>绘图</h3><p>以下代码在Rstudio中逐步输入运行</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的路径&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;microbiota/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据，特征表和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.txt&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-1\"><a href=\"#演示视频-1\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h1 id=\"Beta多样性\"><a href=\"#Beta多样性\" class=\"headerlink\" title=\"Beta多样性\"></a>Beta多样性</h1><h2 id=\"NMDS分析及可视化\"><a href=\"#NMDS分析及可视化\" class=\"headerlink\" title=\"NMDS分析及可视化\"></a>NMDS分析及可视化</h2><h3 id=\"输入文件-2\"><a href=\"#输入文件-2\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h3><p>在Rstudio中运行如下代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;vegan&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;feature-table.tsv&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">design <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span>header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据调整为列名是OTU，行名是样本名</span></span><br><span class=\"line\">otu<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span></span><br><span class=\"line\">vare.hel<span class=\"operator\">&lt;-</span>decostand<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;hellinger&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bray-curtis距离矩阵</span></span><br><span class=\"line\">vare.dis <span class=\"operator\">&lt;-</span> vegdist<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用NMDS的方法</span></span><br><span class=\"line\">vare.mds <span class=\"operator\">&lt;-</span> metaMDS<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>distance <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 首先提取前两轴坐标</span></span><br><span class=\"line\">point <span class=\"operator\">=</span> scores<span class=\"punctuation\">(</span>vare.mds<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将分组文件和得分文件合并</span></span><br><span class=\"line\">index <span class=\"operator\">=</span> merge<span class=\"punctuation\">(</span>design<span class=\"punctuation\">,</span> point<span class=\"punctuation\">,</span>by<span class=\"operator\">=</span><span class=\"string\">&quot;row.names&quot;</span><span class=\"punctuation\">,</span><span class=\"built_in\">all</span><span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看Stress值</span></span><br><span class=\"line\"><span class=\"comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span></span><br><span class=\"line\">vare.mds</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span></span><br><span class=\"line\">anosim.result<span class=\"operator\">&lt;-</span>anosim<span class=\"punctuation\">(</span>vare.dis<span class=\"punctuation\">,</span> design<span class=\"operator\">$</span>Depth<span class=\"punctuation\">,</span>permutations <span class=\"operator\">=</span><span class=\"number\">999</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">summary<span class=\"punctuation\">(</span>anosim.result<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"><span class=\"comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span></span><br><span class=\"line\"><span class=\"comment\">#tiff(file=&quot;beta_bray_NMDS.tiff&quot;, res = 300, compression =&quot;none&quot;, width=180,height=140,units= &quot;mm&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;beta_bray_NMDS.pdf&quot;</span><span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">180</span><span class=\"punctuation\">,</span>height<span class=\"operator\">=</span><span class=\"number\">140</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开始出图，代码如下：</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggplot2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p <span class=\"operator\">=</span> ggplot<span class=\"punctuation\">(</span>index<span class=\"punctuation\">,</span> aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> color<span class=\"operator\">=</span>as.factor<span class=\"punctuation\">(</span>Depth<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">      geom_point<span class=\"punctuation\">(</span>size<span class=\"operator\">=</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">     <span class=\"comment\">#scale_colour_manual(values = c(&quot;red&quot;,&quot;blue&quot;, &quot;green&quot;)) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span></span><br><span class=\"line\">     labs<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS1&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> title<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span>stat_ellipse<span class=\"punctuation\">(</span>type <span class=\"operator\">=</span> <span class=\"string\">&quot;t&quot;</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> level <span class=\"operator\">=</span> <span class=\"number\">0.95</span><span class=\"punctuation\">,</span> show.legend <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.25</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;R: &#x27;*0.8036&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.35</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;p: &#x27;*0.001&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.45</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;Stress: &#x27;*0.075&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_point<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> shape<span class=\"operator\">=</span>Site<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> size<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">\t<span class=\"comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span></span><br><span class=\"line\">    theme_classic<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-2\"><a href=\"#演示视频-2\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]}]}