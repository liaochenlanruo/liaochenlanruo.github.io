{"total":135,"pageSize":10,"pageCount":14,"data":[{"title":"Perl处理可恶的Windows换行符","slug":"Perl处理可恶的Windows换行符","date":"2021-09-27T12:13:15.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Perl处理可恶的Windows换行符.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>每次在Windows下运行Perl，或者通过Perl处理Windows系统生成的文件时，行尾总会有隐藏的换行符删不掉，chomp毛用都没有。处理后的文件在文本阅读器如TXT、EditPlus等中是看不到换行符的，然而当将文本内容拷贝到Excel表格中时，明明应该在一行的内容却变成了两行，这便是隐藏的换行符在捣鬼。疑惑、愤怒、迷茫的情绪交织在一起，伴随着一声声的“哪儿错了”却不知所措，其实只要通过下面一句代码干掉那些隐藏的换行符就万事大吉了。</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$_=~<span class=\"regexp\">s/[\\n\\r]+$//</span>;</span><br></pre></td></tr></table></figure>\n\n<p>上述命令表示通过查找替换的方式去除当前行末尾的所有换行符。</p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"perl","path":"api/tags/perl.json"},{"name":"编程","path":"api/tags/编程.json"}]},{"title":"扩增子系之绘制物种分类堆叠图","slug":"扩增子系之绘制物种分类堆叠图","date":"2021-09-27T09:09:53.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子系之绘制物种分类堆叠图.json","excerpt":null,"keywords":null,"cover":null,"content":"<p><strong>为何要手绘堆叠图？</strong><br>QIIME2虽然可以生成堆叠图，然而图片只能在网页上查看，无法下载。此外，QIIME2的图有几分丑，且不可个性化修改，因此，手绘最靠谱。手绘当然不是用手画，而是用手敲代码。</p>\n<h1 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h1><ul>\n<li>各级别的物种分布文件，可以直接从QIIME2 生成的taxa_barplot.qzv文件提交至 <a href=\"https://view.qiime2.org/\">https://view.qiime2.org</a> ，随后从网页左上角“CSV”按钮处导出各分类级别的丰度表，但是要删除风度表最后几列的元数据信息，只保留丰度信息，各列之间以逗号分隔，内容如下所示，该文件是LEVEL-2（Phylum）水平的物种丰度分布：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index,Bacteria;Chloroflexi,Bacteria;Planctomycetota,Archaea;Nanoarchaeota,Bacteria;Patescibacteria,Bacteria;Proteobacteria,Bacteria;Actinobacteriota,Archaea;Aenigmarchaeota,Bacteria;Acidobacteriota,Archaea;Altiarchaeota,Bacteria;Firmicutes,Bacteria;Bdellovibrionota,Bacteria;Dependentiae,Bacteria;Spirochaetota,Bacteria;Margulisbacteria,Bacteria;Myxococcota,Archaea;Halobacterota,Archaea;Crenarchaeota,Bacteria;Latescibacterota,Bacteria;NB1-j,Bacteria;Desulfobacterota,Bacteria;Verrucomicrobiota,Archaea;Iainarchaeota,Bacteria;DTB120,Bacteria;Elusimicrobiota,Eukaryota;SAR,Archaea;Asgardarchaeota,Archaea;Euryarchaeota,Bacteria;CK-2C2-2,Bacteria;Sva0485,Archaea;Thermoplasmatota,Bacteria;Bacteroidota,Bacteria;Marinimicrobia (SAR406 clade),Bacteria;MBNT15,Bacteria;Nitrospinota,Bacteria;Zixibacteria,Bacteria;Nitrospirota,Archaea;Micrarchaeota,Bacteria;LCP-89,Bacteria;Armatimonadota,Bacteria;WOR-1,Bacteria;Gemmatimonadota,Bacteria;Fibrobacterota,Bacteria;Calditrichota,Bacteria;Sumerlaeota,Bacteria;Aerophobota,Bacteria;WS1,Bacteria;NKB15,Bacteria;SAR324 clade(Marine group B),Bacteria;Dadabacteria,Bacteria;BHI80-139,Bacteria;Desantisbacteria,Bacteria;Schekmanbacteria,Archaea;Hadarchaeota,Archaea;Hydrothermarchaeota,Bacteria;Caldatribacteriota,Bacteria;TA06,Bacteria;WS2,Eukaryota;Amorphea,Bacteria;Cyanobacteria,Bacteria;Hydrogenedentes,Bacteria;Cloacimonadota,Bacteria;WPS-2,Bacteria;Modulibacteria,Eukaryota;Archaeplastida,Bacteria;10bav-F6,Bacteria;Methylomirabilota,Bacteria;Deferrisomatota,Bacteria;Fusobacteriota,Bacteria;Fermentibacterota,Bacteria;Entotheonellaeota,Eukaryota;Discoba,Bacteria;Campylobacterota,Bacteria;PAUC34f,Bacteria;Poribacteria,Bacteria;AncK6,Bacteria;GN01,Bacteria;Acetothermia,Bacteria;FCPU426</span><br><span class=\"line\">B01,383,1058,157,274,7755,1317,0,1025,0,39,22,16,0,0,71,0,6841,20,633,49,145,0,0,0,247,13,0,0,0,13,1012,0,0,53,0,137,0,0,39,0,271,7,17,4,0,0,0,7,471,0,0,0,0,0,3,0,0,69,3,53,0,0,0,0,0,46,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B02,225,507,98,27,3279,228,0,522,0,10,4,0,0,0,25,0,7995,8,336,6,54,0,0,0,9,4,0,0,0,0,259,0,12,65,0,29,0,0,0,0,163,0,16,0,0,0,0,22,106,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,71,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B03,196,360,246,38,2605,119,0,587,0,8,5,0,0,0,172,0,11619,16,370,11,0,3,0,0,13,0,0,0,0,0,206,5,0,83,8,67,0,0,0,0,130,0,5,0,0,0,0,27,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B04,437,922,636,61,4209,195,0,1051,0,9,5,6,0,0,274,0,14573,22,628,5,88,9,0,0,17,8,0,0,0,26,271,14,0,129,7,95,0,0,0,0,219,0,20,0,0,0,0,84,145,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,467,0,0,0,5,0,0,12,0,0,0,0,0</span><br><span class=\"line\">B05,240,1159,187,26,2929,149,0,778,0,8,0,0,0,0,204,0,10918,26,473,0,20,0,0,7,10,8,0,0,0,0,193,9,0,209,0,96,0,0,2,0,244,3,19,0,0,0,0,131,125,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,532,0,0,0,12,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B06,211,2003,1380,168,2469,188,12,617,3,13,4,15,7,2,196,0,7802,16,383,47,94,0,0,22,7,43,25,0,0,84,223,33,0,244,5,112,0,0,0,0,204,8,28,8,0,0,0,69,105,0,5,0,0,8,0,0,0,0,0,0,0,0,0,0,0,639,0,0,0,9,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B07,231,2607,4129,694,2667,231,20,399,12,36,10,21,37,0,156,0,5611,47,453,76,93,112,0,16,21,187,53,0,0,267,196,73,0,106,0,74,0,0,0,24,169,8,37,6,6,0,5,82,118,0,7,0,0,0,0,0,0,4,0,0,0,0,0,0,0,399,0,0,0,8,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B08,228,2573,4942,604,2084,150,51,507,7,14,0,22,32,2,109,0,6026,28,269,58,156,94,0,31,7,193,21,0,0,264,220,11,4,212,0,67,4,0,0,65,113,3,26,0,0,0,0,81,108,0,0,5,0,0,0,0,0,0,0,13,0,0,0,0,0,468,0,0,0,21,0,0,7,0,0,0,0,0</span><br><span class=\"line\">B09,606,3235,2950,1247,1922,696,52,487,16,21,20,84,12,0,107,0,1559,80,341,478,198,148,0,34,63,131,6,3,9,144,141,30,6,106,13,87,42,0,4,0,205,6,76,5,8,11,8,142,70,9,0,3,0,15,0,0,0,0,0,7,0,0,0,0,0,508,0,0,0,18,0,5,0,0,0,0,0,0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>样本元数据，描述各样本特征的文件，以制表符分隔各列，内容如下：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ID\tSamples\tLayer\tDepth\tLocation\tPosition\tSite</span><br><span class=\"line\">B01\tB01\t0-1\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B02\tB02\t1-2\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B03\tB03\t2-3\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B04\tB04\t3-4\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B05\tB05\t4-5\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B06\tB06\t5-6\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B07\tB07\t6-7\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B08\tB08\t7-8\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B09\tB09\t8-9\t10\tRight\tDownstream\tB</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><p><strong>建议在Rstudio中运行。</strong></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先需要安装依赖包“amplicon”，如果没有安装“devtools”需要先安装，命令如下：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装依赖包“amplicon”，我对原作者的程序做了些许的优化，所以，可以从我的GitHub进行安装，命令如下：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，视自己的具体情况而定，工作目录中当包含输入文件：</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;E:/Researches/Xiaqian/NGS/CleanData/ALL/细菌V6V8-1/Analysis_20210624/barplot&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制堆叠柱状图，颜色自定义。界水平物种组成表和元数据作为输入，分组列名为Group，显示前4个分类，其余归类为其他(Other)，按丰度排序。</span></span><br><span class=\"line\">otutab1<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-1.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab1<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组，通过“groupID”参数设置分组信息，这里我选择根据站位（Site）分组，用户当根据自己的实际情况来设置。</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ds<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ds2 <span class=\"operator\">=</span> ds <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 出图</span></span><br><span class=\"line\">ds2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>dd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dd2 <span class=\"operator\">=</span> dd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>pd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pd2 <span class=\"operator\">=</span> pd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 纲水平物种组成表和元数据作为输入，分组列名为Group，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab3<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-3.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;\\&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab3<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>cs<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cs2 <span class=\"operator\">=</span> cs <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cs2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>cd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd2 <span class=\"operator\">=</span> cd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 属水平物种组成表和元数据作为输入，分组列名为Site，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab6<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-6.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab6<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>gs<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs2 <span class=\"operator\">=</span> gs <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>gd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gd2 <span class=\"operator\">=</span> gd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gd2</span><br></pre></td></tr></table></figure>\n\n<p>最后的图可以在Rstudio中手动导出。</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=378319348&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]},{"title":"扩增子可视化专题","slug":"扩增子可视化专题","date":"2021-09-15T03:23:28.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子可视化专题.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>扩增子分析较常用的软件是QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将QIIME2生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a href=\"#准备数据\" class=\"headerlink\" title=\"准备数据\"></a>准备数据</h1><ul>\n<li>特征表（Feature table），或者叫做OTU表，本教程中文件名为<strong>feature-table.tsv</strong>。该文件可由QIIME2生成，由biome格式转换而来。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>6</span><br><span class=\"line\">3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">d2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">b624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0</span><br><span class=\"line\">60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong>sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite</span><br><span class=\"line\">F01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>6\tH2<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>分类信息，本教程中文件名为<strong>taxonomy.tsv</strong>。该文件可由QIIME2生成。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature ID\tTaxon\tConfidence</span><br><span class=\"line\">9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045</span><br><span class=\"line\">2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394</span><br><span class=\"line\">5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067</span><br><span class=\"line\">cc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506</span><br><span class=\"line\">5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154</span><br><span class=\"line\">d62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316</span><br><span class=\"line\">920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409</span><br><span class=\"line\">b5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555</span><br><span class=\"line\">43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367</span><br><span class=\"line\">0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901</span><br><span class=\"line\">430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459</span><br><span class=\"line\">0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>进化树，本教程中文件名为<strong>tree.nwk</strong>。该文件可由QIIME2生成，Newick格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr>\n<h1 id=\"Alpha-diversity\"><a href=\"#Alpha-diversity\" class=\"headerlink\" title=\"Alpha diversity\"></a>Alpha diversity</h1><h2 id=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\"><a href=\"#Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\" class=\"headerlink\" title=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化\"></a>Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化</h2><h3 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步：计算多样性\"><a href=\"#第一步：计算多样性\" class=\"headerlink\" title=\"第一步：计算多样性\"></a>第一步：计算多样性</h3><p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\">#定义函数</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span>       <span class=\"comment\">#picante 包加载时默认同时加载 vegan</span></span><br><span class=\"line\"> </span><br><span class=\"line\">alpha <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"built_in\">exp</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        est <span class=\"operator\">&lt;-</span> estimateR<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Richness <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Chao1 <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        ACE <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Shannon <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;shannon&#x27;</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Simpson <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;simpson&#x27;</span><span class=\"punctuation\">)</span>    <span class=\"comment\">#Gini-Simpson 指数</span></span><br><span class=\"line\">        Pielou <span class=\"operator\">&lt;-</span> Shannon <span class=\"operator\">/</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        goods_coverage <span class=\"operator\">&lt;-</span> 1 <span class=\"operator\">-</span> rowSums<span class=\"punctuation\">(</span>x <span class=\"operator\">==</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">/</span> rowSums<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        result <span class=\"operator\">&lt;-</span> data.frame<span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> Shannon<span class=\"punctuation\">,</span> Simpson<span class=\"punctuation\">,</span> Pielou<span class=\"punctuation\">,</span> Chao1<span class=\"punctuation\">,</span> ACE<span class=\"punctuation\">,</span> goods_coverage<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                PD_whole_tree <span class=\"operator\">&lt;-</span> pd<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> include.root <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">                <span class=\"built_in\">names</span><span class=\"punctuation\">(</span>PD_whole_tree<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"string\">&#x27;PD_whole_tree&#x27;</span></span><br><span class=\"line\">                result <span class=\"operator\">&lt;-</span> cbind<span class=\"punctuation\">(</span>result<span class=\"punctuation\">,</span> PD_whole_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        result</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#加载 OTU 丰度表和进化树文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&#x27;feature-table.tsv&#x27;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&#x27;\\t&#x27;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> check.names <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\">tree <span class=\"operator\">&lt;-</span> read.tree<span class=\"punctuation\">(</span><span class=\"string\">&#x27;tree.nwk&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\"><span class=\"comment\">##alpha_all &lt;- alpha(otu, base = 2)</span></span><br><span class=\"line\"><span class=\"comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\">alpha_all <span class=\"operator\">&lt;-</span> alpha<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#输出保存在本地</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>alpha_all<span class=\"punctuation\">,</span> <span class=\"string\">&#x27;alpha.txt&#x27;</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第二步：制图\"><a href=\"#第二步：制图\" class=\"headerlink\" title=\"第二步：制图\"></a>第二步：制图</h3><p>这一步需要在Rstudio中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出7个PDF图形文件。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载github包安装工具</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测amplicon包是否安装，没有从源码安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># library加载包，suppress不显示消息和警告信息</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，根据实际情况设定</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span></span><br><span class=\"line\">metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#alpha_div = read.table(&quot;alpha.txt&quot;, header=T, row.names=1, sep=&quot;\\t&quot;, comment.char=&quot;&quot;)</span></span><br><span class=\"line\">alpha_div <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha.txt&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p1 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Shannon&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##物种丰富度 Richness 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p2 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Richness&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p3 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Simpson&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Chao1 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p4 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ACE 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p5 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;ACE&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Shannon 均匀度（Pielou 均匀度）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p6 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Pielou&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##谱系多样性</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p7 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;PD_whole_tree&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_shannon.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p1<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Richness.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p2<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Simpson.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p3<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Chao1.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p4<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_ACE.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p5<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Pielou.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p6<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_PD_whole_tree.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p7<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"演示视频\"><a href=\"#演示视频\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h2 id=\"物种多样性条形图的绘制\"><a href=\"#物种多样性条形图的绘制\" class=\"headerlink\" title=\"物种多样性条形图的绘制\"></a>物种多样性条形图的绘制</h2><h3 id=\"输入文件-1\"><a href=\"#输入文件-1\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>处理后的Feature Table</li>\n</ul>\n<p>从QIIME2可视化网站上下载的各level的物种丰度表，此处以level-2（Phylum水平）为例，命名为“level-2.csv”。该文件可以用excel或WPS打开，然后复制所有内容至一个新建的名字为“level-2.txt”的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index\tspecies1\tspecies2\tspecies3\tspecies4</span><br><span class=\"line\">Sample1\t0\t8152\t11\t65</span><br><span class=\"line\">Sample2\t12\t97\t1097\t1315</span><br><span class=\"line\">...</span><br><span class=\"line\">Samplex\t15\t46\t2928\t1011</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a href=\"#绘图\" class=\"headerlink\" title=\"绘图\"></a>绘图</h3><p>以下代码在Rstudio中逐步输入运行</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的路径&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;microbiota/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据，特征表和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.txt&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-1\"><a href=\"#演示视频-1\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h1 id=\"Beta多样性\"><a href=\"#Beta多样性\" class=\"headerlink\" title=\"Beta多样性\"></a>Beta多样性</h1><h2 id=\"NMDS分析及可视化\"><a href=\"#NMDS分析及可视化\" class=\"headerlink\" title=\"NMDS分析及可视化\"></a>NMDS分析及可视化</h2><h3 id=\"输入文件-2\"><a href=\"#输入文件-2\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h3><p>在Rstudio中运行如下代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;vegan&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;feature-table.tsv&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">design <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span>header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据调整为列名是OTU，行名是样本名</span></span><br><span class=\"line\">otu<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span></span><br><span class=\"line\">vare.hel<span class=\"operator\">&lt;-</span>decostand<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;hellinger&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bray-curtis距离矩阵</span></span><br><span class=\"line\">vare.dis <span class=\"operator\">&lt;-</span> vegdist<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用NMDS的方法</span></span><br><span class=\"line\">vare.mds <span class=\"operator\">&lt;-</span> metaMDS<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>distance <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 首先提取前两轴坐标</span></span><br><span class=\"line\">point <span class=\"operator\">=</span> scores<span class=\"punctuation\">(</span>vare.mds<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将分组文件和得分文件合并</span></span><br><span class=\"line\">index <span class=\"operator\">=</span> merge<span class=\"punctuation\">(</span>design<span class=\"punctuation\">,</span> point<span class=\"punctuation\">,</span>by<span class=\"operator\">=</span><span class=\"string\">&quot;row.names&quot;</span><span class=\"punctuation\">,</span><span class=\"built_in\">all</span><span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看Stress值</span></span><br><span class=\"line\"><span class=\"comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span></span><br><span class=\"line\">vare.mds</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span></span><br><span class=\"line\">anosim.result<span class=\"operator\">&lt;-</span>anosim<span class=\"punctuation\">(</span>vare.dis<span class=\"punctuation\">,</span> design<span class=\"operator\">$</span>Depth<span class=\"punctuation\">,</span>permutations <span class=\"operator\">=</span><span class=\"number\">999</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">summary<span class=\"punctuation\">(</span>anosim.result<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"><span class=\"comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span></span><br><span class=\"line\"><span class=\"comment\">#tiff(file=&quot;beta_bray_NMDS.tiff&quot;, res = 300, compression =&quot;none&quot;, width=180,height=140,units= &quot;mm&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;beta_bray_NMDS.pdf&quot;</span><span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">180</span><span class=\"punctuation\">,</span>height<span class=\"operator\">=</span><span class=\"number\">140</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开始出图，代码如下：</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggplot2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p <span class=\"operator\">=</span> ggplot<span class=\"punctuation\">(</span>index<span class=\"punctuation\">,</span> aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> color<span class=\"operator\">=</span>as.factor<span class=\"punctuation\">(</span>Depth<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">      geom_point<span class=\"punctuation\">(</span>size<span class=\"operator\">=</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">     <span class=\"comment\">#scale_colour_manual(values = c(&quot;red&quot;,&quot;blue&quot;, &quot;green&quot;)) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span></span><br><span class=\"line\">     labs<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS1&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> title<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span>stat_ellipse<span class=\"punctuation\">(</span>type <span class=\"operator\">=</span> <span class=\"string\">&quot;t&quot;</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> level <span class=\"operator\">=</span> <span class=\"number\">0.95</span><span class=\"punctuation\">,</span> show.legend <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.25</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;R: &#x27;*0.8036&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.35</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;p: &#x27;*0.001&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.45</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;Stress: &#x27;*0.075&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_point<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> shape<span class=\"operator\">=</span>Site<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> size<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">\t<span class=\"comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span></span><br><span class=\"line\">    theme_classic<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-2\"><a href=\"#演示视频-2\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]},{"title":"绘图自定义colors","slug":"绘图自定义colors","date":"2021-09-08T07:13:51.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/绘图自定义colors.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>在绘图过程中经常需要为不同的对象分配不同的color，然而如何得到对比度高又不唐突的color组合是一门艺术。对于不懂美术的理工男来说，希望有现成的color sets可用。</p>\n<span id=\"more\"></span>\n\n<p>实际上，D3.js中给出了两套color sets方案，分别用于10和20个对象的color。colors代码（16进制）和效果如下：</p>\n<h1 id=\"Category-10\"><a href=\"#Category-10\" class=\"headerlink\" title=\"Category 10\"></a>Category 10</h1><p><svg width=\"500\" height=\"500\"><rect x=\"75\" y=\"0\" width=\"460\" height=\"46\" fill=\"#1f77b4\"></rect><rect x=\"75\" y=\"46\" width=\"460\" height=\"46\" fill=\"#ff7f0e\"></rect><rect x=\"75\" y=\"92\" width=\"460\" height=\"46\" fill=\"#2ca02c\"></rect><rect x=\"75\" y=\"138\" width=\"460\" height=\"46\" fill=\"#d62728\"></rect><rect x=\"75\" y=\"184\" width=\"460\" height=\"46\" fill=\"#9467bd\"></rect><rect x=\"75\" y=\"230\" width=\"460\" height=\"46\" fill=\"#8c564b\"></rect><rect x=\"75\" y=\"276\" width=\"460\" height=\"46\" fill=\"#e377c2\"></rect><rect x=\"75\" y=\"322\" width=\"460\" height=\"46\" fill=\"#7f7f7f\"></rect><rect x=\"75\" y=\"368\" width=\"460\" height=\"46\" fill=\"#bcbd22\"></rect><rect x=\"75\" y=\"414\" width=\"460\" height=\"46\" fill=\"#17becf\"></rect><text x=\"0\" y=\"20\">#1f77b4  </text><text x=\"0\" y=\"66\">#ff7f0e  </text><text x=\"0\" y=\"112\">#2ca02c  </text><text x=\"0\" y=\"158\">#d62728  </text><text x=\"0\" y=\"204\">#9467bd  </text><text x=\"0\" y=\"250\">#8c564b  </text><text x=\"0\" y=\"296\">#e377c2  </text><text x=\"0\" y=\"342\">#7f7f7f  </text><text x=\"0\" y=\"388\">#bcbd22  </text><text x=\"0\" y=\"434\">#17becf  </text></svg></p>\n<h1 id=\"Category-20a\"><a href=\"#Category-20a\" class=\"headerlink\" title=\"Category 20a\"></a>Category 20a</h1><p><svg width=\"500\" height=\"500\"><rect x=\"75\" y=\"0\" width=\"460\" height=\"23\" fill=\"#1f77b4\"></rect><rect x=\"75\" y=\"23\" width=\"460\" height=\"23\" fill=\"#aec7e8\"></rect><rect x=\"75\" y=\"46\" width=\"460\" height=\"23\" fill=\"#ff7f0e\"></rect><rect x=\"75\" y=\"69\" width=\"460\" height=\"23\" fill=\"#ffbb78\"></rect><rect x=\"75\" y=\"92\" width=\"460\" height=\"23\" fill=\"#2ca02c\"></rect><rect x=\"75\" y=\"115\" width=\"460\" height=\"23\" fill=\"#98df8a\"></rect><rect x=\"75\" y=\"138\" width=\"460\" height=\"23\" fill=\"#d62728\"></rect><rect x=\"75\" y=\"161\" width=\"460\" height=\"23\" fill=\"#ff9896\"></rect><rect x=\"75\" y=\"184\" width=\"460\" height=\"23\" fill=\"#9467bd\"></rect><rect x=\"75\" y=\"207\" width=\"460\" height=\"23\" fill=\"#c5b0d5\"></rect><rect x=\"75\" y=\"230\" width=\"460\" height=\"23\" fill=\"#8c564b\"></rect><rect x=\"75\" y=\"253\" width=\"460\" height=\"23\" fill=\"#c49c94\"></rect><rect x=\"75\" y=\"276\" width=\"460\" height=\"23\" fill=\"#e377c2\"></rect><rect x=\"75\" y=\"299\" width=\"460\" height=\"23\" fill=\"#f7b6d2\"></rect><rect x=\"75\" y=\"322\" width=\"460\" height=\"23\" fill=\"#7f7f7f\"></rect><rect x=\"75\" y=\"345\" width=\"460\" height=\"23\" fill=\"#c7c7c7\"></rect><rect x=\"75\" y=\"368\" width=\"460\" height=\"23\" fill=\"#bcbd22\"></rect><rect x=\"75\" y=\"391\" width=\"460\" height=\"23\" fill=\"#dbdb8d\"></rect><rect x=\"75\" y=\"414\" width=\"460\" height=\"23\" fill=\"#17becf\"></rect><rect x=\"75\" y=\"437\" width=\"460\" height=\"23\" fill=\"#9edae5\"></rect><text x=\"0\" y=\"20\">#1f77b4  </text><text x=\"0\" y=\"43\">#aec7e8  </text><text x=\"0\" y=\"66\">#ff7f0e  </text><text x=\"0\" y=\"89\">#ffbb78  </text><text x=\"0\" y=\"112\">#2ca02c  </text><text x=\"0\" y=\"135\">#98df8a  </text><text x=\"0\" y=\"158\">#d62728  </text><text x=\"0\" y=\"181\">#ff9896  </text><text x=\"0\" y=\"204\">#9467bd  </text><text x=\"0\" y=\"227\">#c5b0d5  </text><text x=\"0\" y=\"250\">#8c564b  </text><text x=\"0\" y=\"273\">#c49c94  </text><text x=\"0\" y=\"296\">#e377c2  </text><text x=\"0\" y=\"319\">#f7b6d2  </text><text x=\"0\" y=\"342\">#7f7f7f  </text><text x=\"0\" y=\"365\">#c7c7c7  </text><text x=\"0\" y=\"388\">#bcbd22  </text><text x=\"0\" y=\"411\">#dbdb8d  </text><text x=\"0\" y=\"434\">#17becf  </text><text x=\"0\" y=\"457\">#9edae5  </text></svg></p>\n<h1 id=\"Category-20b\"><a href=\"#Category-20b\" class=\"headerlink\" title=\"Category 20b\"></a>Category 20b</h1><p><svg width=\"500\" height=\"500\"><rect x=\"75\" y=\"0\" width=\"460\" height=\"23\" fill=\"#393b79\"></rect><rect x=\"75\" y=\"23\" width=\"460\" height=\"23\" fill=\"#5254a3\"></rect><rect x=\"75\" y=\"46\" width=\"460\" height=\"23\" fill=\"#6b6ecf\"></rect><rect x=\"75\" y=\"69\" width=\"460\" height=\"23\" fill=\"#9c9ede\"></rect><rect x=\"75\" y=\"92\" width=\"460\" height=\"23\" fill=\"#637939\"></rect><rect x=\"75\" y=\"115\" width=\"460\" height=\"23\" fill=\"#8ca252\"></rect><rect x=\"75\" y=\"138\" width=\"460\" height=\"23\" fill=\"#b5cf6b\"></rect><rect x=\"75\" y=\"161\" width=\"460\" height=\"23\" fill=\"#cedb9c\"></rect><rect x=\"75\" y=\"184\" width=\"460\" height=\"23\" fill=\"#8c6d31\"></rect><rect x=\"75\" y=\"207\" width=\"460\" height=\"23\" fill=\"#bd9e39\"></rect><rect x=\"75\" y=\"230\" width=\"460\" height=\"23\" fill=\"#e7ba52\"></rect><rect x=\"75\" y=\"253\" width=\"460\" height=\"23\" fill=\"#e7cb94\"></rect><rect x=\"75\" y=\"276\" width=\"460\" height=\"23\" fill=\"#843c39\"></rect><rect x=\"75\" y=\"299\" width=\"460\" height=\"23\" fill=\"#ad494a\"></rect><rect x=\"75\" y=\"322\" width=\"460\" height=\"23\" fill=\"#d6616b\"></rect><rect x=\"75\" y=\"345\" width=\"460\" height=\"23\" fill=\"#e7969c\"></rect><rect x=\"75\" y=\"368\" width=\"460\" height=\"23\" fill=\"#7b4173\"></rect><rect x=\"75\" y=\"391\" width=\"460\" height=\"23\" fill=\"#a55194\"></rect><rect x=\"75\" y=\"414\" width=\"460\" height=\"23\" fill=\"#ce6dbd\"></rect><rect x=\"75\" y=\"437\" width=\"460\" height=\"23\" fill=\"#de9ed6\"></rect><text x=\"0\" y=\"20\">#393b79  </text><text x=\"0\" y=\"43\">#5254a3  </text><text x=\"0\" y=\"66\">#6b6ecf  </text><text x=\"0\" y=\"89\">#9c9ede  </text><text x=\"0\" y=\"112\">#637939  </text><text x=\"0\" y=\"135\">#8ca252  </text><text x=\"0\" y=\"158\">#b5cf6b  </text><text x=\"0\" y=\"181\">#cedb9c  </text><text x=\"0\" y=\"204\">#8c6d31  </text><text x=\"0\" y=\"227\">#bd9e39  </text><text x=\"0\" y=\"250\">#e7ba52  </text><text x=\"0\" y=\"273\">#e7cb94  </text><text x=\"0\" y=\"296\">#843c39  </text><text x=\"0\" y=\"319\">#ad494a  </text><text x=\"0\" y=\"342\">#d6616b  </text><text x=\"0\" y=\"365\">#e7969c  </text><text x=\"0\" y=\"388\">#7b4173  </text><text x=\"0\" y=\"411\">#a55194  </text><text x=\"0\" y=\"434\">#ce6dbd  </text><text x=\"0\" y=\"457\">#de9ed6  </text></svg></p>\n<h1 id=\"Category-20c\"><a href=\"#Category-20c\" class=\"headerlink\" title=\"Category 20c\"></a>Category 20c</h1><p><svg width=\"500\" height=\"500\"><rect x=\"75\" y=\"0\" width=\"460\" height=\"23\" fill=\"#3182bd\"></rect><rect x=\"75\" y=\"23\" width=\"460\" height=\"23\" fill=\"#6baed6\"></rect><rect x=\"75\" y=\"46\" width=\"460\" height=\"23\" fill=\"#9ecae1\"></rect><rect x=\"75\" y=\"69\" width=\"460\" height=\"23\" fill=\"#c6dbef\"></rect><rect x=\"75\" y=\"92\" width=\"460\" height=\"23\" fill=\"#e6550d\"></rect><rect x=\"75\" y=\"115\" width=\"460\" height=\"23\" fill=\"#fd8d3c\"></rect><rect x=\"75\" y=\"138\" width=\"460\" height=\"23\" fill=\"#fdae6b\"></rect><rect x=\"75\" y=\"161\" width=\"460\" height=\"23\" fill=\"#fdd0a2\"></rect><rect x=\"75\" y=\"184\" width=\"460\" height=\"23\" fill=\"#31a354\"></rect><rect x=\"75\" y=\"207\" width=\"460\" height=\"23\" fill=\"#74c476\"></rect><rect x=\"75\" y=\"230\" width=\"460\" height=\"23\" fill=\"#a1d99b\"></rect><rect x=\"75\" y=\"253\" width=\"460\" height=\"23\" fill=\"#c7e9c0\"></rect><rect x=\"75\" y=\"276\" width=\"460\" height=\"23\" fill=\"#756bb1\"></rect><rect x=\"75\" y=\"299\" width=\"460\" height=\"23\" fill=\"#9e9ac8\"></rect><rect x=\"75\" y=\"322\" width=\"460\" height=\"23\" fill=\"#bcbddc\"></rect><rect x=\"75\" y=\"345\" width=\"460\" height=\"23\" fill=\"#dadaeb\"></rect><rect x=\"75\" y=\"368\" width=\"460\" height=\"23\" fill=\"#636363\"></rect><rect x=\"75\" y=\"391\" width=\"460\" height=\"23\" fill=\"#969696\"></rect><rect x=\"75\" y=\"414\" width=\"460\" height=\"23\" fill=\"#bdbdbd\"></rect><rect x=\"75\" y=\"437\" width=\"460\" height=\"23\" fill=\"#d9d9d9\"></rect><text x=\"0\" y=\"20\">#3182bd  </text><text x=\"0\" y=\"43\">#6baed6  </text><text x=\"0\" y=\"66\">#9ecae1  </text><text x=\"0\" y=\"89\">#c6dbef  </text><text x=\"0\" y=\"112\">#e6550d  </text><text x=\"0\" y=\"135\">#fd8d3c  </text><text x=\"0\" y=\"158\">#fdae6b  </text><text x=\"0\" y=\"181\">#fdd0a2  </text><text x=\"0\" y=\"204\">#31a354  </text><text x=\"0\" y=\"227\">#74c476  </text><text x=\"0\" y=\"250\">#a1d99b  </text><text x=\"0\" y=\"273\">#c7e9c0  </text><text x=\"0\" y=\"296\">#756bb1  </text><text x=\"0\" y=\"319\">#9e9ac8  </text><text x=\"0\" y=\"342\">#bcbddc  </text><text x=\"0\" y=\"365\">#dadaeb  </text><text x=\"0\" y=\"388\">#636363  </text><text x=\"0\" y=\"411\">#969696  </text><text x=\"0\" y=\"434\">#bdbdbd  </text><text x=\"0\" y=\"457\">#d9d9d9  </text></svg></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"R语言","path":"api/tags/R语言.json"}]},{"title":"Nature Protocols投稿经验","slug":"Nature-Protocols投稿经验","date":"2021-05-19T11:10:03.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Nature-Protocols投稿经验.json","excerpt":null,"keywords":null,"cover":null,"content":"<h1 id=\"PGCGAP投稿过程\"><a href=\"#PGCGAP投稿过程\" class=\"headerlink\" title=\"PGCGAP投稿过程\"></a>PGCGAP投稿过程</h1><h2 id=\"第一次投稿\"><a href=\"#第一次投稿\" class=\"headerlink\" title=\"第一次投稿\"></a>第一次投稿</h2><h3 id=\"类型：\"><a href=\"#类型：\" class=\"headerlink\" title=\"类型：\"></a>类型：</h3><ul>\n<li>Protocols</li>\n</ul>\n<h3 id=\"周期：\"><a href=\"#周期：\" class=\"headerlink\" title=\"周期：\"></a>周期：</h3><ul>\n<li>~1周</li>\n</ul>\n<h3 id=\"节点：\"><a href=\"#节点：\" class=\"headerlink\" title=\"节点：\"></a>节点：</h3><ul>\n<li><strong>Submitted</strong>：2020.01.08</li>\n<li><strong>Editor Assigned</strong>：2020.01.13</li>\n<li><strong>Manuscript under consideration</strong>：2020.01.13</li>\n<li><strong>Manuscript under editorial consideration</strong>：2020.01.15</li>\n<li><strong>Rejection</strong>：2020.01.15</li>\n</ul>\n<h3 id=\"拒稿原因：\"><a href=\"#拒稿原因：\" class=\"headerlink\" title=\"拒稿原因：\"></a>拒稿原因：</h3><p>欲在NP上发表的方法应该在至少一篇primary research artical中使用过，已证明其正确性。而彼时PGCGAP并未在任何已发表的文章中使用过，因此不适宜发表。NP拒稿有两种：其一，直接拒绝；其二，暂时拒绝。编辑建议将稿件投到其开放平台《protocol exchange》上，待符合要求以后可再次投稿。</p>\n<h3 id=\"积累：\"><a href=\"#积累：\" class=\"headerlink\" title=\"积累：\"></a>积累：</h3><p>一年多的时间，PGCGAP更新了十几个版本，protocol也更新了5个版本。陆陆续续的也出了5篇引用PGCGAP的文章，其中两篇自引（NP要求自引）和三篇他引。</p>\n<h2 id=\"第二次投稿\"><a href=\"#第二次投稿\" class=\"headerlink\" title=\"第二次投稿\"></a>第二次投稿</h2><h3 id=\"类型：-1\"><a href=\"#类型：-1\" class=\"headerlink\" title=\"类型：\"></a>类型：</h3><ul>\n<li>Protocols</li>\n</ul>\n<h3 id=\"周期：-1\"><a href=\"#周期：-1\" class=\"headerlink\" title=\"周期：\"></a>周期：</h3><ul>\n<li>~ 50d</li>\n</ul>\n<h3 id=\"节点：-1\"><a href=\"#节点：-1\" class=\"headerlink\" title=\"节点：\"></a>节点：</h3><ul>\n<li><strong>Submitted</strong>：2021.04.25</li>\n<li><strong>Editor Assigned</strong>：2021.04.27</li>\n<li><strong>Manuscript under consideration</strong>：2021.04.27</li>\n<li><strong>First Feedback</strong>：2021.05.24，编辑提出PGCGAP的部分而非全部模块在primary paper中引用，并让我们回复是否有primary paper引用了所有的模块。</li>\n<li><strong>Reply</strong>：2021.05.16，向编辑说明了其他模块的情况。</li>\n<li><strong>Manuscript under editorial consideration</strong>：2021.06.03</li>\n<li><strong>Editor Decision Started</strong>：2021.06.07</li>\n<li><strong>Decision sent to author</strong>：2021.06.15</li>\n</ul>\n","raw":null,"categories":[{"name":"投稿","path":"api/categories/投稿.json"}],"tags":[{"name":"投稿经验","path":"api/tags/投稿经验.json"}]},{"title":"扩增子分析--计算随机过程和决定性过程比例","slug":"扩增子分析-计算随机过程和决定性过程比例","date":"2021-03-25T08:42:06.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子分析-计算随机过程和决定性过程比例.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>确定性过程（deterministic processes）和随机性过程（stochastic processes)是两个影响微生物群落结构系统发育组装的重要过程，本文介绍计算二者所占比例的方法。</p>\n<span id=\"more\"></span>\n<h1 id=\"1-软件\"><a href=\"#1-软件\" class=\"headerlink\" title=\"1. 软件\"></a><font color=#FF0000 >1. 软件</font></h1><ul>\n<li>NST</li>\n<li>iCAMP</li>\n<li>ape 用于读取进化树文件</li>\n<li>picante</li>\n</ul>\n<h1 id=\"2-文件准备\"><a href=\"#2-文件准备\" class=\"headerlink\" title=\"2. 文件准备\"></a><font color=#FF0000 >2. 文件准备</font></h1><h2 id=\"2-1-Feature-Table\"><a href=\"#2-1-Feature-Table\" class=\"headerlink\" title=\"2.1 Feature Table\"></a><font color=#FF0000 >2.1 Feature Table</font></h2><p>行为OTUs&#x2F;ASVs，列为样本。</p>\n<table>\n<thead>\n<tr>\n<th>TaxonID</th>\n<th>Sample 1</th>\n<th>Sample 2</th>\n<th>Sample 3</th>\n<th>Sample 4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>232.0</td>\n<td>209.0</td>\n<td>349.0</td>\n<td>256.0</td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>75.0</td>\n<td>35.0</td>\n<td>44.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>237.0</td>\n<td>224.0</td>\n<td>291.0</td>\n<td>353.0</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>371.0</td>\n<td>80.0</td>\n<td>319.0</td>\n<td>345.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-2-Group-File\"><a href=\"#2-2-Group-File\" class=\"headerlink\" title=\"2.2 Group File\"></a><font color=#FF0000 >2.2 Group File</font></h2><p>该文件描述了所有样本的分组情况，如实验组和对照组，或者其他分组。</p>\n<table>\n<thead>\n<tr>\n<th>Sample_ID</th>\n<th>Group</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-3-Tree-File\"><a href=\"#2-3-Tree-File\" class=\"headerlink\" title=\"2.3 Tree File\"></a><font color=#FF0000 >2.3 Tree File</font></h2><p>包含Feature table中所有OTUs&#x2F;ASVs的系统发育树文件，理想条件下仅包含Feature table中的OTUs&#x2F;ASVs，不过大部分情况下还会包含数据库中的一些物种，在随后的分析中需要去除多余的物种（后续会讲到）。</p>\n<h1 id=\"3-开始分析\"><a href=\"#3-开始分析\" class=\"headerlink\" title=\"3. 开始分析\"></a><font color=#FF0000 >3. 开始分析</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">########################</span></span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># version 20200919</span></span><br><span class=\"line\"><span class=\"comment\"># Step 1. 文件、路径和参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定包含输入文件的目录路径，注意区分Windows和Linux的路径写法</span></span><br><span class=\"line\">wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定结果文件的保存路径</span></span><br><span class=\"line\">save.wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick/Result2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建文件保存路径</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span> recursive <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定Feature table（OTU表）的文件名</span></span><br><span class=\"line\">com.file<span class=\"operator\">=</span><span class=\"string\">&quot;feature-table.tsv&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定样本分组文件，每行为一个样本</span></span><br><span class=\"line\">group.file<span class=\"operator\">=</span><span class=\"string\">&quot;treatment.txt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定NWK格式的系统发育树文件</span></span><br><span class=\"line\">tree.file<span class=\"operator\">=</span><span class=\"string\">&quot;tree.nwk&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置并行运算使用的线程数</span></span><br><span class=\"line\">nworker<span class=\"operator\">=</span><span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># randomization time for null model analysis. 真实分析的时候一般设置为1000，如果测试的话可以设20</span></span><br><span class=\"line\">rand.time<span class=\"operator\">=</span><span class=\"number\">999</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出文件的前缀名，随便设置</span></span><br><span class=\"line\">prefix<span class=\"operator\">=</span><span class=\"string\">&quot;Lujia&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 2. 加载R包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 确保已经安装过所需的R包</span></span><br><span class=\"line\"><span class=\"comment\">#install.packages(&quot;NST&quot;) </span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ape<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>iCAMP<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>NST<span class=\"punctuation\">)</span> <span class=\"comment\"># need to be NST &gt;=3.0.3</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 3. 加载数据并匹配IDs</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入Feature Table，注意自己文件的列与列之间的分隔符是什么，制表符用sep = &quot;\\t&quot;，逗号用sep = &quot;,&quot;</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>read.table<span class=\"punctuation\">(</span>com.file<span class=\"punctuation\">,</span>header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入分组文件，同样注意设置分隔符</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span>group.file<span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果tree中的OTUs和Feature Table中的OTUs一一对应，可以直接用下面一个命令读入tree（注意去掉###），否则的话则运行下面LHL加入的3行命令</span></span><br><span class=\"line\"><span class=\"comment\">###tree=ape::read.tree(file = tree.file) # if you have tree</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下3行是LHL加入的</span></span><br><span class=\"line\">phy<span class=\"operator\">&lt;-</span>read.tree<span class=\"punctuation\">(</span>tree.file<span class=\"punctuation\">)</span><span class=\"comment\"># 读入树文件</span></span><br><span class=\"line\">prune_tree<span class=\"operator\">&lt;-</span>prune.sample<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">,</span>phy<span class=\"punctuation\">)</span><span class=\"comment\"># 使树文件和OTU表文件一一对齐</span></span><br><span class=\"line\">tree<span class=\"operator\">=</span>prune_tree <span class=\"comment\"># 此刻的Tree干净了，可用于后续分析而不会报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的样本名称是否与分组文件中的样本名一一对应</span></span><br><span class=\"line\">samp.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>rn.list<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span>group<span class=\"operator\">=</span>group<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span>colSums<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">)</span><span class=\"operator\">&gt;</span><span class=\"number\">0</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>group</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的OTUs名称是否与Tree中的OTUs名一一对应</span></span><br><span class=\"line\">tax.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>cn.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>tree.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>tree<span class=\"operator\">=</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"comment\"># if you have tree</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">tree<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>tree</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 4. Grouping way and metacommunity seting</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选择分组，如果拥有多种分组方式，每次运行时选择其中的一组。此处选择的时分组文件中的第二列</span></span><br><span class=\"line\">groupi<span class=\"operator\">=</span>group<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重新定义输出文件的前缀，以分组的名称来命名，此处以分组文件第二列的表头“Group”为前缀</span></span><br><span class=\"line\">prefixi<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>prefix<span class=\"punctuation\">,</span><span class=\"string\">&quot;.Group&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if treatment and control are from different metacommunities, you may set meta.groupi=groupi，默认为NULL</span></span><br><span class=\"line\"><span class=\"comment\">#meta.groupi=NULL</span></span><br><span class=\"line\">meta.groupi<span class=\"operator\">=</span>groupi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5. taxonomic NST</span></span><br><span class=\"line\"><span class=\"comment\"># Step 5.1 calculate tNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定计算距离矩阵的方法，&quot;jaccard&quot; and &quot;bray&quot; are preferred.</span></span><br><span class=\"line\">dist.method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录运行时间</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入输出目录</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算tNST</span></span><br><span class=\"line\">tnst<span class=\"operator\">=</span>tNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> meta.com<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> dist.method<span class=\"operator\">=</span>dist.method<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> LB<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> null.model<span class=\"operator\">=</span><span class=\"string\">&quot;PF&quot;</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以R data格式保存tNST的输出 </span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnst<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存其他tNST结果到多个文件中</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.2 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bootstrapping</span></span><br><span class=\"line\">tnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.3 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">tnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Steo 6. phylogenetic NST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.1 phylogentic distance matrix # use bigmemory for big dataset</span></span><br><span class=\"line\"></span><br><span class=\"line\">wd.pd<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span><span class=\"string\">&quot;/pdbig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>dir.exists<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span>dir.create<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span>file.exists<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.desc&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\"># if already done before, directly use it.</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>tip.label<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.wd<span class=\"operator\">=</span>wd.pd</span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.desc&quot;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.name.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"keyword\">else</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span>iCAMP<span class=\"operator\">::</span>pdist.big<span class=\"punctuation\">(</span>tree <span class=\"operator\">=</span> tree<span class=\"punctuation\">,</span> wd <span class=\"operator\">=</span> wd.pd<span class=\"punctuation\">,</span> nworker <span class=\"operator\">=</span> nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.2 calculate pNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># to count time cost</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnst<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>pNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> pd.desc<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.file<span class=\"punctuation\">,</span> pd.wd<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.wd<span class=\"punctuation\">,</span></span><br><span class=\"line\">pd.spname<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>tip.label<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> taxo.null.model<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> phylo.shuffle<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> exclude.conspecifics<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save pNST output in R data format</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnst<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.3 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.4 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-结果解读\"><a href=\"#4-结果解读\" class=\"headerlink\" title=\"4. 结果解读\"></a><font color=#FF0000 >4. 结果解读</font></h1><h2 id=\"4-1-确定性过程和随机性过程的相对重要性\"><a href=\"#4-1-确定性过程和随机性过程的相对重要性\" class=\"headerlink\" title=\"4.1 确定性过程和随机性过程的相对重要性\"></a><font color=#FF0000 >4.1 确定性过程和随机性过程的相对重要性</font></h2><ul>\n<li><p>An index, normalized stochasticity ratio (NST), was developed with 50% as the boundary point between more deterministic (&lt;50%) and more stochastic (&gt;50%) assembly. <font color=#2196F3>NST &gt; 50%时Stochastic Processes占主导，而NST &lt; 50%时，Deterministic Processes占主导。</font></p>\n</li>\n<li><p>用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。同质性和变异性选择应分别造成小于和大于预期的群落更替;βNTI &lt;−2或&gt; + 2进一步解释为表明同质性或变异性选择分别占主导地位;</p>\n</li>\n</ul>\n<h2 id=\"4-2-通过RCbray判断随机过程中各种过程的贡献\"><a href=\"#4-2-通过RCbray判断随机过程中各种过程的贡献\" class=\"headerlink\" title=\"4.2 通过RCbray判断随机过程中各种过程的贡献\"></a><font color=#FF0000 >4.2 通过RCbray判断随机过程中各种过程的贡献</font></h2><p>Modified Raup-Crick index (RCbray) is subsequently calculated by comparing empirically observed Bray-Curtis and simulated null distribution. Thus, according to themodified Raup-Crick index (RCbray), stochastic processes could be classified into 3 ecological processes: 均质分散homogenizing dispersal (RCbray &lt; −0.95), 分散限制dispersal limitation (RCbray &gt; +0.95) and 生态漂变ecological drift (−0.95&lt; RCbray &lt; +0.95) <a href=\"https://doi.org/10.1038/ismej.2012.22\">Stegen et al., 2012</a>;  <a href=\"https://doi.org/10.1038/ismej.2013.93\">Stegen et al., 2013</a>.</p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"}]},{"title":"Use microeco分析扩增子数据","slug":"Use_microeco分析扩增子数据","date":"2021-03-14T07:01:45.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Use_microeco分析扩增子数据.json","excerpt":null,"keywords":null,"cover":"#/images/lujia/show_15_taxa_at_Class_level.jpg","content":"<p>本文阐述使用microeco分析扩增子数据……</p>\n<span id=\"more\"></span>\n\n<h1 id=\"1-安装microeco\"><a href=\"#1-安装microeco\" class=\"headerlink\" title=\"1. 安装microeco\"></a><font color=#FF0000 >1. 安装microeco</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># If devtools package is not installed, first install it</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># then install microeco</span></span><br><span class=\"line\">devtools<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;ChiLiubio/microeco&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span>install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">devtools<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;jbisanz/qiime2R&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-准备数据\"><a href=\"#2-准备数据\" class=\"headerlink\" title=\"2. 准备数据\"></a><font color=#FF0000 >2. 准备数据</font></h1><h2 id=\"otu-table\"><a href=\"#otu-table\" class=\"headerlink\" title=\"otu_table\"></a><font color=#FF9800 >otu_table</font></h2><p>OTU表</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Sample 1</th>\n<th>Sample 2</th>\n<th>Sample 3</th>\n<th>Sample 4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>232.0</td>\n<td>209.0</td>\n<td>349.0</td>\n<td>256.0</td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>75.0</td>\n<td>35.0</td>\n<td>44.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>237.0</td>\n<td>224.0</td>\n<td>291.0</td>\n<td>353.0</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>371.0</td>\n<td>80.0</td>\n<td>319.0</td>\n<td>345.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"taxonomy-table\"><a href=\"#taxonomy-table\" class=\"headerlink\" title=\"taxonomy_table\"></a><font color=#FF9800 >taxonomy_table</font></h2><p>分类表</p>\n<div style=\"overflow-x:auto;\">\n<table>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Kingdom</th>\n<th>Phylum</th>\n<th>Class</th>\n<th>Order</th>\n<th>Family</th>\n<th>Genus</th>\n<th>Species</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>d__Bacteria</td>\n<td>p__Desulfobacterota</td>\n<td>c__Desulfobacteria</td>\n<td>o__Desulfatiglandales</td>\n<td>f__Desulfatiglandaceae</td>\n<td>g__Desulfatiglans</td>\n<td></td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>d__Bacteria</td>\n<td>p__Sva0485</td>\n<td>c__Sva0485</td>\n<td>o__Sva0485</td>\n<td>f__Sva0485</td>\n<td>g__Sva0485</td>\n<td>s__uncultured_hydrocarbon</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>d__Bacteria</td>\n<td>p__Desulfobacterota</td>\n<td>c__Syntrophobacteria</td>\n<td>o__Syntrophobacterales</td>\n<td>f__uncultured</td>\n<td>g__uncultured</td>\n<td>s__uncultured_delta</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>d__Bacteria</td>\n<td>p__Myxococcota</td>\n<td>c__Polyangia</td>\n<td>o__Polyangiales</td>\n<td>f__Sandaracinaceae</td>\n<td>g__uncultured</td>\n<td></td>\n</tr>\n</tbody></table>\n</table>\n</div>\n\n<h2 id=\"sample-info\"><a href=\"#sample-info\" class=\"headerlink\" title=\"sample_info\"></a><font color=#FF9800 >sample_info</font></h2><p>样本元数据</p>\n<table>\n<thead>\n<tr>\n<th>SampleID</th>\n<th>Group</th>\n<th>Type</th>\n<th>Saline</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>G1</td>\n<td>T1</td>\n<td>Non-saline</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>G1</td>\n<td>T1</td>\n<td>Non-saline</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>G2</td>\n<td>T1</td>\n<td>Saline</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>G2</td>\n<td>T2</td>\n<td>Saline</td>\n</tr>\n</tbody></table>\n<h2 id=\"env-data\"><a href=\"#env-data\" class=\"headerlink\" title=\"env_data\"></a><font color=#FF9800 >env_data</font></h2><p>环境因子</p>\n<table>\n<thead>\n<tr>\n<th>SampleID</th>\n<th>Depth</th>\n<th>Longitude</th>\n<th>Latitude</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>0</td>\n<td>23.0</td>\n<td>20</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>10</td>\n<td>35.0</td>\n<td>44.0</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>20</td>\n<td>43.0</td>\n<td>70.0</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>30</td>\n<td>60.0</td>\n<td>69.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"phylo-tree\"><a href=\"#phylo-tree\" class=\"headerlink\" title=\"phylo_tree\"></a><font color=#FF9800 >phylo_tree</font></h2><p>进化树</p>\n<h1 id=\"3-导入数据\"><a href=\"#3-导入数据\" class=\"headerlink\" title=\"3. 导入数据\"></a><font color=#FF0000 >3. 导入数据</font></h1><ul>\n<li><p>加载R包</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>microeco<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ape<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>qiime2R<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># use pipe operator in magrittr package</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>magrittr<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># set.seed is used to fix the random number generation to make the results repeatable</span></span><br><span class=\"line\">set.seed<span class=\"punctuation\">(</span><span class=\"number\">123</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># make the plotting background same with the tutorial</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\">theme_set<span class=\"punctuation\">(</span>theme_bw<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>导入数据</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 单独导入环境因子文件</span></span><br><span class=\"line\">env_data <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/Ordination_analyses/env4.txt&quot;</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 定义数据导入函数</span></span><br><span class=\"line\">qiimed2meco <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>ASV_data<span class=\"punctuation\">,</span> sample_data<span class=\"punctuation\">,</span> taxonomy_data<span class=\"punctuation\">,</span> phylo_tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\"># Read ASV data</span></span><br><span class=\"line\">\tASV <span class=\"operator\">&lt;-</span> as.data.frame<span class=\"punctuation\">(</span>read_qza<span class=\"punctuation\">(</span>ASV_data<span class=\"punctuation\">)</span><span class=\"operator\">$</span>data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\t<span class=\"comment\">#  Read metadata</span></span><br><span class=\"line\">\tmetadata <span class=\"operator\">&lt;-</span> read_q2metadata<span class=\"punctuation\">(</span>sample_data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\trownames<span class=\"punctuation\">(</span>metadata<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"built_in\">as.character</span><span class=\"punctuation\">(</span>metadata<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">\t<span class=\"comment\"># Read taxonomy table</span></span><br><span class=\"line\">\ttaxa_table <span class=\"operator\">&lt;-</span> read_qza<span class=\"punctuation\">(</span>taxonomy_data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\ttaxa_table <span class=\"operator\">&lt;-</span> parse_taxonomy<span class=\"punctuation\">(</span>taxa_table<span class=\"operator\">$</span>data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\t<span class=\"comment\"># Make the taxonomic table clean, this is very important.</span></span><br><span class=\"line\">\ttaxa_table <span class=\"operator\">%&lt;&gt;%</span> tidy_taxonomy</span><br><span class=\"line\">\t<span class=\"comment\"># Read phylo tree</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>phylo_tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t\tphylo_tree <span class=\"operator\">&lt;-</span> read_qza<span class=\"punctuation\">(</span>phylo_tree<span class=\"punctuation\">)</span><span class=\"operator\">$</span>data</span><br><span class=\"line\">\t<span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">\tdataset <span class=\"operator\">&lt;-</span> microtable<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>sample_table <span class=\"operator\">=</span> metadata<span class=\"punctuation\">,</span> tax_table <span class=\"operator\">=</span> taxa_table<span class=\"punctuation\">,</span> otu_table <span class=\"operator\">=</span> ASV<span class=\"punctuation\">,</span> phylo_tree <span class=\"operator\">=</span> phylo_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">\tdataset</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入本地数据，包括OTU表、样本元数据、分类表、tree文件。这几个文件均有QIIME2生成。</span></span><br><span class=\"line\">meco_dataset <span class=\"operator\">&lt;-</span> qiimed2meco<span class=\"punctuation\">(</span>ASV_data <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/dada2_table.qza&quot;</span><span class=\"punctuation\">,</span> sample_data <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/metadata.tsv&quot;</span><span class=\"punctuation\">,</span> taxonomy_data <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/taxonomy.qza&quot;</span><span class=\"punctuation\">,</span> phylo_tree <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/tree.qza&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">meco_dataset</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"4-数据预处理\"><a href=\"#4-数据预处理\" class=\"headerlink\" title=\"4. 数据预处理\"></a><font color=#FF0000 >4. 数据预处理</font></h1><ul>\n<li><p>移除未被分配到 “k__Archaea” 或 “k__Bacteria”的OTUs</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>tax_table <span class=\"operator\">%&lt;&gt;%</span> base<span class=\"operator\">::</span>subset<span class=\"punctuation\">(</span>Kingdom <span class=\"operator\">==</span> <span class=\"string\">&quot;k__Archaea&quot;</span> <span class=\"operator\">|</span> Kingdom <span class=\"operator\">==</span> <span class=\"string\">&quot;k__Bacteria&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">print<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>移除注释为线粒体和叶绿体的OTUs</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 移除tax_table中包含taxa名字的行，无论分类等级（taxonomic ranks），不区分大小写字母。简言之，taxa = c(&quot;mitochondria&quot;, &quot;chloroplast&quot;)定义了删除包含mitochondria和chloroplast的行。</span></span><br><span class=\"line\"></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>filter_pollution<span class=\"punctuation\">(</span>taxa <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;mitochondria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;chloroplast&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">print<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>为了使otu_table、tax_table和phylo_tree中的OTUs相同，我们再次使用tidy_dataset() 函数</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>tidy_dataset<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">print<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>调用sample_sums()检查各样本中的序列数量</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>sample_sums<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">range</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>有时，为了减少物种数目对多样性度量的影响，我们需要进行重采样，使每个样本中的序列数量相等。函数rarefy_samples可以在稀疏（rarefying）前后自动调用函数tidy_dataset。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># As an example, we use 20001 sequences in each sample</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>rarefy_samples<span class=\"punctuation\">(</span>sample.size <span class=\"operator\">=</span> <span class=\"number\">20001</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>sample_sums<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">range</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"5-alpha多样性\"><a href=\"#5-alpha多样性\" class=\"headerlink\" title=\"5. alpha多样性\"></a><font color=#FF0000 >5. alpha多样性</font></h1><ul>\n<li><p>然后，我们使用cal_abund()计算每个分类等级的分类单元丰度（taxa abundance）。此函数返回一个名为taxa_abund的列表，其中包含每个分类等级上的丰度信息的多个数据框。列表自动存储在microtable object中。</p>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>cal_abund<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return dataset$taxa_abund</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>taxa_abund<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>通过save_abund()将taxa abundance保存至本地文件</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxa_abund&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>save_abund<span class=\"punctuation\">(</span>dirpath <span class=\"operator\">=</span> <span class=\"string\">&quot;taxa_abund&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>计算alpha多样性。结果自动存储在microtable object中。<font color=#2196F3>作为示例，此处未计算系统发育多样性（phylogenetic diversity）</font>。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 若要计算Faith&#x27;s phylogenetic diversity，设置PD = TRUE，计算速度会较慢</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>cal_alphadiv<span class=\"punctuation\">(</span>PD <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># return dataset$alpha_diversity</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>alpha_diversity<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save dataset$alpha_diversity to a directory</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_diversity&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>save_alphadiv<span class=\"punctuation\">(</span>dirpath <span class=\"operator\">=</span> <span class=\"string\">&quot;alpha_diversity&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"6-β多样性\"><a href=\"#6-β多样性\" class=\"headerlink\" title=\"6. β多样性\"></a><font color=#FF0000 >6. β多样性</font></h1><ul>\n<li><p>利用函数cal_betadiv()计算beta-多样性的距离矩阵。我们提供了四个最常用的索引：Bray-curtis、Jaccard、加权Unifrac和未加权Unifrac。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># If you do not want to calculate unifrac metrics, use unifrac = FALSE</span></span><br><span class=\"line\"><span class=\"comment\"># 需要GUniFrac package</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;GUniFrac&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>cal_betadiv<span class=\"punctuation\">(</span>unifrac <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return dataset$beta_diversity</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save dataset$beta_diversity to a directory</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;beta_diversity&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>save_betadiv<span class=\"punctuation\">(</span>dirpath <span class=\"operator\">=</span> <span class=\"string\">&quot;beta_diversity&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"7-trans-abund-class\"><a href=\"#7-trans-abund-class\" class=\"headerlink\" title=\"7. trans_abund class\"></a><font color=#FF0000 >7. trans_abund class</font></h1><ul>\n<li><p>绘制Barplot。转换分类丰度数据，以便使用ggplot2包绘制分类单元丰度。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># create trans_abund object</span></span><br><span class=\"line\"><span class=\"comment\"># use 12 Phyla with the highest abundance in the dataset.</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1 object now include the transformed abundance data t1$abund_data and other elements for the following plotting</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>绘制Barplot. We remove the sample names in x axis and add the facet to show abundance according to groups.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>others_color <span class=\"operator\">=</span> <span class=\"string\">&quot;grey70&quot;</span><span class=\"punctuation\">,</span> facet <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> xtext_keep <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> legend_text_italic <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return a ggplot2 object</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取组内平均值。The groupmean parameter can be used to obtain the group-mean barplot.</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">,</span> groupmean <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>others_color <span class=\"operator\">=</span> <span class=\"string\">&quot;grey70&quot;</span><span class=\"punctuation\">,</span> legend_text_italic <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then alluvial plot is implemented in the plot_bar function.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggalluvial&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># use_alluvium = TRUE make the alluvial plot, clustering =TRUE can be used to reorder the samples by clustering</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>use_alluvium <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> clustering <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> xtext_type_hor <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> xtext_size <span class=\"operator\">=</span> <span class=\"number\">6</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>The box plot is an excellent way to intuitionally show data distribution across groups.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># show 15 taxa at Class level</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Class&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_box<span class=\"punctuation\">(</span>group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/show_15_taxa_at_Class_level.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/show_15_taxa_at_Class_level.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"show 15 taxa at Class level\"></p>\n<ul>\n<li><p>Then we show the heatmap with the high abundant genera.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># show 40 taxa at Genus level</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">40</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_heatmap<span class=\"punctuation\">(</span>facet <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> xtext_keep <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> withmargin <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then, we show the pie chart.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">6</span><span class=\"punctuation\">,</span> groupmean <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># all pie chart in one row</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_pie<span class=\"punctuation\">(</span>facet_nrow <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"8-trans-venn-class\"><a href=\"#8-trans-venn-class\" class=\"headerlink\" title=\"8. trans_venn class\"></a><font color=#FF0000 >8. trans_venn class</font></h1><ul>\n<li><p>The trans_venn class is used for venn analysis. To analyze the unique and shared OTUs of groups, we first merge samples according to the “Group” column of sample_table.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># merge samples as one community for each group</span></span><br><span class=\"line\">dataset1 <span class=\"operator\">&lt;-</span> meco_dataset<span class=\"operator\">$</span>merge_samples<span class=\"punctuation\">(</span>use_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># dataset1 is a new microtable object</span></span><br><span class=\"line\"><span class=\"comment\"># create trans_venn object</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_venn<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset1<span class=\"punctuation\">,</span> ratio <span class=\"operator\">=</span> <span class=\"string\">&quot;seqratio&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_venn<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># The integer data is OTU number</span></span><br><span class=\"line\"><span class=\"comment\"># The percentage data is the sequence number/total sequence number</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>When the groups are too many to show with venn plot, we can use petal plot.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use &quot;Type&quot; column in sample_table</span></span><br><span class=\"line\">dataset1 <span class=\"operator\">&lt;-</span> meco_dataset<span class=\"operator\">$</span>merge_samples<span class=\"punctuation\">(</span>use_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_venn<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset1<span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_venn<span class=\"punctuation\">(</span>petal_plot <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Sometimes, we are interested in the unique and shared species. In another words, the composition of the unique or shared species may account for the different and similar parts of ecological characteristics across groups[10]. For this goal, we first transform the results of venn plot to the traditional species-sample table, that is, another object of microtable class.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset1 <span class=\"operator\">&lt;-</span> meco_dataset<span class=\"operator\">$</span>merge_samples<span class=\"punctuation\">(</span>use_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_venn<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset1<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># transform venn results to the sample-species table, here do not consider abundance, only use presence/absence information.</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>trans_venn_com<span class=\"punctuation\">(</span>use_OTUs_frequency <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t2 is a new microtable class, each part is considered as a sample</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>t2<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We use bar plot to show the composition at the Genus level.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate taxa abundance, that is, the frequency</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_abund<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># transform and plot</span></span><br><span class=\"line\">t3 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> t2<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t3<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>bar_type <span class=\"operator\">=</span> <span class=\"string\">&quot;part&quot;</span><span class=\"punctuation\">,</span> legend_text_italic <span class=\"operator\">=</span> <span class=\"built_in\">T</span><span class=\"punctuation\">,</span> ylab_title <span class=\"operator\">=</span> <span class=\"string\">&quot;Frequency (%)&quot;</span><span class=\"punctuation\">,</span> xtext_type_hor <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We also try to use pie chart to show the compositions at the Phylum level</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t3 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> t2<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">8</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t3<span class=\"operator\">$</span>plot_pie<span class=\"punctuation\">(</span>facet_nrow <span class=\"operator\">=</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span> use_colors <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span>RColorBrewer<span class=\"operator\">::</span>brewer.pal<span class=\"punctuation\">(</span><span class=\"number\">8</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Dark2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;grey50&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"9-trans-alpha-class\"><a href=\"#9-trans-alpha-class\" class=\"headerlink\" title=\"9. trans_alpha class\"></a><font color=#FF0000 >9. trans_alpha class</font></h1><ul>\n<li><p>Alpha diversity can be transformed and plotted using trans_alpha class. Creating trans_alpha object can return two data frame: alpha_data and alpha_stat.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_alpha<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$alpha_stat</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>alpha_stat<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then, we test the differences among groups using the KW rank sum test and anova with multiple comparisons.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_diff<span class=\"punctuation\">(</span>method <span class=\"operator\">=</span> <span class=\"string\">&quot;KW&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_alpha_diff</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_alpha_diff<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Groups</th>\n<th>Measure</th>\n<th>Test method</th>\n<th>p.value</th>\n<th>Significance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>T16 vs T18</td>\n<td>Observed</td>\n<td>KW</td>\n<td>2.601895e-03</td>\n<td>**</td>\n</tr>\n<tr>\n<td>2</td>\n<td>T16 vs T20</td>\n<td>Observed</td>\n<td>KW</td>\n<td>3.011399e-08</td>\n<td>***</td>\n</tr>\n<tr>\n<td>3</td>\n<td>T16 vs T21</td>\n<td>Observed</td>\n<td>KW</td>\n<td>2.174162e-04</td>\n<td>***</td>\n</tr>\n<tr>\n<td>4</td>\n<td>T16 vs T17</td>\n<td>Observed</td>\n<td>KW</td>\n<td>1.234229e-03</td>\n<td>**</td>\n</tr>\n<tr>\n<td>5</td>\n<td>T18 vs T20</td>\n<td>Observed</td>\n<td>KW</td>\n<td>7.319258e-08</td>\n<td>***</td>\n</tr>\n</tbody></table>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_diff<span class=\"punctuation\">(</span>method <span class=\"operator\">=</span> <span class=\"string\">&quot;anova&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_alpha_diff</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_alpha_diff</span><br></pre></td></tr></table></figure>\n  <div style=\"overflow-x:auto;\">\n  <table>\n\n<table>\n<thead>\n<tr>\n<th>Observed</th>\n<th>Chao1</th>\n<th>ACE</th>\n<th>Shannon</th>\n<th>Simpson</th>\n<th>InvSimpson</th>\n<th>Fisher</th>\n<th>Coverage</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>T18</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n</tr>\n<tr>\n<td>T16</td>\n<td>b</td>\n<td>b</td>\n<td>b</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>b</td>\n</tr>\n<tr>\n<td>T17</td>\n<td>c</td>\n<td>c</td>\n<td>c</td>\n<td>b</td>\n<td>a</td>\n<td>b</td>\n<td>c</td>\n</tr>\n<tr>\n<td>T21</td>\n<td>d</td>\n<td>d</td>\n<td>d</td>\n<td>c</td>\n<td>a</td>\n<td>c</td>\n<td>d</td>\n</tr>\n<tr>\n<td>T20</td>\n<td>e</td>\n<td>e</td>\n<td>e</td>\n<td>d</td>\n<td>b</td>\n<td>d</td>\n<td>e</td>\n</tr>\n<tr>\n<td></table></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></div></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n</li>\n<li><p>Now, let us plot the mean and se of alpha diversity for each group, and add the duncan.test (agricolae package) result.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_alpha<span class=\"punctuation\">(</span>add_letter <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We can also use the boxplot to show the paired comparisons directly.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_alpha<span class=\"punctuation\">(</span>pair_compare <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"10-trans-beta-class\"><a href=\"#10-trans-beta-class\" class=\"headerlink\" title=\"10. trans_beta class\"></a><font color=#FF0000 >10. trans_beta class</font></h1><ul>\n<li><p>The distance matrix of beta diversity can be transformed and plotted using trans_beta class. The analysis referred to the beta diversity in this class mainly include ordination, group distance, clustering and manova. We first show the ordination using PCoA.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># we first create an object and select PCoA for ordination</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">,</span> ordination <span class=\"operator\">=</span> <span class=\"string\">&quot;PCoA&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_ordination is the ordination result list</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>t1<span class=\"operator\">$</span>res_ordination<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># plot the PCoA result</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_ordination<span class=\"punctuation\">(</span>plot_color <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> plot_shape <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> plot_group_ellipse <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then we plot and compare the group distances.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate and plot sample distances within groups</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_group_distance</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># calculate and plot sample distances between groups (报错：错误: Insufficient values in manual scale. 10 needed but only 8 provided.)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span>within_group <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Clustering plot is also a frequently used method.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use replace_name to set the label name, group parameter used to set the color (报错：找不到对象&#x27;dataset&#x27;)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_clustering<span class=\"punctuation\">(</span>group <span class=\"operator\">=</span> <span class=\"string\">&quot;Indexs&quot;</span><span class=\"punctuation\">,</span> replace_name <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;Water-depth(m)&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Indexs&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>perMANOVA is often used in the differential test of distances among groups.</p>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># manova for all groups</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_manova<span class=\"punctuation\">(</span>cal_manova_all <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_manova<span class=\"operator\">$</span>aov.tab</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Permutation: free</th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Number of permutations: 999</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Terms added sequentially (first to last)</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Df</td>\n<td>SumsOfSqs</td>\n<td>MeanSqs</td>\n<td>F.Model</td>\n<td>R<sup>2</sup></td>\n<td>Pr(&gt;F)</td>\n</tr>\n<tr>\n<td>Site</td>\n<td>4</td>\n<td>15.669</td>\n<td>3.9173</td>\n<td>19.445</td>\n<td>0.48077</td>\n<td>0.001 ***</td>\n</tr>\n<tr>\n<td>Residuals</td>\n<td>84</td>\n<td>16.923</td>\n<td>0.2015</td>\n<td></td>\n<td>0.51923</td>\n<td></td>\n</tr>\n<tr>\n<td>Total</td>\n<td>88</td>\n<td>32.592</td>\n<td></td>\n<td></td>\n<td>1.00000</td>\n<td></td>\n</tr>\n</tbody></table>\n<p> &gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</p>\n</li>\n</ul>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># manova for each paired groups</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_manova<span class=\"punctuation\">(</span>cal_manova_paired <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_manova</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Groups</th>\n<th>measure</th>\n<th>permutations</th>\n<th>R<sup>2</sup></th>\n<th>p.value</th>\n<th>Significance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>T16 vs T18</td>\n<td>bray</td>\n<td>999</td>\n<td>0.2748773</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>2</td>\n<td>T16 vs T20</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4539103</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>3</td>\n<td>T16 vs T21</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4102009</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>4</td>\n<td>T16 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.2243404</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>5</td>\n<td>T18 vs T20</td>\n<td>bray</td>\n<td>999</td>\n<td>0.3736482</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>6</td>\n<td>T18 vs T21</td>\n<td>bray</td>\n<td>999</td>\n<td>0.3504104</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>7</td>\n<td>T18 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.2147055</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>8</td>\n<td>T20 vs T21</td>\n<td>bray</td>\n<td>999</td>\n<td>0.3575765</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>9</td>\n<td>T20 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4589248</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>10</td>\n<td>T21 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4395176</td>\n<td>0.001</td>\n</tr>\n</tbody></table>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># manova for specified group set: here &quot;Group + Type&quot;</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_manova<span class=\"punctuation\">(</span>cal_manova_set <span class=\"operator\">=</span> <span class=\"string\">&quot;Site+ Indexs&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_manova<span class=\"operator\">$</span>aov.tab</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Permutation: free</th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Number of permutations: 999</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Terms added sequentially (first to last)</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Df</td>\n<td>SumsOfSqs</td>\n<td>MeanSqs</td>\n<td>F.Model</td>\n<td>R<sup>2</sup></td>\n<td>Pr(F)</td>\n</tr>\n<tr>\n<td>Site</td>\n<td>4</td>\n<td>15.669</td>\n<td>4</td>\n<td>0</td>\n<td>0.48077</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Indexs</td>\n<td>84</td>\n<td>16.923</td>\n<td>0</td>\n<td>0</td>\n<td>0.51923</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Residuals</td>\n<td>0</td>\n<td>0.000</td>\n<td>Inf</td>\n<td></td>\n<td>0.00000</td>\n<td></td>\n</tr>\n<tr>\n<td>Total</td>\n<td>88</td>\n<td>32.592</td>\n<td></td>\n<td></td>\n<td>1.00000</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"11-trans-diff-class\"><a href=\"#11-trans-diff-class\" class=\"headerlink\" title=\"11. trans_diff class\"></a><font color=#FF0000 >11. trans_diff class</font></h1><ul>\n<li><p>Differential abundance test is a very important part in the microbial community data analysis. It can be used to find the significant taxa in determining the community differences across groups. Currently, trans_diff class have three famous approaches to perform this analysis: metastat[11], LEfSe[12] and random forest. Metastat depends on the permutations and t-test and performs well on the sparse data. It is used for the comparisons between two groups.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># metastat analysis at Genus level</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;metastat&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> metastat_taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_metastat is the result</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_metastat_group_matrix is the group comparisons order for plotting</span></span><br><span class=\"line\"><span class=\"comment\"># plot the first paired groups, choose_group = 1</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_metastat<span class=\"punctuation\">(</span>use_number <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">10</span><span class=\"punctuation\">,</span> qvalue <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span> choose_group <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>LEfSe combines the non-parametric test and linear discriminant analysis. We implement this approach in this package instead of the python version.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;lefse&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> alpha <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span> lefse_subgroup <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_lefse is the LEfSe result</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_abund is the abundance information</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_lefse_bar<span class=\"punctuation\">(</span>LDA_score <span class=\"operator\">=</span> <span class=\"number\">4</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We can also plot the abundance of taxa detected using LEfSe.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_diff_abund<span class=\"punctuation\">(</span>use_number <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">30</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then, we show the cladogram of the differential features in the taxonomic tree. There are too many taxa in this dataset. As an example, we only use the highest 200 abundant taxa in the tree and 50 differential features. We only show the full taxonomic label at Phylum level and use letters at other levels to reduce the text overlap.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># clade_label_level 5 represent phylum level in this analysis</span></span><br><span class=\"line\"><span class=\"comment\"># require ggtree package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_lefse_cladogram<span class=\"punctuation\">(</span>use_taxa_num <span class=\"operator\">=</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> use_feature_num <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> clade_label_level <span class=\"operator\">=</span> <span class=\"number\">5</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>There may be a problem related with the taxonomic labels in the plot. When the levels used are too many, the taxonomic labels may have too much overlap. However, if we only indicate the Phylum labels, the taxa in the legend with marked letters are too many. At this time, you can select the taxa that you want to show in the plot manually like the following operation.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># choose some taxa according to the positions in the previous picture; those taxa labels have minimum overlap</span></span><br><span class=\"line\">use_labels <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;c__Deltaproteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Actinobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Rhizobiales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Proteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Bacteroidetes&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">\t<span class=\"string\">&quot;o__Micrococcales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Acidobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Verrucomicrobia&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Firmicutes&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">\t<span class=\"string\">&quot;p__Chloroflexi&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Acidobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Gammaproteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Betaproteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__KD4-96&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;c__Bacilli&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Gemmatimonadales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;f__Gemmatimonadaceae&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Bacillales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Rhodobacterales&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># then use parameter select_show_labels to show</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_lefse_cladogram<span class=\"punctuation\">(</span>use_taxa_num <span class=\"operator\">=</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> use_feature_num <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> select_show_labels <span class=\"operator\">=</span> use_labels<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># Now we can see that more taxa names appear in the tree</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>If you are interested in taxonomic tree, you can also use metacoder package[13] to plot the taxonomic tree based on the selected taxa. We do not show the usage here.</p>\n</li>\n<li><p>The third approach is rf, which depends on the random forest[14, 15] and the non-parametric test. The current method can calculate random forest by bootstrapping like the method in LEfSe and only use the significant features. MeanDecreaseGini is selected as the indicator value in the analysis.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use Genus level for parameter rf_taxa_level, if you want to use all taxa, change to &quot;all&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># nresam = 1 and boots = 1 represent no bootstrapping and use all samples directly</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;rf&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> rf_taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rf is the result stored in the object</span></span><br><span class=\"line\"><span class=\"comment\"># plot the result</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>plot_diff_abund<span class=\"punctuation\">(</span>use_number <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> only_abund_plot <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">gridExtra<span class=\"operator\">::</span>grid.arrange<span class=\"punctuation\">(</span>t2<span class=\"operator\">$</span>p1<span class=\"punctuation\">,</span> t2<span class=\"operator\">$</span>p2<span class=\"punctuation\">,</span> ncol<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> nrow <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> widths <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">,</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># the middle asterisk represent the significances</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"12-trans-env-class\"><a href=\"#12-trans-env-class\" class=\"headerlink\" title=\"12. trans_env class\"></a><font color=#FF0000 >12. trans_env class</font></h1><ul>\n<li><p>分析环境因子对微生物群落结构和组装的影响：RDA分析(db-RDA和RDA).</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># add_data is used to add the environmental data</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">7</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># use bray-curtis distance to do dbrda</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_rda<span class=\"punctuation\">(</span>use_dbrda <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> use_measure <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rda is the result list stored in the object</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>trans_rda<span class=\"punctuation\">(</span>adjust_arrow_length <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> max_perc_env <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rda_trans is the transformed result for plotting</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_rda<span class=\"punctuation\">(</span>plot_color <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># use Genus</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_rda<span class=\"punctuation\">(</span>use_dbrda <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># As the main results of RDA are related with the projection and angles between different arrows,</span></span><br><span class=\"line\"><span class=\"comment\"># we adjust the length of the arrow to show them clearly using several parameters.</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>trans_rda<span class=\"punctuation\">(</span>show_taxa <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span> adjust_arrow_length <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> max_perc_env <span class=\"operator\">=</span> <span class=\"number\">1500</span><span class=\"punctuation\">,</span> max_perc_tax <span class=\"operator\">=</span> <span class=\"number\">3000</span><span class=\"punctuation\">,</span> min_perc_env <span class=\"operator\">=</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> min_perc_tax <span class=\"operator\">=</span> <span class=\"number\">300</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rda_trans is the transformed result for plotting</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_rda<span class=\"punctuation\">(</span>plot_color <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Mantel test 用于检测环境因子和距离矩阵之间是否具有显著的相关性。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_mantel<span class=\"punctuation\">(</span>use_measure <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_mantel</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_mantel</span><br></pre></td></tr></table></figure>\n\n  <div style=\"overflow-x:auto;\">\n  <table>\n  \n<table>\n<thead>\n<tr>\n<th></th>\n<th>variable_name</th>\n<th>cor_method</th>\n<th>corr_res</th>\n<th>p_res</th>\n<th>significance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>TN</strong></td>\n<td>pearson</td>\n<td>0.5571885</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>TC</strong></td>\n<td>pearson</td>\n<td>0.5712239</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>TS</strong></td>\n<td>pearson</td>\n<td>0.2665453</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>TOC</strong></td>\n<td>pearson</td>\n<td>0.3540337</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Salinity</strong></td>\n<td>pearson</td>\n<td>0.2782537</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>6</td>\n<td>Temperature</td>\n<td>pearson</td>\n<td>0.5856050</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>Dissolved.oxygen</strong></td>\n<td>pearson</td>\n<td>0.4358422</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>8</td>\n<td>Surface.chlorophyll.concentrations</td>\n<td>pearson</td>\n<td>0.2586823</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>9</td>\n<td>pH</td>\n<td>pearson</td>\n<td>0.4498964</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>PAR</strong></td>\n<td>pearson</td>\n<td>0.1712861</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>11</td>\n<td>Density</td>\n<td>pearson</td>\n<td>0.5682679</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>12</td>\n<td>Turbidity</td>\n<td>pearson</td>\n<td>0.2260436</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td></table></div></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n</li>\n<li><p>环境变量与分类群（taxa）的相关性对分析和推断影响群落结构的因素具有重要意义。在本例中，我们首先进行了差异丰度检验（differential abundance test）和随机森林分析（random forest），得到了重要的属（Genus）。然后利用这些分类单元进行相关性分析。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># first create trans_diff object</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;rf&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> rf_taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># then create trans_env object</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">7</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># calculate correlation</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>use_data <span class=\"operator\">=</span> <span class=\"string\">&quot;other&quot;</span><span class=\"punctuation\">,</span> p_adjust_method <span class=\"operator\">=</span> <span class=\"string\">&quot;fdr&quot;</span><span class=\"punctuation\">,</span> other_taxa <span class=\"operator\">=</span> t2<span class=\"operator\">$</span>res_rf<span class=\"operator\">$</span>Taxa<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">60</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_cor </span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用ggplot2或pheatmap进行可视化</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># default ggplot2 method</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># clustering heatmap; require pheatmap package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span>pheatmap <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4ggplot2.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4ggplot2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"7个环境变量与分类群ggplot2\"></p>\n<p><img src=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4%E7%9B%B8%E5%85%B3%E6%80%A7_pheatmap.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4%E7%9B%B8%E5%85%B3%E6%80%A7_pheatmap.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"7个环境变量与分类群相关性_pheatmap\"></p>\n<ul>\n<li><p>各组内的环境变量与分类群taxa之间的关系</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate correlations for different groups using parameter by_group</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>by_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> use_data <span class=\"operator\">=</span> <span class=\"string\">&quot;other&quot;</span><span class=\"punctuation\">,</span> p_adjust_method <span class=\"operator\">=</span> <span class=\"string\">&quot;fdr&quot;</span><span class=\"punctuation\">,</span> other_taxa <span class=\"operator\">=</span> t2<span class=\"operator\">$</span>res_rf<span class=\"operator\">$</span>Taxa<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">60</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_cor</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/correlations_between_environmental_variables_and_60_taxa.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/correlations_between_environmental_variables_and_60_taxa.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"correlations_between_environmental_variables_and_60_taxa\"></p>\n<ul>\n<li><p>环境因子与alpha-多样性之间的关系</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">7</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># use add_abund_table parameter to add the extra data table</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>add_abund_table <span class=\"operator\">=</span> meco_dataset<span class=\"operator\">$</span>alpha_diversity<span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/relationship_between_7_environmental_factors_and_alpha_diversity.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/relationship_between_7_environmental_factors_and_alpha_diversity.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"relationship_between_7_environmental_factors_and_alpha_diversity\"></p>\n<h1 id=\"13-trans-nullmodel-class\"><a href=\"#13-trans-nullmodel-class\" class=\"headerlink\" title=\"13. trans_nullmodel class\"></a><font color=#FF0000 >13. trans_nullmodel class</font></h1><ul>\n<li><p>近几十年来，系统发育分析和空模型（null model）的结合，通过增加系统发育维度（phylogeny dimension），更加有力地促进了生态位和中性（niche and neutral）对群落组装影响的推断[16，17]。trans_nullmodel class提供了一个封装，包括对系统发育信号、beta平均成对系统发育距离（beta mean pairwise phylogenetic distance，betaMPD）、beta平均最近分类单元距离（beta mean nearest taxon distance，betaMNTD）、beta最近分类单元指数（beta nearest taxon index，betaNTI）、beta净相关指数（beta net relatedness index，betaNRI）和基于Bray-Curtis的Raup-Crick（Bray-Curtis-based Raup-Crick，RCbray）的计算。系统发育信号分析的方法基于mantel相关图（mantel correlogram）[18]，与其他方法相比，系统发育信号的变化是直观而清晰的。betaMNTD和betaMPD的算法已经过优化，比picante包中的算法更快[3]。RCbray和betaNTI（或betaNRI）之间的组合可用于推断在特定假设下支配群落装配（community assembly）的每个生态过程（ecological process）的强度[17]。这可以通过函数cal_process()来解析每个推断进程（ecological process）的百分比来实现。<font color=#2196F3 ><strong>我们首先检查系统发育信号：</strong></font></p>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># generate trans_nullmodel object; use 10000 OTUs as example</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_nullmodel<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">,</span> taxa_number <span class=\"operator\">=</span> <span class=\"number\">10000</span><span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># use TOC as the test variable (__报错：Error in cor(as.vector(xdis), ydis, method = method, use = use) : </span></span><br><span class=\"line\">  cov<span class=\"operator\">/</span>cor中有遗漏值__<span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_mantel_corr<span class=\"punctuation\">(</span>use_env <span class=\"operator\">=</span> <span class=\"string\">&quot;TOC&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_mantel_corr</span></span><br><span class=\"line\"><span class=\"comment\"># plot the mantel correlogram(__报错：Error in names(x) &lt;- value : &#x27;names&#x27;属性的长度[4]必需和矢量的长度[0]一样__)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_mantel_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>betaNRI（ses.betampd）用于显示“basal”系统发育转换（phylogenetic turnover）[18]。与betaNTI相比，它能捕获更多与深层系统发育（deep phylogeny）相关的转换信息（turnover information）。值得注意的是，经过几十年的发展，出现了许多空模型（null models）。在trans-nullmodel class中，我们随机化了物种的系统发育相关性。这种洗牌方法（shuffling approach）固定了观察到的物种α-多样性和β-多样性的水平，以探讨观察到的系统发育转换是否与空模型（物种间的系统发育关系是随机的）显著不同。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 运行500次null model</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_ses_betampd<span class=\"punctuation\">(</span>runs<span class=\"operator\">=</span><span class=\"number\">500</span><span class=\"punctuation\">,</span> abundance.weighted <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 返回t1$res_ses_betampd</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>可以使用trans_beta class中的plot_group_distance function绘制betaNRI图。结果表明T20和T21的平均betaNRI 显著高于其它三者，表明T20和T21中的basal phylogenetic turnover是高的。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 将betaNRI矩阵加入到beta_diversity列表中</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">[[</span><span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>res_ses_betampd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用measure &quot;betaNRI&quot;创建trans_beta class</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># transform the distance for each group</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果可视化</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">&lt;-</span> t2<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/betaNRI_all.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/betaNRI_all.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"betaNRI all\"></p>\n<ul>\n<li><p>若要单独的对每个组进行 null model analysis，例如每个组作为一个物种池（species pool），我们可以分别为每个组计算结果。 我们发现，当分别对每个组进行betaNRI 分析时，CW和TW间的mean betaNRI没有显著差异，且二者均显著高于IW ，揭示了在将每个区域视为特定物种库的条件下，CW和TW中变量选择的强度（strength of variable selection）可能相似。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建一个列表用于存放trans_nullmodel的结果</span></span><br><span class=\"line\">sesbeta_each <span class=\"operator\">&lt;-</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">group_col <span class=\"operator\">&lt;-</span> <span class=\"string\">&quot;Site&quot;</span></span><br><span class=\"line\">all_groups <span class=\"operator\">&lt;-</span> unique<span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>sample_table<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> group_col<span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 对每个组分别进行计算</span></span><br><span class=\"line\"><span class=\"keyword\">for</span><span class=\"punctuation\">(</span>i <span class=\"keyword\">in</span> all_groups<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\"># like the above operation, but need provide &#x27;group&#x27; and &#x27;select_group&#x27;</span></span><br><span class=\"line\">\ttest <span class=\"operator\">&lt;-</span> trans_nullmodel<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> group_col<span class=\"punctuation\">,</span> select_group <span class=\"operator\">=</span> i<span class=\"punctuation\">,</span> taxa_number <span class=\"operator\">=</span> <span class=\"number\">1000</span><span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\ttest<span class=\"operator\">$</span>cal_ses_betampd<span class=\"punctuation\">(</span>runs <span class=\"operator\">=</span> <span class=\"number\">500</span><span class=\"punctuation\">,</span> abundance.weighted <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">\tsesbeta_each<span class=\"punctuation\">[[</span>i<span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> test<span class=\"operator\">$</span>res_ses_betampd</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并结果并重塑（reshape），得到一个对称矩阵（symmetrical matrix）</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>reshape2<span class=\"punctuation\">)</span></span><br><span class=\"line\">test <span class=\"operator\">&lt;-</span> lapply<span class=\"punctuation\">(</span>sesbeta_each<span class=\"punctuation\">,</span> melt<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> do.call<span class=\"punctuation\">(</span>rbind<span class=\"punctuation\">,</span> .<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> reshape2<span class=\"operator\">::</span>dcast<span class=\"punctuation\">(</span>.<span class=\"punctuation\">,</span> Var1<span class=\"operator\">~</span>Var2<span class=\"punctuation\">,</span> value.var <span class=\"operator\">=</span> <span class=\"string\">&quot;value&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> `row.names&lt;-`<span class=\"punctuation\">(</span>.<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> .<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"operator\">-</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> drop <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如同上述操作</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">[[</span><span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> test</span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">&lt;-</span> t2<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/betaNRI_individual.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/betaNRI_individual.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"betaNRI individual\"></p>\n<ul>\n<li><p>BetaNTI(ses.betamntd) 可用于指示系统发育的末端转换（ phylogenetic terminal turnover） [17]</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 运行500次null model</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_ses_betamntd<span class=\"punctuation\">(</span>runs<span class=\"operator\">=</span><span class=\"number\">500</span><span class=\"punctuation\">,</span> abundance.weighted <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 返回t1$res_ses_betamntd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将betaNTI矩阵加入到beta_diversity列表中</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">[[</span><span class=\"string\">&quot;betaNTI&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>res_ses_betamntd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用measure &quot;betaNRI&quot;创建trans_beta class</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;betaNTI&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># transform the distance for each group</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果可视化</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">&lt;-</span> t2<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>cal_rcbray()功能用于计算RCbray (Bray-Curtis-based Raup-Crick) ，以评估成分转换（compositional turnover）是否主要受漂移控制[19]。我们应用空模型（null model）通过从每个物种池中随机采样个体来模拟物种分布，同时保留物种发生频率（species occurrence frequency）和样本物种丰富度（sample species richness）[18]。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># result stored in t1$res_rcbray</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_rcbray<span class=\"punctuation\">(</span>runs <span class=\"operator\">=</span> <span class=\"number\">1000</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_rcbray</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>作为一个例子，我们还计算了引用文献[17，18]中所示的在群落组装（community assembly）上推断过程（ inferred processes ）所占的比例。在此示例中，具有显着betaNTI值（|βNTI|&gt; 2）的成对比较部分是估计的选择（Selection）造成影响； βNTI&gt; 2代表异构选择（heterogeneous ）； βNTI&lt;-2表示同质选择（homogeneous ）。 RCbray值表征了随机分配（randomization）下观察到的Bray-Curtis和Bray-Curtis期望值之间的偏差大小（magnitude of deviation）。 | RCbray | &gt; 0.95被认为是显着的。 |βNTI| &lt; 2和RCbray &gt; +0.95被视为受散播限制（Dispersal Limitation）与漂移（Drift）相结合的影响。 |βNTI| &lt; 2和RCbray &lt; -0.95被视为均质分散（Homogenizing Dispersal）影响的估计值。 |βNTI| &lt; 2和|RCbray| &lt; 0.95估算了漂移单独作用的影响。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use betaNTI and rcbray to evaluate processes</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_process<span class=\"punctuation\">(</span>use_betamntd <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_process</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_process</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>process</th>\n<th>percentage</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>variable selection</td>\n<td>0.4341164</td>\n</tr>\n<tr>\n<td>2</td>\n<td>homogeneous selection</td>\n<td>63.6874362</td>\n</tr>\n<tr>\n<td>3</td>\n<td>dispersal limitation</td>\n<td>0.0000000</td>\n</tr>\n<tr>\n<td>4</td>\n<td>homogeneous dispersal</td>\n<td>14.8365679</td>\n</tr>\n<tr>\n<td>5</td>\n<td>drift</td>\n<td>21.0418795</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<h1 id=\"14-trans-network-class\"><a href=\"#14-trans-network-class\" class=\"headerlink\" title=\"14. trans_network class\"></a><font color=#FF0000 >14. trans_network class</font></h1><h2 id=\"correlation-based-network\"><a href=\"#correlation-based-network\" class=\"headerlink\" title=\"correlation-based network\"></a><font color=#FF9800 >correlation-based network</font></h2><ul>\n<li>准备R包并进行计算相关性  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;WGCNA&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>WGCNA<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 以下3选1</span></span><br><span class=\"line\"><span class=\"comment\"># 1. Use R base cor.test, slow</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_network<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> cal_cor <span class=\"operator\">=</span> <span class=\"string\">&quot;base&quot;</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;OTU&quot;</span><span class=\"punctuation\">,</span> filter_thres <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span> cor_method <span class=\"operator\">=</span> <span class=\"string\">&quot;spearman&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_cor_p list; one table: correlation; another: p value</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. SparCC method, require SpiecEasi package</span></span><br><span class=\"line\"><span class=\"comment\"># SparCC is very slow, so consider filtering more species with low abundance</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_network<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> cal_cor <span class=\"operator\">=</span> <span class=\"string\">&quot;SparCC&quot;</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;OTU&quot;</span><span class=\"punctuation\">,</span> filter_thres <span class=\"operator\">=</span> <span class=\"number\">0.001</span><span class=\"punctuation\">,</span> SparCC_simu_num <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. When the OTU number is large, use R WGCNA package to replace R base to calculate correlations</span></span><br><span class=\"line\"><span class=\"comment\"># require WGCNA package</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_network<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> dataset<span class=\"punctuation\">,</span> cal_cor <span class=\"operator\">=</span> <span class=\"string\">&quot;WGCNA&quot;</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;OTU&quot;</span><span class=\"punctuation\">,</span> filter_thres <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span> cor_method <span class=\"operator\">=</span> <span class=\"string\">&quot;spearman&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"构建网络\"><a href=\"#构建网络\" class=\"headerlink\" title=\"构建网络\"></a><font color=#FF9800 >构建网络</font></h2><ul>\n<li><p>COR_optimization &#x3D; TRUE represent using RMT theory to find the optimized correlation threshold instead of the COR_cut.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># construct network; require igraph package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_network<span class=\"punctuation\">(</span>p_thres <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span> COR_optimization <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_network</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (可选) use arbitrary coefficient threshold to contruct network</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_network<span class=\"punctuation\">(</span>p_thres <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span> COR_cut <span class=\"operator\">=</span> <span class=\"number\">0.73</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save network</span></span><br><span class=\"line\"><span class=\"comment\"># open the gexf file using Gephi(https://gephi.org/)</span></span><br><span class=\"line\"><span class=\"comment\"># require rgexf package</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;rgexf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>save_network<span class=\"punctuation\">(</span>filepath <span class=\"operator\">=</span> <span class=\"string\">&quot;network.gexf&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Now, we show the node colors with the Phylum information and the edges colors with the positive and negative correlations. All the data used has been stored in the network.gexf file, including modules classifications, Phylum information and edges classifications.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate network attributes</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_network_attr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_network_attr</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># classify the node; return t1$res_node_type</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_node_type<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_node_type</span></span><br><span class=\"line\"><span class=\"comment\"># we retain the file for the following example in trans_func part</span></span><br><span class=\"line\">network_node_type <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>res_node_type</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># plot node roles in terms of the within-module connectivity and among-module connectivity</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_taxa_roles<span class=\"punctuation\">(</span>use_type <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># plot node roles with phylum information</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_taxa_roles<span class=\"punctuation\">(</span>use_type <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Now, we show the eigengene analysis of modules. The eigengene of a module, i.e. the first principal component of PCA, represents the main variance of the abundance in the species of the module.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_eigen<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_eigen</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>出错了</strong>！Then we perform correlation heatmap to show the relationships between eigengenes and environmental factors.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># create trans_env object like the above operation</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data_16S<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">4</span><span class=\"operator\">:</span><span class=\"number\">11</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># calculate correlations</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>add_abund_table <span class=\"operator\">=</span> t1<span class=\"operator\">$</span>res_eigen<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># plot the correlation heatmap</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>The function cal_sum_links() is used to sum the links (edge) number from one taxa to another or in the same taxa. The function plot_sum_links() is used to show the result from the function cal_sum_links(). This is very useful to fast see how many nodes are connected between different taxa or within one taxa. In terms of “Phylum” level in the tutorial, the function cal_sum_links() sum the linkages number from one Phylum to another Phylum or the linkages in the same Phylum. So the numbers along the outside of the circular plot represent how many edges or linkages are related with the Phylum. For example, in terms of Proteobacteria, there are roughly total 900 edges associated with the OTUs in Proteobacteria, in which roughly 200 edges connect both OTUs in Proteobacteria and roughly 150 edges connect the OTUs from Proteobacteria with the OTUs from Chloroflexi.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devtools<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;mattflor/chorddiag&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># calculate the links between or within taxonomic ranks (报错：Error in ecount(network) : 没有&quot;ecount&quot;这个函数)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_sum_links<span class=\"punctuation\">(</span>taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_sum_links_pos and t1$res_sum_links_neg</span></span><br><span class=\"line\"><span class=\"comment\"># require chorddiag package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_sum_links<span class=\"punctuation\">(</span>plot_pos <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> plot_num <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"15-trans-func-class\"><a href=\"#15-trans-func-class\" class=\"headerlink\" title=\"15. trans_func class\"></a><font color=#FF0000 >15. trans_func class</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Identify microbial traits</span></span><br><span class=\"line\"><span class=\"comment\"># create object of trans_func</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_func<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># mapping the taxonomy to the database</span></span><br><span class=\"line\"><span class=\"comment\"># the function can recognize prokaryotes or fungi automatically</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_spe_func<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t2$res_spe_func, 1 represent function exists, 0 represent no or cannot confirmed.</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>The percentages of the OTUs having the same trait can reflect the functional redundancy of this function in the community or the module in the network.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate the percentages of OTUs for each trait in each module of network</span></span><br><span class=\"line\"><span class=\"comment\"># use_community = FALSE represent calculating module, not community, node_type_table provide the module information</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_spe_func_perc<span class=\"punctuation\">(</span>use_community <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> node_type_table <span class=\"operator\">=</span> network_node_type<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t2$res_spe_func_perc</span></span><br><span class=\"line\"><span class=\"comment\"># we only plot some important traits, so we use the default group list to filter and show the traits.</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>plot_spe_func_perc<span class=\"punctuation\">(</span>select_samples <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;M&quot;</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">10</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># M represents module, ordered by the nodes number from high to low</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Tax4Fun requires a strict input file demand on the taxonomic information. To analyze the trimmed or changed OTU data in R with Tax4Fun, we provide a link to the Tax4Fun functional prediction.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_func<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># install Tax4Fun package and download SILVA123 ref data from  http://tax4fun.gobics.de/</span></span><br><span class=\"line\">wget https<span class=\"operator\">:</span><span class=\"operator\">/</span><span class=\"operator\">/</span>github.com<span class=\"operator\">/</span>bwemheu<span class=\"operator\">/</span>Tax4Fun2<span class=\"operator\">/</span>releases<span class=\"operator\">/</span>download<span class=\"operator\">/</span><span class=\"number\">1.1</span>.5<span class=\"operator\">/</span>Tax4Fun2_1.1.5.tar.gz</span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span>pkgs <span class=\"operator\">=</span> <span class=\"string\">&quot;Tax4Fun2_1.1.5.tar.gz&quot;</span><span class=\"punctuation\">,</span> repos <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> source <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># decompress SILVA123; provide path in folderReferenceData as you put</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_tax4fun<span class=\"punctuation\">(</span>folderReferenceData <span class=\"operator\">=</span> <span class=\"string\">&quot;./SILVA123&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return two files: t1$tax4fun_KO: KO file; t1$tax4fun_path: pathway file.</span></span><br><span class=\"line\"><span class=\"comment\"># t1$tax4fun_KO$Tax4FunProfile[1:5, 1:2]</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"16-知识点\"><a href=\"#16-知识点\" class=\"headerlink\" title=\"16. 知识点\"></a><font color=#FF0000 >16. 知识点</font></h1><h2 id=\"确定性过程和随机过程\"><a href=\"#确定性过程和随机过程\" class=\"headerlink\" title=\"确定性过程和随机过程\"></a><font color=#FF9800 >确定性过程和随机过程</font></h2><ul>\n<li><p>The term <font color=#2196F3 size=5><b>“deterministic process”</b></font> refers to two types of selective forces, namely, those that lead to either more (i.e. homogeneous selection) or less (i.e. heterogeneous selection) similar structures among communities due to homogeneous and heterogeneous environmental pressures, respectively (Zhou &amp; Ning, 2017).  <font color=#2196F3 size=5><b>确定性过程</b></font>包括两种选择力，即分别导致更加相似（即同质选择）或更少相似（即异质选择）的群落间的结构的同质和异质环境压力。</p>\n</li>\n<li><p>The term<font color=#2196F3 size=5><b> “stochastic process” </b></font>refers to homogenizing dispersal, dispersal limitation (combined with drift) and pure drift, which can obscure the turnover among microbial communities due to high dispersal; low dispersal; and random changes in birth, death and reproduction, respectively (Zhou &amp; Ning, 2017). <font color=#2196F3 size=5><b>随机过程</b></font>是指均匀分散、分散限制（结合漂变）和纯漂变，它们可以通过高度分散、低分散和出生、死亡和繁殖的随机变化来掩盖&#x2F;减弱微生物群落之间的更替。</p>\n</li>\n</ul>\n<p><img src=\"/images/lujia/nullmodel.png\" alt=\"Community assembly processes by Stegen *et al.* https://www.nature.com/articles/ismej201393\n\"></p>\n<ul>\n<li>An NTI of &gt;+2 indicates that the ASVs in a local community are more closely related than expected by chance, suggesting the role of selective pressures (e.g. environmental conditions) in phylogenetic clustering. An NTI of &lt;−2 represents phylogenetic overdispersion, indicating two possible biotic interactions: competition and facilitation. In contrast, a mean NTI across multiple communities that is significantly greater or less than zero indicates phylogenetic clustering or overdispersion, respectively (Zhou &amp; Ning, 2017). NTI &gt;2表明，在一个地方群落中，ASVs的亲缘关系比预期的更为密切，表明选择压力（如环境条件）在系统发育聚类中的作用。NTI &lt;-2表示系统发育过度分散，表明两种可能的生物相互作用：竞争和促进。相反，多个群落间的平均NTI显著大于或小于零，分别表明系统发育聚类或过度分散（Zhou和Ning，2017）。</li>\n<li>βNTI&gt;+2 or &lt;−2 signified heterogeneous selection or homogeneous selection, respectively. βNTI&gt;+2 or &lt;−2 分别指示异质选择和同质选择。</li>\n</ul>\n<h1 id=\"17-参考\"><a href=\"#17-参考\" class=\"headerlink\" title=\"17. 参考\"></a><font color=#FF0000 >17. 参考</font></h1><ul>\n<li><a href=\"https://chiliubio.github.io/microeco/\">https://chiliubio.github.io/microeco/</a></li>\n<li>Zhou, J., &amp; Ning, D. (2017). Stochastic community assembly: Does it matter in microbial ecology? Microbiology and Molecular Biology Reviews, 81(4), e00002–17. <a href=\"https://doi.org/10.1128/MMBR.00002%E2%80%9017\">https://doi.org/10.1128/MMBR.00002‐17</a></li>\n<li><a href=\"http://www.360doc.com/content/20/1223/07/71874948_952966442.shtml\">http://www.360doc.com/content/20/1223/07/71874948_952966442.shtml</a></li>\n</ul>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"}]},{"title":"宏基因组分析流程及代码","slug":"宏基因组分析流程及代码","date":"2021-01-19T07:24:28.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/宏基因组分析流程及代码.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>本文阐述宏基因组物种分类、组装、bining、基因预测及注释……</p>\n<span id=\"more\"></span>\n\n<h1 id=\"A、软件列表及安装\"><a href=\"#A、软件列表及安装\" class=\"headerlink\" title=\"A、软件列表及安装\"></a>A、软件列表及安装</h1><h2 id=\"A-1-分类相关\"><a href=\"#A-1-分类相关\" class=\"headerlink\" title=\"A.1 分类相关\"></a>A.1 分类相关</h2><h3 id=\"A-1-1-metaphlan-3-0\"><a href=\"#A-1-1-metaphlan-3-0\" class=\"headerlink\" title=\"A.1.1 metaphlan 3.0\"></a>A.1.1 metaphlan 3.0</h3><p>MetaPhlAn is a tool for profiling the composition of microbial communities from metagenomic shotgun sequencing data.</p>\n<h4 id=\"a-安装主文件\"><a href=\"#a-安装主文件\" class=\"headerlink\" title=\"a. 安装主文件\"></a>a. 安装主文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda create -n metaphlan python=3.7 metaphlan</span><br><span class=\"line\">$ conda activate metaphlan</span><br></pre></td></tr></table></figure>\n<h4 id=\"b-安装数据库\"><a href=\"#b-安装数据库\" class=\"headerlink\" title=\"b. 安装数据库\"></a>b. 安装数据库</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metaphlan --install</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"c-安装依赖包\"><a href=\"#c-安装依赖包\" class=\"headerlink\" title=\"c. 安装依赖包\"></a>c. 安装依赖包</h4><ul>\n<li>hclust<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda install -c bioconda hclust2</span><br></pre></td></tr></table></figure></li>\n<li>R, vegan, ape <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda install r-base r-vegan r-ape</span><br></pre></td></tr></table></figure></li>\n<li>rbiom<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ R</span><br><span class=\"line\">$ install.packages(<span class=\"string\">&quot;rbiom&quot;</span>)</span><br><span class=\"line\">$ quit()</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"A-1-2-gtdbtk\"><a href=\"#A-1-2-gtdbtk\" class=\"headerlink\" title=\"A.1.2 gtdbtk\"></a>A.1.2 <a href=\"https://ecogenomics.github.io/GTDBTk/\">gtdbtk</a></h3><h4 id=\"a-Hardware-requirements\"><a href=\"#a-Hardware-requirements\" class=\"headerlink\" title=\"a. Hardware requirements\"></a>a. Hardware requirements</h4><table>\n<thead>\n<tr>\n<th>Domain</th>\n<th>Memory</th>\n<th>Storage</th>\n<th>Time</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Archaea</td>\n<td>~8 GB</td>\n<td>~27 GB</td>\n<td>~1 hour &#x2F; 1,000 genomes @ 64 CPUs</td>\n</tr>\n<tr>\n<td>Bacteria</td>\n<td>~150 GB</td>\n<td>~27 GB</td>\n<td>~1 hour &#x2F; 1,000 genomes @ 64 CPUs</td>\n</tr>\n</tbody></table>\n<h4 id=\"b-Install-GTDB-Tk-with-conda\"><a href=\"#b-Install-GTDB-Tk-with-conda\" class=\"headerlink\" title=\"b. Install GTDB-Tk with conda\"></a>b. Install GTDB-Tk with conda</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda create -n gtdbtk -c conda-forge -c bioconda gtdbtk</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"c-GTDB-Tk-reference-data\"><a href=\"#c-GTDB-Tk-reference-data\" class=\"headerlink\" title=\"c. GTDB-Tk reference data\"></a>c. GTDB-Tk reference data</h4><ul>\n<li><strong>Note that different versions of the GTDB release data may not run on all versions of GTDB-Tk, below are all supported versions:</strong></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>GTDB Release</th>\n<th>Minimum version</th>\n<th>Maximum version</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>R95</td>\n<td>1.3.0</td>\n<td>N&#x2F;A</td>\n</tr>\n<tr>\n<td>R89</td>\n<td>0.3.0</td>\n<td>0.1.2</td>\n</tr>\n<tr>\n<td>R86.2</td>\n<td>0.2.1</td>\n<td>0.2.2</td>\n</tr>\n<tr>\n<td>R86</td>\n<td>0.1.0</td>\n<td>0.1.6</td>\n</tr>\n<tr>\n<td>R83</td>\n<td>0.0.6</td>\n<td>0.0.7</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Download the reference data</li>\n</ul>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://data.ace.uq.edu.au/public/gtdb/data/releases/release95/95.0/auxillary_files/gtdbtk_r95_data.tar.gz</span><br><span class=\"line\">  </span><br><span class=\"line\">$ tar xvzf gtdbtk_r95_data.tar.gz</span><br></pre></td></tr></table></figure>\n<p><strong>注意</strong>：GTDB-Tk requires an environment variable named GTDBTK_DATA_PATH to be set to the directory containing the unarchived GTDB-Tk reference data.</p>\n<ul>\n<li>You can automatically alias GTDBTK_DATA_PATH whenever the environment is activated by editing {gtdbtk environment path}&#x2F;etc&#x2F;conda&#x2F;activate.d&#x2F;gtdbtk.sh, e.g.:</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Determine the GTDB-Tk environment path</span></span><br><span class=\"line\">$ conda activate gtdbtk</span><br><span class=\"line\">$ <span class=\"built_in\">which</span> gtdbtk</span><br><span class=\"line\"><span class=\"comment\"># /miniconda3/envs/gtdbtk-1.3.0/bin/gtdbtk</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Edit the activate file</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">&quot;export GTDBTK_DATA_PATH=/path/to/release/package/&quot;</span> &gt; /miniconda3/envs/gtdbtk-1.3.0/etc/conda/activate.d/gtdbtk.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"A-1-3-Kraken2\"><a href=\"#A-1-3-Kraken2\" class=\"headerlink\" title=\"A.1.3 Kraken2\"></a>A.1.3 <a href=\"https://github.com/DerrickWood/kraken2\">Kraken2</a></h3><h4 id=\"a-Hardware-requirements-1\"><a href=\"#a-Hardware-requirements-1\" class=\"headerlink\" title=\"a. Hardware requirements\"></a>a. Hardware requirements</h4><ul>\n<li>Disk space: Construction of a Kraken 2 standard database requires approximately 100 GB of disk space. A test on 01 Jan 2018 of the default installation showed 42 GB of disk space was used to store the genomic library files, 26 GB was used to store the taxonomy information from NCBI, and 29 GB was used to store the Kraken 2 compact hash table.</li>\n<li>Memory: To run efficiently, Kraken 2 requires enough free memory to hold the database (primarily the hash table) in RAM. While this can be accomplished with a ramdisk, Kraken 2 will by default load the database into process-local RAM; the –memory-mapping switch to kraken2 will avoid doing so. The default database size is 29 GB (as of Jan. 2018), and you will need slightly more than that in RAM if you want to build the default database.</li>\n</ul>\n<h4 id=\"b-Install-Kraken2-with-conda\"><a href=\"#b-Install-Kraken2-with-conda\" class=\"headerlink\" title=\"b. Install Kraken2 with conda\"></a>b. Install Kraken2 with conda</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda create -n kraken2 kraken2</span><br></pre></td></tr></table></figure>\n<h4 id=\"c-Build-the-database\"><a href=\"#c-Build-the-database\" class=\"headerlink\" title=\"c. Build the database\"></a>c. Build the database</h4><ul>\n<li>下载数据库。找到一个存储空间比较大的目录并进入，运行如下命令，这里下载的数据库包括archaea，bacteria，plasmid，viral，fungi，protozoa，UniVec和UniVec_Core：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">nohup</span> bash -c <span class=\"string\">&#x27;for i in archaea bacteria plasmid viral fungi protozoa UniVec UniVec_Core; do kraken2-build --download-library $i --threads 24 --db db_name; done&#x27;</span> &amp;</span><br></pre></td></tr></table></figure></li>\n<li>下载分类信息<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">nohup</span> kraken2-build --download-taxonomy --threads 24 --db db_name &amp;</span><br></pre></td></tr></table></figure></li>\n<li>建立索引<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">nohup</span> kraken2-build --build --threads 24 --db db_name &amp;</span><br></pre></td></tr></table></figure>\n<h4 id=\"d-序列分类\"><a href=\"#d-序列分类\" class=\"headerlink\" title=\"d. 序列分类\"></a>d. 序列分类</h4></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kraken2 --paired --threads 24 --unclassified-out unclassified<span class=\"comment\">#.fq --classified-out classified#.fq --output outfile --confidence 0.5 --memory-mapping --use-names --report reportname --report-zero-counts --db $DBNAME reads1 read2</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"A-2-组装、Bining、质量评估\"><a href=\"#A-2-组装、Bining、质量评估\" class=\"headerlink\" title=\"A.2 组装、Bining、质量评估\"></a>A.2 组装、Bining、质量评估</h2><h3 id=\"A-2-1-metawrap\"><a href=\"#A-2-1-metawrap\" class=\"headerlink\" title=\"A.2.1 metawrap\"></a>A.2.1 metawrap</h3><p>MetaWRAP is a pipeline for genome-resolved metagenomic data analysis.</p>\n<h4 id=\"a-安装主文件-1\"><a href=\"#a-安装主文件-1\" class=\"headerlink\" title=\"a. 安装主文件\"></a>a. 安装主文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda create -n metawrap python=2.7 metaphlan</span><br></pre></td></tr></table></figure>\n<h4 id=\"b-安装其他分析工具到metawrap环境中\"><a href=\"#b-安装其他分析工具到metawrap环境中\" class=\"headerlink\" title=\"b. 安装其他分析工具到metawrap环境中\"></a>b. 安装其他分析工具到metawrap环境中</h4><ul>\n<li><strong>cd-hit</strong></li>\n<li><strong>coverm</strong> DNA read coverage and relative abundance calculator focused on metagenomics applications</li>\n<li><strong>bamm</strong> Metagenomics-focused BAM file manipulation</li>\n<li><strong>unitem</strong> Ensemble binning strategies for combining the output of multiple binning methods</li>\n<li><strong>humann2</strong> The HMP Unified Metabolic Analysis Network 2</li>\n<li><strong><a href=\"https://github.com/biobakery/biobakery/wiki/GraPhlAn\">graphlan</a></strong> </li>\n<li><strong><a href=\"https://pypi.org/project/export2graphlan/\">export2graphlan</a></strong> </li>\n<li><strong><a href=\"https://data.ace.uq.edu.au/public/CheckM_databases/\">checkm database</a></strong><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda activeta metawrap</span><br><span class=\"line\">$ conda install cd-hit coverm bamm unitem humann2 graphlan export2graphlan</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 找到一个合适的目录并cd进入以便存储checkm数据库</span></span><br><span class=\"line\">$ wget https://data.ace.uq.edu.au/public/CheckM_databases/checkm_data_2015_01_16.tar.gz</span><br><span class=\"line\">$ tar zxvf checkm_data_2015_01_16.tar.gz</span><br><span class=\"line\">$ checkm data setRoot</span><br><span class=\"line\"><span class=\"comment\"># 随后输入数据库所在的full path</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"A-3-非冗余基因功能注释\"><a href=\"#A-3-非冗余基因功能注释\" class=\"headerlink\" title=\"A.3 非冗余基因功能注释\"></a>A.3 非冗余基因功能注释</h2><h3 id=\"A-3-1-eggNOG-mapper\"><a href=\"#A-3-1-eggNOG-mapper\" class=\"headerlink\" title=\"A.3.1 eggNOG-mapper\"></a>A.3.1 eggNOG-mapper</h3><p>功能注释，uniref, eggNOG, KEGG, GO; CAZy; VFDB; CARD; TCDB; PHI。</p>\n<h3 id=\"A-3-2-EnrichM\"><a href=\"#A-3-2-EnrichM\" class=\"headerlink\" title=\"A.3.2 EnrichM\"></a>A.3.2 EnrichM</h3><p><a href=\"https://github.com/geronimp/enrichM\">EnrichM</a> is a set of comparative genomics tools for large sets of metagenome assembled genomes (MAGs). The current functionality includes:</p>\n<ul>\n<li>A basic annotation pipeline for MAGs.</li>\n<li>A pipeline to determine the metabolic pathways that are encoded by MAGs, using KEGG modules as a reference (although custom pathways can be specified)</li>\n<li>A pipeline to identify genes or metabolic pathways that are enriched within and between user-defined groups of genomes (groups can be genomes that are related functionally, phylogenetically, recovered from different environments, etc).</li>\n<li>To construct metabolic networks from annotated population genomes.</li>\n<li>Construct random forest machine learning models from the functional composition of either MAGs, metagenomes or transcriptomes.</li>\n<li>Apply these random forest machine learning models to classify new MAGs metagenomes.</li>\n</ul>\n<h4 id=\"a-安装主文件-2\"><a href=\"#a-安装主文件-2\" class=\"headerlink\" title=\"a. 安装主文件\"></a>a. 安装主文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda create -n enrichm python=3</span><br><span class=\"line\">$ conda install enrichm</span><br></pre></td></tr></table></figure>\n<h4 id=\"b-安装数据库-1\"><a href=\"#b-安装数据库-1\" class=\"headerlink\" title=\"b. 安装数据库\"></a>b. 安装数据库</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 约5.7 G</span></span><br><span class=\"line\">$ enrichm data</span><br></pre></td></tr></table></figure>\n<p><strong>报错</strong> ：</p>\n<blockquote>\n<p>Traceback (most recent call last):<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;data.py”, line 114, in do<br>    version_remote &#x3D; urllib.request.urlopen(self.ftp + self.VERSION).readline().strip().decode(“utf-8”)<br>AttributeError: module ‘urllib’ has no attribute ‘request’</p>\n<p>During handling of the above exception, another exception occurred:</p>\n<p>Traceback (most recent call last):<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;bin&#x2F;enrichm”, line 342, in &lt;module&gt;<br>    run.run_enrichm(args, sys.argv)<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;run.py”, line 288, in run_enrichm<br>    d.do(args.uninstall, args.dry)<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;data.py”, line 117, in do<br>    “Unable to find most current EnrichM database VERSION in ftp. Please complain at <a href=\"https://github.com/geronimp/enrichM\">https://github.com/geronimp/enrichM</a>“)<br>Exception: Unable to find most current EnrichM database VERSION in ftp. Please complain at <a href=\"https://github.com/geronimp/enrichM\">https://github.com/geronimp/enrichM</a></p>\n</blockquote>\n<p><strong>解决方案：将data.py中的’import urllib’替换为’import urllib.request’</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim /home/hualin/miniconda3/envs/enrichm/lib/python3.6/site-packages/enrichm/data.py</span><br></pre></td></tr></table></figure>\n<h4 id=\"c-Sepcifying-the-location-of-the-EnrichM-database\"><a href=\"#c-Sepcifying-the-location-of-the-EnrichM-database\" class=\"headerlink\" title=\"c. Sepcifying the location of the EnrichM database\"></a>c. Sepcifying the location of the EnrichM database</h4><p>If you would like to store the EnrichM database outside of your home directory, move you need to tell EnrichM where to look. To do this, export a BASH variable named “ENRICHM_DB”:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">export</span> ENRICHM_DB=/path/to/database/ &gt;&gt;~/.bashrc</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong> ：&#x2F;path&#x2F;to&#x2F;database&#x2F;根据实际情况而定！<br><strong>报错</strong>：</p>\n<blockquote>\n<p>$ enrichm<br>Traceback (most recent call last):<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;bin&#x2F;enrichm”, line 38, in &lt;module&gt;<br>    from enrichm.run import Run<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;run.py”, line 24, in &lt;module&gt;<br>    from enrichm.network_analyzer import NetworkAnalyser<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;network_analyzer.py”, line 22, in &lt;module&gt;<br>    from enrichm.network_builder import NetworkBuilder<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;network_builder.py”, line 24, in &lt;module&gt;<br>    from enrichm.databases import Databases<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;databases.py”, line 28, in &lt;module&gt;<br>    class Databases:<br>  File “&#x2F;home&#x2F;hualin&#x2F;miniconda3&#x2F;envs&#x2F;enrichm&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;enrichm&#x2F;databases.py”, line 36, in Databases<br>    PICKLE_VERSION &#x3D; open(os.path.join(CUR_DATABASE_DIR, ‘VERSION’)).readline().strip()<br>FileNotFoundError: [Errno 2] No such file or directory: ‘&#x2F;new_data&#x2F;hualin&#x2F;db&#x2F;enrichm_database_v10&#x2F;26-11-2018&#x2F;VERSION’</p>\n</blockquote>\n<p><strong>Solve</strong>: 将下载的数据库文件全部复制一份到“<strong>26-11-2018</strong>”目录中，否则后续运行annotaton时会提示找不到数据库文件。</p>\n<h1 id=\"B、数据分析\"><a href=\"#B、数据分析\" class=\"headerlink\" title=\"B、数据分析\"></a>B、数据分析</h1><h2 id=\"B-1-使用metaphlan从Reads中获取物种分类信息\"><a href=\"#B-1-使用metaphlan从Reads中获取物种分类信息\" class=\"headerlink\" title=\"B.1 使用metaphlan从Reads中获取物种分类信息\"></a>B.1 使用metaphlan从Reads中获取物种分类信息</h2><h3 id=\"Step-1-激活环境\"><a href=\"#Step-1-激活环境\" class=\"headerlink\" title=\"Step 1. 激活环境\"></a>Step 1. 激活环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda activate metaphlan</span><br></pre></td></tr></table></figure>\n<h3 id=\"Step-2-对paired-end-Reads进行注释\"><a href=\"#Step-2-对paired-end-Reads进行注释\" class=\"headerlink\" title=\"Step 2. 对paired-end Reads进行注释\"></a>Step 2. 对paired-end Reads进行注释</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metaphlan Reads1,Reads2 --input_type fastq --bowtie2out Str1.bowtie2.bz2 --<span class=\"built_in\">nproc</span> 10 -o Str1_profiled.txt</span><br></pre></td></tr></table></figure>\n<p>Reads1和Reads2分别代表双端测序得到的正向和反向数据；–input_type指定文件格式，我们拿到的下机数据一般为fastq格式；–bowtie2out参数将会保存运行产生的中间文件以便后续重新运行程序时作为输入文件；–nproc指定使用的线程数量；-o指定输出文件名。</p>\n<h3 id=\"Step-3-汇总所有的结果文件\"><a href=\"#Step-3-汇总所有的结果文件\" class=\"headerlink\" title=\"Step 3. 汇总所有的结果文件\"></a>Step 3. 汇总所有的结果文件</h3><p>对所有的文件均运行Step 2 ，产生了多个输出文件（*_profiled.txt），可以将它们汇总到一个文件中（merged_abundance_table.txt），便于后续对多个样品进行相互比较。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ merge_metaphlan_tables.py *_profiled.txt &gt; merged_abundance_table.txt</span><br></pre></td></tr></table></figure>\n<h3 id=\"Step-4-从合并的文件中提取种水平的分类\"><a href=\"#Step-4-从合并的文件中提取种水平的分类\" class=\"headerlink\" title=\"Step 4. 从合并的文件中提取种水平的分类\"></a>Step 4. 从合并的文件中提取种水平的分类</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep -E <span class=\"string\">&quot;s__|clade&quot;</span> merged_abundance_table.txt | sed <span class=\"string\">&#x27;s/^.*s__//g&#x27;</span> | <span class=\"built_in\">cut</span> -f1,3-8 | sed -e <span class=\"string\">&#x27;s/clade_name/body_site/g&#x27;</span> &gt; merged_abundance_table_species.txt</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Step-5-绘制样本间种水平的热图\"><a href=\"#Step-5-绘制样本间种水平的热图\" class=\"headerlink\" title=\"Step 5. 绘制样本间种水平的热图\"></a>Step 5. 绘制样本间种水平的热图</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hclust2.py -i merged_abundance_table_species.txt -o abundance_heatmap_species.png --ftop 50 --f_dist_f braycurtis --s_dist_f braycurtis --cell_aspect_ratio 0.5 -l --flabel_size 10 --slabel_size 10 --max_flabel_len 100 --max_slabel_len 100 --minv 0.1 --dpi 300</span><br></pre></td></tr></table></figure>\n<h3 id=\"Step-6-计算样本间的unifrac距离\"><a href=\"#Step-6-计算样本间的unifrac距离\" class=\"headerlink\" title=\"Step 6. 计算样本间的unifrac距离\"></a>Step 6. 计算样本间的unifrac距离</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下载依赖的tree文件和脚本,与要分析的文件放于同一目录下</span></span><br><span class=\"line\">$ wget https://github.com/biobakery/MetaPhlAn/blob/master/metaphlan/utils/mpa_v30_CHOCOPhlAn_201901_species_tree.nwk</span><br><span class=\"line\">$ wget https://github.com/biobakery/MetaPhlAn/blob/master/metaphlan/utils/calculate_unifrac.R</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 开始计算距离</span></span><br><span class=\"line\">$ Rscript plot_unifrac.R merged_abundance_table.txt mpa_v30_CHOCOPhlAn_201901_species_tree.nwk unifrac_merged_abundance_table.txt</span><br></pre></td></tr></table></figure>\n<h3 id=\"Step-7-绘制cladogram图\"><a href=\"#Step-7-绘制cladogram图\" class=\"headerlink\" title=\"Step 7. 绘制cladogram图\"></a>Step 7. 绘制cladogram图</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 激活依赖软件所在的环境</span></span><br><span class=\"line\">$ conda activate metawrap</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 生成绘图所需的文件</span></span><br><span class=\"line\">$ <span class=\"built_in\">tail</span> -n +2 merged_abundance_table.txt | <span class=\"built_in\">cut</span> -f1,3- &gt; merged_abundance_table_reformatted.txt</span><br><span class=\"line\"></span><br><span class=\"line\">$ export2graphlan.py --skip_rows 1 -i merged_abundance_table_reformatted.txt --tree merged_abundance.tree.txt --annotation merged_abundance.annot.txt --most_abundant 100 --abundance_threshold 1 --least_biomarkers 10 --annotations 5,6 --external_annotations 7 --min_clade_size 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图</span></span><br><span class=\"line\">$ graphlan_annotate.py --annot merged_abundance.annot.txt merged_abundance.tree.txt merged_abundance.xml</span><br><span class=\"line\"></span><br><span class=\"line\">$ graphlan.py --dpi 300 merged_abundance.xml merged_abundance.pdf --external_legends</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"B-2-使用metawrap对Reads进行组装\"><a href=\"#B-2-使用metawrap对Reads进行组装\" class=\"headerlink\" title=\"B.2 使用metawrap对Reads进行组装\"></a>B.2 使用metawrap对Reads进行组装</h2><h3 id=\"Step-1-激活环境-1\"><a href=\"#Step-1-激活环境-1\" class=\"headerlink\" title=\"Step 1. 激活环境\"></a>Step 1. 激活环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda activate metawrap</span><br></pre></td></tr></table></figure>\n<h3 id=\"Step-2-组装\"><a href=\"#Step-2-组装\" class=\"headerlink\" title=\"Step 2. 组装\"></a>Step 2. 组装</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metawrap assembly -1 Reads1 -2 Reads2 -o Assemble1 -m 300 -t 15 --metaspades</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nUsage: metaWRAP assembly [options] -1 reads_1.fastq -2 reads_2.fastq -o output_dir\n\n<ul>\n<li>Options:<ul>\n<li><p>   -1 STR          forward fastq reads</p>\n</li>\n<li><p>   -2 STR          reverse fastq reads</p>\n</li>\n<li><p>   -o STR          output directory</p>\n</li>\n<li><p>   -m INT          memory in GB (default&#x3D;24)</p>\n</li>\n<li><p>   -t INT          number of threads (defualt&#x3D;1)</p>\n</li>\n<li><p>   -l INT\t\tminimum length of assembled contigs (default&#x3D;1000)</p>\n</li>\n<li><p>   --megahit\tassemble with megahit (default)</p>\n</li>\n<li><p>--metaspades\tassemble with metaspades instead of megahit (better results but slower and higher memory requirement)</p>\n</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<p>Reads1和Reads2分别代表双端测序得到的正向和反向数据；-o指定输出目录，-m指定最大可用内存大小，超过设定值后程序会自动退出，建议设大一点，我10G的数据大概需要180G内存；-t指定线程数；–metaspades表示用metaspades进行组装，特别慢，但是组装结果相对好一些。</p>\n<h2 id=\"B-3-使用metawrap对Contigs进行Bining\"><a href=\"#B-3-使用metawrap对Contigs进行Bining\" class=\"headerlink\" title=\"B.3 使用metawrap对Contigs进行Bining\"></a>B.3 使用metawrap对Contigs进行Bining</h2><h3 id=\"Step-1-激活环境-2\"><a href=\"#Step-1-激活环境-2\" class=\"headerlink\" title=\"Step 1. 激活环境\"></a>Step 1. 激活环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda activate metawrap</span><br></pre></td></tr></table></figure>\n<h3 id=\"Step-2-Bining\"><a href=\"#Step-2-Bining\" class=\"headerlink\" title=\"Step 2. Bining\"></a>Step 2. Bining</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metawrap binning -o Str1.INITIAL_BINNING -t 20 -m 200 --universal --run-checkm -a &lt;path of contigs&gt; --metabat2 --maxbin2 --concoct 解压的Reads1 解压的Reads2</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nUsage: metaWRAP binning [options] -a assembly.fa -o output_dir readsA_1.fastq readsA_2.fastq ... [readsX_1.fastq readsX_2.fastq]\n\n<ul>\n<li><p>Note1: Make sure to provide all your separately replicate read files, not the joined file.</p>\n</li>\n<li><p>Note2: You may provide single end or interleaved reads as well with the use of the correct option</p>\n</li>\n<li><p>Note3: If the output already has the .bam alignments files from previous runs, the module will skip re-aligning the reads</p>\n</li>\n<li><p>Options:</p>\n<ul>\n<li>   -a STR          metagenomic assembly file</li>\n<li>   -o STR          output directory</li>\n<li>   -t INT          number of threads (default&#x3D;1)</li>\n<li>   -m INT\t\tamount of RAM available (default&#x3D;4)</li>\n<li>   -l INT\t\tminimum contig length to bin (default&#x3D;1000bp). Note: metaBAT will default to 1500bp minimum</li>\n<li>   --metabat2      bin contigs with metaBAT2</li>\n<li>   --metabat1\tbin contigs with the original metaBAT</li>\n<li>   --maxbin2\tbin contigs with MaxBin2</li>\n<li>   --concoct\tbin contigs with CONCOCT</li>\n<li>--universal\tuse universal marker genes instead of bacterial markers in MaxBin2 (improves Archaea binning)</li>\n<li>   --run-checkm\timmediately run CheckM on the bin results (requires 40GB+ of memory)</li>\n<li>   --single-end\tnon-paired reads mode (provide *.fastq files)</li>\n<li>   --interleaved\tthe input read files contain interleaved paired-end reads</details>\n**注意避坑：** 这里的Reads1和Reads2需要提供解压缩后的Reads文件，不但要解压缩，还需要重命名，即后缀名必须为“\\_clean\\_1.fastq” 和 “\\_clean\\_2.fastq”，否则软件无法运行。-o指定输出目录；-t指定线程数；-m指定最大内存限制；--run-checkm表明即时检查Bining的质量；--metabat2 --maxbin2 --concoct 指定同时采用这三个分箱工具进行Bining；--universal指定MaxBin2采用universal marker 基因代替 bacterial markers  (improves Archaea binning)。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Step-3-整合三种方法的bins-metabat2-maxbin2-concoct-结果\"><a href=\"#Step-3-整合三种方法的bins-metabat2-maxbin2-concoct-结果\" class=\"headerlink\" title=\"Step 3. 整合三种方法的bins (metabat2, maxbin2, concoct) 结果\"></a>Step 3. 整合三种方法的bins (metabat2, maxbin2, concoct) 结果</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metawrap bin_refinement -o F01_BIN_REFINEMENT(输出目录) -t 20 -A str1.INITIAL_BINNING/metabat2_bins/ -B str1.INITIAL_BINNING/maxbin2_bins/ -C str1.INITIAL_BINNING/concoct_bins/ -c 70 -x 5</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nUsage: metaWRAP bin_refinement [options] -o output_dir -A bin_folderA [-B bin_folderB -C bin_folderC]\n\n<ul>\n<li><p>Note: the contig names in different bin folders must be consistant (must come from the same assembly).</p>\n</li>\n<li><p>Options:</p>\n<ul>\n<li>-o STR          output directory</li>\n<li>   -t INT          number of threads (default&#x3D;1)</li>\n<li>   -m INT\t\tmemory available (default&#x3D;40)</li>\n<li>   -c INT          完整度minimum % completion of bins [should be &gt;50%] (default&#x3D;70)</li>\n<li>   -x INT          污染度maximum % contamination of bins that is acceptable (default&#x3D;10)</li>\n<li>   -A STR\t\tfolder with metagenomic bins (files must have .fa or .fasta extension)</li>\n<li>   -B STR\t\tanother folder with metagenomic bins</li>\n<li>   -C STR\t\tanother folder with metagenomic bins</li>\n<li>   --skip-refinement\tdont use binning_refiner to come up with refined bins based on combinations of binner outputs</li>\n<li>   --skip-checkm\t\tdont run CheckM to assess bins</li>\n<li>   --skip-consolidation\tchoose the best version of each bin from all bin refinement iteration</li>\n<li>   --keep-ambiguous\tfor contigs that end up in more than one bin, keep them in all bins (default: keeps them only in the best bin)</li>\n<li>   --remove-ambiguous\tfor contigs that end up in more than one bin, remove them in all bins (default: keeps them only in the best bin)</li>\n<li>   --quick\t\t\tadds –reduced_tree option to checkm, reducing runtime, especially with low memory</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h3 id=\"Step-4-Blobology可视化bin\"><a href=\"#Step-4-Blobology可视化bin\" class=\"headerlink\" title=\"Step 4. Blobology可视化bin\"></a>Step 4. Blobology可视化bin</h3><p><strong>一个坑：</strong> metawrap安装的blast为2.6版本，只能用Version 4 的nt库。而最新的nt库为Version 5，v4已经不再维护了。因此需要更新metawrap安装环境中的blast至2.8.0及以上版本，这里无法通过‘conda updata blast’实现更新，而是需要下载新版本的blast可执行程序，覆盖metawrap环境中的blast程度们。 如果你采用的是默认版本的blast和V5的nt库，会得到报错：“BLAST Database error: Error: Not a valid version 4 database”.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metawrap blobology -a Result/Assemble/F01/final_assembly.fasta -t 20 -o F01.BLOBOLOGY --bins F01_BIN_REFINEMENT/metawrap_70_5_bins reads/F01_clean_1.fastq reads/F01_clean_2.fastq</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nUsage: metaWRAP blobology [options] -a assembly.fasta -o output_dir readsA_1.fastq readsA_2.fastq [readsB_1.fastq readsB_2.fastq ... ]\n\n<ul>\n<li><p>Options:</p>\n<ul>\n<li>   -a STR\t\tassembly fasta file</li>\n<li>   -o STR          output directory</li>\n<li>   -t INT          number of threads</li>\n<li>   --subsamble \tINT\tNumber of contigs to run blobology on. Subsampling is randomized. (default&#x3D;ALL)</li>\n<li>   --bins\t\tSTR\tFolder containing bins. Contig names must match those of the assembly file. (default&#x3D;None)</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h3 id=\"Step-5-Bins-定量\"><a href=\"#Step-5-Bins-定量\" class=\"headerlink\" title=\"Step 5. Bins 定量\"></a>Step 5. Bins 定量</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ metawrap quant_bins -b F01_BIN_REFINEMENT/metawrap_70_5_bins -t 8 -o F01.QUANT_BINS -a Result/Assemble/F01/final_assembly.fasta reads/F01_clean_1.fastq reads/F01_clean_2.fastq</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nUsage: metaWRAP quant_bins [options] -b bins_folder -o output_dir -a assembly.fa readsA_1.fastq readsA_2.fastq ... [readsX_1.fastq readsX_2.fastq]\n\n<ul>\n<li><p>Options:</p>\n<ul>\n<li>   -b STR          folder containing draft genomes (bins) in fasta format</li>\n<li>   -o STR          output directory</li>\n<li>   -a STR\t\tfasta file with entire metagenomic assembly (strongly recommended!)</li>\n<li>   -t INT\t\tnumber of threads</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h3 id=\"Step-6-重组装\"><a href=\"#Step-6-重组装\" class=\"headerlink\" title=\"Step 6. 重组装\"></a>Step 6. 重组装</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">metawrap reassemble_bins -o F01.BIN_REASSEMBLY -1 reads/F01_clean_1.fastq -2 reads/F01_clean_2.fastq -t 20 -m 400 -c 70 -x 10 -b F01_BIN_REFINEMENT/metawrap_70_5_bins</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nUsage: metaWRAP reassemble_bins [options] -o output_dir -b bin_folder -1 reads_1.fastq -2 reads_2.fastq\n\n<ul>\n<li><p>Options:</p>\n<ul>\n<li>   -b STR\t\tfolder with metagenomic bins</li>\n<li>   -o STR\t\toutput directory</li>\n<li>   -1 STR          forward reads to use for reassembly</li>\n<li>   -2 STR          reverse reads to use for reassembly</li>\n<li>   -t INT\t\tnumber of threads (default&#x3D;1)</li>\n<li>   -m INT\t\tmemory in GB (default&#x3D;40)</li>\n<li>   -c INT\t\tminimum desired bin completion % (default&#x3D;70)</li>\n<li>   -x INT\t\tmaximum desired bin contamination % (default&#x3D;10)</li>\n<li>   -l INT\t\tminimum contig length to be included in reassembly (default&#x3D;500)</li>\n<li>   --strict-cut-off\tmaximum allowed SNPs for strict read mapping (default&#x3D;2)</li>\n<li>   --permissive-cut-off\tmaximum allowed SNPs for permissive read mapping (default&#x3D;5)</li>\n<li>   --skip-checkm\t\tdont run CheckM to assess bins</li>\n<li>   --parallel\t\trun spades reassembly in parallel, but only using 1 thread per bin</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h2 id=\"B-4-MAGs注释\"><a href=\"#B-4-MAGs注释\" class=\"headerlink\" title=\"B.4 MAGs注释\"></a>B.4 MAGs注释</h2><h3 id=\"B-4-1-GTDB-TK-进行物种分类和注释，构建系统发育树\"><a href=\"#B-4-1-GTDB-TK-进行物种分类和注释，构建系统发育树\" class=\"headerlink\" title=\"B.4.1 GTDB-TK 进行物种分类和注释，构建系统发育树\"></a>B.4.1 GTDB-TK 进行物种分类和注释，构建系统发育树</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ conda activate gtdbtk</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"classify-wf——Classify-workflow-包括了Step-1-3\"><a href=\"#classify-wf——Classify-workflow-包括了Step-1-3\" class=\"headerlink\" title=\"classify_wf——Classify workflow (包括了Step 1-3)\"></a>classify_wf——Classify workflow (包括了Step 1-3)</h4><p>The classify workflow consists of three steps: identify, align, and classify.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ time gtdbtk classify_wf --genome_dir metawrap_70_5_bins/ --out_dir classify_wf_output -x .fa --prefix F --cpus 6 -r --debug</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nusage: gtdbtk classify_wf (--genome_dir GENOME_DIR | --batchfile BATCHFILE) --out_dir OUT_DIR [-x EXTENSION] [--min_perc_aa MIN_PERC_AA] [--prefix PREFIX] [--cpus CPUS]\n                          [--pplacer_cpus PPLACER_CPUS] [--force] [--scratch_dir SCRATCH_DIR] [-r] [--min_af MIN_AF] [--debug] [-h]\n\n<ul>\n<li><p>mutually exclusive required arguments:</p>\n<ul>\n<li>--genome_dir GENOME_DIR<br>               directory containing genome files in FASTA format</li>\n<li>--batchfile BATCHFILE<br>               path to file describing genomes - tab separated in 2 or 3 columns (FASTA file, genome ID, translation table [optional])</li>\n</ul>\n</li>\n<li><p>required named arguments:</p>\n<ul>\n<li>--out_dir OUT_DIR     directory to output files</li>\n</ul>\n</li>\n<li><p>optional arguments:</p>\n<ul>\n<li>-x, --extension EXTENSION<br>                extension of files to process, gz &#x3D; gzipped (default: fna)</li>\n<li>--min_perc_aa MIN_PERC_AA<br>                exclude genomes that do not have at least this percentage of AA in the MSA (inclusive bound) (default: 10)</li>\n<li>--prefix PREFIX       prefix for all output files (default: gtdbtk)</li>\n<li>--cpus CPUS           number of CPUs to use (default: 1)</li>\n<li>--pplacer_cpus PPLACER_CPUS<br>                use pplacer_cpus during placement (default: cpus)</li>\n<li>--force               continue processing if an error occurs on a single genome (default: False)</li>\n<li>--scratch_dir SCRATCH_DIR<br>                Reduce pplacer memory usage by writing to disk (slower).</li>\n<li>-r, --recalculate_red<br>                recalculate RED values based on the reference tree and all added user genomes (default: False)</li>\n<li>--min_af MIN_AF       minimum alignment fraction to consider closest genome (default: 0.65)</li>\n<li>--debug               create intermediate files for debugging purposes (default: False)</li>\n<li>-h, --help            show help message</details></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Step-1-identify——在基因组中寻找marker-genes\"><a href=\"#Step-1-identify——在基因组中寻找marker-genes\" class=\"headerlink\" title=\"Step 1: identify——在基因组中寻找marker genes\"></a>Step 1: identify——在基因组中寻找marker genes</h4><p>Translation table选择：use table 11 unless the coding density using table 4 is 5% higher than when using table 11 and the coding density under table 4 is &gt;70%.  GTDB-Tk 不会区分 tables 4和tables 5. 若用户清楚使用哪一个table，可以通过--batchfile指定。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ time gtdbtk identify --genome_dir metawrap_70_5_bins/ --out_dir identify_output --cpus 6 --prefix F --debug -x .fa --write_single_copy_genes</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Step-2-align\"><a href=\"#Step-2-align\" class=\"headerlink\" title=\"Step 2: align\"></a>Step 2: align</h4><p>Create a multiple sequence alignment based on the AR122&#x2F;BAC120 marker set.<br>Time 3m50.019s</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ time gtdbtk align --identify_dir identify_output/ --out_dir align_output --cpus 3 --prefix F --debug</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Step-3-classify\"><a href=\"#Step-3-classify\" class=\"headerlink\" title=\"Step 3: classify\"></a>Step 3: classify</h4><p>Determine taxonomic classification of genomes.<br>Time 118m9.386s</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ time gtdbtk classify --genome_dir metawrap_70_5_bins/ --align_dir align_output/ --out_dir classify_output --cpus 3 --prefix F --debug -x .fa -r</span><br></pre></td></tr></table></figure>\n<p><strong>注意</strong>：如果内存较小，则加上“–scratch_dir”参数。</p>\n<hr>\n<h4 id=\"Step-4-export-msa-这一步不运行\"><a href=\"#Step-4-export-msa-这一步不运行\" class=\"headerlink\" title=\"Step 4: export_msa (这一步不运行)\"></a>Step 4: export_msa (这一步不运行)</h4><p>The export_msa will export the untrimmed archaeal or bacterial MSA used in the reference data.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 古菌 0m1.503s</span></span><br><span class=\"line\">$ time gtdbtk export_msa --domain arc --output msa_arc.faa --debug</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 细菌 0m16.679s</span></span><br><span class=\"line\">$ time gtdbtk export_msa --domain bac --output msa_bac.faa --debug</span><br></pre></td></tr></table></figure>\n<h4 id=\"Step-5-trim-msa-这一步不运行\"><a href=\"#Step-5-trim-msa-这一步不运行\" class=\"headerlink\" title=\"Step 5: trim_msa (这一步不运行)\"></a>Step 5: trim_msa (这一步不运行)</h4><p>The trim_msa command will trim a MSA given a user-specified mask file, or the archaeal&#x2F;bacterial mask present in the reference data.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 古菌 0m10.675s</span></span><br><span class=\"line\">$ time gtdbtk trim_msa --untrimmed_msa msa_arc.faa --output msa_arc_trim.faa --reference_mask arc --debug</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 细菌 3m28.793s</span></span><br><span class=\"line\">$ time gtdbtk trim_msa --untrimmed_msa msa_bac.faa --output msa_bac_trim.faa --reference_mask bac --debug</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Step-6-infer\"><a href=\"#Step-6-infer\" class=\"headerlink\" title=\"Step 6: infer\"></a>Step 6: infer</h4><p>Infer tree from multiple sequence alignment.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#古菌 44m54.884s</span></span><br><span class=\"line\">$ time gtdbtk infer --msa_file align_output/F.ar122.msa.fasta --out_dir infer_out_arc_F --prefix F --cpus 12 --debug</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#细菌</span></span><br><span class=\"line\">$ time gtdbtk infer --msa_file align_output/F.bac120.msa.fasta --out_dir infer_out_bac_F --prefix F --cpus 12 --debug</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nusage: gtdbtk infer --msa_file MSA_FILE --out_dir OUT_DIR [--prot_model {JTT,WAG,LG}] [--no_support] [--gamma] [--prefix PREFIX] [--cpus CPUS] [--debug] [-h]\n\n<ul>\n<li><p>required named arguments:</p>\n<ul>\n<li>--msa_file MSA_FILE   multiple sequence alignment in FASTA format</li>\n<li>--out_dir OUT_DIR     directory to output files</li>\n</ul>\n</li>\n<li><p>optional arguments:</p>\n<ul>\n<li>--prot_model {JTT,WAG,LG}<br>                protein substitution model for tree inference (default: WAG)</li>\n<li>--no_support          do not compute local support values using the Shimodaira-Hasegawa test (default: False)</li>\n<li>--gamma               rescale branch lengths to optimize the Gamma20 likelihood (default: False)</li>\n<li>--prefix PREFIX       prefix for all output files (default: gtdbtk)</li>\n<li>--cpus CPUS           number of CPUs to use (default: 1)</li>\n<li>--debug               create intermediate files for debugging purposes (default: False)</li>\n<li>-h, --help            show help message</details></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Step-7-decorate\"><a href=\"#Step-7-decorate\" class=\"headerlink\" title=\"Step 7: decorate\"></a>Step 7: decorate</h4><p>Decorate a tree with the GTDB-Tk taxonomy.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 古菌</span></span><br><span class=\"line\">$ time gtdbtk decorate --input_tree infer_out_arc_F/F.unrooted.tree --output_tree F.decorate_unrooted_arc.tree --gtdbtk_classification_file classify_output/classify/F.ar122.summary.tsv --debug</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 细菌</span></span><br><span class=\"line\">$ time gtdbtk decorate --input_tree infer_out_bac_F/F.unrooted.tree --output_tree F.decorate_unrooted_brc.tree --gtdbtk_classification_file classify_output/classify/F.bac120.summary.tsv --debug</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nusage: gtdbtk decorate --input_tree INPUT_TREE --output_tree OUTPUT_TREE [--gtdbtk_classification_file GTDBTK_CLASSIFICATION_FILE] [--custom_taxonomy_file CUSTOM_TAXONOMY_FILE]\n                       [--debug] [-h]\n\n<ul>\n<li><p>required named arguments:</p>\n<ul>\n<li>--input_tree INPUT_TREE<br>                path to the unrooted tree in Newick format</li>\n<li>--output_tree OUTPUT_TREE<br>                path to output the tree</li>\n</ul>\n</li>\n<li><p>optional arguments:</p>\n<ul>\n<li>--gtdbtk_classification_file GTDBTK_CLASSIFICATION_FILE<br>                file with GTDB-Tk classifications produced by the <code>classify</code> command</li>\n<li>--custom_taxonomy_file CUSTOM_TAXONOMY_FILE<br>                file indicating custom taxonomy strings for user genomes, that should contain any genomes belonging to the outgroup</li>\n<li>--debug               create intermediate files for debugging purposes (default: False)</li>\n<li>-h, --help            show help message</details></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Step-8-root\"><a href=\"#Step-8-root\" class=\"headerlink\" title=\"Step 8: root\"></a>Step 8: root</h4><p>Root a tree using an outgroup.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ time gtdbtk root --input_tree input.tree --outgroup_taxon p__Nanoarchaeota --output_tree output.tree --gtdbtk_classification_file &lt;file with GTDB-Tk classifications produced by the classify <span class=\"built_in\">command</span>&gt; --debug</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nusage: gtdbtk root --input_tree INPUT_TREE --outgroup_taxon OUTGROUP_TAXON --output_tree OUTPUT_TREE [--gtdbtk_classification_file GTDBTK_CLASSIFICATION_FILE]\n                   [--custom_taxonomy_file CUSTOM_TAXONOMY_FILE] [--debug] [-h]\n\n<ul>\n<li><p>required named arguments:</p>\n<ul>\n<li>--input_tree INPUT_TREE<br>                path to the unrooted tree in Newick format</li>\n<li>--outgroup_taxon OUTGROUP_TAXON<br>                taxon to use as outgroup (e.g., p__Patescibacteria or p__Altarchaeota)</li>\n<li>--output_tree OUTPUT_TREE<br>                path to output the tree</li>\n</ul>\n</li>\n<li><p>optional arguments:</p>\n<ul>\n<li>--gtdbtk_classification_file GTDBTK_CLASSIFICATION_FILE<br>                file with GTDB-Tk classifications produced by the <code>classify</code> command</li>\n<li>--custom_taxonomy_file CUSTOM_TAXONOMY_FILE<br>                file indicating custom taxonomy strings for user genomes, that should contain any genomes belonging to the outgroup</li>\n<li>--debug               create intermediate files for debugging purposes (default: False)</li>\n<li>-h, --help            show help message</details></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h4 id=\"Step-9-ani-rep——计算ANI值\"><a href=\"#Step-9-ani-rep——计算ANI值\" class=\"headerlink\" title=\"Step 9: ani_rep——计算ANI值\"></a>Step 9: ani_rep——计算ANI值</h4><p>Compute the ANI of input genomes to all GTDB-Tk representative genomes.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ time gtdbtk ani_rep --genome_dir metawrap_70_5_bins/ --out_dir ani_rep/ --cpus 6 -x .fa --prefix F --debug</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ gtdbtk de_novo_wf --genome_dir metawrap_70_5_bins/ --out_dir de_novo_wf --extension .fa --bacteria --outgroup_taxon p__Patescibacteria --prefix F --cpus 6 --debug</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\nusage: gtdbtk ani_rep (--genome_dir GENOME_DIR | --batchfile BATCHFILE) --out_dir OUT_DIR [--no_mash] [--mash_k MASH_K] [--mash_s MASH_S] [--mash_d MASH_D] [--mash_v MASH_V]\n                      [--mash_db MASH_DB] [--min_af MIN_AF] [-x EXTENSION] [--prefix PREFIX] [--cpus CPUS] [--debug] [-h]\n\n<ul>\n<li><p>mutually exclusive required arguments:</p>\n<ul>\n<li><p>--genome_dir GENOME_DIR<br>                directory containing genome files in FASTA format</p>\n</li>\n<li><p>--batchfile BATCHFILE<br>                path to file describing genomes - tab separated in 2 or 3 columns (FASTA file, genome ID, translation table [optional])</p>\n</li>\n<li><p>- required named arguments:</p>\n</li>\n<li><p>--out_dir OUT_DIR     directory to output files</p>\n</li>\n</ul>\n</li>\n<li><p>optional Mash arguments:</p>\n<ul>\n<li>--no_mash             skip pre-filtering of genomes using Mash (default: False)</li>\n<li>--mash_k MASH_K       k-mer size [1-32] (default: 16)</li>\n<li>--mash_s MASH_S       maximum number of non-redundant hashes (default: 5000)</li>\n<li>--mash_d MASH_D       maximum distance to keep [0-1] (default: 0.1)</li>\n<li>--mash_v MASH_V       maximum p-value to keep [0-1] (default: 1.0)</li>\n<li>--mash_db MASH_DB     path to save&#x2F;read (if exists) the Mash reference sketch database (.msh)</li>\n</ul>\n</li>\n<li><p>optional FastANI arguments:</p>\n<ul>\n<li>--min_af MIN_AF       minimum alignment fraction to consider closest genome (default: 0.65)</li>\n</ul>\n</li>\n<li><p>optional arguments:</p>\n<ul>\n<li>-x, --extension EXTENSION<br>                extension of files to process, gz &#x3D; gzipped (default: fna)</li>\n<li>--prefix PREFIX       prefix for all output files (default: gtdbtk)</li>\n<li>--cpus CPUS           number of CPUs to use (default: 1)</li>\n<li>--debug               create intermediate files for debugging purposes (default: False)</li>\n<li>-h, --help            show help message </details></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"B-4-2-EnrichM-注释\"><a href=\"#B-4-2-EnrichM-注释\" class=\"headerlink\" title=\"B.4.2 EnrichM 注释\"></a>B.4.2 EnrichM 注释</h3><h4 id=\"Step-1-annotate\"><a href=\"#Step-1-annotate\" class=\"headerlink\" title=\"Step 1. annotate\"></a>Step 1. annotate</h4><p>基因组注释管道，可以使用dbCAN将基因组与KO, PFAM, TIGRFAM和CAZY 数据库进行比对。结果将为每个基因组产生一个.gff文件，并生成每个注释类型的频率矩阵（frequency matrix），其中行是注释IDs，列是基因组。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ enrichm annotate --genome_directory metawrap_70_5_bins --output EnrichM_annotate --force --ko --ko_hmm --pfam --tigrfam --clusters --orthologs --cazy --ec --threads 30 --parallel 8 --suffix .fa --count_domains --chunk_number 8</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\n\n<ul>\n<li><p>Output options:</p>\n<ul>\n<li>--output OUTPUT       Output directory</li>\n<li>--force               Overwrite previous run</li>\n</ul>\n</li>\n<li><p>Input options (Use one):</p>\n<ul>\n<li>--genome_files GENOME_FILES [GENOME_FILES …]<br>      Space separated list of genomes to annotate</li>\n<li>--genome_directory GENOME_DIRECTORY<br>      Directory containing genomes to annotate</li>\n<li>--protein_files PROTEIN_FILES [PROTEIN_FILES …]<br>      Space separated list of .faa files of genomes to annotate. Protein files need to be generated by prodigal.</li>\n<li>--protein_directory PROTEIN_DIRECTORY<br>      Directory containing .faa files of genomes to annotate. Protein files need to be generated by prodigal.</li>\n</ul>\n</li>\n<li><p>Annotations options:</p>\n<ul>\n<li>--ko                  Annotate with KO ids</li>\n<li>--ko_hmm              Annotate with KO ids</li>\n<li>--pfam                Annotate with Pfam HMMs</li>\n<li>--tigrfam             Annotate with TIGRFAM HMMs</li>\n<li>--clusters            Annotate with cluster ids</li>\n<li>--orthologs           Annotate with ortholog ids</li>\n<li>--cazy                Annotate with dbCAN HMMs</li>\n<li>--ec                  Annotate with EC ids</li>\n</ul>\n</li>\n<li><p>Cutoff options:</p>\n<ul>\n<li>--cut_ga              For PFAM and TIGRfam searches: use profiles GA gathering cutoffs to set all thresholding</li>\n<li>--cut_nc              For PFAM and TIGRfam searches: use profiles NC noise cutoffs to set all thresholding</li>\n<li>--cut_tc              For PFAM and TIGRfam searches: use profiles TC trusted cutoffs to set all thresholding</li>\n<li>--cut_ko              For KO HMM annotation searches: use cutoffs defined by KEGG to maximise F-score.</li>\n<li>--evalue EVALUE       Use this evalue cutoff to filter false positives (default: 1e-05)</li>\n<li>--bit BIT             Use this bit score cutoff to filter false positives (default: 0)</li>\n<li>--id ID               Use this percent identity cutoff to filter false positives (default: 0.3)</li>\n<li>--aln_query ALN_QUERY<br>      This fraction of the query must align to the reference (default: 0.7)</li>\n<li>--aln_reference ALN_REFERENCE<br>      This fraction of the reference must align to the query (default: 0.7)</li>\n<li>--c C                 When clustering, use matches above this fraction of aligned (covered) query and target residues (default: 0.7)</li>\n</ul>\n</li>\n<li><p>Runtime options:</p>\n<ul>\n<li>--threads THREADS     Use this number of threads when annotating with BLAST and HMMsearch (default: 1)</li>\n<li>--parallel PARALLEL   Run this number of jobs in parallel when annotating with HMMsearch (default: 5)</li>\n<li>--inflation INFLATION<br>     Inflation factor to use when calling clusters in ortholog (default &#x3D; 5.0)</li>\n<li>--suffix SUFFIX       Treat files ending with this suffix within the –genome_directory as genomes (default: .fna for –genome_directory and .faa for )</li>\n<li>--light               Don’t store metadata for genome files (can’t use enrichM compare downstream, default&#x3D;False)</li>\n<li>--count_domains       Fill the frequency matrix with the total number of times an annotation was detected (for example, when one domain more than once within a protein), rather than the count of proteins with with that annotation</li>\n<li>--chunk_number CHUNK_NUMBER<br>      Split loading of genomes into this many chunks (default &#x3D; 4)</li>\n<li>--chunk_max CHUNK_MAX<br>      Maximum number of genomes to load per chunk (default &#x3D; 2500)</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h4 id=\"Step-2-classify\"><a href=\"#Step-2-classify\" class=\"headerlink\" title=\"Step 2. classify\"></a>Step 2. classify</h4><p>Determine what pathways a genome encodes. Classify quickly reads in KO annotations in the form of a matrix (KO IDs as rows, genomes as columns) and determines which KEGG modules are complete. Annotation matrices can be generated using the annotate function.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ enrichm classify --output EnrichM_classify/ko_hmm_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/ko_hmm_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/ko_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/ko_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下6个命令可不必运行</span></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/cazy_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/cazy_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/cluster_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/cluster_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/ec_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/ec_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/ortholog_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/ortholog_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/pfam_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/pfam_frequency_table.tsv --cutoff 0</span><br><span class=\"line\"></span><br><span class=\"line\">$ enrichm classify --output EnrichM_classify/tigrfam_frequency_table --aggregate --genome_and_annotation_matrix EnrichM_annotate/tigrfam_frequency_table.tsv --cutoff 0</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\n\n<ul>\n<li><p>Output options:</p>\n<ul>\n<li>--output OUTPUT       Output directory</li>\n<li>--force               Overwrite previous run</li>\n</ul>\n</li>\n<li><p>Input options:</p>\n<ul>\n<li>--genome_and_annotation_matrix GENOME_AND_ANNOTATION_MATRIX<br>      Path to file containing a genome annotation matrix</li>\n<li>--custom_modules CUSTOM_MODULES<br>      Tab separated file containing module name, definition as the columns</li>\n<li>--module_rules_json MODULE_RULES_JSON<br>       json file specifying rules to interpret the annotation and guide module annotation</li>\n<li>--gff_files GFF_FILES<br>      GFF files for the genomes being classified.</li>\n</ul>\n</li>\n<li><p>Cutoff options:</p>\n<ul>\n<li>--cutoff CUTOFF       Output only modules with greater than this percent of the requied KO groups (default &#x3D; print all modules)</li>\n</ul>\n</li>\n<li><p>Runtime options:</p>\n<ul>\n<li>--aggregate           Calculate the abundance of each pathway within each genome&#x2F;sample (column)</details></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Step-3-enrichment\"><a href=\"#Step-3-enrichment\" class=\"headerlink\" title=\"Step 3. enrichment\"></a>Step 3. enrichment</h4><p>Enrichment will read in KO or PFAM annotations in the form of a matrix (IDs as rows, genomes as columns) and a metadata file that separates genomes into groups to compare, and will run some basic stats to determine the enrichment of modules or pfam clans between and within the groups.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ enrichm enrichment --output EnrichM_enrichment/ --metadata genome.list --annotation_matrix EnrichM_annotate/ko_frequency_table.tsv --force</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\n\n<ul>\n<li><p>- Output options:</p>\n<ul>\n<li>--output OUTPUT       Output directory</li>\n<li>--force               Overwrite previous run</li>\n</ul>\n</li>\n<li><p>Input options:</p>\n<ul>\n<li>--annotate_output ANNOTATE_OUTPUT<br>     Output directory provided by enrichm annotate</li>\n<li>--metadata METADATA   Metadata file with two columns, the first with the genome name, the second with the groupings to compare.</li>\n<li>--annotation_matrix ANNOTATION_MATRIX<br>     Annotation matrix to compare.</li>\n<li>--gff_files GFF_FILES [GFF_FILES …]<br>     Gff files for genomes to compare.</li>\n<li>--abundance 基因组丰度矩阵</li>\n<li>--abundance_metadata ABUNDANCE_METADATA<br>     Metadata grouping abundance samples.</li>\n<li>--transcriptome TRANSCRIPTOME  基因组丰度矩阵</li>\n<li>--transcriptome_metadata TRANSCRIPTOME_METADATA<br>     Metadata grouping abundance samples.</li>\n</ul>\n</li>\n<li><p>Genome Taxonomy DataBase (GTDB) options:</p>\n<ul>\n<li>--batchfile BATCHFILE<br>     metadata file to compare with.</li>\n</ul>\n</li>\n<li><p>Runtime options:</p>\n<ul>\n<li>--pval_cutoff PVAL_CUTOFF<br>     Only output results with a p-value below a this cutoff (default&#x3D;0.05).</li>\n<li>--proportions_cutoff PROPORTIONS_CUTOFF<br>     Proportion enrichment cutoff.</li>\n<li>--threshold THRESHOLD<br>     The threshold to control for in false discovery rate of familywise error rate.</li>\n<li>--multi_test_correction MULTI_TEST_CORRECTION<br>     The form of mutiple test correction to use. Uses the statsmodel module and consequently has all of its options.<br>                Default: Benjamini-Hochberg FDR (fdr_bh)<br>                Options: Bonferroni (b)<br>                     Sidak (s)<br>                     Holm (h)<br>                     Holm-Sidak (hs)<br>                     Simes-Hochberg (sh)<br>                     Hommel (ho)<br>                     FDR Benjamini-Yekutieli (fdr_by)<br>                     FDR 2-stage Benjamini-Hochberg (fdr_tsbh)<br>                     FDR 2-stage Benjamini-Krieger-Yekutieli (fdr_tsbky)<br>                     FDR adaptive Gavrilov-Benjamini-Sarkar (fdr_gbs))</li>\n<li>--processes PROCESSES  采用多少个进程进行富集分析</li>\n<li>--allow_negative_values  允许输入的矩阵中有负值</li>\n<li>--ko                    Compare KO ids (annotated with DIAMOND)</li>\n<li>--ko_hmm          Compare KO ids (annotated with HMMs)</li>\n<li>--pfam                Compare Pfam ids</li>\n<li>--tigrfam             Compare TIGRFAM ids</li>\n<li>--cluster              Compare cluster ids</li>\n<li>--ortholog            Compare ortholog ids</li>\n<li>--cazy                 Compare dbCAN ids</li>\n<li>--ec                     Compare EC ids</li>\n<li>--range RANGE         Base pair range to search for synteny within. Default &#x3D; 2500.</li>\n<li>--subblock_size SUBBLOCK_SIZE<br>                Number of genes clustered in a row to be reported. Default &#x3D; 2.</li>\n<li>--operon_mismatch_cutoff OPERON_MISMATCH_CUTOFF<br>                Number of allowed mismatches when searching for operons across genomes. Defaul</li>\n<li>--operon_match_score_cutoff OPERON_MATCH_SCORE_CUTOFF<br>                Score cutoff for operon matches</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h4 id=\"Step-4-pathway\"><a href=\"#Step-4-pathway\" class=\"headerlink\" title=\"Step 4. pathway\"></a>Step 4. pathway</h4><p>Pathway reads in a KO matrix and generates a Cytoscape-readable metabolic network and metadata file. Only reactions that are possible given the KOs present in the input matrix are shown, and the modules and reactions that are included in the output can be customized（<strong>报错</strong>）.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ enrichm pathway --matrix EnrichM_annotate/ko_frequency_table.tsv --genome_metadata genome.list --output EnrichM_pathway --abundance EnrichM_enrichment/F01_vs_F02_ivg_results.cdf.tsv --abundance_metadata genome.list --force</span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\n\n<ul>\n<li><p>Input options:</p>\n<ul>\n<li>--matrix KO矩阵. 必须提供</li>\n<li>--genome_metadata GENOME_METADATA<br>       Metadata文件包含两列，第一列为基因组名字，第二列with the groupings to compare.</li>\n<li>--abundance 丰度矩阵</li>\n<li>--abundance_metadata ABUNDANCE_METADATA<br>      Metadata文件包含两列，第一列为基因组名字，第二列with the groupings to compare.</li>\n<li>--tpm_values TPM_VALUES<br>       DetectM产生的TPM values</li>\n<li>--tpm_metadata TPM_METADATA<br>       Metadata文件包含两列，第一列为基因组名字，第二列with the groupings to compare.</li>\n<li>--metabolome METABOLOME<br>       Metabolome CID matrix.</li>\n</ul>\n</li>\n<li><p>Logging options:</p>\n<ul>\n<li>--log LOG             Output logging information to this file.</li>\n<li>--verbosity VERBOSITY<br>     Level of verbosity (1 - 5 - default &#x3D; 4) 5 &#x3D; Very verbose, 1 &#x3D; Silent</li>\n</ul>\n</li>\n<li><p>Output options:</p>\n<ul>\n<li>--output             输出路径</li>\n<li>--force               覆盖之前输出的结果</li>\n</ul>\n</li>\n<li><p>Pathway options:</p>\n<ul>\n<li>--limit LIMIT [LIMIT …]<br>     USE ONLY these reactions, or reactions within this pathway or module (space separated list).</li>\n<li>--filter FILTER [FILTER …]<br>     Do not use these reactions, or reactions within this pathway or module (space separated list).</li>\n<li>--enrichment_output ENRICHMENT_OUTPUT<br>      Supply an enrichment output to integrate the results into the output network.</li>\n</ul>\n</li>\n</ul>\n</details>\n\n<h4 id=\"Step-5-explore\"><a href=\"#Step-5-explore\" class=\"headerlink\" title=\"Step 5. explore\"></a>Step 5. explore</h4><p>Explore is similar to pathway, but rather than generating a specified pathway it will start from a given query compound ID, and explore the possible reactions that use that compound given the enzymes present in the input KO matrix.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ </span><br></pre></td></tr></table></figure>\n<details>\n<summary>点击此处查看参数</summary>\n\n<ul>\n<li><p>Input options: </p>\n<ul>\n<li>--matrix MATRIX       KO矩阵. 必须提供</li>\n<li>--genome_metadata GENOME_METADATA<br>      Metadata文件包含两列，第一列为基因组名字，第二列with the groupings to compare.</li>\n<li>--abundance 丰度矩阵</li>\n<li>--abundance_metadata ABUNDANCE_METADATA<br>     Metadata文件包含两列，第一列为基因组名字，第二列with the groupings to compare..</li>\n<li>--tpm_values TPM_VALUES<br>     DetectM产生的TPM values</li>\n<li>--tpm_metadata TPM_METADATA<br>     Metadata文件包含两列，第一列为基因组名字，第二列with the groupings to compare..</li>\n<li>--metabolome METABOLOME<br>     Metabolome CID matrix.</li>\n</ul>\n</li>\n<li><p>Logging options:</p>\n<ul>\n<li>--log LOG             Output logging information to this file.</li>\n<li>--verbosity VERBOSITY<br>      Level of verbosity (1 - 5 - default &#x3D; 4) 5 &#x3D; Very verbose, 1 &#x3D; Silent</li>\n</ul>\n</li>\n<li><p>Output options:</p>\n<ul>\n<li>--output             输出路径</li>\n<li>--force               覆盖之前输出的结果</li>\n</ul>\n</li>\n<li><p>Query options:</p>\n<ul>\n<li>--queries QUERIES     A file containing the KEGG ids of the compounds from which to start in the metabolic network</li>\n<li>--depth DEPTH         Number of steps to take into the metabolic network</details></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"C-Metagenome-functional-profiling\"><a href=\"#C-Metagenome-functional-profiling\" class=\"headerlink\" title=\"C Metagenome functional profiling\"></a>C Metagenome functional profiling</h1><ul>\n<li>从宏基因组组装的contigs中预测基因——prodigal -p meta模式</li>\n<li>Metagenome-assembled genes which were not included in the MAGs were subjected to taxonomic classification using <a href=\"https://github.com/bioinformatics-centre/kaiju\">Kaiju</a></li>\n<li>eggNOG-mapper比对<a href=\"https://doi.org/10.1093/nar/gkv1248\">eggnog</a>数据库</li>\n<li>HMMER 比对<a href=\"https://doi.org/10.1093/nar/gky995\">Pfam</a></li>\n<li><a href=\"https://www.kegg.jp/blastkoala/\">GhostKOALA </a>和<a href=\"https://www.genome.jp/tools/kofamkoala/\">KofamKOALA (v1.0.0)</a>比对<a href=\"https://doi.org/10.1093/nar/28.1.27\">KEGG</a></li>\n<li>BLASTP比对<a href=\"https://doi.org/10.1093/nar/gkv1103\">TCDB</a></li>\n<li><a href=\"http://bcb.unl.edu/dbCAN2/\">dbCAN2 (v2.0.1)</a>比对<a href=\"https://doi.org/10.1093/nar/gkn663\">CAZy</a></li>\n<li>BLASTP比对<a href=\"https://www.ebi.ac.uk/merops/submit_searches.shtml\">MEROPS </a></li>\n<li><a href=\"https://github.com/Arkadiy-Garber/FeGenie\">FeGenie</a>检测Iron-related genes</li>\n<li>Fe-containing domains were characterized using <a href=\"https://doi.org/10.1073/pnas.0605798103\">Superfamily (v1.75)</a>.</li>\n<li>砷呼吸和抗性基因挖掘<a href=\"https://github.com/ShadeLab/PAPER_Dunivin_meta_arsenic/tree/master/HMM_search\">https://github.com/ShadeLab/PAPER_Dunivin_meta_arsenic&#x2F;tree&#x2F;master&#x2F;HMM_search</a>，模型下载<a href=\"https://github.com/ShadeLab/PAPER_Dunivin_meta_arsenic/tree/master/gene_targeted_assembly/gene_resource\">https://github.com/ShadeLab/PAPER_Dunivin_meta_arsenic/tree/master/gene_targeted_assembly/gene_resource</a></li>\n</ul>\n<h1 id=\"参考资料：\"><a href=\"#参考资料：\" class=\"headerlink\" title=\"参考资料：\"></a>参考资料：</h1><ul>\n<li><a href=\"https://github.com/biobakery/MetaPhlAn/wiki/MetaPhlAn-3.0\">MetaPhlAn 3.0 tutorial</a></li>\n<li><a href=\"https://zouhua.top/archives/9d8099c8.html\">MetaPhlAn 3.0: 宏基因组物种组成分析软件</a></li>\n<li><a href=\"https://github.com/biobakery/biobakery/wiki/GraPhlAn\">GraPhlAn Tutorial</a></li>\n<li></li>\n</ul>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"宏基因组","path":"api/tags/宏基因组.json"}]},{"title":"Linux骚操作","slug":"Linux骚操作","date":"2021-01-15T07:37:43.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Linux骚操作.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png","content":"<p>记录一些平时遇到的Linux问题及解决方法！</p>\n<span id=\"more\"></span>\n\n<h1 id=\"骚操作1：查杀僵尸进程\"><a href=\"#骚操作1：查杀僵尸进程\" class=\"headerlink\" title=\"骚操作1：查杀僵尸进程\"></a>骚操作1：查杀僵尸进程</h1><h2 id=\"通过top命令发现了僵尸进程\"><a href=\"#通过top命令发现了僵尸进程\" class=\"headerlink\" title=\"通过top命令发现了僵尸进程\"></a>通过top命令发现了僵尸进程</h2><p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"发现僵尸进程\"></p>\n<p>这里的aragorn和prodigal为僵尸进程。</p>\n<h2 id=\"寻找僵尸进程的父进程\"><a href=\"#寻找僵尸进程的父进程\" class=\"headerlink\" title=\"寻找僵尸进程的父进程\"></a>寻找僵尸进程的父进程</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -A -ostat,ppid,pid,cmd | grep -e <span class=\"string\">&#x27;^[Zz]&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill2.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill2.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"寻找父进程ppid\"></p>\n<p>aragorn和prodigal的父进程的ppid为133619。</p>\n<h2 id=\"杀死父进程\"><a href=\"#杀死父进程\" class=\"headerlink\" title=\"杀死父进程\"></a>杀死父进程</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">kill</span> -9 133619</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill3.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill3.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"僵尸进程已被杀死\"></p>\n<p>之所以选择杀死父进程是因为僵尸进程本身很难被杀掉！</p>\n<h1 id=\"骚操作2：使用sudo或nohup运行bash报错\"><a href=\"#骚操作2：使用sudo或nohup运行bash报错\" class=\"headerlink\" title=\"骚操作2：使用sudo或nohup运行bash报错\"></a>骚操作2：使用sudo或nohup运行bash报错</h1><h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><p>在终端里使用sudo或nohup运行bash的时候经常报错：-bash: syntax error near unexpected token ‘do’。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>将要运行的命令加到如下语句中：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#用超级用户运行时</span></span><br><span class=\"line\">sudo bash -c <span class=\"string\">&#x27;your commands&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#服务器投后台运行</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> bash -c <span class=\"string\">&#x27;your commands&#x27;</span> &amp;</span><br></pre></td></tr></table></figure>\n<h1 id=\"骚操作3：CentOS升级GCC\"><a href=\"#骚操作3：CentOS升级GCC\" class=\"headerlink\" title=\"骚操作3：CentOS升级GCC\"></a>骚操作3：CentOS升级GCC</h1><h2 id=\"安装SCL（第三方软件选集）\"><a href=\"#安装SCL（第三方软件选集）\" class=\"headerlink\" title=\"安装SCL（第三方软件选集）\"></a>安装SCL（第三方软件选集）</h2><p>使用下面命令安装SCL<br>SCL可以在不覆盖原有软件包的情况下与其共存，缺点就是仅支持64位<br>SCL仅支持安装devtoolset-4（gcc 5.2）（不含）之后的gcc版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y centos-release-scl</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装gcc\"><a href=\"#安装gcc\" class=\"headerlink\" title=\"安装gcc\"></a>安装gcc</h2><p>使用以下命令安装gcc，其中的9表示大版本号，默认安装大版本下的最新稳定版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"将gcc加入环境变量\"><a href=\"#将gcc加入环境变量\" class=\"headerlink\" title=\"将gcc加入环境变量\"></a>将gcc加入环境变量</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"骚操作4：CentOS-7防火墙\"><a href=\"#骚操作4：CentOS-7防火墙\" class=\"headerlink\" title=\"骚操作4：CentOS 7防火墙\"></a>骚操作4：CentOS 7防火墙</h1><h2 id=\"启动防火墙\"><a href=\"#启动防火墙\" class=\"headerlink\" title=\"启动防火墙\"></a>启动防火墙</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动： systemctl start firewalld</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"开启端口\"><a href=\"#开启端口\" class=\"headerlink\" title=\"开启端口\"></a>开启端口</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=80/tcp --permanent </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重新载入\"><a href=\"#重新载入\" class=\"headerlink\" title=\"重新载入\"></a>重新载入</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查看防火墙状态\"><a href=\"#查看防火墙状态\" class=\"headerlink\" title=\"查看防火墙状态\"></a>查看防火墙状态</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status firewalld.service</span><br><span class=\"line\"></span><br><span class=\"line\">firewall-cmd --state</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看当前开了哪些端口\"><a href=\"#查看当前开了哪些端口\" class=\"headerlink\" title=\"查看当前开了哪些端口\"></a>查看当前开了哪些端口</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-services</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查看所有打开的端口\"><a href=\"#查看所有打开的端口\" class=\"headerlink\" title=\"查看所有打开的端口\"></a>查看所有打开的端口</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"骚操作5：Linux基本指令丢失修复办法\"><a href=\"#骚操作5：Linux基本指令丢失修复办法\" class=\"headerlink\" title=\"骚操作5：Linux基本指令丢失修复办法\"></a>骚操作5：Linux基本指令丢失修复办法</h1><p>如输入ls、cd、cat等基本指令提示找不到命令，可以通过以下命令修复：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"}]},{"title":"BtToxin_Digger--A high-throughput Bacillus thuringiensis toxin mining pipeline","slug":"BtToxin_Digger","date":"2020-11-04T07:38:43.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/BtToxin_Digger.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>BtToxin_Digger is the latest high-throughput Bacillus thuringiensis virulence factor mining pipeline on the whole network, including the basic web version and the local advanced version.</p>\n<span id=\"more\"></span>\n\n<h2 id=\"What-is-BtToxin-Digger\"><a href=\"#What-is-BtToxin-Digger\" class=\"headerlink\" title=\"What is BtToxin_Digger?\"></a>What is BtToxin_Digger?</h2><p>BtToxin_Digger is a high-throughput, automatic gene mining tool that can mine toxin genes, such as Cry, Cyt and Vip, etc, from <em>Bacillus thuringiensis</em>. The pipeline accepts multiple forms of input data including Reads, assembled genomes, CDSs, and protein sequences and can output rich and useful results. It is derived from the re-design of the tool <a href=\"https://bcam.hzau.edu.cn/BtToxin_Digger/\">BtToxin_Digger</a> we developed previously. Compared with BtToxin_Digger, BtToxin_Digger has many improvements, as follows:</p>\n<ul>\n<li><p>Can be run in batches, suitable for large-scale genome analysis.</p>\n</li>\n<li><p>Added genome assembly functions, including second-generation short-reads assembly, third-generation long-reads assembly, and hybrid assembly of short-reads and long-reads, to realize the full-automatic mining of genes from Reads to virulence factors. The previous three input files (assembled genomes, ORFs and protein sequences) are still supported, and genome assembly can be used independently.</p>\n</li>\n<li><p>Fixed a bug where BtToxin_Digger often reported errors when processing assembled genomes.</p>\n</li>\n<li><p>Added support for CDSs and not limited to ORFs.</p>\n</li>\n<li><p>The database has been updated, adding support for App, Gpp, Mcf, Mpf, Mpp, Mtx, Pra, Prb, Spp, Tpp, Cyt, Vip, Vpa, Vpb, Xpp and other virulence factors.</p>\n</li>\n<li><p>BtToxin_Digger generates comprehensive and readable outputs including toxin list and sequence for each input; a matrix of all strains and the virulence factors it contains (behavior strain names, listed as virulence factor names), which can be used as virulence factors contained in the strain Database; and a file writes the information and sequences of all toxins (Table 1) to facilitate centralized processing and downstream analysis and experiment designs.</p>\n</li>\n<li><p>Added multi-thread support, greatly improving the running speed of the pipeline.</p>\n</li>\n</ul>\n<h2 id=\"Installation\"><a href=\"#Installation\" class=\"headerlink\" title=\"Installation\"></a>Installation</h2><ul>\n<li><p>Required dependencies<br>– <a href=\"http://metacpan.org/pod/BioPerl\">BioPerl</a><br>– <a href=\"https://www.ebi.ac.uk/Tools/hmmer/\">HMMER</a><br>– <a href=\"https://github.com/cjlin1/libsvm\">libsvm</a><br>– <a href=\"https://blast.ncbi.nlm.nih.gov/Blast.cgi?CMD=Web&amp;PAGE_TYPE=BlastDocs&amp;DOC_TYPE=Download\">NCBI-blast+</a><br>– <a href=\"http://www.perl.org/get.html\">Perl</a><br>– <a href=\"https://liaochenlanruo.hzaubmb.org/pgcgap\">PGCGAP</a></p>\n</li>\n<li><p>Source codes</p>\n</li>\n</ul>\n<p>The BtToxin_Digger codes can be downloaded from <a href=\"https://github.com/liaochenlanruo/BtToxin_Digger\">GitHub</a>.</p>\n<ul>\n<li>Install with Bioconda - OSX&#x2F;Linux&#x2F;WSL</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conda create -n toxin python=3</span><br><span class=\"line\">conda activate toxin</span><br><span class=\"line\">conda install bttoxin_digger</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Install with the docker container</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull quay.io/biocontainers/bttoxin_digger:&lt;tag&gt;</span><br></pre></td></tr></table></figure>\n<p>(See <a href=\"https://quay.io/repository/biocontainers/bttoxin_digger?tab=tags\">bttoxin_digger&#x2F;tags</a> for valid values for <tag>)</p>\n<h2 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger [Options]</span><br></pre></td></tr></table></figure>\n\n<p>Options:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[--help]                      Print the help message and exit</span><br><span class=\"line\">[--version]                   Show version number of BtToxin_Digger and exit</span><br><span class=\"line\">[--threads (INT)]             Number of threads to be used ( Default 4 )</span><br><span class=\"line\">[--SeqPath (PATH)]            [Required] The path of input sequences ( Default &quot;the current directory&quot; )</span><br><span class=\"line\">[--SequenceType (STRING)]     [Required] Sequence type for inputs. &quot;reads&quot;, &quot;nucl&quot;, &quot;orfs&quot;, and &quot;prot&quot; avaliable ( Default nucl )</span><br><span class=\"line\">[--platform (STRING)]         [Required] Sequencing Platform, &quot;illumina&quot;, &quot;pacbio&quot;, &quot;oxford&quot; and &quot;hybrid&quot; available ( Default illumina )</span><br><span class=\"line\">[--assemble_only (STRING)]    Only perform genome assembly without predicting toxins.</span><br><span class=\"line\">[--reads1 (STRING)]           [Required by &quot;reads&quot;] The suffix name of reads 1 ( for example: if the name of reads 1 is &quot;YBT-1520_L1_I050.R1.clean.fastq.gz&quot;, &quot;YBT-1520&quot; is the strain same, so the suffix name should be &quot;.R1.clean.fastq.gz&quot; )</span><br><span class=\"line\">[--reads2 (STRING)]           [Required by &quot;reads&quot;] The suffix name of reads 2( not required by &quot;oxford&quot; and &quot;pacbio&quot;. For example: if the name of reads 2 is &quot;YBT-1520_2.fq&quot;, the suffix name should be _2.fq&quot; )</span><br><span class=\"line\">[--suffix_len (INT)]          [Required by &quot;reads&quot;] (Strongly recommended) The suffix length of the reads file, that is the length of the reads name minus the length of the strain name. For example the --suffix_len of &quot;YBT-1520_L1_I050.R1.clean.fastq.gz&quot; is 26 ( &quot;YBT-1520&quot; is the strain name ) ( Default 0 )</span><br><span class=\"line\">[--short1 (STRING)]           [Required] FASTQ file of first short reads in each pair. Needed by hybrid assembly ( Default Unset )</span><br><span class=\"line\">[--short2 (STRING)]           [Required] FASTQ file of second short reads in each pair. Needed by hybrid assembly ( Default Unset )</span><br><span class=\"line\">[--long (STRING)]             [Required] FASTQ or FASTA file of long reads. Needed by hybrid assembly ( Default Unset )</span><br><span class=\"line\">[--hout (STRING)]             [Required] Output directory for hybrid assembly ( Default &quot;../../Results/Assembles/Hybrid&quot; )</span><br><span class=\"line\">[--genomeSize (STRING)]       [Required] An estimate of the size of the genome. Common suffixes are allowed, for example, 3.7m or 2.8g. Needed by PacBio data and Oxford data ( Default 6.07m )</span><br><span class=\"line\">[--Scaf_suffix (STRING)]      The suffix of scaffolds or genomes ( Default &quot;.filtered.fas&quot; )</span><br><span class=\"line\">[--orfs_suffix (STRING)]      The suffix of orfs files ( Default &quot;.ffn&quot; )</span><br><span class=\"line\">[--prot_suffix (STRING)]      The suffix of protein files ( Default &quot;.faa&quot; )</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h2><ul>\n<li>Processing Illumina paired-end Reads</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;Illumina Reads PATH&gt; --SequenceType reads --platform illumina --reads1 &lt;suffix name of reads 1&gt; -reads2 &lt;suffix name of reads 2&gt; --threads &lt;INT&gt; --suffix_len &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Processing PacBio long Reads</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;PacBio Reads PATH&gt; --SequenceType reads --platform pacbio --reads1 &lt;suffix name of PacBio reads&gt; --threads &lt;INT&gt; --suffix_len &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Processing Oxford long Reads</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;Oxford Reads PATH&gt; --SequenceType reads --platform oxford --reads1 &lt;suffix name of Oxford reads&gt; --threads &lt;INT&gt; --suffix_len &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Processing Hybrid Reads (Long reads + illumina short reads)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;Reads PATH&gt; --SequenceType reads --platform hybrid --short1 &lt;short reads 1&gt; --short2 &lt;short reads 2&gt; --long &lt;long reads&gt; --threads &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Processing Assembled genomes</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;Assembled genome PATH&gt; --SequenceType nucl --Scaf_suffix &lt;suffix of genomes&gt; --threads &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Processing Protein sequences</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;Protein file PATH&gt; --SequenceType prot --prot_suffix &lt;suffix of protein files&gt; --threads &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Processing Coding sequences</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BtToxin_Digger --SeqPath &lt;CDSs file PATH&gt; --SequenceType orfs --orfs_suffix &lt;suffix of orfs files&gt; --threads &lt;INT&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Outputs\"><a href=\"#Outputs\" class=\"headerlink\" title=\"Outputs\"></a>Outputs</h2><ul>\n<li><p><strong>Results&#x2F;Assembles&#x2F;*</strong>: Genome assembly results;</p>\n</li>\n<li><p><strong>Results&#x2F;Toxins&#x2F;*.list</strong>: Toxin list of each strain;</p>\n</li>\n<li><p><strong>Results&#x2F;Toxins&#x2F;*.gbk</strong>: Toxin sequences in Genbank format of each strain;</p>\n</li>\n<li><p><strong>Results&#x2F;Toxins&#x2F;Btallgenes.table</strong>: A matrix describes Strains vs. Toxins;</p>\n</li>\n<li><p><strong>Results&#x2F;Toxins&#x2F;All_Toxins.txt</strong>: A table containing all information and sequences of all toxin genes. See table 1 for details.</p>\n</li>\n</ul>\n<h2 id=\"Contents-of-list\"><a href=\"#Contents-of-list\" class=\"headerlink\" title=\"Contents of *.list:\"></a>Contents of *.list:</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Overview of prediction \t Sequence type: nucl</span><br><span class=\"line\">Name\tCry\tCyt\tVip\tOthers\tSummary</span><br><span class=\"line\">Rank1\t1\t0\t0\t0\t1</span><br><span class=\"line\">Rank2\t0\t0\t0\t0\t0</span><br><span class=\"line\">Rank3\t0\t0\t0\t0\t0</span><br><span class=\"line\">Rank4\t10\t0\t1\t1\t12</span><br><span class=\"line\">HMM_SVM\t0\t0\t0\t0</span><br><span class=\"line\">Summary\t11\t0\t1\t1\t13</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Toxin type: Cry protein</span><br><span class=\"line\">ID\tProtein_ID\t\tProtein_description\tLength\tRank\tBLAST\tBest_hit\tHit length\tCoverage\tIdentity\tSVM\tHMM</span><br><span class=\"line\">1\tNHPK02000085.1_00018\t+2 19034-20206 len=391\t391\tRank1\tYES\tCry78Aa1\t359\t\t97.21\t\t32.66\t\tNO\tNO</span><br><span class=\"line\">2\tNHPK02000099.1_00001\t-1 5374-7407 len=678\t678\tRank4\tYES\tCry2Ab35\t633\t\t100.00\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">3\tNHPK02000115.1_00002\t+2 2-1342 len=447\t447\tRank4\tYES\tCry1Da2\t\t1165\t\t38.37\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">4\tNHPK02000115.1_00006\t+3 4275-7898 len=1208\t1208\tRank4\tYES\tCry1Ca15\t1189\t\t100.00\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">5\tNHPK02000153.1_00001\t-1 4176-6365 len=730\t730\tRank4\tYES\tCry1Ia40\t719\t\t100.00\t\t100.00\t\tYES\tYES</span><br><span class=\"line\">6\tNHPK02000168.1_00002\t-3 1673-5146 len=1158\t1158\tRank4\tYES\tCry9Ea9\t\t1150\t\t100.00\t\t100.00\t\tYES\tYES</span><br><span class=\"line\">7\tNHPK02000196.1_00001\t+3 723-2942 len=740\t740\tRank4\tYES\tCry1Da2\t\t1165\t\t63.43\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">8\tNHPK02000240.1_00001\t+2 2-1813 len=604\t604\tRank4\tYES\tCry1Ac16\t1178\t\t51.27\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">9\tNHPK02000243.1_00001\t+2 2-1738 len=579\t579\tRank4\tYES\tCry1Aa18\t1225\t\t47.27\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">10\tNHPK02000256.1_00001\t+2 2-1294 len=431\t431\tRank4\tYES\tCry1Ac30\t1178\t\t36.59\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">11\tNHPK02000386.1_00001\t-2 3-530 len=176\t176\tRank4\tYES\tCry1Ab11\t695\t\t25.32\t\t99.43\t\tNO\tYES</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Toxin type: Cyt protein</span><br><span class=\"line\">ID\tProtein_ID\tProtein_description\tLength\tRank\tBLAST\tBest_hit\tHit length\tCoverage\tIdentity\tSVM\tHMM</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Toxin type: Vip protein</span><br><span class=\"line\">ID\tProtein_ID\t\tProtein_description\tLength\tRank\tBLAST\tBest_hit\tHit length\tCoverage\tIdentity\tSVM\tHMM</span><br><span class=\"line\">1\tNHPK02000099.1_00004\t-3 10013-12397 len=795\t795\tRank4\tYES\tVip3Aa12\t789\t\t100.00\t\t100.00\t\tNO\tYES</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Toxin type: Other toxins</span><br><span class=\"line\">ID\tProtein_ID\t\tProtein_description\tLength\tRank\tBLAST\tBest_hit\tHit length\tCoverage\tIdentity\tSVM\tHMM</span><br><span class=\"line\">1\tNHPK02000017.1_00027\t-3 15272-16258 len=329\t329\tRank4\tYES\tZwa5B-other\t322\t\t100.00\t\t99.07\t\tNO\tNA</span><br><span class=\"line\">//</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Contents-of-gbk-Partial\"><a href=\"#Contents-of-gbk-Partial\" class=\"headerlink\" title=\"Contents of *.gbk (Partial):\"></a>Contents of *.gbk (Partial):</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOCUS       NHPK02000017.1_00027        77664 bp    dna     linear   UNK</span><br><span class=\"line\">ACCESSION   NHPK02000017.1_00027</span><br><span class=\"line\">FEATURES             Location/Qualifiers</span><br><span class=\"line\">     Segment         complement(15272..16258)</span><br><span class=\"line\">                     /ETX_MTX2=&quot;NO&quot;</span><br><span class=\"line\">                     /Endotoxin_C=&quot;NO&quot;</span><br><span class=\"line\">                     /Endotoxin_M=&quot;NO&quot;</span><br><span class=\"line\">                     /Endotoxin_N=&quot;NO&quot;</span><br><span class=\"line\">                     /Endotoxin_mid=&quot;NO&quot;</span><br><span class=\"line\">                     /Rank=&quot;Rank4&quot;</span><br><span class=\"line\">                     /Segment_name=&quot;NHPK02000017.1_00027&quot;</span><br><span class=\"line\">                     /Toxin_10=&quot;NO&quot;</span><br><span class=\"line\">                     /blast_detail=&quot;Query_desc:-3 15272-16258 len=329</span><br><span class=\"line\">                     Query_Length:329\tQuery_Start-End:8-329\tHit_id:Zwa5B-other</span><br><span class=\"line\">                     Hit_desc:AAZ67352.1\tHit_length:322\tHit_Start-End:1-322</span><br><span class=\"line\">                     Aln_length:322\tPercent_identity:99.0683229813665</span><br><span class=\"line\">                     E-value:0.0&quot;</span><br><span class=\"line\">                     /blast_prediction=&quot;YES&quot;</span><br><span class=\"line\">                     /hmm_detail=&quot;&quot;</span><br><span class=\"line\">                     /hmm_prediction=&quot;NA&quot;</span><br><span class=\"line\">                     /locus_tag=&quot;NHPK02000017.1_00027&quot;</span><br><span class=\"line\">                     /protein_desc=&quot;-3 15272-16258 len=329&quot;</span><br><span class=\"line\">                     /protein_id=&quot;NHPK02000017.1_00027&quot;</span><br><span class=\"line\">                     /protein_len=&quot;329&quot;</span><br><span class=\"line\">                     /svm_prediction=&quot;NO&quot;</span><br><span class=\"line\">                     /translation=&quot;YRNEEAIMMYLNTKHINEMGVNWEETINVISKAVQSLDAEDFSQ</span><br><span class=\"line\">                     PIKPYLRFDDPANRIIAMPAYIGGEFKVSGIKWIASFPKNIEKGIQRAHSVTILNDAM</span><br><span class=\"line\">                     TGKPFATLNTAMVSVIRTASVTGLMIREFAKLRDLNNVKVGIIGFGPIGQMHLKMVTA</span><br><span class=\"line\">                     LLGDKIESVYLYDINGIKDELIPEDIYSKTQKVNAYEEAYNDADIFITCTVSAEGYID</span><br><span class=\"line\">                     KKPKDGALLLNVSLRDFKPDILEYTKSLVVDNWEEVCREKTDVERMHLERGLQKEDTV</span><br><span class=\"line\">                     SIADVVIRGALQNFPYDKAILFNPMGMAIFDVAIAAYYYQRAREKEIGVLLED&quot;</span><br><span class=\"line\">ORIGIN      </span><br><span class=\"line\">        1 cttctaaccg caaggactgc ggggttagcc taatcaatta gagttcgata gaactcttta</span><br><span class=\"line\">       61 cttaggaatc cctcacttct aaacgaagtg aaagtggggt tagttcaaaa ctattaacta</span><br><span class=\"line\">      121 taatataccc tttcaagaaa ttttaaaaag gttgaagtag ccaaaaaata ttttccggaa</span><br><span class=\"line\">      181 taattagatt aatttctctt ttttgtatat ttatgttaaa ttattgttat cactacaaat</span><br><span class=\"line\">      241 ttattgaata attttaatac tctccccttt atactatggt aatatgtttt tcacaataca</span><br><span class=\"line\">      301 tattaccact ataattgcaa acatatataa acccatattt agaattttta agattctttc</span><br><span class=\"line\">      361 atagcattaa gatatttttt accttttagt ttgtttattc ttaattttta aactaaaata</span><br><span class=\"line\">      421 atatatattg gtaataatta aataaaattc caataattat aggaaggaga aaattatgaa</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"Table-1-Description-of-“All-Toxins-txt”\"><a href=\"#Table-1-Description-of-“All-Toxins-txt”\" class=\"headerlink\" title=\"Table 1. Description of “All_Toxins.txt”\"></a>Table 1. Description of “All_Toxins.txt”</h2><table>\n<thead>\n<tr>\n<th align=\"left\">Header</th>\n<th align=\"left\">Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">Strain</td>\n<td align=\"left\">The name of your input</td>\n</tr>\n<tr>\n<td align=\"left\">Protein_id</td>\n<td align=\"left\">The protein ID</td>\n</tr>\n<tr>\n<td align=\"left\">Protein_len</td>\n<td align=\"left\">The length of protein sequence</td>\n</tr>\n<tr>\n<td align=\"left\">Strand</td>\n<td align=\"left\">Positive or negative strand where the gene comes from</td>\n</tr>\n<tr>\n<td align=\"left\">Gene location on scaffold</td>\n<td align=\"left\">Gene coordinates on the genome</td>\n</tr>\n<tr>\n<td align=\"left\">SVM</td>\n<td align=\"left\">Is the protein predicted by SVM</td>\n</tr>\n<tr>\n<td align=\"left\">BLAST</td>\n<td align=\"left\">Is the protein predicted by BLAST</td>\n</tr>\n<tr>\n<td align=\"left\">HMM</td>\n<td align=\"left\">Is the protein predicted by HMM</td>\n</tr>\n<tr>\n<td align=\"left\">Hit_id</td>\n<td align=\"left\">The subject sequence ID</td>\n</tr>\n<tr>\n<td align=\"left\">Hit_length</td>\n<td align=\"left\">The length of subject sequence</td>\n</tr>\n<tr>\n<td align=\"left\">Aln_length</td>\n<td align=\"left\">alignment length (sequence overlap)</td>\n</tr>\n<tr>\n<td align=\"left\">Query start-end</td>\n<td align=\"left\">Start and end of alignment in query</td>\n</tr>\n<tr>\n<td align=\"left\">Hit stard-end</td>\n<td align=\"left\">Start and end of alignment in subject</td>\n</tr>\n<tr>\n<td align=\"left\">Identity</td>\n<td align=\"left\">Percentage of identical matches</td>\n</tr>\n<tr>\n<td align=\"left\">Evalue of blast</td>\n<td align=\"left\">Expect value of BLAST</td>\n</tr>\n<tr>\n<td align=\"left\">Hmm hit</td>\n<td align=\"left\">The subject model ID</td>\n</tr>\n<tr>\n<td align=\"left\">Hmm hit length</td>\n<td align=\"left\">The length of subject model sequence</td>\n</tr>\n<tr>\n<td align=\"left\">Evalue of Hmm</td>\n<td align=\"left\">Expect value of HMM</td>\n</tr>\n<tr>\n<td align=\"left\">Nomenclature</td>\n<td align=\"left\"><a href=\"http://www.lifesci.sussex.ac.uk/home/Neil_Crickmore/Bt\">Bt nomenclature</a> containing 4 Ranks</td>\n</tr>\n<tr>\n<td align=\"left\">Endotoxin_N</td>\n<td align=\"left\">Whether the Cry protein contain Endotoxin_N domain</td>\n</tr>\n<tr>\n<td align=\"left\">Endotoxin_M</td>\n<td align=\"left\">Whether the Cry protein contain Endotoxin_M domain</td>\n</tr>\n<tr>\n<td align=\"left\">Endotoxin_C</td>\n<td align=\"left\">Whether the Cry protein contain Endotoxin_C domain</td>\n</tr>\n<tr>\n<td align=\"left\">Endotoxin_mid</td>\n<td align=\"left\">Whether the Cry protein contain Endotoxin_mid domain</td>\n</tr>\n<tr>\n<td align=\"left\">Toxin_10</td>\n<td align=\"left\">Whether the Cry protein contain Toxin_10 domain</td>\n</tr>\n<tr>\n<td align=\"left\">ETX_MTX2</td>\n<td align=\"left\">Whether the Cry protein contain ETX_MTX2 domain</td>\n</tr>\n<tr>\n<td align=\"left\">Gene sequence</td>\n<td align=\"left\">The nucleotide sequence of the toxin</td>\n</tr>\n<tr>\n<td align=\"left\">Protein sequence</td>\n<td align=\"left\">Amino acid sequence of the toxin</td>\n</tr>\n<tr>\n<td align=\"left\">Scaffold sequence</td>\n<td align=\"left\">The scaffold sequence where the toxin gene is located</td>\n</tr>\n</tbody></table>\n<h2 id=\"Table-2-The-contents-of-“All-Toxins-txt”-Partial\"><a href=\"#Table-2-The-contents-of-“All-Toxins-txt”-Partial\" class=\"headerlink\" title=\"Table 2. The contents of “All_Toxins.txt” (Partial)\"></a>Table 2. The contents of “All_Toxins.txt” (Partial)</h2><table>\n<thead>\n<tr>\n<th align=\"center\">Strain</th>\n<th align=\"center\">Protein_id</th>\n<th align=\"center\">Protein_len</th>\n<th align=\"center\">Strand</th>\n<th align=\"center\">Gene location on scaffold</th>\n<th align=\"center\">SVM</th>\n<th align=\"center\">BLAST</th>\n<th align=\"center\">HMM</th>\n<th align=\"center\">Hit_id</th>\n<th align=\"center\">Hit_length</th>\n<th align=\"center\">Aln_length</th>\n<th align=\"center\">Query start-end</th>\n<th align=\"center\">Hit stard-end</th>\n<th align=\"center\">Identity</th>\n<th align=\"center\">Evalue of blast</th>\n<th align=\"center\">Hmm hit</th>\n<th align=\"center\">Hmm hit length</th>\n<th align=\"center\">Evalue of Hmm</th>\n<th align=\"center\">Nomenclature</th>\n<th align=\"center\">Endotoxin_N</th>\n<th align=\"center\">Endotoxin_M</th>\n<th align=\"center\">Endotoxin_C</th>\n<th align=\"center\">Endotoxin_mid</th>\n<th align=\"center\">Toxin_10</th>\n<th align=\"center\">ETX_MTX2</th>\n<th align=\"center\">Gene sequence</th>\n<th align=\"center\">Protein sequence</th>\n<th align=\"center\">Scaffold sequence</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">1126_1</td>\n<td align=\"center\">NHPK02000017.1_00027</td>\n<td align=\"center\">329</td>\n<td align=\"center\">-3</td>\n<td align=\"center\">10001-10987</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">YES</td>\n<td align=\"center\">NA</td>\n<td align=\"center\">Zwa5B-other</td>\n<td align=\"center\">322</td>\n<td align=\"center\">322</td>\n<td align=\"center\">8-329</td>\n<td align=\"center\">1-322</td>\n<td align=\"center\">99.0683229813665</td>\n<td align=\"center\">0.0</td>\n<td align=\"center\">NA</td>\n<td align=\"center\">NA</td>\n<td align=\"center\">NA</td>\n<td align=\"center\">Rank4</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">NO</td>\n<td align=\"center\">GTCTTCTAATAAAACACCTATTTCCTTTTCCCTAGCCCTTTGATAGTAATAAGCAGCAATGGCTACATCAAAAATGGCCATACCCATTGGATTAAATAATATTGCTTTGTCATAAGGGAAGTTTTGCAGTGCTCCTCGGATTACAACGTCAGCAATTGATACTGTATCTTCTTTTTGTAAACCTCTTTCAAGGTGCATCCTTTCAACATCAGTTTTTTCACGACAGACTTCTTCCCAATTATCAACAACTAGGGATTTTGTATATTCTAAGATATCAGGCTTAAAATCACGAAGAGAAACATTGAGTAGTAGCGCTCCATCTTTAGGTTTCTTATCAATATAACCTTCTGCAGAAACAGTACAAGTAATAAAAATATCAGCATCATTATAGGCTTCTTCATAAGCATTAACCTTTTGAGTTTTAGAATAAATATCCTCAGGAATTAATTCGTCTTTAATTCCATTGATATCATATAGGTAAACACTTTCGATTTTATCGCCTAATAGGGCAGTTACCATCTTTAAATGCATCTGACCAATAGGTCCAAATCCAATAATTCCAACTTTAACATTATTTAAATCTCTTAACTTGGCAAACTCTCGAATCATTAACCCTGTTACAGAAGCTGTTCGTATTACACTGACCATTGCTGTATTAAGCGTCGCAAATGGTTTTCCAGTCATAGCATCATTTAATATAGTAACTGAATGAGCACGTTGAATACCTTTCTCAATATTCTTCGGAAAACTAGCTATCCATTTGATTCCTGAAACCTTAAATTCTCCTCCAATATAAGCTGGCATAGCAATAATTCTATTAGCCGGATCATCAAAACGTAAGTATGGCTTAATTGGCTGAGAAAAATCTTCTGCATCAAGACTTTGTACTGCCTTTGAAATGACATTTATTGTTTCTTCCCAATTAACACCCATTTCATTGATATGTTTAGTATTTAAATACATCATAATTGCTTCCTCATTTCTATA</td>\n<td align=\"center\">YRNEEAIMMYLNTKHINEMGVNWEETINVISKAVQSLDAEDFSQPIKPYLRFDDPANRIIAMPAYIGGEFKVSGIKWIASFPKNIEKGIQRAHSVTILNDAMTGKPFATLNTAMVSVIRTASVTGLMIREFAKLRDLNNVKVGIIGFGPIGQMHLKMVTALLGDKIESVYLYDINGIKDELIPEDIYSKTQKVNAYEEAYNDADIFITCTVSAEGYIDKKPKDGALLLNVSLRDFKPDILEYTKSLVVDNWEEVCREKTDVERMHLERGLQKEDTVSIADVVIRGALQNFPYDKAILFNPMGMAIFDVAIAAYYYQRAREKEIGVLLED</td>\n<td align=\"center\">TCTCAATACGAACCAGTAAAAATGGTTCAGGGCGTTGAAGATACTGGACGTAATTCTTTTAGCCAAGCTAGTTTTTCAAACGTACTTCTAAGAACAGATACATCTGGAGCTACCTACAAAAGTTGGAACGGTTCAATTTCTTCCTCATTTTCTAAACACGGTACTTATGGTAACAGTTTCACAGTTTATTCTCAAGTGCCATTAAGCGCAAGTTTACGCTAAAATTGTTCTTGTATACGAATAATTTTGTGAAAAAGGTAGCTGTACTTTTGTACAGCTACCTTTTTCATATGGTGAATTTTTAATAGATATTGTATCAGACATAAGTTACATTCTTCATATTTTAACTTCTTTGAATTCAATAATACTTAATCAGCTTGTCTTATTACTTCACTTAACGTATCGAGATACAGCTTATAGCAACTACAACACGCTTTATTATTAATAATACCACTCTTCTTAATTTAACTTTAATTCCATTGCATTGATTTTTTAATAATAAATATACAACTTAGTAATGATAATAGATATACAATAAGAATAATATACAACTGTTTTGGTTCAATGCTATCGATATAAAGACTCATAATTGGATATGACCAAGGAAACAGTATCCAATAGTTTGTATGCGAGATAAAAAAGCTACCCAACCCGCCTATAACCCCTACTAATAATGAAAGTAACGGGATTTTATAAAATATTATATTTATTAAAAAATGTAAATTCACAATAGTTAAAGAGCTAATCACCATAAAAAGTATAGAAAAAATTAATCTTTGATAAACAGTCCCAAGATTATCAACCGTTAATACTATAGGTATACTAGTTATGACTAAAGCACATATTAAATAACCAAAAGTAATTATTAAGCAAAACAAAAACTTATTACTTAATATAGTTTTTAAAGTGATTCCGTGATAAATAGCAGACATATATCCTTTTCTTCTGAACTCGTTTACAAAAGAAAATGACACTAATAGACCTATTGCAATAGGTAAAAATAATCTACAAAAAAGACTTAGAATCGCTATATGCATGAAAACGCCATCTTTTGATTGAGATGATACAGTTAGAAAGATTTGAAAACTAATTGGTATCAACAGAAATACTAGTAACAGGATATACAATCCATTATGAAGACTTTTTTTATATTCACCTAATATACCCACTTATTTCACCCTTTATTATTCATATGTATAATATTTAAAACTCACAGCTAATAACATAATTCCTAAAATATAGATTGAAGAACTTGCAAGATATATTAAAATAGTTGTTTCTTTCATCATTACATCACTTACTATATTCAATGCATAAAATATTGGAAATGTCTTTGTGAATACTACAGGAAATAATCCATAAGTTACGCTAAAAAAAATCCAAATAACTGACAAGGACGCCGCAAGAATTCCCTTTTTTATAATCAAATGAAAAAGTAATTGAGAATATGGTATTGCTAAAGATAGAATTGTACAAAGCATCAACATTTTCAAAAAATAAAGTATAGATATTTCATATCCATTTATAAAAATATAGATACCCATAACTGAAAAATTTAAAATATTAAAGATTAAATAAAACAGTATAAACAATAAATTTTTAGCTACCAATAATTTAAATTTTGAAATTGGCTTTGTATAGATAATGGCCCAAGTACCATATTTATTTTCAGAAGAAATGATAAAATACCACATACAAGCAGAAAAAATGCTTAATGTTAGTGTATTAAAGTTTACTGTAATTGCTATAAGATTGGTAGATTGAAACATATCGGGATTATTCTTGTTAAAAATAAAATAACTTATACACAAAAAGCTTGATAATAATGAAAAAAACAAAGAAAATAACAATAATTTTCTCCCACCAATTTTCCTCATCTCACTATTCACACTTTTAAAGATAAATTGCATTATGATAGTAACTCCTTTTGTTTAGTTAAAGATAAAAATACTTCCTCTAATGTTAGCTTTTTAGGGCTAACTTCAAAAATATCTATATCATTTTCAATTAATATTCTGGTTAAATTAGGAACACTATTTTGATCTATCATTAGTTTGAATACCCCTTCTTTTTCTATGCTATAAGGTATATCCTTTGTATTTAAAATCCTTTCTGTGGCAGTAGTGTCATTAACATGAACAATATATTCTCTAGAAGTAATAATACTGTTTAAATTCCCTTCATAGAGTAAGTTACCCTTATGCAGTAATGCTATGTAATCTGCTATCATTTCGATTTCAGCTAAATTATGACTAGAAATAAATATTGTCTTCCCCTCATTTTTTACTAAATGAAGTAATAAGCGCCTTATCTCGTGTACTCCCTCTGGGTCTAATCCATTTGTCGGCTCATCAAGAATTAGTATTTTAGGATCATTAAGAATAGCAAAGGAAATACCTAGCCTTTGTTTCATTCCTAAAGAAAAATCTTTCACTTTTTTATCTTTTGCTTTATATATTCCTGTAATTTTTAATACTCTGTCTATTTCATCTAAAGGCTTATTAATCATTTTTTGTACATAGGCTAAATTTTCATATGCTGTCAAATTAGGATAGTAGGTAGGTGAATCAATAAAACAACCCACATTTTCAAATAATTCTTCTTTCCAATCTTTGATATCTTTATTATTAAATAATATCGTTCCTTTATCTAATGGAATTAATCCTAATAGCATTCGCATTGTTGTTGTTTTTCCTGCACCATTTGGTCCAATAAAAGCATATAAACTTCCTTCAGGAACAGATAAGTTTAAATCCCTTACAATGGATTGATTGTCAAAAGACTTTGTTAAATTTTTAGTTTGGATTGCTAATTTCATTTTGTTCCTCACTTTCTTATTCTCAAATAAAAGTAAGTATCTATTAAATTCTTGATCTATTAGATATTCTATTTACCCTTTACCTAATGTTTGCAATTTGGATTTAGAAAATATTTCTCGTTGTTTTAATTTTTTATCAGTAAGTTCATAAACTCTATCTACACGCTCTAAAATATTTTCATCATGAGTGATAATAATCTTAGTGGATGGTATGGCAAATATATTTTCAATAACAGCATTTGCCGTTTCCCTATCTAAATGGTTAGTTGGTTCATCCAAAATAAGAATCGGATATTCTTTCATGAACAATCGTAACATAGCCAACCTTTGTCTTTGGCCACCGGAGAAATTTGTTCCTCCCTCTGAGATTAAAATATCATTTATACTTTGAAATTGAATATAATTACTCAGATTCAATTTATCAATAGACTCCTGGATTTTTGAAGGATCATAATTTATATCAAAGTAAGATAAATTCTCAGATAAACTTCCTCTAAATAAAACTCCATCCTGAGTCATTAGTCCTACATTTTTTCTTAGTTCCTCACTGTTCCAATCTTTAATATCTCTATCGTCTATTAATATATTACCCTTATCGGGAGTATGCAATTTTAATAATAAGTTAGCTAAAGTGGACTTACCACTGCCACTTTCTCCAACAATAGCAATACTTTCGTTATTTTTAATGTTCAAACTTAAGTTTTCTATTATTTTTTTGTCATCAAAACTAAACGAAATATTATTAAATTGAATCGATCCTCTAAGAATGTTTACTTTAGTATCCGATCCATCTTTTTCTAGTTCCTCTTCCAAGATATCTAAAGTTCTTAATAAAAGTGGTTTAACTGAATTCCAATTTAAAATTGATCCTATAATTGTTGAAACCGGAGAAAATATAATACTAGATATAGCAATAAAGAAGAAAATATTACTTAAATCCCCTTCTCCTTTACTAAAATTATAAAATCCTACAGCAAGCATTATGATAATAAATATTGTTGATAGGGAACTATTAAATGATTCTAAAGCATTTTGTTTTAGCGCTCGTTTATGTACTGTATCTAAGTATTTATTATAATCTTTTTGCCATACAGATTTAATTCTAGAAAAAATCCCTGTAGCCTTTACATAATACATCGCTTTTAATGATTCATTAATTTTCCCTCTATGTTCTCCTAGGTAATACGTTTCGACTAAATTAGCATTATATATGAATTTCCCTAAGGAAATATTGATAAATAGGGAACTAGCAATAAAAAACATCAATATTAAAGTATAAAAAGTCTCAGTATATAATAGATACATCAATAATGGAATGATAACTACTATTGATATAATCATTTCAATTAGATCCTCTAAAATATATCCTCGTATTGATTCTAGGCTCATGATTCTTACATTTAAATCCCCTGCATGACGTGTAGTAATTTTTTCTATGGGGGTATTAAACATATGCTCAAAAACTTTTGTTGTACTTTTTCTATCAATTTCTTTCTGAAAGTTTACTTTTATAATAGAAGTTATAGATTTTATCCCTATAACAACGATTAAACTTCCCAAAATAATTAAAAGGTATCTTACATCCACTTCCTTTGAAGCATTCAAAATATCCATAAACTTTTTCAAAATAAAGGGGAAAGCAAGAATTGAGATTTGTGCTAACAATGCTAATAGTGCTAATAAAACAATCTGGCTAGGAGATACAAAATGATCAATATATCTAAGTAATATATGTTTTTCACGCCTTTTAGTATTTGGCTGTATATCTTTTTTGTTTTCTATTACTAGGATATAGTCACAGAACATTTCCTCAAAACTTCTTATATCAATTATCATCGGCCCTGCCTTAGGATCTACAATATAAAATTTATTTGCTTTAACCCTTTCAATAATTACAAAGTGATTAAAGCCCCAAAATGCTATCATCGGCTTTTGTATCCTTTGTAAATCAGTTATATTTTCTATCCTATATGCAGTTGCAGAAAGTCCATACGATTTACTAACTTTTTTAATATCCAACAAACTCCATGCCGATTTTTTATTGATAATTTTACTATTTCTAATTTCCGAAGCTTGTACTGCTGAACCATAATAATGCATAATCATTGCTAGACAACTAGGCCCACAATCAAAAGATGTCATTTGCGGTATAAATTTAATTTTCTTCCTTAACATATTTATCACCTATTCTAGGCATTAAAGTATAAAATGCTATTTAGTTTATTATCCTCTAACCTTTGTAAAAAATACAAAATACTTCCTAGCCCTGTAAATAATGCGATTTTATGAGGATTAAAATCTTCTATATCAAAATTATTCAAAAAGTTATTTGTTACTTTCATAACAATTTGTTTTTCATTGCGCTCGAGCATACCTCTATTTTCTAGCTCCAATAAAAAGTCTAGTTTCCCCATTAAACCATGACATAAACAATAATCACTATTTTCATGTAATGTACTTAAGATTTGTTTTTTAAAAAAAATTAAATCTGATTGTATATCCTCATTTTGATACGATTCTAAAATTTTAATTCTCGAGATTCCCATTCCACTAAATCCTTTACACCAGCTATCTGTATACTCATATTCACTCATACTCATTTTCTCACTTTTATGTATACCATGTATTACTCTATCGTACTTATTTGTTTTTAATATGCCTTTTAACTTATAAAATGCGAGAAGTTGTCCTGATAATCCATGAACAAACCCCTTTAATGAATCCTCTAAATTTAGAGTATCGTGAGCTTTCCAATATACAAATTCATTATGTGTTTGCATATTATTGACAATGTAGTCACCGAGATTTTCAGCCACTTTAAGCAATATTTTATAATTAGGATTAATTTGATAGAACTTAACTGCCGTTAAAATTAGACCAGCTGAACCCCCTAATATATCAAAATGCTTATCGCTATATTTACCTTTTTCAATATCAGAGTTGACATCCATAAATATTTGCAATATCAATCTTTCATCGATAGATGTTATATGTGGTAAATTTGTTAAATAGTAAGAAATAATTGCATTAACACCATTTACAAAACCATAATTATTTTTATTTTTGTTTAATATTTCTTGCAGGGCTTTTTGTTCAAGTTTATTTATAATTTCAATCTGATTAGGATCAGCATTATTTCTCAATAATGAACTTATTCCCAATAATCCATCATATATTCCACTATTCAAATGGTTTATCTCAAGCTCCCCTTGCCAATTTGTTTTTAATCCAATAAAATCTACAGCACCGTCTTTTGATATATAACTGCCATCAAGAATTTTCCCTGTAATTGCTTCCTTTATTTTATTTGTAGGTAAATTAGTTCGAAAATTAATTGTTTCCTTTACTGTATTCAGCTTATATAGATTGTCATTTTGATTAGAAAGGGATATTTCTATAATTTTTCTTTGTAATAAAAAGTCAGCATATGAAATTTTTTTAAATTTTGTTTCTAGATCTATTTCATTATTTGATAAACTTTCGCAAGACTCCCATTCATACTTATTAAAGAAATATGGAACATCATAGGATAATAGTGCCTCTATCTCTTTTTGAATAATATCTTTCCTAGTAGCCAAGTATATGTTTTTTTCAAGAATATTCCGCAAATATTTTATAGTCTTTAATTTATTCTCTAATAAATCCGGAACATTTAGTCTATCTAATAAAAGGGTATAGACTTTTGTATTTCGATATACTTTTCGATAATTCCATTTAGAAACACTATTTTTTAATATACACATATACTCCTCTTTGTTTTTTAAAACTGAGTTATATGCATTCTCAAAACCTTTAATAATATCATCTATATAATTATCATACTCGTATATATCATCGTTAAGAAACGGTAAATTCTGAACCGTATCTTCTACTATTGTCTCTTCTCTTATTTCAATTGGATTCGATGTAAATTCATTTTTTATTTTAATTGTTTTTACCAAAGACTTCATTACTCTCCCAATTGCACTGTAATCTCTTATTACCTCCCTACCTCCACTAAACCTTATAGGTAGCATTCTAGAATTTAATACTGAATTAGATAATATAAAACTACTGGTTTCTTCAGTAACACTTGGATTTAATGTACTTCCTAATGTCTCAAAATCAATTATGACTGGTGAGGATTGTTTAGCTATGATATTTTCATTATGTATGTCACTTCCATTAATCAAATACATTACCGAAAGCACTACACCTAAATTATAATAATAATCTTTAATTTGCTCATTAGATTCACATGATTCATGATTAATGTATTCCATATATCCATAATTTCTTTTATTAACTACTTGCGGAATAAAGATATCCGTATTTAAATCTTTATTCAGTTGATTAATTAAACTATGATATAGTATAGAATTTTTCAAATCGACTGGTTTTAAAATTACCTTATTATTAAATTTATCTTCTAAAAGAATTGTTCTCTTTCCATTATTATGGTAGTCACCTAGGTTAATAACTTTTTCTACATGCATAATATTAAAACCCGACATTTTATGAATTTCTTTTTGATCTTTTTCAAGAGCACCTTGCAACCAAATCATATAATTTATTTCATTTTCAATGATTGTAAAAATTTTTTCGTTTAATACGGGTAATATTTTAAAAAAATTCATATAAAATTTTTTAAAATGAAAGAAGTTCTTTGTAAAATACTTATATTCTTCATTGGTATCCATTCCTCTTAAAGCATTTTCTACCCTAAGTTTATTTATGTATACAATTAAGGATGGCCTTAATACTTGGTATAGTCTTTTTTCTAAATCAAACATTATCGATTCAGAAACCTTCTCAAAATTACCAAAAAAATCAATTTTATTTATTATCATATTTTTAAAGAATACTACATATGTTTGTATTATTTTTTGAAAGTTATAGTTTTCGTCATCCTTAATGACATCATTACATGAAAAACCCTCTAAAAAGATAACAAAATTTTTTTCTAGATATTCTTTTGTTACTAAAGAATGTGATCCATTATCTATTGTATTCAAAATTCCATGTGAATTATTTTTCATAATAACCTCTTCTTTTTATAGGTAGGAGAAACAGTTAGAAATTCATTCTCATTAAAGAGAGTAAGGCCTTTCGCCTTACTCTCTTTAACTATTAGTAGCATTTTTTACAAATTCTTTGTCCCATAATCGTGACACATGCTACAGGCACATTCCAAGGACAATCTTTAGTTAAAGTTTCAACCCAACCAGGTCCTGCTCCACCAACTAATTGTTCAATCTCTTCATCTTCTACGACTTGTAAATATTTTTCAGTTTCCATTTCAATACCTACCTTTTATTTTTTTGAAAATGATGTTATAAATTCAATAATTTACCACAACATTATCTAAAAACAATATACCATTAAATGTTAATAAAAAAAAGATATATTTATAGAAAAATAAAATAATAGGATATTTAACTATATTAATATAATTAAAGGAGACTCACTTACTATATCATTAAAATTTAAAGGCTATTTTCCAAGTTAATATTTTTAAAATTTTATAAATTTATTAATAATCAATGCTGTTTAATAATTTAAATAATTCTTCTAATACCTGAATAACGATTAAGAATATTAATTAAACTTGTAAAAAATAGATTTTCAGAAGATATAGCTCAAGAATATTTTACCATAAAATAGGATAATCAATTCTTTTTTTAATAGTATAATGCTTCGTCAGAAAATTTTAATCATGAATTGCAAAAAGCATGTTAAAAATAAAAAGATGAAATTGCAAGTATATTCACTTCACAATCCCATCTCTTCTAAAAATTGTATATCATCAACTCTCTTGATCCTCGCAATTCTACCAAATTAATAGCAACACATTATGTAGATATAGGTTTATACTATTCTACATTTAAATACATGTAATATTGCCTATACTTTGTTATTTTCATGTGAAACTAATTCACTATATATCTCTTTCTCTATATTTTTCAAGAGAATTTCCAACCTATTTTTTGTAGCTAGATTAAAATGTGGATTTAATTCTTTTATTATAAATTCAAGTATCTCAAAGCTTATGTAATCTCCTAATTCAAGTGAATATTGATCACCCAAGAAAGTTTTTAATTTTTTAGAGATCTCCACTTTATCTTTTTTGGTAATATTTACCCCATCCGATAACAAACCTCTCTTAGATTAGTCTTAAATACTAATTCAAAAAGTTTTTATAACATAATAAAAATATTTTGGAATTAATATAAATCATATAATGAAATTTTTACAAATAAATAAAAAATATACATCATAATCATTAAACAATATATTAAGCATCGTAAACATATATTGGCTCGTCATAAAGGCGTAAACATTTTGACCAATTTCCACATAACGTTTCCCATTCACCAGCAGGATATACTTCCGTACGCAATATATGAAGTGGTATACGTAAATTCAATAACCGACCACTAAGCGTCGTACGAGTAACTCCCGCTGGCATTAAAAACTTTGCTTCAATTACCTTTTTCAGTTCCATCAACGAGTATTCTGGATAACTCATCAATATTTCATTTGAATGAGGCCAGACCTCAGTATCATTTGAATGACGGCGTACCGTATACTCATGTTGATATAAGCTGACAATACGATGCCATATCTCTAAATGATTAAATAAATCGCTATTTAAATCCCTTGCATATAAAAAATGTACTTGTTTATTTGCTTCTGTAATTTTTGCAAGCAAACGTTTATTAGCAATAATCTTACCTGACCAAATTATTGTAGGTTCTTTCTTTAAATTATTTACCCATTCCCCCATTGGTAATAAATGATTCCAAGCACGAATTTTTATTTTTTCATCAGGTACTACCTGTACAGCAACGCGTTTACAACCTAATGCCATCATAGCCTTCATACGATGGGCACCATCAAGTAACAGATAATTACCATCACTAAGCTCAGATACTAAGGGAGGATTCCGTAAAACACCTTCGCTTTCCATTACACGACAAATTTGTTCCAATCTTTTGTGTTCATATGATTCATGAAAGCGAATTTGCTTGGGATGTAAGAGATCTAAGGCCGAAATAATTTCACTCATAAAAACAGCTCCTCAAATAATTACATAAATTCTAAGCTTATCAAATAACTAATTTTCTATAATGATTAGTCGTGTTTACCGATATTTAGCAGCTATTAGACAATTATTTCAAACTACGTTTAATAATTTTACTAGTCTTCTAATAAAACACCTATTTCCTTTTCCCTAGCCCTTTGATAGTAATAAGCAGCAATGGCTACATCAAAAATGGCCATACCCATTGGATTAAATAATATTGCTTTGTCATAAGGGAAGTTTTGCAGTGCTCCTCGGATTACAACGTCAGCAATTGATACTGTATCTTCTTTTTGTAAACCTCTTTCAAGGTGCATCCTTTCAACATCAGTTTTTTCACGACAGACTTCTTCCCAATTATCAACAACTAGGGATTTTGTATATTCTAAGATATCAGGCTTAAAATCACGAAGAGAAACATTGAGTAGTAGCGCTCCATCTTTAGGTTTCTTATCAATATAACCTTCTGCAGAAACAGTACAAGTAATAAAAATATCAGCATCATTATAGGCTTCTTCATAAGCATTAACCTTTTGAGTTTTAGAATAAATATCCTCAGGAATTAATTCGTCTTTAATTCCATTGATATCATATAGGTAAACACTTTCGATTTTATCGCCTAATAGGGCAGTTACCATCTTTAAATGCATCTGACCAATAGGTCCAAATCCAATAATTCCAACTTTAACATTATTTAAATCTCTTAACTTGGCAAACTCTCGAATCATTAACCCTGTTACAGAAGCTGTTCGTATTACACTGACCATTGCTGTATTAAGCGTCGCAAATGGTTTTCCAGTCATAGCATCATTTAATATAGTAACTGAATGAGCACGTTGAATACCTTTCTCAATATTCTTCGGAAAACTAGCTATCCATTTGATTCCTGAAACCTTAAATTCTCCTCCAATATAAGCTGGCATAGCAATAATTCTATTAGCCGGATCATCAAAACGTAAGTATGGCTTAATTGGCTGAGAAAAATCTTCTGCATCAAGACTTTGTACTGCCTTTGAAATGACATTTATTGTTTCTTCCCAATTAACACCCATTTCATTGATATGTTTAGTATTTAAATACATCATAATTGCTTCCTCATTTCTATATCATTTTTATAAAGAAACTAATTGGTCTTCTACTGATTTTTTTGTATTAAGCCATTCTACCCATTCTACGTTGTAAATAGTTGATGTGTAAGCTTGTCCATTATCAGGACACAAGAAAACAACATTAGGTGTATTTTGAACATCCCTATTTTCAAAATACTTTTGGATTGCATAATATGAAGTCCCTGATGATCCACCAGCAAATATTGCATGTTTATTAAATAGCTCATAACAACCTGCAACAGTATGGACCTCCGGTACAATCATTACATCATCAATCAATGCTTTTTTAACCATACCAGGTATCATACTGGCACCAATTCCTGGTATGTACCGTTTACGAGGCTTATCACCAAAAATAATGGACCCTTGACTATCTACCGCAATAATTTTAATATTAGGGAATTTTTCTTTTAATCGTGTAGATACCCCAGCGATAGTTCCTCCAGTACTCACTCCAATGAAGGCATAATCTAACTGTTTAAAATCATTAGATATTTCTTCACCAATTCCTTGATAATGGGCTTCAAAGTTATCAGCATTATTATATTGATTTGTCCAGTATGCATTAGGAATAGTATTTAAAAGTTCTTCCACCTTATTTAAACGCGTTAATAAATAGCCACCTGTTTCATCTCGTTCATCCACTTTAGCTACTTGATAGGAAGTTGCTCTCAAAAAATTCTCATAACTATCATTAATATTTGGATCAATAACTGGTATGAATTTCAGGCCGATATACCTACAAAGAGTAGCAAGAGCAACCGCAAAGTTACCAGATGAAGATTCGATAATTGTAGAATTTTCAGTCACTTCACCGCGACTTATTGCTGATTTTAAAATATGGTGAGCAGCACGCACTTTAACACTATTCATTAAATTGTGATATTCTAGTTTTGCATACAGATTAATCTTTTCATGCTCTAATTTAATCATAGGTGTGTTGCCGATTACCCTTTCTAAACTCTCTAATTTCTTGAGCATAATTTGCTTCCTTTCTTGGTTAAAATCTAAAAAAATAATTAAAGATAAATAGTTGTAAATGTTCTTTCGAATGTATTTCAAATAGAACTTATACCTGAAAGACAATAAATGCTAGATTCTTTAGTATCGATAAGCTAAGCACCATTCAAGTACTGCCATAGCACTATTTAGCTTGTTTTCGGCCTGGGTAAATACAATACTTTTCGGTCCATCAATAACTGTTGCTGCTACTTCTTCCCCCCGGTGTGCTGGGAGGTCATGCATGAAAGTAGCTTCCGGATATAAAGTCAAAATTCTCTCTGTCACTGCAAATGGATTAAAGGCATCTTTCCATAAAGGATCTATTTTGCTTGTCCCTGTTGTTTGCCACCTTGTTGTATATACAACATCCACTTCACTAGGTAACATTTTTATATCATGACATTCAATAACTTTAGCACCAGATAATCGTGCATATTCTTTTGATTTTTCAAGCACACTTGGAGACACTCCATAACCAGCAGGTGTAAAAAGATATAACTCCGTACCTGGAAAACGAGATAAAGAAAGAGCTAGAGCTGCAGCACTGTTATTACCTTCTCCCATATATAAAACCCGTAATCCAGCTATTTCACCAAATTTTTGTTTCATTGTTGTTAAGTCTGTTAGCGCTTGTGTTGGATGTTCTTCCGTACTCATTGCATTAATGACTGCCATACGACTTTGAGATGCCAGCTTTTCCATTTCCTTTTGACTATCTGCAGTTCTTGCTACTAGTGCATCCAGCATTCGCGAAAGTACTTGAGTAGTGTCTTCTATAGACTCCCCTGTATTTTCTTGCAAATCATTTGGACCATACGTTACAATTTGTGCACCCATCTTTAATGCTGCAACAGAAAATGCCGATCGAGTTCTAGTCGATGTTTTACGGAAGTAAATCCCAATTATATTTCCCGCTAATATTTGATTAGGTTGTGATTTACCTGTGGCAAACTCTACCCCACGAGTTACAATTTGGTTAATATCACTATCAGTAAGATCCTCAAGAGTAATTAAATGTTTTCGAATAGCCATTATTATATTACCTCCCTTTTGAATAATTGCATGTAACAAAAATGTATTTACATATGTATGTAAATAAAAACTACTAAACAGCTAAAGTAAAAATAATAGATTGGAAATATAATTCATGTGGATCCATTACCACACTTTTCTATAATTTTTTTTAAACTAATGTATAGCAGTTGATATATAGCCTATATGAACTCGAATACTATTTTTACTCAGAAATACTTACATATAATTCTATTGTTAGTCTATATTCCTATTTTTTATGATATAGCTCTGCTGAATATATTACACACTACAACACTAAAAATATACTCAAAATACAGAATTTTCAGCTTTCTCAATTCTTTCATCAATTTTCTGTCAATTCATACTCAAATTATCTTTTTTACTAATAATATACATACAATGTTGGCTGTTTCTTTTATAGCCCACTTCTAAAAAATCCACCCATTCAAAAATAACGTTTTCCGGATTGTCAGTTAAGATACAAATTACTGCTGCAGTCATTAAAGAGTCCTCTTTAAAAGAGATATACTCCTTCTACTGGCTCGCTATTTTTAGTTATGATAACCTCTTAATTGTTACAGCTATAACGCTAACAATTGTTATTGCAACCATTGATCTAAGTAAACAAACAATGAATGACATACTAATATATACACAAAGTAATCTATTAAGCGTAAAATGATTGCATCTCCAGCAAGTTTAATTACTTATTCAGATCTTTGCTTTTATAATTTTCAAAATTAAATTTCCGAAAATTTTCTTTCCTTAAGGAAATATCGATCATTTTAAACTATGTAAGAATGCTTATCTTCTATAAAGTAATTACACAAATCAACAAAGTCAATTTCAATTATTGATTCTGGAAAACTATCTAAAGAAGCACAACAAGAAAGCTTATAATCTTTACCAATAGTAAACTTTTTATAATAAACCTCATTAGATAGCATGTCACCATAAAATATTATATTTTTTTTAATAACAAAAGAGTTTAAAGGTATAGTTAGTCCTTTCCCTATCCATTTAACAAAGCTTTCTTTTATAGTCCATAATTCATAAAACACATCTAATTGTTGTTCTACATTTAATGAATTTAAATAATTAAATTCTTCCTCAGTAAATATATTTTTAATCATTGTAGTATCCATGGGCCGGACTTTTTCTACATCTATTCCTACTTCTTCCTCATGAATAGCTCCAACAACCCAACTTTCGGAATGCGATATATTAAAATGAAAATTATTTAACTCATCCACATAAGGCTTTCCGTATTCATTGTATTTATATTTAATATCTTTATTTTCTTTTGAGAAATTTGTAATAATTAAATATCTTATTATAATGTCTCCAATTAAGGCGCTATATTGGTCGGGCTTTCTTTTATATTTCTGTATTTTCATCTGCTTTTCTTTTGAGACCAAACTCATAAGTTTCTGCATAATGTTATGTTCTATATTTCCTGGCACACGTACCTTATATATATTCATTATTTCCTTCCCACCTAACTTCTTATATAAATATAAAAAACTCTCAATGAATAATTCCTATTTATTTTTGATTAGTAAAAAACATTTTCAGAGGATAATATTCTATTTTACATTCATATTTTCGACTTATTTTCTAACCTCTTTATGTCTATTATTGAATGGGCTCAAAGAAAAAAGTCTCATAATATGTTATACACGAATTTATGAGACTTTTAGAAAACTAATAGTGTACAATTTCAAATAATATTTCACCTATTTACATGTGCTAATAAGAGCATTTGTTTAAAACTCATTTTTATACTCTTTACCAACTCATGAATATGCGGTTTCTCTAACATACTCAGATGGGAACCTGGCACTTGCAAAGCGTATACTTCCCCTGATGTATATTCATTCCATCTGTTATAATCTACTAGTGGGTGAATGTCATTAATAGATGCATTAAATAGAAAGATATCTGCTTTTATTTTTTGTTTACAATTATATTTTAGGTATGCATATCTATTAGCTATCATTACTTTTAACTTATTCATCATTGGATCTTCAAAATTTTGCTGACAACTATTTTTATTCAATGTAAATTTTTTCAGTAAAGATTCTATTAATTGTTCTTCACTCATTTGCTCAAAACTAATTTTCTCAATCCCTAACTGATCATTGAATTTTTCCAATTCTTCAAAGGCATTCTTAATATTTAAACTAAGAATCTCCTTACCTTGTTCAATAGGATGAACATCAAGTAAACCTAGAAAACTAACTTTATCACCTAGTTCTTCTAATTTTCTAGCCATTTCAAATGCAACTATTCCTCCAAAAGACCATCCTAATAAGGCATATGGCCCTTCTTTTTTTACTTGTTTAATCTCTTCTATATATCTTACCGCCATTTCCTCTACAGATAAGTTTGAAAATCTATTATCATCATATCCTATAGATTGTAACCCATATACAGTCTTATCCTCTCCTAATTCTCTAGCCAAATCATAATAGTTTAATATGCCCCCTCCTTGTCCATGAACAATGAACCATTGACTATCCTTGTTTGTCCCATTTTGAATTGGAATTAAACACTCACTGTCTATTCCTTTATTCCTACTTATTACATCACTTAATTGTTCAATAGTAGCATTTTGAAATAATAAACTTAATGGCAGTTGCACATTAAACATTCTCTTGATATTTTCGAATAACTTTAATCCCTTAAGAGAATGACCACCTAATTCAAAGAAATTATCATTTATACCAATATTATTTACGCCTAATATACTACTCCAAATATCAATTAAACTACTATCTATGTCATTTCTTGGTGGTACATAATTACTATTGTCCAGTGTATTTAGCTTCGGTAACTTACTTCTATCTATTTTCCCATTTTGTGTTAATGGTATATTGTGAATTGGTATGAGTTGTTGAGGTATCATATAATGTGGTAACTTTGTTGCCAAATATGCTCTTACCTCTGGAATAGGAATATCTTTTTCTGTAACTACGTATGCACATAAATACTTTTCCCCAGCTTCATCTTCTTGATCTATTACTACGGCCGTTTTGATTGTCTCATATTTTAACAAACTCGCTTCTATCTCACCTAGTTCTATTCGATATCCCCTTATTTTTACTTGATGATCGACTCGGCCCAAGTATTCAATGTTACCATCAGGTAGCCACCTTGCTATATCCCCTGTTTTATATAGTTTCTCACCTCGTTCAAATGGATGATCAATAAATTTATCTGCTGTTAATTCTGTTCGATTGATGTATCCTCTAGCTAACCCTATGCCAGAGATACATATTTCACCTGGAACACCTATAGGTTGTATCCTATAAAATGAATCCAATATATAAATTTTAGTATTTAACAATGGTGAACCTATCGGTACGTTTTGTGTTGTAATTTCTTTATTACTCTCATATCGATAAGATGTACAACAAACTGTAGCCTCTGTAGGTCCGTATCCATTTAATATTTGGAGGTTCCCCCTAAATAGATGATCGTATTTTGCGAGTAATTCTGTTTTAATGGGTTCTACTCCCACAAGTAGCTTATTTAACACTATCTTCTGGTTATCTCTAACAAAATAATCATATATTTCATTTAATAAAGTAGGTGGAATATATGATAATGTAACCTGTTCTTCAAGAATAACTTGTACAAGTTTTGATACATCAAACTTCTCACCTTGATAAATAGTCATTCTTGCGCCATATATCAATGGGACAAATATCTCAAAAATAGTAACATCAAAAGAAATACTACTTGAGAATAGAACGTTATCAGTTATCCCTATATCTTGAGAGAAATCTTCATACATTGCACACAAAAAATTAGTCAAGGATCGATGTTCAATCATTACTCCTTTAGGTTGTCCTGTAGAACCTGATGTATAAATAACATACGCTAAGTTGTGAGGTTCTATCATCATTTGCATGTCTTCTCCTGGTTCTTCTTCAAAAGACATATCCATTAGATCTATTACATTACCTTGGAATTCTATCCCCTTTATAATAGAGTTTTGATGTACTAATACATGTGAACACCCACTGTCTGTCAGCATATATTCCACTCTTTGTTTTGGTAAGGCGGTATCAATTGGTAAATACGCCCCACCTGCTTTTAAAACACCTAATATACCTATAACCATCTCGATGGATCGTTCCATCATCACACCAACAATGGATTCTCTTTTAACTCCTTGGTCTAATAACCTTCTCGCCAACTGATTAGCTTTTATATTTAATTCATTATATGTAATTCCTTTTTCATTACATACAACGGCTATTTGATTAGGGTTCCGTTTTACTTGTTCTTCAAACATTTTATGCACTAATAAATGATTAGAATTTGAATTCTCTTTTTTGTTAAATTCATTCATAATACAATGTTCTTCTTCTATAGATAACATATTAATATTACGCAATCGTACTCTAGGGTTATTAGTTACTTCCTCAACTATATTTGTAAAATGTACCATTAACCTTTCTATTGTCTCCGCTTTAAATAACTTAGTACTATATTCTACTTTTAAATGAATGTTATTATCTATTTCCGTTGCTACTAATGACAAATCAAATTTTGAAACTGACTGCTTAAACGGATACGGTGTAAATTCTAATTCACCAATAGATATTGGATTCATATCCATGTTTTGAAAAACAAACATGGTATCAAATAATGGATTTCTACTTGTATCCCTATGCAAGTCTAAACCTTCTAATAGTTCTTCAAAAGGATAGTCTTGATTTTCATAAGCTTCTAATGTATTGAGTTTTAATCTACTCAAAAACTCAATAAACTCATCGTCATTTTCTAGATAATTTCTCATTACCAAAGTATTAATAAACATACCAATCATATGATTAGTATCAGAATGAGACCTTCCAGCAATAGGCGAACCTACAATAATGTCTTCTTGACCTGTGTATCTAGATAAAAGTATGTTATAAATGGCCAATAAAATCATATATGGCGTAGTACCAGTTTCAGTTGCTAGCTTATTTACTTTAAAAGTTAAATCTCTTCCCAAATTAAAAGAACAAACATTACCTTTAAAGCTTTGTATAGTCGGTCTTTGAAAATCGGTTGGAAAATTTAAAACCGGGAGTTCTCCTTTTAAAGTTGTTAACCAATAATTCTTTTGTTCACTAATTAGATTCTTATAGTAAGGTCCATTTTGCCACATCACATAGTCTTTGTACTGCACTCTCAATTTTGGAAGCTCATTTCCTTTATACAATTCTACAAACTCTTTTATTAATATCCCCATTGATAAACCATCAGATATTATATGATGCATATCTACTACAAGGATATGTCTTTCTTCTGCTATCCTTAAAAGCAACACCCTTAATAATGGAGGTTTTGATAAATCAAATGGACTTATAAACTCATGTATTAAATAATCCGCATCTTTTTCATTTACATGAACGTATTCAATATTGAAATCTACATTAGGCTCAATTTTCTGCACTAATTCCCCATCTAAAATTTGAAAAGAAGTTCTTAATATTTCATGTCTCTCAATTAAAGATTGAAATATATTTTCAAACTTATCTTTACAAATATCCCCTTCTACTTTAAGTATTGTGGGCATATTATAAGTTGTATTTGTACCATCTTCGAATTGATCTACTATAAACATTCTCTTTTGTGACGTAGAAGCTAAATAATACTCTTGTTGTTTTACAGGTTCTATGGAAATATAATTACTTTTTTCCATTTCTAATATACATTTTGAAAAATCAACCAAAATAGGAAACTTAAATAGGGATTTAATAGATAATTGCACATTAAATTCTTTATTAACGATAGAAATTAGCCTAGCAGCCTTTAATGAATGACCACCTATCTCAAAAAAATTATCCCGTATTCCTACCCTTTGTATTCCTAATACATCTTTCCAAATCTCAACTAATTTTCTTTCTGTAGAATTTGTCGGCTCTAGATGACTAGATTTCAAATTATTTATAGGTTGAGGTAATTTTTTTCTATCTATTTTTCCGTTTTGTGTTAACGGTATGTTTTGAATGGATATGATTTGTTGAGGTATCATATAATATGGTAACTTGGTTGCTAAATATGCTCTTACCTCTGGAATAGGAATATCTTTTTCGGTAACTACATACGCACATAAATACTTTTCTCCACTTTCATCTTCTCGCTGTATTACTACGGCGGTTTTGATTGTCTCATATTTTAACAAACTTGCTTCTATCTCACCTAGTTCTATTCGATATCCCCTTATTTTCACTTGATGATCAACTCGTCCCAAGTATTCTATGTTACCATCAGGTAGCCATCTCGCTATATCTCCTGTTTTATATAATTTCTCACCATGTTCAAATGGATGATCAATAAATTTATCTGCTGTTAATTCTTTTCGATTGATGTATCCCCTAGCTAACCCTATGCCAGAAATACATATTTCTCCTGGAACACCTATAGGTTGTAGCCTGTGAAATGAATCCAATATATAAATTTTAGTATTTAACAATGGCGAACCTATTGGTACGTTTTGTATTGTAATTTCTTTATCCCTCTCATATTGATAAGATGTACAACAGACTGTAGCCTCTGTAGGTCCGTATAAATTTAATATTTGGAGGTTCCCCCTAAATAGATGATCGTATTTTGCAAGTAATTCTGTTTTAATTGGTTCTACTCCCACGAAAAGTTTATTTAACGATATCTTCTGATTCGCCCTTACAAAATAATCATATATTTCATTTAATAAGGTAGGTGGAATATATGCTAACGTGACCTGTTCCTCAAGAATGACTTGTACAAGTTTTGGTACATCAAACTTCTCACCTTGATAAATAGTCATTCTTGCTCCATATACCAATGGGACAAATATTTCAAATATAGTAACATCAAAAGAAATACTACTTGAGAATAGTACATTATCACTTATCCCTATATCTTGAGAGAAGTCCTCATACATTGCACACAAAAAATTAGTTAAGGAACGATGTTCAATCATTACCCCTTTGGGCTGGCCTGTAGAACCTGATGTATAAATAACATATGCCAAATTTTGAGGTTCCATCGTTATCTGCAAATCTTCTACTTGTTCTTCTTCAAAAGGAATATCCATTAGATTTATTACACTACCTTGAAATGCTACTCCCTTTATAATAGAGTTTTGATATGTTAGTACATGTGAACACCCGCTGTCTGTCAGCATATATTCCACTCTTTGTTTTGGTAACTCGGTATCAATCGGTAAATACGCCCCACCCGCTTTTAAGATACCTAATATGCCTACAATCATCTCAATAGAGCGTTCCATCATCACACCAACAATGGATTCTCTTTTAACTCCCTGGTCTAATAACCTTCTCGCCAACTGATTAGCTTTTATATTTAATTGTTTATATGTAATTTCTTTTCCATTACATACAATCGCTATTTGATTAGGATTCTGTTTTACCTGCTCTTCAAATAATTGAGGAGCTGTTACAGTCTCACAAAGTAATGTTTTATGAACTCTAGTCGTATGATTGAAATCAAATAATATTTGATTCTTTTCTGTTTTAGGCATTACATCTAGATCCATTGCAGATTTATTTGGATCTTTCATTAATATATCTAAAATATTATATAAATGATTAACTATTCTACTAACTAATCCTTCACTATATAAAATAGAATTGTAATCCACTTGAACCTTTAACTGTTCTTCATTTTTCATAAACCTAATAACCATATCAGAGTTTATTTTATCTGTACTCTCATAACAATGAATATCATCTAACATTACTATTGTATTTAATAAGGGAAGATTATTACTCTCTCCATCTAGACTTAATAATTGAGTAAGTTTATTAAAAGGAAAATGACAATGTTCATTTGACTCTAAAATTGTTTCTTTAATTTTATATATTATTTCTTTAAAATTATCTTCTTGATTTATTTGAGTACGTAATAATAAAAAGTTGTTTTGAAAAACCGTCTCTTCTTGACCTTGTTTAAA</td>\n</tr>\n</tbody></table>\n<h2 id=\"Table-3-The-contents-of-“Bt-all-genes-table”\"><a href=\"#Table-3-The-contents-of-“Bt-all-genes-table”\" class=\"headerlink\" title=\"Table 3. The contents of “Bt_all_genes.table”\"></a>Table 3. The contents of “Bt_all_genes.table”</h2><table>\n<thead>\n<tr>\n<th align=\"center\">-</th>\n<th align=\"center\">Cry1Ac16</th>\n<th align=\"center\">Cry1Ca15</th>\n<th align=\"center\">Cry1Da2</th>\n<th align=\"center\">Cry1Ia40</th>\n<th align=\"center\">Cry2Aa10</th>\n<th align=\"center\">Cry2Ab35</th>\n<th align=\"center\">Cry78Aa1</th>\n<th align=\"center\">Cry9Ea9</th>\n<th align=\"center\">HMM_Cry_len_492</th>\n<th align=\"center\">HMM_Cyt_len_531</th>\n<th align=\"center\">HMM_Cyt_len_533</th>\n<th align=\"center\">HMM_Cyt_len_615</th>\n<th align=\"center\">Sip1A2-other</th>\n<th align=\"center\">Vip1Aa2</th>\n<th align=\"center\">Vip3Aa12</th>\n<th align=\"center\">Zwa5B-other</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">1126_1</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\"></td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">32.66</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">99.07</td>\n</tr>\n<tr>\n<td align=\"center\">AFS094730</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">36.14</td>\n<td align=\"center\"></td>\n<td align=\"center\">1</td>\n<td align=\"center\">1</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">92.41</td>\n<td align=\"center\">29.46</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">AFS095482</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">1</td>\n<td align=\"center\"></td>\n<td align=\"center\">1</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">AK47</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">100.00</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">1</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">100.00</td>\n<td align=\"center\">100.00</td>\n</tr>\n</tbody></table>\n<p><strong>Footnote:</strong> The float number represent the identity of blast search, and the integer number represent the number of toxins predicted by HMM and SVM.</p>\n<h2 id=\"License\"><a href=\"#License\" class=\"headerlink\" title=\"License\"></a>License</h2><p>BtToxin_Digger is free software, licensed under <a href=\"https://github.com/liaochenlanruo/BtToxin_Digger/blob/master/LICENSE\">GPLv3</a>.</p>\n<h2 id=\"Feedback-Issues\"><a href=\"#Feedback-Issues\" class=\"headerlink\" title=\"Feedback&#x2F;Issues\"></a>Feedback&#x2F;Issues</h2><p>Please report any issues about usage of the software to the <a href=\"https://github.com/liaochenlanruo/BtToxin_Digger/issues\">issues page</a>.</p>\n<h2 id=\"Citation\"><a href=\"#Citation\" class=\"headerlink\" title=\"Citation\"></a>Citation</h2><ul>\n<li><p>If you use this software please cite: <strong>Hualin Liu</strong>, Jinshui Zheng, Dexin Bo, Yun Yu, Weixing Ye, Donghai Peng, Ming Sun. (2021) BtToxin_Digger: a comprehensive and high-throughput pipeline for mining toxin protein genes from <em>Bacillus thuringiensis</em>. <em><strong>Bioinformatics</strong></em>, 2021;, btab506, <a href=\"https://doi.org/10.1093/bioinformatics/btab506\">https://doi.org/10.1093/bioinformatics/btab506</a>.</p>\n</li>\n<li><p>If you used the genome assembly function, please also cite: Liu H, Xin B, Zheng J, Zhong H, Yu Y, Peng D, Sun M. Build a bioinformatics analysis platform and apply it to routine analysis of microbial genomics and comparative genomics. Protocol exchange, 2021. DOI: <a href=\"https://dx.doi.org/10.21203/rs.2.21224/v5\">10.21203&#x2F;rs.2.21224&#x2F;v5+</a>.</p>\n</li>\n</ul>\n<h2 id=\"FAQs\"><a href=\"#FAQs\" class=\"headerlink\" title=\"FAQs\"></a>FAQs</h2><h2 id=\"Updates\"><a href=\"#Updates\" class=\"headerlink\" title=\"Updates\"></a>Updates</h2><ul>\n<li><p>v1.0.2</p>\n<ul>\n<li>Fixed a “Can not find path” error.</li>\n</ul>\n</li>\n<li><p>v1.0.3</p>\n<ul>\n<li>Fixed a bug of “get_all_info_nucl.pl”, which can not get the gene location and strand information of some toxins.</li>\n</ul>\n</li>\n<li><p>v1.0.4</p>\n<ul>\n<li>Updated the database and models to support <a href=\"https://www.bpprc.org/\">the latest clasiffication of Bt toxins</a>.</li>\n</ul>\n</li>\n<li><p>v1.0.5</p>\n<ul>\n<li>The name of strains with no toxin found will be outputed into the file “Strains_without_toxins_found.txt”.</li>\n</ul>\n</li>\n<li><p>v1.0.6</p>\n<ul>\n<li>Update to adapt to PGCGAP v1.0.23, and to delete the intermediate files.</li>\n</ul>\n</li>\n<li><p>v1.0.7</p>\n<ul>\n<li>To delete the intermediate files.</li>\n</ul>\n</li>\n<li><p>v1.0.8</p>\n<ul>\n<li>To delete the intermediate files.</li>\n</ul>\n</li>\n<li><p>v1.0.9</p>\n<ul>\n<li>Update the database to keep it consistent with the BPPRC (to 2021-06-07).<br>More HMM models are added.<br>The filter length of amino acid sequence was reduced from 115 to 75.<br>Solved a problem: BioPerl reported an error when the length of the sequence in the input file was inconsistent.</li>\n</ul>\n</li>\n<li><p>v1.0.10</p>\n<ul>\n<li>Users can use the command “BtToxin_Digger –update-db” to update their local database.<br>The toxin database was updated to 2021.08.02.</li>\n</ul>\n</li>\n</ul>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"Functional genomics","path":"api/tags/Functional genomics.json"}]}]}