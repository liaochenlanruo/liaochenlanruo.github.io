{"total":139,"pageSize":10,"pageCount":14,"data":[{"title":"Shiny从入门到入定——2-在大大的花园里面挖呀挖呀挖","slug":"Shiny从入门到入定——2-在大大的花园里面挖呀挖呀挖","date":"2023-11-18T12:14:50.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Shiny从入门到入定——2-在大大的花园里面挖呀挖呀挖.json","excerpt":null,"keywords":null,"cover":"https://d33wubrfki0l68.cloudfront.net/e7b5aeb0678eac89f60033eb84640779ad510c41/f7ade/demos/basic-ui/free-text.png","content":"<h1 id=\"基础UI\"><a href=\"#基础UI\" class=\"headerlink\" title=\"基础UI\"></a>基础UI</h1><h2 id=\"引言\"><a href=\"#引言\" class=\"headerlink\" title=\"引言\"></a>引言</h2><p>现在，您已经具备了基本的Shiny应用程序，我们可以开始详细探索使Shiny起作用的内容。正如您在上一章所看到的，Shiny鼓励将生成用户界面（前端）的代码与驱动应用程序行为的代码（后端）分开。</p>\n<p>在本章中，我们将重点关注前端，并向您展示由Shiny提供的HTML输入和输出的大致情况。这使您能够捕获许多类型的表单数据，并显示许多类型的R输出。到目前为止，您可能还没有很多将输入和输出拼接在一起的方法，我们将在第6章中回顾这一点。</p>\n<p>在这里，我将主要关注Shiny自身内置的输入和输出。但是，还有一个丰富而充满活力的社区扩展包，例如<a href=\"https://github.com/dreamRs/shinyWidgets\">shinyWidgets</a>、<a href=\"https://github.com/daattali/colourpicker\">colorpicker</a>和<a href=\"https://rstudio.github.io/sortable/\">sorttable</a>。您可以在<a href=\"https://github.com/nanxstats/awesome-shiny-extensions\">https://github.com/nanxstats/awesome-shiny-extensions</a>找到其他全面且维护良好的包列表，该列表由<a href=\"https://nanx.me/\">Nan Xiao</a>维护。</p>\n<p>与往常一样，我们将从加载shiny包开始：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"输入\"><a href=\"#输入\" class=\"headerlink\" title=\"输入\"></a>输入</h2><p>正如我们在上一章所看到的，您使用诸如<code>sliderInput()</code>、<code>selectInput()</code>、<code>textInput()</code>和<code>numericInput()</code>之类的函数将输入控件插入到您的UI规范中。现在我们将讨论所有输入函数所共有的常见结构，并为内置在Shiny中的输入提供快速概述。</p>\n<h3 id=\"常见结构\"><a href=\"#常见结构\" class=\"headerlink\" title=\"常见结构\"></a>常见结构</h3><p>所有输入函数都具有相同的第一个参数：<code>inputId</code>。这是用于将前端与后端连接的标识符：如果您的用户界面具有ID为<code>name</code>的输入，则server函数将使用<code>input$name</code>来访问它。</p>\n<p><code>inputId</code>有两个约束：</p>\n<ul>\n<li><p>它必须是一个简单的字符串，只包含字母、数字和下划线（不允许空格、破折号、句点或其他特殊字符！）以R命名变量。</p>\n</li>\n<li><p>它必须是唯一的。如果它不是唯一的，那么您将无法在server函数中引用此控件！</p>\n</li>\n</ul>\n<p>大多数输入函数都有一个称为<code>label</code>的第二个参数。这是用于为控件创建一个人类可读的标签。Shiny对此字符串没有任何限制，但您需要仔细考虑，以确保您的应用程序对人类可用！第三个参数通常是<code>value</code>，在可能的情况下，允许您设置默认值。其余参数是控件特有的。</p>\n<p>创建输入时，我建议按位置提供inputId和label参数，并按名称提供所有其他参数：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;min&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Limit (minimum)&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>以下部分描述了Shiny内置的输入，根据它们创建的控制类型松散分组。目标是让您快速了解您的选项，而不是详尽地描述所有参数。下面我将展示每个控件最重要的参数，但您需要阅读文档以获得完整详细信息。</p>\n<h3 id=\"自由文本\"><a href=\"#自由文本\" class=\"headerlink\" title=\"自由文本\"></a>自由文本</h3><p>使用<code>textInput()</code>收集少量文本，使用<code>passwordInput()</code><sup>3</sup>收集密码，使用<code>textAreaInput()</code>收集段落文本。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  textInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;name&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;What&#x27;s your name?&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  passwordInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;password&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;What&#x27;s your password?&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  textAreaInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;story&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Tell me about yourself&quot;</span><span class=\"punctuation\">,</span> rows <span class=\"operator\">=</span> <span class=\"number\">3</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/e7b5aeb0678eac89f60033eb84640779ad510c41/f7ade/demos/basic-ui/free-text.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/e7b5aeb0678eac89f60033eb84640779ad510c41/f7ade/demos/basic-ui/free-text.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"text\"></p>\n<p>如果你想确保文本具有某些属性，你可以使用<code>validate()</code>，我们将在第8章中介绍这个函数。</p>\n<h3 id=\"数值输入\"><a href=\"#数值输入\" class=\"headerlink\" title=\"数值输入\"></a>数值输入</h3><p>要收集数值，请使用<code>numericInput()</code>创建一个受约束的文本框，或使用<code>sliderInput()</code>创建一个滑块。如果你为sliderInput()的默认值提供一个长度为2的数值向量，你将获得一个带有两个端点的“范围”滑块。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  numericInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;num&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Number one&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;num2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Number two&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;rng&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Range&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">10</span><span class=\"punctuation\">,</span> <span class=\"number\">20</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/dcd1cdd3477e7f859c8d5388b435ca75836d74ba/cdd56/demos/basic-ui/numeric.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/dcd1cdd3477e7f859c8d5388b435ca75836d74ba/cdd56/demos/basic-ui/numeric.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"numeric\"></p>\n<p>一般来说，我只建议在范围较小或者精确数值不太重要的情况下使用滑块。尝试在小的滑块上精确选择一个数字是一件很令人沮丧的事情！</p>\n<p>滑块非常可定制，有很多方法可以调整它们的外观。更多细节请参见<code>?sliderInput</code>和<a href=\"https://shiny.rstudio.com/articles/sliders.html\">https://shiny.rstudio.com/articles/sliders.html</a>。</p>\n<h3 id=\"日期\"><a href=\"#日期\" class=\"headerlink\" title=\"日期\"></a>日期</h3><p>使用<code>dateInput()</code>收集单个日期，或使用<code>dateRangeInput()</code>收集两个日期之间的范围。这些都提供了一个方便的日历选择器，额外的参数如<code>datesdisabled</code>和<code>daysofweekdisabled</code>允许您限制有效的输入集。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  dateInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;dob&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;When were you born?&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  dateRangeInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;holiday&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;When do you want to go on vacation next?&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/585b8dcaf38038e5c2768e8a4858171baa04e308/02979/demos/basic-ui/date.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/585b8dcaf38038e5c2768e8a4858171baa04e308/02979/demos/basic-ui/date.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"date\"></p>\n<p>日期格式、语言和一周开始的日期默认采用美国标准。如果您正在为国际用户创建应用程序，请设置格式、语言和一周开始日期，以便日期对您的用户来说是自然的。</p>\n<h3 id=\"有限制的选择\"><a href=\"#有限制的选择\" class=\"headerlink\" title=\"有限制的选择\"></a>有限制的选择</h3><p>有两种不同的方法允许用户从预设的选项集中进行选择：<code>selectInput()</code>和<code>radioButtons()</code>。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animals <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;dog&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;cat&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;mouse&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;bird&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;other&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;I hate animals&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  selectInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;state&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;What&#x27;s your favourite state?&quot;</span><span class=\"punctuation\">,</span> state.name<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  radioButtons<span class=\"punctuation\">(</span><span class=\"string\">&quot;animal&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;What&#x27;s your favourite animal?&quot;</span><span class=\"punctuation\">,</span> animals<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/2605fed791b02e16d28d2c389df9130d349bf1b3/4dc8e/demos/basic-ui/limited-choices.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/2605fed791b02e16d28d2c389df9130d349bf1b3/4dc8e/demos/basic-ui/limited-choices.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"choice\"></p>\n<p>单选按钮有两个很好的特点：它们显示所有可能的选项，适合于短列表，并且通过<code>choiceNames/choiceValues</code>参数，它们可以显示除普通文本之外的其他选项。<code>choiceNames</code>确定向用户显示的内容；<code>choiceValues</code>确定在您的server函数中返回的内容。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  radioButtons<span class=\"punctuation\">(</span><span class=\"string\">&quot;rb&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Choose one:&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    choiceNames <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span></span><br><span class=\"line\">      icon<span class=\"punctuation\">(</span><span class=\"string\">&quot;angry&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      icon<span class=\"punctuation\">(</span><span class=\"string\">&quot;smile&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      icon<span class=\"punctuation\">(</span><span class=\"string\">&quot;sad-tear&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    choiceValues <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;angry&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;happy&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;sad&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; This Font Awesome icon (&#x27;angry&#x27;) does not exist:</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; * if providing a custom `html_dependency` these `name` checks can </span></span><br><span class=\"line\"><span class=\"comment\">#&gt;   be deactivated with `verify_fa = FALSE`</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; This Font Awesome icon (&#x27;smile&#x27;) does not exist:</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; * if providing a custom `html_dependency` these `name` checks can </span></span><br><span class=\"line\"><span class=\"comment\">#&gt;   be deactivated with `verify_fa = FALSE`</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; This Font Awesome icon (&#x27;sad-tear&#x27;) does not exist:</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; * if providing a custom `html_dependency` these `name` checks can </span></span><br><span class=\"line\"><span class=\"comment\">#&gt;   be deactivated with `verify_fa = FALSE`</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/eab54ba86e9dda3fd9cd417553de341695d46d34/0eb0f/demos/basic-ui/radio-icon.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/eab54ba86e9dda3fd9cd417553de341695d46d34/0eb0f/demos/basic-ui/radio-icon.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"单选按钮\"></p>\n<p>使用<code>selectInput()</code>创建的下拉菜单无论选项数量多少，都占用相同数量的空间，这使得它们更适合于更长的选项。您还可以设置<code>multiple = TRUE</code>以允许用户选择多个元素。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  selectInput(</span><br><span class=\"line\">    &quot;state&quot;, &quot;What&#x27;s your favourite state?&quot;, state.name,</span><br><span class=\"line\">    multiple = TRUE</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/c53795ad09b7866f0ed7adc1b3adabdd6fc120db/437be/images/basic-ui/multi-select.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/c53795ad09b7866f0ed7adc1b3adabdd6fc120db/437be/images/basic-ui/multi-select.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"下拉菜单\"></p>\n<p>如果你有一组非常大的可能选项，你可能想要使用“server-side”<code>selectInput()</code>，这样完整的可能选项集不被嵌入到UI中（这可能会使加载变慢），而是由服务器按需发送。您可以了解有关此高级主题的更多信息，请访问<a href=\"https://shiny.rstudio.com/articles/selectize.html#server-side-selectize\">https://shiny.rstudio.com/articles/selectize.html#server-side-selectize</a>。</p>\n<p>没有方法可以在单选按钮中选择多个值，但有一个概念上类似的替代方案：<code>checkboxGroupInput()</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  checkboxGroupInput(&quot;animal&quot;, &quot;What animals do you like?&quot;, animals)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/d3d61d703bac03a0d2823da98e2dbba03d6619d4/51e34/demos/basic-ui/multi-radio.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/d3d61d703bac03a0d2823da98e2dbba03d6619d4/51e34/demos/basic-ui/multi-radio.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<p>如果您想要一个单选框来回答一个<code>Yes/No</code>问题，请使用<code>checkboxInput()</code>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  checkboxInput(&quot;cleanup&quot;, &quot;Clean up?&quot;, value = TRUE),</span><br><span class=\"line\">  checkboxInput(&quot;shutdown&quot;, &quot;Shutdown?&quot;)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h3><p>允许用户通过 <code>fileInput()</code>上传文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  fileInput(&quot;upload&quot;, NULL)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/92e2422e9b00cec1d6a852cbdb484071ce51ae4e/85324/demos/basic-ui/upload.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/92e2422e9b00cec1d6a852cbdb484071ce51ae4e/85324/demos/basic-ui/upload.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"上传文件\"></p>\n<p>fileInput()需要在server端进行特殊处理，并在第9章中详细讨论。</p>\n<h3 id=\"动作按钮\"><a href=\"#动作按钮\" class=\"headerlink\" title=\"动作按钮\"></a>动作按钮</h3><p>使用<code>actionButton()</code>或<code>actionLink()</code>让用户执行动作。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  actionButton(&quot;click&quot;, &quot;Click me!&quot;),</span><br><span class=\"line\">  actionButton(&quot;drink&quot;, &quot;Drink me!&quot;, icon = icon(&quot;cocktail&quot;))</span><br><span class=\"line\">)</span><br><span class=\"line\">#&gt; This Font Awesome icon (&#x27;cocktail&#x27;) does not exist:</span><br><span class=\"line\">#&gt; * if providing a custom `html_dependency` these `name` checks can </span><br><span class=\"line\">#&gt;   be deactivated with `verify_fa = FALSE`</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/30a4be90f407bf28ef9a780e78c6d48b8e9e3112/b196c/demos/basic-ui/action.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/30a4be90f407bf28ef9a780e78c6d48b8e9e3112/b196c/demos/basic-ui/action.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"按钮\"></p>\n<p>动作链接和按钮最自然地与server函数中的<code>observeEvent()</code>或<code>eventReactive()</code>配对。您还没有学习这些重要的函数，但我们在第3.5节中会回到它们。</p>\n<p>您可以使用<code>class</code>参数来自定义外观，使用<code>&quot;btn-primary&quot;</code>，<code>&quot;btn-success&quot;</code>，<code>&quot;btn-info&quot;</code>，<code>&quot;btn-warning&quot;</code>或<code>&quot;btn-danger&quot;</code>之一。您还可以使用<code>&quot;btn-lg&quot;</code>，<code>&quot;btn-sm&quot;</code>，<code>&quot;btn-xs&quot;</code>更改大小。最后，您可以使用<code>&quot;btn-block&quot;</code>使按钮跨越其嵌入的元素的整个宽度。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  fluidRow(</span><br><span class=\"line\">    actionButton(&quot;click&quot;, &quot;Click me!&quot;, class = &quot;btn-danger&quot;),</span><br><span class=\"line\">    actionButton(&quot;drink&quot;, &quot;Drink me!&quot;, class = &quot;btn-lg btn-success&quot;)</span><br><span class=\"line\">  ),</span><br><span class=\"line\">  fluidRow(</span><br><span class=\"line\">    actionButton(&quot;eat&quot;, &quot;Eat me!&quot;, class = &quot;btn-block&quot;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><code>class</code>参数通过设置底层HTML的<code>class</code>属性来工作，这会影响元素的样式。要查看其他选项，您可以阅读Shiny使用的CSS设计系统Bootstrap的文档：<a href=\"http://bootstrapdocs.com/v3.3.6/docs/css/#buttons\">http://bootstrapdocs.com/v3.3.6/docs/css/#buttons</a>。</p>\n<h3 id=\"练习\"><a href=\"#练习\" class=\"headerlink\" title=\"练习\"></a>练习</h3><p>2.2.8.1 当空间不足时，使用一个出现在文本输入区域内的占位符来标记文本框很有用。您如何调用<code>textInput()</code>生成下面的UI？</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/0250dd2b285e770d5fd2a66670a6604775bb7f1e/eaa81/demos/basic-ui/placeholder.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/0250dd2b285e770d5fd2a66670a6604775bb7f1e/eaa81/demos/basic-ui/placeholder.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"2.2.8.1\"></p>\n<p>2.2.8.2 认真阅读<code>sliderInput()</code>的文档以了解如何创建日期滑块，如下：</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/95326f3d91fd5e3c1eba0cfb8aa69a65f1cc0953/ae529/demos/basic-ui/date-slider.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/95326f3d91fd5e3c1eba0cfb8aa69a65f1cc0953/ae529/demos/basic-ui/date-slider.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"日历滑块\"></p>\n<p>2.2.8.3 如何创建日期滑块，使得用户可以在0到100之间选择日期，滑块上每个可选值的间隔为5。然后，为输入小部件添加动画，以便当用户按下播放时，输入小部件会自动滚动到该范围。</p>\n<p>2.2.8.4 如果您有一个中等长度的<code>selectInput()</code>列表，创建子标签是有用的，它可以将列表分成几部分。阅读文档以了解如何操作。（提示：底层HTML称为<code>&lt;optgroup&gt;</code>。）</p>\n<h2 id=\"输出\"><a href=\"#输出\" class=\"headerlink\" title=\"输出\"></a>输出</h2><p>用户界面中的输出创建了占位符，稍后将由server函数填充。与输入一样，输出需要一个唯一的ID作为其第一个参数：如果您的用户界面规范创建了一个ID为<code>plot</code>的输出，您可以通过<code>output$plot</code>在服务器函数中访问它。</p>\n<p>前端中的每个输出函数都与后端的渲染函数配对。有三种主要的输出类型，对应于您通常在报告中包含的三件事：<code>文本</code>、<code>表格</code>和<code>图形</code>。以下部分向您展示了前端输出函数的基本知识，以及后端相应的渲染函数。</p>\n<h3 id=\"文本\"><a href=\"#文本\" class=\"headerlink\" title=\"文本\"></a>文本</h3><p>使用<code>textOutput()</code>输出普通文本，使用<code>verbatimTextOutput()</code>输出固定代码和控制台输出。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  textOutput(&quot;text&quot;),</span><br><span class=\"line\">  verbatimTextOutput(&quot;code&quot;)</span><br><span class=\"line\">)</span><br><span class=\"line\">server &lt;- function(input, output, session) &#123;</span><br><span class=\"line\">  output$text &lt;- renderText(&#123; </span><br><span class=\"line\">    &quot;Hello friend!&quot; </span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  output$code &lt;- renderPrint(&#123; </span><br><span class=\"line\">    summary(1:10) </span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/61f37c119d66f0b25bb834d6773274856b764727/a9ae2/demos/basic-ui/output-text.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/61f37c119d66f0b25bb834d6773274856b764727/a9ae2/demos/basic-ui/output-text.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<p>请注意，只有在需要运行多行代码时，<code>&#123;&#125;</code>才需要在渲染函数中使用。正如您即将了解的那样，您应该在渲染函数中尽可能少地进行计算，这意味着您通常可以省略它们。以下是上述server函数更简洁的方式：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &lt;- function(input, output, session) &#123;</span><br><span class=\"line\">  output$text &lt;- renderText(&quot;Hello friend!&quot;)</span><br><span class=\"line\">  output$code &lt;- renderPrint(summary(1:10))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意，有两种渲染函数的行为略有不同：</p>\n<ul>\n<li><p><code>renderText()</code>将结果合并成一个字符串，通常与<code>textOutput()</code>配对</p>\n</li>\n<li><p><code>renderPrint()</code>打印结果，就像在R控制台中一样，通常与<code>verbatimTextOutput()</code>配对。</p>\n</li>\n</ul>\n<p>我们可以通过一个玩具应用程序看到这种差异：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  textOutput(&quot;text&quot;),</span><br><span class=\"line\">  verbatimTextOutput(&quot;print&quot;)</span><br><span class=\"line\">)</span><br><span class=\"line\">server &lt;- function(input, output, session) &#123;</span><br><span class=\"line\">  output$text &lt;- renderText(&quot;hello!&quot;)</span><br><span class=\"line\">  output$print &lt;- renderPrint(&quot;hello!&quot;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/086a9fbcf20ad02bb679141fbe4f263d6cd7646c/dda5c/demos/basic-ui/text-vs-print.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/086a9fbcf20ad02bb679141fbe4f263d6cd7646c/dda5c/demos/basic-ui/text-vs-print.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<p>二者的区别与R中的 <code>cat()</code> and <code>print()</code>一样。</p>\n<h3 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h3><p>有三种方法可以在表格中显示数据框：</p>\n<ul>\n<li><p><code>tableOutput()</code>和<code>renderTable()</code>呈现静态数据表，一次显示所有数据。</p>\n</li>\n<li><p><code>dataTableOutput()</code>和<code>renderDataTable()</code>呈现动态数据表，一次显示固定数量的行，同时显示控件以更改可见行。</p>\n</li>\n</ul>\n<p><code>tableOutput()</code>最适合小型、固定的摘要（例如模型系数）；如果您想向用户展示完整的数据框，<code>dataTableOutput()</code>最为合适。如果您想更精确地控制<code>dataTableOutput()</code>的输出，我强烈推荐Greg Lin的<a href=\"https://glin.github.io/reactable/index.html\">reactable</a>包。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  tableOutput(&quot;static&quot;),</span><br><span class=\"line\">  dataTableOutput(&quot;dynamic&quot;)</span><br><span class=\"line\">)</span><br><span class=\"line\">server &lt;- function(input, output, session) &#123;</span><br><span class=\"line\">  output$static &lt;- renderTable(head(mtcars))</span><br><span class=\"line\">  output$dynamic &lt;- renderDataTable(mtcars, options = list(pageLength = 5))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/2fe4c674645896fa18d345ad162f479434746dd2/2e28c/demos/basic-ui/output-table.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/2fe4c674645896fa18d345ad162f479434746dd2/2e28c/demos/basic-ui/output-table.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"表格\"></p>\n<h3 id=\"图形\"><a href=\"#图形\" class=\"headerlink\" title=\"图形\"></a>图形</h3><p>您可以使用<code>plotOutput()</code>和<code>renderPlot()</code>显示任何类型的R图形（基础、ggplot2或其他）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  plotOutput(&quot;plot&quot;, width = &quot;400px&quot;)</span><br><span class=\"line\">)</span><br><span class=\"line\">server &lt;- function(input, output, session) &#123;</span><br><span class=\"line\">  output$plot &lt;- renderPlot(plot(1:5), res = 96)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/c87e58475e7a0c2e0d12f06ac28169c0c670dc91/b2f86/demos/basic-ui/output-plot.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/c87e58475e7a0c2e0d12f06ac28169c0c670dc91/b2f86/demos/basic-ui/output-plot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"绘图\"></p>\n<p>默认情况下，<code>plotOutput()</code>将占据其容器的全部宽度（稍后将详细介绍），高度为400像素。您可以使用<code>height</code>和<code>width</code>参数覆盖这些默认值。我们建议始终将<code>res</code>设置为<strong>96</strong>，这样您的Shiny图形就会尽可能与RStudio中看到的图形相匹配。</p>\n<p>图形是特殊的输出，因为它们也可以作为输入。<code>plotOutput()</code>具有许多参数，如<code>click</code>、<code>dblclick</code>和<code>hover</code>。如果您将这些参数传递给字符串，例如<code>click = &quot;plot_click&quot;</code>，则它们将创建一个可响应的输入（<code>input$plot_click</code>），您可以使用它来处理与图形的用户交互，例如单击图形。我们将在第7章中再次讨论Shiny中的交互式图形。</p>\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><p>您可以使用<code>downloadButton()</code>或<code>downloadLink()</code>让用户下载文件。这些需要在server函数中使用新技术，因此我们将在第9章中详细介绍。</p>\n<h3 id=\"练习-1\"><a href=\"#练习-1\" class=\"headerlink\" title=\"练习\"></a>练习</h3><p>2.3.5.1 下列哪个应与<code>textOutput()</code>和<code>verbatimTextOutput()</code>配对？</p>\n<p>a. renderPrint(summary(mtcars))</p>\n<p>b. renderText(“Good morning!”)</p>\n<p>c. renderPrint(t.test(1:5, 2:6))</p>\n<p>d. renderText(str(lm(mpg ~ wt, data &#x3D; mtcars)))</p>\n<p>2.3.5.2 重新创建第2.3.3节的Shiny应用程序，这次将高度设置为300像素，宽度设置为700像素。设置图的“alt”文本，以便视障用户可以判断其是五个随机数的散点图。</p>\n<p>2.3.5.3 更新以下调用<code>renderDataTable()</code>的选项，以便仅显示数据，但其他控件均被抑制（即删除搜索、排序和过滤命令）。您需要阅读<a href=\"https://rdrr.io/pkg/shiny/man/renderDataTable.html\">?renderDataTable</a>并回顾<a href=\"https://datatables.net/reference/option/\">https://datatables.net/reference/option/</a>中的选项。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui &lt;- fluidPage(</span><br><span class=\"line\">  dataTableOutput(&quot;table&quot;)</span><br><span class=\"line\">)</span><br><span class=\"line\">server &lt;- function(input, output, session) &#123;</span><br><span class=\"line\">  output$table &lt;- renderDataTable(mtcars, options = list(pageLength = 5))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2.3.5.4 或者，您可以阅读<a href=\"https://glin.github.io/reactable\">reactable</a>的文档，并将上面的应用程序转换为使用它。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本章向您介绍了Shiny应用程序前端的主要输入和输出功能。这是一次大量的信息灌输，因此不要期望在一次阅读后就能记住所有内容。相反，当您需要查找特定组件时，请返回本章：您可以快速浏览图示，然后找到您需要的代码。</p>\n<p>下一章我们将介绍Shiny应用程序的后端：使您的用户界面生动起来的R代码。</p>\n<h1 id=\"练习题答案获取\"><a href=\"#练习题答案获取\" class=\"headerlink\" title=\"练习题答案获取\"></a>练习题答案获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“5369”获取习题答案。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"编程","path":"api/tags/编程.json"},{"name":"Shiny入门系列","path":"api/tags/Shiny入门系列.json"}]},{"title":"16S扩增子测序及宏基因组测序","slug":"16S扩增子测序及宏基因组测序","date":"2023-11-13T01:15:23.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/16S扩增子测序及宏基因组测序.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","content":"<h1 id=\"引言\"><a href=\"#引言\" class=\"headerlink\" title=\"引言\"></a>引言</h1><p>在本文中，我将着重介绍两种高通量测序技术：<code>16S rDNA扩增子测序</code>和<code>Shot-gun宏基因组测序</code>。我们的主要目的是帮助大家深入了解这些技术的原理、应用场景以及如何解读数据分析结果。</p>\n<p>随着高通量测序技术的快速发展，我们能够更全面、更深入地了解微生物群落结构和功能。16S rDNA扩增子测序作为一种常用的方法，可以通过对16S rRNA基因进行扩增和测序，快速揭示微生物群落的组成和多样性。而Shot-gun宏基因组测序则针对整个样本的全部基因组进行测序，提供了更全面的信息，包括微生物种类和功能丰度等。</p>\n<p>通过阅读本文，我们希望您能够掌握以下几个方面的内容：</p>\n<ul>\n<li>理解16S rDNA扩增子测序和Shot-gun宏基因组测序的基本原理和流程；</li>\n<li>了解两种技术在微生物学组学研究中的应用场景；</li>\n<li>学会收集、保存和运输样本时需要注意的细节；</li>\n<li>掌握如何解读和分析16S rDNA扩增子测序和Shot-gun宏基因组测序的数据结果。</li>\n</ul>\n<p>我相信，通过这次学习，您将能够更好地理解和应用这些高通量测序技术，并在自己的研究中获得更准确、全面的数据和结论。现在，让我们开始深入探索16S rDNA扩增子测序和Shot-gun宏基因组测序的世界吧！</p>\n<h1 id=\"高通量测序概述\"><a href=\"#高通量测序概述\" class=\"headerlink\" title=\"高通量测序概述\"></a>高通量测序概述</h1><p>高通量测序，也被称为下一代测序（Next Generation Sequencing, NGS），是一种革命性的DNA或RNA序列分析技术。与传统的Sanger测序方法相比，高通量测序具有更快、更便宜和更高通量的特点。</p>\n<p>高通量测序技术的核心原理是将待测样本中的DNA或RNA分子通过特定的方法进行扩增，并将其分成数百万个片段。然后，这些片段将被同时测序，产生大量的短序列片段，称为reads。这些reads可以根据其碱基序列进行排序和分析，以揭示样本中的遗传信息。</p>\n<h2 id=\"高通量测序在生物学研究中的重要性\"><a href=\"#高通量测序在生物学研究中的重要性\" class=\"headerlink\" title=\"高通量测序在生物学研究中的重要性\"></a>高通量测序在生物学研究中的重要性</h2><p>高通量测序技术在生物学研究中发挥着重要作用，对于我们理解生物系统的复杂性和多样性具有重要意义。以下是高通量测序在生物学研究中的几个重要应用：</p>\n<ul>\n<li><p><strong>基因组学研究</strong>：高通量测序可以帮助我们解析生物体的基因组组成、结构和功能，揭示基因与表型之间的关系。例如，它可以用于全基因组测序，鉴定和研究与疾病相关的基因突变。</p>\n</li>\n<li><p><strong>转录组学研究</strong>：通过高通量测序，我们可以了解到不同细胞或组织中正在表达的所有基因，进而研究基因的表达调控机制、信号通路以及与疾病相关的差异基因表达。</p>\n</li>\n<li><p><strong>蛋白质组学研究</strong>：高通量测序还可以用于蛋白质组学研究，帮助我们理解蛋白质的组成和功能。通过RNA测序和质谱分析相结合的方法，可以更全面地研究细胞内蛋白质的表达水平、亚细胞定位和相互作用网络等。</p>\n</li>\n<li><p><strong>微生物学研究</strong>：高通量测序在微生物学研究中广泛应用。通过对微生物群落DNA测序，我们可以揭示不同环境中微生物的多样性、组成和功能，为环境保护、药物开发和人类健康等领域提供重要依据。</p>\n</li>\n</ul>\n<p>总的来说，高通量测序技术推动了生物学研究的进步，并为我们提供了更全面、更深入的遗传信息。它为解决重要生物学问题和促进医学领域的发展提供了强大工具和资源。</p>\n<h1 id=\"16S-rDNA扩增子测序介绍\"><a href=\"#16S-rDNA扩增子测序介绍\" class=\"headerlink\" title=\"16S rDNA扩增子测序介绍\"></a>16S rDNA扩增子测序介绍</h1><p>16S rDNA是细菌和古细菌中的一个高度保守的基因区域，它编码了小亚基核糖体RNA（Small Subunit Ribosomal RNA），在细菌和古细菌的细胞中普遍存在。由于16S rDNA具有高度保守性和变异性的特点，它成为了研究微生物群落结构和多样性的理想标记。</p>\n<h2 id=\"16S-rDNA扩增子测序原理和流程：\"><a href=\"#16S-rDNA扩增子测序原理和流程：\" class=\"headerlink\" title=\"16S rDNA扩增子测序原理和流程：\"></a>16S rDNA扩增子测序原理和流程：</h2><ul>\n<li><strong>样品提取与PCR扩增：</strong> 首先，从样品中提取总DNA，包括微生物组成的DNA。然后，利用引物对16S rDNA进行PCR扩增，产生包含16S rDNA片段的扩增子。</li>\n<li><strong>文库构建：</strong> 将扩增子进行文库构建，即将其转化为适合高通量测序平台测序的文库。</li>\n<li><strong>高通量测序：</strong> 使用高通量测序技术（如Illumina MiSeq或Ion Torrent等）对文库进行测序，得到数百万个短序列片段，称为reads。</li>\n<li><strong>数据分析：</strong> 对测序数据进行质量控制、去除噪音和低质量reads，并对reads进行比对和聚类，得到OTU（Operational Taxonomic Unit）或ASV表格，用来表示不同的微生物分类单元。</li>\n<li><strong>分类学注释与功能预测：</strong> 对OTU&#x2F;ASV进行分类学注释，将其与已知的16S rDNA数据库比对，确定微生物群落的组成。此外，还可以使用相应的工具对OTU&#x2F;ASV进行功能预测，以了解微生物群落的功能潜力。</li>\n</ul>\n<h2 id=\"16S-rDNA扩增子测序在微生物群落分析中的应用：\"><a href=\"#16S-rDNA扩增子测序在微生物群落分析中的应用：\" class=\"headerlink\" title=\"16S rDNA扩增子测序在微生物群落分析中的应用：\"></a>16S rDNA扩增子测序在微生物群落分析中的应用：</h2><ul>\n<li><p><strong>多样性研究：</strong> 通过16S rDNA扩增子测序，我们可以了解到微生物群落的多样性、丰度和组成。这对于研究环境中的微生物生态系统、人体内的菌群结构和变化等具有重要意义。</p>\n</li>\n<li><p><strong>疾病相关研究：</strong> 微生物与宿主之间存在着复杂的相互关系，16S rDNA扩增子测序可帮助我们揭示微生物与疾病之间的关联。例如，可以研究肠道菌群在肠炎、肠癌等疾病中的变化，为疾病的早期诊断和治疗提供依据。</p>\n</li>\n<li><p><strong>环境监测：</strong> 通过16S rDNA扩增子测序，可以对环境中的微生物进行评估和监测。这有助于了解环境中的微生物多样性、菌群结构的变化等，为环境保护和资源管理提供科学依据。</p>\n<p>16S rDNA扩增子测序在微生物群落分析中的应用，有助于我们深入了解微生物的组成和功能特征，揭示微生物在各种生态系统中的作用和影响。</p>\n</li>\n</ul>\n<h1 id=\"Shot-gun宏基因组测序介绍\"><a href=\"#Shot-gun宏基因组测序介绍\" class=\"headerlink\" title=\"Shot-gun宏基因组测序介绍\"></a>Shot-gun宏基因组测序介绍</h1><h2 id=\"宏基因组测序概述\"><a href=\"#宏基因组测序概述\" class=\"headerlink\" title=\"宏基因组测序概述\"></a>宏基因组测序概述</h2><p>宏基因组测序是一种用于研究环境微生物的基因组的技术。与常规基因组测序不同，宏基因组测序可以同时测序一个样品中的所有DNA片段，而不仅仅是特定基因或区域。这使得我们能够获得更全面的宏基因组信息，了解生物群体的遗传多样性和功能潜力。</p>\n<h2 id=\"Shot-gun宏基因组测序原理和流程：\"><a href=\"#Shot-gun宏基因组测序原理和流程：\" class=\"headerlink\" title=\"Shot-gun宏基因组测序原理和流程：\"></a>Shot-gun宏基因组测序原理和流程：</h2><ul>\n<li><strong>样品提取与DNA纯化：</strong> 首先，从样品中提取总DNA（原核、真核、宿主等）。</li>\n<li><strong>文库构建：</strong> 将提取到的DNA进行碎片化处理，然后将其转化为适合高通量测序平台的文库，其中每个DNA片段都被连接到测序适配器上。</li>\n<li><strong>高通量测序：</strong> 利用高通量测序技术（如Illumina NovaSeq或PacBio等）对文库进行测序，产生海量的短读段或长读段。</li>\n<li><strong>数据处理与组装：</strong> 对测序数据进行质量控制（去宿主序列）、去除低质量reads，并将reads进行拼接组装，以重建原始DNA序列的完整性。</li>\n<li><strong>功能注释与分析：</strong> 对宏基因组进行进一步的数据处理和分析，包括基因预测、基因注释、物种注释、代谢通路分析等，以了解宏基因组的功能潜力。</li>\n</ul>\n<h2 id=\"Shot-gun宏基因组测序在宏基因组学研究中的应用：\"><a href=\"#Shot-gun宏基因组测序在宏基因组学研究中的应用：\" class=\"headerlink\" title=\"Shot-gun宏基因组测序在宏基因组学研究中的应用：\"></a>Shot-gun宏基因组测序在宏基因组学研究中的应用：</h2><ul>\n<li><strong>功能和代谢潜力分析：</strong> 通过Shot-gun宏基因组测序，我们可以预测宏生物体内存在的基因，并进一步推断其功能和代谢潜力。这有助于理解宏生物体对环境的适应性和功能特征。</li>\n<li><strong>群落结构和相互作用分析：</strong> 宏基因组测序可以揭示宏生物群落的组成和结构，以及不同种群之间的相互作用模式。这对于研究宏生态系统的稳定性、共生共存关系和复杂网络等方面具有重要意义。</li>\n</ul>\n<p>Shot-gun宏基因组测序提供了了解宏生物的遗传多样性、功能潜力和生态作用的强大工具。它在宏基因组学研究中发挥着重要作用，为我们深入了解生物的基因组特征和生态系统功能提供了新的视角。</p>\n<h1 id=\"16S-rDNA扩增子测序与Shot-gun宏基因组测序的区别\"><a href=\"#16S-rDNA扩增子测序与Shot-gun宏基因组测序的区别\" class=\"headerlink\" title=\"16S rDNA扩增子测序与Shot-gun宏基因组测序的区别\"></a>16S rDNA扩增子测序与Shot-gun宏基因组测序的区别</h1><table>\n<thead>\n<tr>\n<th>特点</th>\n<th>宏基因组测序</th>\n<th>16S测序</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>分析范围</td>\n<td>微生物群落中的所有微生物种类和全基因组信息</td>\n<td>微生物群落中的16S rRNA基因信息</td>\n</tr>\n<tr>\n<td>精度和分辨率</td>\n<td>高（种水平）</td>\n<td>相对较低（属水平）</td>\n</tr>\n<tr>\n<td>数据处理和分析复杂性</td>\n<td>复杂</td>\n<td>相对简单</td>\n</tr>\n<tr>\n<td>优势</td>\n<td>提供全面性信息，高分辨率，功能分析，适用于各种生态系统研究</td>\n<td>揭示微生物的多样性、群落结构、系统发育关系，成本低</td>\n</tr>\n<tr>\n<td>宿主影响</td>\n<td>易</td>\n<td>不易</td>\n</tr>\n<tr>\n<td>局限性</td>\n<td>昂贵，需要大量计算资源和专业知识</td>\n<td>仅提供关于16S rRNA基因（细菌和古细菌）的信息，分辨率有限，无法提供详细的功能和代谢潜力信息。</td>\n</tr>\n<tr>\n<td>以上是宏基因组测序和16S测序的主要差别。16S rDNA扩增子测序更加注重微生物群落的结构和多样性分析，尽管宏基因组测序具有更广泛的应用和更高的解析能力，但同时也存在着一些局限性，如成本高昂、数据处理和分析的复杂性以及对专业知识的依赖。因此，在选择使用哪种技术时，研究人员需要根据自身的研究目的、样品类型和预算进行权衡。</td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"样本收集保存和运输注意事项\"><a href=\"#样本收集保存和运输注意事项\" class=\"headerlink\" title=\"样本收集保存和运输注意事项\"></a>样本收集保存和运输注意事项</h1><h2 id=\"扩增子和宏基因组测序前样本的采集方法和注意事项：\"><a href=\"#扩增子和宏基因组测序前样本的采集方法和注意事项：\" class=\"headerlink\" title=\"扩增子和宏基因组测序前样本的采集方法和注意事项：\"></a>扩增子和宏基因组测序前样本的采集方法和注意事项：</h2><h3 id=\"样本采集方法：\"><a href=\"#样本采集方法：\" class=\"headerlink\" title=\"样本采集方法：\"></a>样本采集方法：</h3><ul>\n<li>对于微生物群落研究，例如16S rDNA扩增子测序，通常采集环境样品（如土壤、水体、肠道内容物）或临床样品（如口腔拭子、粪便样品）。</li>\n<li>采集时要避免污染，使用无菌工具（如消毒的手套、取样器具等）进行采集。</li>\n<li>采集前应了解目标生物的分布情况、适宜的时间和地点，并进行采样地点的描述和记录。</li>\n<li>宏基因组测序涉及更广泛的样品类型，包括细菌、古细菌、真核生物等。采集方法根据样品类型有所不同。</li>\n</ul>\n<h3 id=\"注意事项：\"><a href=\"#注意事项：\" class=\"headerlink\" title=\"注意事项：\"></a>注意事项：</h3><ul>\n<li>样品采集和处理过程中，必须遵守无菌操作规范，以减少外部污染对样品的影响。</li>\n<li>避免使用可能含有RNase或DNase酶的试剂和工具，以防止核酸降解。</li>\n<li>了解目标生物的生态环境和特性，选择合适的采集时间和地点，确保获得代表性的样品。</li>\n<li>根据不同采样类型，选择合适的容器（如离心管、冰袋、采集棒等）进行样品收集，并在收集后立即进行处理或冷冻保存。</li>\n<li>在采集样品前，将采样工具彻底清洁消毒，尽量避免重复采样和交叉污染。</li>\n<li>通过宏基因组测序研究宿主相关微生物时，需要注意尽可能避免采集到宿主组织，否则会导致测序数据中微生物序列占比过小。</li>\n</ul>\n<h2 id=\"样本保存和运输以保持完整性和稳定性：\"><a href=\"#样本保存和运输以保持完整性和稳定性：\" class=\"headerlink\" title=\"样本保存和运输以保持完整性和稳定性：\"></a>样本保存和运输以保持完整性和稳定性：</h2><ul>\n<li><p><strong>保存方法：</strong></p>\n<ul>\n<li>样品保存应根据实验需求和样品特性选择适当的方法。常见的保存方法包括低温冷冻、保护液保存等。</li>\n<li>对于微生物样品，通常将其迅速冷冻保存在-80°C的冰箱中，以减缓DNA降解和生物活性的损失。</li>\n</ul>\n</li>\n<li><p><strong>运输方法：</strong></p>\n<ul>\n<li>在样品运输过程中，应确保样品的温度稳定性和完整性。</li>\n<li>使用合适的运输容器，如冷箱、干冰盒等，以保持低温和防止样品破裂或泄漏。</li>\n<li>对于国际运输，遵守相关法规和运输限制，确保样品能够顺利通过海关和检疫。</li>\n</ul>\n</li>\n</ul>\n<p>在采集样本和进行扩增子或宏基因组测序之前，正确的采集方法和样品处理是确保数据质量和可靠性的重要步骤。选择适当的保存和运输方法可以确保样品的完整性和稳定性，并最大程度地保护其中的生物信息。</p>\n<p>请注意，不同类型的样品可能需要采用不同的保存和运输方法。因此，在进行扩增子或宏基因组测序之前，建议咨询专业人士或参考相关文献以获取针对特定样品类型的最佳实践建议。</p>\n<h1 id=\"数据分析结果解读\"><a href=\"#数据分析结果解读\" class=\"headerlink\" title=\"数据分析结果解读\"></a>数据分析结果解读</h1><h2 id=\"16S-rDNA和宏基因组数据分析的基本流程：\"><a href=\"#16S-rDNA和宏基因组数据分析的基本流程：\" class=\"headerlink\" title=\"16S rDNA和宏基因组数据分析的基本流程：\"></a>16S rDNA和宏基因组数据分析的基本流程：</h2><h3 id=\"16S-rDNA数据分析流程：\"><a href=\"#16S-rDNA数据分析流程：\" class=\"headerlink\" title=\"16S rDNA数据分析流程：\"></a>16S rDNA数据分析流程：</h3><ul>\n<li>质量控制：对原始测序数据进行质量过滤和去除接头、低质量序列。</li>\n<li>序列拼接：将质量控制后的序列根据重叠区域进行拼接，得到高质量的长序列。</li>\n<li>物种注释：使用参考数据库（如Greengenes、SILVA）进行物种注释，将序列与已知物种进行比对并分类。</li>\n<li>多样性分析：计算物种多样性指数、绘制稀释曲线、构建物种共生网络等。</li>\n<li>群落结构分析：通过聚类分析（如OTU聚类）和Beta多样性分析（如PCoA、NMDS）研究群落结构差异。</li>\n<li>寻找Biomarker：通过LESFE分析寻找差异物种。</li>\n<li>功能预测：通过软件（picrust2，FAPROTAX）预测群落功能。</li>\n</ul>\n<h3 id=\"宏基因组数据分析流程：\"><a href=\"#宏基因组数据分析流程：\" class=\"headerlink\" title=\"宏基因组数据分析流程：\"></a>宏基因组数据分析流程：</h3><ul>\n<li>质量控制：对原始测序数据进行质量过滤和去除低质量序列。</li>\n<li>去宿主序列：将质量控制后的序列与宿主参考基因组进行比对，剩余的为微生物序列。</li>\n<li>基因预测：对微生物序列进行基因预测。</li>\n<li>功能注释：使用参考数据库（如KEGG、COG、GO、CAZY）对预测的功能基因进行注释。</li>\n<li>Alpha和Beta多样性分析：计算Alpha多样性指数和Beta多样性，比较不同样本之间的功能结构差异。</li>\n</ul>\n<h3 id=\"常见的分析软件和工具：\"><a href=\"#常见的分析软件和工具：\" class=\"headerlink\" title=\"常见的分析软件和工具：\"></a>常见的分析软件和工具：</h3><ul>\n<li>16S rDNA数据分析：QIIME2，mothur，DADA2，UPARSE, RDPipeline，vegan，PICRUSt……</li>\n<li>宏基因组数据分析：MetaPhlAn, HUMAnN, MG-RAST, MEGAN, kraken2……</li>\n</ul>\n<h1 id=\"结论和展望\"><a href=\"#结论和展望\" class=\"headerlink\" title=\"结论和展望\"></a>结论和展望</h1><h2 id=\"16S-rDNA扩增子和Shot-gun宏基因组测序的特点和应用：\"><a href=\"#16S-rDNA扩增子和Shot-gun宏基因组测序的特点和应用：\" class=\"headerlink\" title=\"16S rDNA扩增子和Shot-gun宏基因组测序的特点和应用：\"></a>16S rDNA扩增子和Shot-gun宏基因组测序的特点和应用：</h2><h3 id=\"16S-rDNA扩增子测序特点和应用：\"><a href=\"#16S-rDNA扩增子测序特点和应用：\" class=\"headerlink\" title=\"16S rDNA扩增子测序特点和应用：\"></a>16S rDNA扩增子测序特点和应用：</h3><ul>\n<li>特点：通过放大和测序16S rDNA基因区域，可以研究微生物群落的组成和结构。</li>\n<li>应用：<ul>\n<li>揭示微生物群落的多样性和相对丰度，了解不同环境中的微生物群落变化。</li>\n<li>研究微生物与健康、疾病之间的关联，如肠道菌群与肠道疾病的关系。</li>\n<li>探索环境中未知微生物种类，发现新的微生物资源。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Shot-gun宏基因组测序特点和应用：\"><a href=\"#Shot-gun宏基因组测序特点和应用：\" class=\"headerlink\" title=\"Shot-gun宏基因组测序特点和应用：\"></a>Shot-gun宏基因组测序特点和应用：</h3><ul>\n<li>特点：对整个基因组进行测序，包括微生物和宿主的DNA，提供更全面的信息。</li>\n<li>应用：<ul>\n<li>研究微生物和宿主基因组之间的相互作用，如微生物的代谢功能对宿主健康的影响。</li>\n<li>分析微生物的功能潜力，如预测微生物群落参与的代谢途径和信号通路。</li>\n<li>研究微生物基因组的进化和遗传多样性，理解微生物演化和适应策略。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"未来发展方向和潜在的研究前景：\"><a href=\"#未来发展方向和潜在的研究前景：\" class=\"headerlink\" title=\"未来发展方向和潜在的研究前景：\"></a>未来发展方向和潜在的研究前景：</h2><h3 id=\"方法改进：\"><a href=\"#方法改进：\" class=\"headerlink\" title=\"方法改进：\"></a>方法改进：</h3><ul>\n<li>提高测序技术的精度和通量，降低成本，使得扩增子和宏基因组测序更加高效和经济。</li>\n<li>开发新的分析工具和算法，以提高数据处理和解释的准确性和效率。</li>\n</ul>\n<h3 id=\"整合多组学数据：\"><a href=\"#整合多组学数据：\" class=\"headerlink\" title=\"整合多组学数据：\"></a>整合多组学数据：</h3><ul>\n<li>结合16S rDNA&#x2F;宏基因组测序数据与转录组、蛋白质组和代谢组等多组学数据，构建全面的系统生物学模型，深入了解微生物与宿主之间的复杂相互关系。</li>\n</ul>\n<h3 id=\"功能预测和代谢网络建模：\"><a href=\"#功能预测和代谢网络建模：\" class=\"headerlink\" title=\"功能预测和代谢网络建模：\"></a>功能预测和代谢网络建模：</h3><ul>\n<li>进一步发展和完善基于宏基因组数据的功能预测方法，从而揭示微生物群落的代谢功能和关键信号通路。</li>\n<li>基于大规模宏基因组数据，构建微生物群落的代谢网络模型，深入理解微生物共生和协同作用的机制。</li>\n</ul>\n<h3 id=\"环境和临床应用：\"><a href=\"#环境和临床应用：\" class=\"headerlink\" title=\"环境和临床应用：\"></a>环境和临床应用：</h3><ul>\n<li>运用16S rDNA扩增子和宏基因组测序技术，研究不同环境（如土壤、水体、大气）中的微生物群落动态和功能。</li>\n<li>在临床领域，通过微生物组学的研究，探索微生物与健康、疾病之间的关系，并开发个性化微生物介入策略。</li>\n</ul>\n<p>总的来说，未来的发展方向包括技术改进、多组学数据整合、功能预测和代谢网络建模，以及在环境和临床应用方面的深入研究。这些发展将进一步推动微生物组学的应用和理解，为我们揭示微生物的奥秘提供更深入的视角。</p>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"测序","path":"api/tags/测序.json"},{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"宏基因组","path":"api/tags/宏基因组.json"}]},{"title":"Shiny从入门到入定——1.在小小的花园里面挖呀挖呀挖","slug":"Shiny从入门到入定——1-在小小的花园里面挖呀挖呀挖","date":"2023-11-10T13:16:23.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Shiny从入门到入定——1-在小小的花园里面挖呀挖呀挖.json","excerpt":null,"keywords":null,"cover":"https://d33wubrfki0l68.cloudfront.net/fbf45a58e2a82900449f9eb35deba4e670f54624/530cb/images/basic-app/run-app.png","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>本部分为学习Shiny的第一阶段——挖坑。</p>\n<p>在接下来的四章中，目标是让读者尽快学会编写Shiny应用程序。</p>\n<ul>\n<li><p>在第一章中，作者将从小处着手，但内容完整，向读者展示应用程序的所有主要部分以及它们如何组合在一起。</p>\n</li>\n<li><p>在第二章和第三章中，读者将开始详细了解Shiny应用程序的两个主要部分：前端（用户在浏览器中看到的内容）和后端（使应用程序起作用的代码）。</p>\n</li>\n<li><p>第四章将通过案例研究来完成，以帮助巩固读者迄今为止所学的概念。</p>\n</li>\n</ul>\n<h1 id=\"第一个Shiny-app\"><a href=\"#第一个Shiny-app\" class=\"headerlink\" title=\"第一个Shiny app\"></a>第一个Shiny app</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>在本章中，我们将创建一个简单的Shiny应用程序。首先，我将向您展示Shiny应用程序所需的最低样板，然后您将学习如何启动和停止它。接下来，您将学习每个Shiny应用程序的两个关键组件：UI（用户界面的缩写），它定义了应用程序的外观，以及服务器功能，它定义了应用程序的工作方式。Shiny使用响应式编程在输入更改时自动更新输出，因此我们将通过学习Shiny应用程序的第三个重要组件：响应式表达式来结束本章。</p>\n<p>如果你还没有安装Shiny，现在用以下命令安装它</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;shiny&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>如果您已经安装了Shiny，请使用<code>packageVersion(&quot;shiny&quot;)</code>检查您是否安装了1.5.0或更高版本。然后在当前的R会话中加载：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建应用程序目录和文件\"><a href=\"#创建应用程序目录和文件\" class=\"headerlink\" title=\"创建应用程序目录和文件\"></a>创建应用程序目录和文件</h2><p>创建Shiny应用程序有多种方法，最简单的是为您的应用程序创建一个新目录，并在其中放置一个名为<code>app.R</code>的单个文件。这个app.R文件将用于告诉Shiny应用程序应该如何展示界面以及应该如何运行。</p>\n<p>通过创建新目录并添加如下所示的app.R文件来尝试一下：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  <span class=\"string\">&quot;Hello, world!&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>以上是完整的、基础的Shiny应用程序！仔细观察上面的代码，app.R做了四件事：</p>\n<ul>\n<li><p>它调用<code>library(shiny)</code>来加载shiny包。</p>\n</li>\n<li><p>它定义了用户界面，即人类与之交互的HTML网页。在这种情况下，它是一个包含<code>“Hello，world！”</code>的页面。</p>\n</li>\n<li><p>它通过定义<code>server</code>函数来指定应用程序的行为。目前为空，因此我们的应用程序不做任何事情，但我们稍后会回过头来重新审视这一点。</p>\n</li>\n<li><p>它使用<code>shinyApp(ui，server)</code>来构建并启动一个从用户界面和服务器构建的Shiny应用程序。</p>\n</li>\n</ul>\n<p><strong>RStudio提示</strong>：在RStudio中有两种方便的方法可以创建新的应用程序：</p>\n<ul>\n<li><p>通过点击<code>File | New Project</code>，然后选择<code>New Directory</code>和<code>Shiny Web Application</code>，可以一次性创建一个新的目录和<code>app.R</code>文件，其中包含基本的应用程序。</p>\n</li>\n<li><p>如果您已经创建了<code>app.R</code>文件，可以通过键入<code>“shinyapp”</code>并按<code>Shift+Tab</code>快速添加应用程序样板。</p>\n</li>\n</ul>\n<h2 id=\"运行和停止\"><a href=\"#运行和停止\" class=\"headerlink\" title=\"运行和停止\"></a>运行和停止</h2><p>您可以通过几种方式运行此应用程序：</p>\n<ul>\n<li><p>单击文档工具栏中的<code>Run App</code>（图1.1）按钮。</p>\n</li>\n<li><p>使用键盘快捷键：<code>Cmd / Ctrl + Shift + Enter</code>。</p>\n</li>\n<li><p>如果您没有使用RStudio，则可以使用<code>(source())</code><sup>1</sup> 整个文档，或使用包含app.R的目录的路径调用<code>shiny::runApp()</code>。</p>\n</li>\n</ul>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/fbf45a58e2a82900449f9eb35deba4e670f54624/530cb/images/basic-app/run-app.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/fbf45a58e2a82900449f9eb35deba4e670f54624/530cb/images/basic-app/run-app.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图1.1 Run App 按钮可以在源码窗格的右上角找到。\"></p>\n<p>从这些选项中选择一个，并确认您看到的与图1.2中的相同的应用程序。恭喜！您已经制作了您的第一个Shiny应用程序。</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/e9e6b44c85c169aedd2c4e630022e7958aa57696/06ba0/images/basic-app/hello-world.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/e9e6b44c85c169aedd2c4e630022e7958aa57696/06ba0/images/basic-app/hello-world.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图1.2 当你运行上面的代码时，你会看到最简单的shiny应用程序\"></p>\n<p>在你关闭应用程序之前，回到RStudio并查看R控制台。你会注意到它说类似于：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&gt; Listening on http://127.0.0.1:3827</span><br></pre></td></tr></table></figure>\n\n<p>这告诉你应用程序的URL：127.0.0.1是一个标准地址，表示“这台计算机”，而3827是一个随机分配的端口号。你可以将该URL输入到任何兼容的web浏览器中以打开应用程序的另一个副本。</p>\n<p>另外请注意，R正在运行：R提示符不可见，控制台工具栏显示一个停止符号图标。当Shiny应用程序正在运行时，它会“阻止”R控制台。这意味着在Shiny应用程序停止之前，您无法在R控制台运行新的命令。</p>\n<p>您可以使用以下选项之一停止应用程序并返回对控制台的访问权限：</p>\n<ul>\n<li><p>点击R控制台工具栏上的停止符号图标。</p>\n</li>\n<li><p>单击控制台，然后按Esc（或按<code>Ctrl + C</code>如果您没有使用RStudio）。</p>\n</li>\n<li><p>关闭Shiny应用程序窗口。</p>\n</li>\n</ul>\n<p>Shiny应用程序开发的基本工作流程是编写一些代码，启动应用程序，与应用程序交互，编写更多代码，然后重复。如果你使用的是RStudio，你甚至不需要停止和重新启动应用程序来查看你的更改 - 你可以按下工具箱中的<code>Reload app</code>按钮或使用<code>Cmd/Ctrl + Shift + Enter</code>键盘快捷键。我将在第5章中介绍其他工作流程模式。</p>\n<h2 id=\"添加用户界面控件\"><a href=\"#添加用户界面控件\" class=\"headerlink\" title=\"添加用户界面控件\"></a>添加用户界面控件</h2><p>接下来，我们将向用户界面添加一些输入和输出，使其不再如此简约。我们将创建一个非常简单的应用程序，向您展示datasets包中包含的所有内置数据框。</p>\n<p>用以下代码替换您的ui：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  selectInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;dataset&quot;</span><span class=\"punctuation\">,</span> label <span class=\"operator\">=</span> <span class=\"string\">&quot;Dataset&quot;</span><span class=\"punctuation\">,</span> choices <span class=\"operator\">=</span> ls<span class=\"punctuation\">(</span><span class=\"string\">&quot;package:datasets&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  verbatimTextOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;summary&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  tableOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;table&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>这个例子使用了四个新函数：</p>\n<ul>\n<li><p><code>fluidPage()</code>是一个布局函数，用于设置页面的基本视觉结构。您将在第6.2节中了解更多关于它们的信息。</p>\n</li>\n<li><p><code>selectInput()</code>是一种输入控件，使用户可以通过提供值与应用程序进行交互。在这种情况下，它是一个带有标签“Dataset”的下拉菜单，允许您从R自带的内置数据集中选择一个。您将在第2.2节中了解更多关于输入的信息。</p>\n</li>\n<li><p><code>verbatimTextOutput()</code>和<code>tableOutput()</code>是输出控件，它们告诉Shiny将渲染的输出放在哪里（我们稍后再了解）。<code>verbatimTextOutput()</code>显示代码，<code>tableOutput()</code>显示表格。您将在第2.3节中了解更多关于输出的信息。</p>\n</li>\n</ul>\n<p>布局函数、输入和输出有不同的用途，但它们在本质上都是相同的：它们都是生成HTML的巧妙方式，如果您在Shiny应用程序之外调用其中任何一个，您将在控制台上看到HTML输出。不要害怕深入研究这些不同的布局和控件是如何工作的。</p>\n<p>现在运行应用程序。您将看到图1.3，一个包含下拉框的页面。我们只看到了输入，而没有看到两个输出，因为我们还没有告诉Shiny输入和输出之间的关系。</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/17eadbf2ccdea8d4648b05d486dfb465f562df69/d077d/demos/basic-app/ui.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/17eadbf2ccdea8d4648b05d486dfb465f562df69/d077d/demos/basic-app/ui.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图1.3 具有用户界面的datasets应用程序\"></p>\n<h2 id=\"添加行为\"><a href=\"#添加行为\" class=\"headerlink\" title=\"添加行为\"></a>添加行为</h2><p>接下来，我们将通过在<code>server</code>函数中定义它们来为输出提供生命。</p>\n<p>Shiny使用响应式编程使应用程序具有交互性。您将在第3章中了解更多关于响应式编程的信息，但现在只需知道，它涉及到告诉Shiny如何执行计算，而不是命令Shiny实际去做。这就像给某人食谱与命令他们给您做三明治之间的区别。</p>\n<p>我们将为样本应用程序中的摘要和表格输出提供“食谱”，以告诉Shiny如何填充这些输出。用以下代码替换您的空server函数：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>summary <span class=\"operator\">&lt;-</span> renderPrint<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    dataset <span class=\"operator\">&lt;-</span> get<span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>dataset<span class=\"punctuation\">,</span> <span class=\"string\">&quot;package:datasets&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    summary<span class=\"punctuation\">(</span>dataset<span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  output<span class=\"operator\">$</span>table <span class=\"operator\">&lt;-</span> renderTable<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    dataset <span class=\"operator\">&lt;-</span> get<span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>dataset<span class=\"punctuation\">,</span> <span class=\"string\">&quot;package:datasets&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    dataset</span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>赋值运算符（&lt;-）的左侧，<code>output$ID</code>，表示您正在为具有该ID的Shiny输出提供食谱。赋值运算符的右侧使用特定的render函数来包装您提供的代码。每个<code>render&#123;Type&#125;</code>函数旨在生成特定类型的输出（例如文本、表格和图形），并且通常与<code>&#123;type&#125;Output</code>函数配对。例如，在此应用程序中，<code>renderPrint()</code>与<code>verbatimTextOutput()</code>配对以显示具有固定宽度（逐字）文本的统计摘要，而<code>renderTable()</code>与<code>tableOutput()</code>配对以在表格中显示输入数据。</p>\n<p>再次运行应用程序并尝试使用，观察更改输入时输出会发生什么变化。图1.4显示了打开应用程序时应该看到的内容。</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/bb766cc235f190fd2c28d8f011edb7f9cbe526a7/5d540/demos/basic-app/server.png\" alt=\"图1.4 \n现在我们已经提供了一个将输出和输入连接起来的服务器函数，我们已经有了一个功能完整的应用程序\"></p>\n<p>请注意，每当您更改输入数据集时，摘要和表格都会自动更新。这种依赖性是通过在输出函数中引用<code>input$dataset</code>而隐式创建的。<code>input$dataset</code>被填充为UI组件中id为dataset的当前值，并且当该值发生变化时，将导致输出自动更新。这就是反应性的本质：输出在输入发生更改时自动（重新计算）。</p>\n<h2 id=\"使用反应式表达式减少重复\"><a href=\"#使用反应式表达式减少重复\" class=\"headerlink\" title=\"使用反应式表达式减少重复\"></a>使用反应式表达式减少重复</h2><p>即使在这个简单的例子中，我们也有一些重复的代码：下面的这行代码在两个输出中都存在。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset <span class=\"operator\">&lt;-</span> get<span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>dataset<span class=\"punctuation\">,</span> <span class=\"string\">&quot;package:datasets&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>在任何一种编程中，重复的代码都是不良的实践；它可能在计算上是浪费的，更重要的是，它增加了维护或调试代码的难度。在这里不是那么重要，但我想在一个非常简单的上下文中说明这个基本概念。</p>\n<p>在传统的R脚本中，我们使用两种技术来处理重复的代码：要么捕获变量的值，要么用函数捕获计算。不幸的是，这两种方法在这里都不适用，原因将在第13.2节中介绍，我们需要一个新的机制：<code>反应式表达式</code>。</p>\n<p>您可以通过将代码块包装在<code>reactive(&#123;...&#125;)</code>中并将其分配给变量来创建反应式表达式，并且可以通过像调用函数一样来使用反应式表达式。然而，尽管看起来像是在调用函数，但反应式表达式有一个重要的区别：它只在其第一次被调用时运行，然后将其结果缓存直到需要更新。</p>\n<p>我们可以更新我们的server()函数来使用反应式表达式，如下所示。这个应用程序的行为完全相同，但运行更有效率，因为它只需要检索数据集一次，而不是两次。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\"># Create a reactive expression</span></span><br><span class=\"line\">  dataset <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    get<span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>dataset<span class=\"punctuation\">,</span> <span class=\"string\">&quot;package:datasets&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  output<span class=\"operator\">$</span>summary <span class=\"operator\">&lt;-</span> renderPrint<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\"># Use a reactive expression by calling it like a function</span></span><br><span class=\"line\">    summary<span class=\"punctuation\">(</span>dataset<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  output<span class=\"operator\">$</span>table <span class=\"operator\">&lt;-</span> renderTable<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    dataset<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>我们会多次回到响应式编程，但即使只有对输入、输出和反应式表达式的粗略了解，也可以构建非常有用的Shiny应用程序！</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>在本章中，您创建了一个简单的应用程序-这不是很有趣或很有用，但是您已经看到了使用现有的R知识构建Web应用程序的容易程度。在接下来的两章中，您将学习更多关于用户界面和响应式编程的知识，这是Shiny的两个基本构建块。现在是获取Shiny速查表的绝佳时机。这是一个很好的资源，可以帮助您记住Shiny应用程序的主要组件。</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/349cbcca50af85a9214e552296f33f14be37f768/52241/images/basic-app/cheatsheet.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/349cbcca50af85a9214e552296f33f14be37f768/52241/images/basic-app/cheatsheet.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图1.5 Shiny速查表，可从[https://www.rstudio.com/resources/cheatsheets/]获取\"></p>\n<h2 id=\"练习\"><a href=\"#练习\" class=\"headerlink\" title=\"练习\"></a>练习</h2><p><strong>1.8.1</strong> 创建一个应用程序，通过姓名向用户打招呼。您可能不知道需要使用哪些函数来完成此操作，因此我已经在下方包含了一些代码行。请考虑需要使用哪些行，然后将它们复制并粘贴到Shiny应用程序的适当位置。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tableOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;mortgage&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">output<span class=\"operator\">$</span>greeting <span class=\"operator\">&lt;-</span> renderText<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;Hello &quot;</span><span class=\"punctuation\">,</span> input<span class=\"operator\">$</span>name<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">numericInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;age&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;How old are you?&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"literal\">NA</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">textInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;name&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;What&#x27;s your name?&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">textOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;greeting&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">output<span class=\"operator\">$</span>histogram <span class=\"operator\">&lt;-</span> renderPlot<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  hist<span class=\"punctuation\">(</span>rnorm<span class=\"punctuation\">(</span><span class=\"number\">1000</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> res <span class=\"operator\">=</span> <span class=\"number\">96</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>1.8.2</strong> 假设你的朋友想设计一个应用程序，允许用户设置一个介于1和50之间的数字（x），并显示这个数字乘以5的结果。以下是他&#x2F;她的第一次尝试：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;x&quot;</span><span class=\"punctuation\">,</span> label <span class=\"operator\">=</span> <span class=\"string\">&quot;If x is&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"string\">&quot;then x times 5 is&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  textOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;product&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>product <span class=\"operator\">&lt;-</span> renderText<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span> </span><br><span class=\"line\">    x <span class=\"operator\">*</span> <span class=\"number\">5</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>其不幸报错如下，请尝试修复错误：</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/cc947455e46b88242e9c3460d3c2291f9f9393c2/093b0/demos/basic-app/ex-x-times-5.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/cc947455e46b88242e9c3460d3c2291f9f9393c2/093b0/demos/basic-app/ex-x-times-5.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"error\"></p>\n<p><strong>1.8.3</strong> 将前一个练习中的应用程序扩展为允许用户设置乘数y的值，以便应用程序产生x * y的值。最终结果应如下所示：</p>\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/6a4de45b5dd90ca5c9e9ba6bf90d4be54d5ac8db/dc9e2/demos/basic-app/ex-x-times-y.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/6a4de45b5dd90ca5c9e9ba6bf90d4be54d5ac8db/dc9e2/demos/basic-app/ex-x-times-y.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"xy\"></p>\n<p><strong>1.8.4</strong> 以下面的应用程序为例，它为上一练习中描述的最后一个应用程序添加了一些附加功能。有什么新功能？如何使用响应式表达式减少应用程序中的重复代码量。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;x&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;If x is&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;y&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;and y is&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"string\">&quot;then, (x * y) is&quot;</span><span class=\"punctuation\">,</span> textOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;product&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"string\">&quot;and, (x * y) + 5 is&quot;</span><span class=\"punctuation\">,</span> textOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;product_plus5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"string\">&quot;and (x * y) + 10 is&quot;</span><span class=\"punctuation\">,</span> textOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;product_plus10&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>product <span class=\"operator\">&lt;-</span> renderText<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span> </span><br><span class=\"line\">    product <span class=\"operator\">&lt;-</span> input<span class=\"operator\">$</span>x <span class=\"operator\">*</span> input<span class=\"operator\">$</span>y</span><br><span class=\"line\">    product</span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>product_plus5 <span class=\"operator\">&lt;-</span> renderText<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span> </span><br><span class=\"line\">    product <span class=\"operator\">&lt;-</span> input<span class=\"operator\">$</span>x <span class=\"operator\">*</span> input<span class=\"operator\">$</span>y</span><br><span class=\"line\">    product <span class=\"operator\">+</span> <span class=\"number\">5</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>product_plus10 <span class=\"operator\">&lt;-</span> renderText<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span> </span><br><span class=\"line\">    product <span class=\"operator\">&lt;-</span> input<span class=\"operator\">$</span>x <span class=\"operator\">*</span> input<span class=\"operator\">$</span>y</span><br><span class=\"line\">    product <span class=\"operator\">+</span> <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>1.8.5</strong> 以下应用程序与您在本章前面看到的应用程序非常相似：您从包中选择一个数据集（这次我们使用ggplot2包），应用程序会打印出数据的摘要和图表。它还遵循良好的实践，并利用响应式表达式来避免代码冗余。但是，下面提供的代码存在三个错误。您可以找到并修复它们吗？</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">datasets <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;economics&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;faithfuld&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;seals&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  selectInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;dataset&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Dataset&quot;</span><span class=\"punctuation\">,</span> choices <span class=\"operator\">=</span> datasets<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  verbatimTextOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;summary&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  tableOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;plot&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  dataset <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    get<span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>dataset<span class=\"punctuation\">,</span> <span class=\"string\">&quot;package:ggplot2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>summmry <span class=\"operator\">&lt;-</span> renderPrint<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    summary<span class=\"punctuation\">(</span>dataset<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  output<span class=\"operator\">$</span>plot <span class=\"operator\">&lt;-</span> renderPlot<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    plot<span class=\"punctuation\">(</span>dataset<span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> res <span class=\"operator\">=</span> <span class=\"number\">96</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"练习题答案获取\"><a href=\"#练习题答案获取\" class=\"headerlink\" title=\"练习题答案获取\"></a>练习题答案获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“b376”获取习题答案。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"编程","path":"api/tags/编程.json"},{"name":"Shiny入门系列","path":"api/tags/Shiny入门系列.json"}]},{"title":"Shiny从入门到入定——0欢迎入坑","slug":"Shiny从入门到入定——0欢迎入坑","date":"2023-11-09T10:25:21.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Shiny从入门到入定——0欢迎入坑.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","content":"<h1 id=\"欢迎语\"><a href=\"#欢迎语\" class=\"headerlink\" title=\"欢迎语\"></a>欢迎语</h1><p>Shiny是使用R代码创建Web应用程序的框架。它主要是为数据科学家设计的，为此，您可以在不了解HTML，CSS或JavaScript的情况下创建相当复杂的Shiny应用程序。另一方面，Shiny并不限制您只能创建琐碎的或预制的程序：其用户界面组件可以轻松地定制或扩展，其服务器使用反应性编程让您创建任何类型的后端逻辑。Shiny容易上手，当你深入了解它如何工作的时候，你就会更加意识到它是由强大的软件工程原理支撑的通用构建块。</p>\n<p>如今，Shiny的应用领域和行业几乎与R本身一样多。学术界将其作为统计概念的教学工具，激发本科生对编写代码的热情，展示新颖统计方法或模型的引人注目的媒介。大型制药公司将其用于加快药物开发过程中科学家和分析师之间的协作。硅谷科技公司将其用于建立整合高级分析的实时指标仪表板。 本书旨在让您从对Shiny一无所知成为能够编写大型复杂应用程序的专业开发人员，这些应用程序易于维护且性能卓越。您将深入了解Shiny背后的反应式编程模型，以及构建有用的技术工具箱，以解决常见的应用程序挑战。</p>\n<h1 id=\"序\"><a href=\"#序\" class=\"headerlink\" title=\"序\"></a>序</h1><h2 id=\"Shiny是什么？\"><a href=\"#Shiny是什么？\" class=\"headerlink\" title=\"Shiny是什么？\"></a>Shiny是什么？</h2><p>如果你之前从未使用过Shiny，欢迎你！Shiny是一个R包，可以让你轻松地创建丰富的交互式Web应用程序。Shiny允许你将R中的工作通过Web浏览器进行展示，以便任何人都可以使用。Shiny让你轻松创建精美的Web应用程序，让你看起来很酷。</p>\n<p>在过去，对于大多数R用户来说创建Web应用程序很困难，因为：</p>\n<ul>\n<li><p>你需要深入了解HTML、CSS和JavaScript等Web技术。</p>\n</li>\n<li><p>要制作复杂的交互式应用程序，需要仔细分析交互流，以确保当输入变化时，只有相关的输出被更新。</p>\n</li>\n</ul>\n<p>Shiny通过以下方式使R程序员创建Web应用程序变得更容易：</p>\n<ul>\n<li><p>提供一组精心策划的用户界面（UI）函数，用于生成常见任务的HTML、CSS和JavaScript。这意味着，在你想超越Shiny为你提供的基本功能之前，你不需要了解HTML&#x2F;CSS&#x2F;JavaScript的细节。</p>\n</li>\n<li><p>引入一种称为反应式编程的新编程风格，这种风格可以自动跟踪代码的依赖关系。这意味着每当输入发生变化时，Shiny可以自动找出如何进行最小的工作量来更新所有相关的输出。</p>\n</li>\n</ul>\n<p>人们使用Shiny来：</p>\n<ul>\n<li><p>创建跟踪重要高级性能指标的仪表板，同时促进对需要更多调查的指标进行深入挖掘。</p>\n</li>\n<li><p>用交互式应用程序取代数百页的PDF文件，使用户能够跳转到他们关心的确切结果片段。</p>\n</li>\n<li><p>使用信息丰富的可视化和交互式敏感性分析，向非技术受众传达复杂模型。</p>\n</li>\n<li><p>为常见工作流程提供自助式数据分析，用Shiny应用程序取代电子邮件请求，允许人们上传自己的数据并执行标准分析。你可以将复杂的R分析提供给没有编程技能的用户。</p>\n</li>\n<li><p>为教授统计学和数据科学概念创建交互式演示，允许学习者调整输入并观察分析中这些更改的下游影响。</p>\n</li>\n</ul>\n<p>简而言之，Shiny使您能够将您的某些R超级能力传递给任何会使用网络的人。</p>\n<h2 id=\"谁应该阅读本书？\"><a href=\"#谁应该阅读本书？\" class=\"headerlink\" title=\"谁应该阅读本书？\"></a>谁应该阅读本书？</h2><p>本书主要面向以下两个受众群体：</p>\n<ul>\n<li><p>对Shiny感兴趣的R用户，以将他们的分析转化为交互式Web应用程序。要想从本书中获得最大收益，您应该能够熟练使用R进行数据分析，并且至少编写过几个函数。</p>\n</li>\n<li><p>现有的Shiny用户，他们希望提高对Shiny理论知识的了解，以更快更容易地编写更高质量的应用程序。如果您发现自己的应用程序变得越来越庞大并且开始出现管理复杂性的问题，那么您将特别需要本书的帮助。</p>\n</li>\n</ul>\n<h2 id=\"您将学到什么？\"><a href=\"#您将学到什么？\" class=\"headerlink\" title=\"您将学到什么？\"></a>您将学到什么？</h2><p>本书分为四个部分：</p>\n<ul>\n<li><p>在“入门”部分中，您将学习Shiny的基础知识，以便尽快上手。您将了解应用程序结构的基础知识、有用的UI组件和反应式编程的基础。</p>\n</li>\n<li><p>“Shiny实战”部分建立在基础知识之上，帮助您解决常见问题，包括向用户提供反馈、上传和下载数据、使用代码生成UI、减少代码重复和使用Shiny来编程tidyverse。</p>\n</li>\n<li><p>在“掌握反应性”部分中，您将深入了解反应式编程的理论和实践，这是Shiny的基础编程范式。如果您是现有的Shiny用户，那么您将从本章中获得最大的价值，因为它将为您提供坚实理论基础，使您能够创建专门针对您问题的新工具。</p>\n</li>\n<li><p>最后，“最佳实践”部分中，我们将对使您的Shiny应用程序在生产环境中运行良好的实用技术进行调查。您将学习如何将复杂的应用程序分解为函数和模块、如何使用包来组织您的代码、如何测试您的代码以确保它是正确的，以及如何衡量和改进性能。</p>\n</li>\n</ul>\n<h2 id=\"您不会学到什么？\"><a href=\"#您不会学到什么？\" class=\"headerlink\" title=\"您不会学到什么？\"></a>您不会学到什么？</h2><p>本书的重点是制作有效的Shiny应用程序并理解反应性的底层理论。我将尽最大努力展示数据科学、R编程和软件工程的最佳实践，但您需要其他参考资料来掌握这些重要的技能。如果您喜欢本书中的写作风格，您可能会喜欢我的其他关于这些主题的书籍：R for Data Science、Advanced R和R Packages。</p>\n<p>还有一些特定于Shiny的重要主题，本书没有涵盖：</p>\n<ul>\n<li><p>本书只涵盖了内置的用户界面工具包。这并不能提供最吸引人的设计，但很容易学习并能让您走很长一段路。如果您有额外的需求（或者只是对默认值感到厌倦），还有许多其他包可以提供替代的前端。</p>\n</li>\n<li><p>Shiny应用程序的部署。将Shiny“投入生产”超出了本书的范围，因为这因公司而异，并且很多与R无关（大部分挑战往往是文化或组织性的，而不是技术性的）。如果您是Shiny的新手，我建议您从Joe Cheng的2019 rstudio::conf主题演讲开始：<a href=\"https://rstudio.com/resources/rstudioconf-2019/shiny-in-production-principles-practices-and-tools/\">https://rstudio.com/resources/rstudioconf-2019/shiny-in-production-principles-practices-and-tools/</a>。这将为您提供大致情况，讨论将Shiny投入生产需要什么以及如何克服您可能面临的一些挑战。完成此操作后，请参阅<a href=\"https://rstudio.com/products/connect/\">RStudio Connect网站</a>以了解RStudio为您公司内部部署应用程序的产品以及<a href=\"https://shiny.rstudio.com/articles/#deployment\">Shiny 官网</a>了解其他常见的部署场景。</p>\n</li>\n</ul>\n<h2 id=\"先决条件\"><a href=\"#先决条件\" class=\"headerlink\" title=\"先决条件\"></a>先决条件</h2><p>在继续之前，请确保您具备本书所需的所有软件：</p>\n<p>R：如果您还没有安装R，那么您可能读错了书；本书假定您对R有一定的了解。如果您想学习如何使用R，我建议阅读我的《<a href=\"https://r4ds.had.co.nz/\">R for Data Science</a>》一书，该书旨在让您轻松上手R。</p>\n<p>RStudio：RStudio是一个免费且开源的R集成开发环境（IDE）。虽然您可以使用任何R环境（包括R GUI和<a href=\"http://ess.r-project.org/\">ESS</a>）来编写和使用Shiny应用程序，但RStudio具有一些专门用于编写、调试和部署Shiny应用程序的不错功能。我们建议您尝试一下，但这不是成功使用Shiny或本书所必需的。您可以从<a href=\"https://www.rstudio.com/products/rstudio/download\">https://www.rstudio.com/products/rstudio/download</a>下载RStudio Desktop。</p>\n<p>R软件包：本书使用了很多R软件包。您可以通过运行以下代码一次性安装它们：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span></span><br><span class=\"line\">  <span class=\"string\">&quot;gapminder&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;ggforce&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;gh&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;globals&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;openintro&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;profvis&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">  <span class=\"string\">&quot;RSQLite&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;shiny&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;shinycssloaders&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;shinyFeedback&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">  <span class=\"string\">&quot;shinythemes&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;testthat&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;thematic&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;tidyverse&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;vroom&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">  <span class=\"string\">&quot;waiter&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;xml2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;zeallot&quot;</span> </span><br><span class=\"line\"><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"编程","path":"api/tags/编程.json"},{"name":"Shiny入门系列","path":"api/tags/Shiny入门系列.json"}]},{"title":"某某动物与人类基因组的相似性高达x%？——是时候改变这种丈二和尚的说法了","slug":"某某动物与人类基因组的相似性高达x-？——是时候改变这种丈二和尚的说法了","date":"2023-08-06T09:45:29.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/某某动物与人类基因组的相似性高达x-？——是时候改变这种丈二和尚的说法了.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><h2 id=\"缘由\"><a href=\"#缘由\" class=\"headerlink\" title=\"缘由\"></a>缘由</h2><p>网络上随处可见“某物种与人类的基因相似度高达x%”的说法。刚来P公司的时候F博曾问起过此事，初闻摸不着头脑，因为根本就不清楚说的是哪方面的相似性，讨论后一致认为这样的说法不合理。前几天需要制作一个宣传视频，F博又找我谈起了斑马鱼和人类基因的关系，为了严谨，我去查了发表斑马鱼基因组的原文，发现文中所用的描述根本就不是<code>相似性</code>。责任心治好了我的懒病，不如写一篇短文来澄清一下这种说法。</p>\n<h2 id=\"认识同源性和一致性\"><a href=\"#认识同源性和一致性\" class=\"headerlink\" title=\"认识同源性和一致性\"></a>认识同源性和一致性</h2><p>要掰扯清楚所谓的这个相似性，需要搞明白两个概念：<code>同源性</code>和<code>一致性</code>。二者均指的是基因之间的比较。</p>\n<p><strong>同源性</strong>：同源性是指在进化过程中源于同一祖先的分支之间的关系，包括直系同源和旁系同源。直系同源基因指的是在不同物种中来自于共同祖先的基因（就是老祖宗传下来的，给到了不同的物种），而旁系同源基因指的是在同一物种内由于基因复制而产生的同源基因（基因复制现象常有）。同源性只能谈有无，不能说高低，它是<code>质</code>而不是<code>量</code>。举个简单的例子，在做blast序列比对的时候，两条序列比对上了，且coverage比较高，我们就认为二者之间有同源性。我们通常会用一些软件对多个基因组进行同源蛋白家族聚类，说的就是这个同源性。</p>\n<p><strong>一致性</strong>：最常被翻译成相似性，blast比对的出来的<code>identity</code>描述的就是一致性，可以评判两个基因之间的序列相似性。</p>\n<h2 id=\"为何不能直接说“两个基因组的相似性”？\"><a href=\"#为何不能直接说“两个基因组的相似性”？\" class=\"headerlink\" title=\"为何不能直接说“两个基因组的相似性”？\"></a>为何不能直接说“两个基因组的相似性”？</h2><p>不论是同物种还是异种比较，实际上我们比较的是基因，而非把整个染色体拿来比（共线性分析不在此讨论）。对于两个物种而言，部分基因仅存在于物种A中，部分基因仅存在于物种B中。这两部分基因是没有办法做比较的。</p>\n<p>如要比较两个基因组的相似性，我们通常会用平均核苷酸一致性（ANI）或平均氨基酸一致性（AAI）来评估，ANI和AAI的计算方法很简单，可以去网上查。注意，这里只计算两个基因组都含有的基因。实际上不适合于物种跨度大的对象之间的比较，因为它们之间本就没有多少同源基因。</p>\n<p>实际上网传的动物与人基因组的相似性指的是<code>同源基因占所有基因数量的比例</code>。即人类基因组中有x%的基因在某某动物中存在同源基因，至于这些同源基因的ANI是多少需要另外计算。</p>\n<h1 id=\"几个例子\"><a href=\"#几个例子\" class=\"headerlink\" title=\"几个例子\"></a>几个例子</h1><h2 id=\"小鼠-vs-人\"><a href=\"#小鼠-vs-人\" class=\"headerlink\" title=\"小鼠 vs. 人\"></a>小鼠 vs. 人</h2><p><strong>文献</strong>：<a href=\"https://www.nature.com/articles/nature01262\">Initial sequencing and comparative analysis of the mouse genome</a></p>\n<p><strong>杂志</strong>：2002年12月5日，《Nature》</p>\n<ul>\n<li><p>Over 90% of the mouse and human genomes can be partitioned into corresponding regions of conserved synteny, reflecting segments in which the gene order in the most recent common ancestor has been conserved in both species.</p>\n</li>\n<li><p>超过90%的小鼠和人类基因组可以划分为保守共生的对应区域，反映了最近共同祖先的基因顺序在两个物种中都保守的片段。</p>\n</li>\n<li><p>At the nucleotide level, approximately 40% of the human genome can be aligned to the mouse genome. These sequences seem to represent most of the orthologous sequences that remain in both lineages from the common ancestor, with the rest likely to have been deleted in one or both genomes.</p>\n</li>\n<li><p>在核苷酸水平上，大约40%的人类基因组可以比对到小鼠的基因组。这些序列似乎代表了来自共同祖先的两个谱系中保留的大部分直系同源序列，其余的可能在一个或两个基因组中被删除。</p>\n</li>\n<li><p>The proportion of mouse genes with a single identifiable orthologue in the human genome seems to be approximately 80%. The proportion of mouse genes without any homologue currently detectable in the human genome (and vice versa) seems to be less than 1%.</p>\n</li>\n<li><p>大约80%的小鼠基因在人类基因组中具有单个可识别直系同源基因。目前小鼠中可检测到的在人类基因组中没有任何同源物的基因似乎不到1%。</p>\n</li>\n</ul>\n<h2 id=\"黑猩猩-vs-人\"><a href=\"#黑猩猩-vs-人\" class=\"headerlink\" title=\"黑猩猩 vs. 人\"></a>黑猩猩 vs. 人</h2><p><strong>文献</strong>：<a href=\"https://www.nature.com/articles/nature04072\">Initial sequence of the chimpanzee genome and comparison with the human genome</a></p>\n<p><strong>杂志</strong>：2005年9月1日，《Nature》</p>\n<p>Orthologous proteins in human and chimpanzee are extremely similar, with ∼29% being identical and the typical orthologue differing by only two amino acids, one per lineage.<br>人类和黑猩猩的直系同源蛋白非常相似，约29%是相同的，典型的直系同源蛋白仅相差两个氨基酸，每个谱系一个。</p>\n<h2 id=\"斑马鱼-vs-人\"><a href=\"#斑马鱼-vs-人\" class=\"headerlink\" title=\"斑马鱼 vs. 人\"></a>斑马鱼 vs. 人</h2><p><strong>文献</strong>：<a href=\"https://pubmed.ncbi.nlm.nih.gov/23594743/\">The zebrafish reference genome sequence and its relationship to the human genome</a></p>\n<p><strong>杂志</strong>：2013年4月25日，《Nature》</p>\n<p>Detailed automatic and manual annotation provides evidence of more than 26,000 protein-coding genes, the largest gene set of any vertebrate so far sequenced. Comparison to the human reference genome shows that approximately 70% of human genes have at least one obvious zebrafish orthologue.<br>在斑马鱼中注释到了超过26,000个蛋白质编码基因，这是迄今为止（2013年）测序的任何脊椎动物中最大的基因集。与人类参考基因组的比较表明，大约70%的人类基因至少有一个明显的斑马鱼直系同源物。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>从上述几个例子可以看出，原文描述的都是<font color=\"#FF0000\">同源基因数量，而不是所谓的相似性</font>。所以，以后再提及基因组之间的比较，一定要擦亮眼睛，看看彼得到底是什么。</p>\n<h1 id=\"关注我\"><a href=\"#关注我\" class=\"headerlink\" title=\"关注我\"></a>关注我</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n","raw":null,"categories":[{"name":"探讨","path":"api/categories/探讨.json"}],"tags":[{"name":"同源家族","path":"api/tags/同源家族.json"},{"name":"比较基因组学","path":"api/tags/比较基因组学.json"}]},{"title":"公众号9岁了——送给粉丝的话","slug":"公众号9岁了——送给粉丝的话","date":"2023-07-02T06:54:22.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/公众号9岁了——送给粉丝的话.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_1.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>从2014年6月10日发表的第一篇推文到现在，已经走过了9个年头，粉丝也过千了，1150个粉丝看起来少之又少，但对于一个由个人维护的公众号来说，足够了，人不在多，只要它能帮助到几位、几十位有需求的人就足够了。</p>\n<p>本号最初是我读博期间创建的。当时为了做实验室一项科研活动志愿者招募的宣传，需要有一个公众号，而实验室无法以组织身份申请公众号（无公章），因此我以个人身份申请后作为实验室相关活动宣传的窗口。当然，从建号开始到2021年7月，该号只用来发过数条通知，可谓长期处于休眠模式。当然也靠着实验室的宣传，本号积攒了小几百号粉丝。</p>\n<p>我自从2012年底就开始接触生物信息学，那时候学生信多靠自学（当然也少不了师兄的指点），经常需要在网络上查资料。各大博主分享的笔记、方法等对于生信菜鸟来说犹如一座灯塔。早年学生信的应该都知道“铁汉1990”的微博博客吧。那个时候我经常在网上找“大佬”解惑，如今，自己也称为了别人口中的“大佬”。</p>\n<p>逐渐成长之后，也想着去帮助更多的人。事实上，我也曾和水哥一起在武汉和南昌办过线下公益培训班，收到的反响不错，有不少人因此入门了生信，并且后续也在从事相关研究。然而，线下培训的受众毕竟是少数，后又遭遇疫情，线下培训更加困难。因此，我开始转战线上做一些原创分享，包括简书、优酷等各大平台都有投稿。但这些平台存在严格的审核机制，明明是绿色无害的内容，却总会被莫名其妙的屏蔽掉。</p>\n<p>2018年，我开始建个人网站，终于可以自由分享了。当然，网站需要被各大搜索引擎收录是一个漫长和复杂（SEO优化）的过程。换言之，如果没有被收录，网站文章在百度里是搜索不到的，自然无法被人看到。当然，网站现在已经被收录了，百度“了尘兰若的小坑”即可。</p>\n<p>2021年底，我发布声明，将微信公众号与原实验室脱钩（每个人只能申请一个公众号），开始正式发布原创文章。起初，只是在公众号中发布文章，并在自建的QQ群和微信群（群名：生信之巅）中分享，其弊端是粉丝只是小范围的人群。后来想到了通过个人网站引流，效果还不错。在此过程中，粉丝群体得到了洗牌，即初代粉丝大多取关，随之而来的是更加关注生信的粉丝的加入，至此，剩余的千余人粉丝基本上是内容导向的。</p>\n<h1 id=\"粉丝画像\"><a href=\"#粉丝画像\" class=\"headerlink\" title=\"粉丝画像\"></a>粉丝画像</h1><p>那么，是时候梳理一下粉丝画像了。</p>\n<h2 id=\"粉丝地理分布\"><a href=\"#粉丝地理分布\" class=\"headerlink\" title=\"粉丝地理分布\"></a>粉丝地理分布</h2><p>粉丝数排名前7的省市分别是：湖北、广东、北京、江苏、山东、上海、浙江。这一定程度上反映出在这些省份从事与我类似生信研究领域的同行比较多。湖北和广东是我待的比较久的城市，粉丝数也最多，不清楚是否是巧合。有意思的是京城的粉丝数竟然排第三。第四到第七可谓都是东部沿海城市。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"粉丝地理分布\"></p>\n<h2 id=\"粉丝年龄分布\"><a href=\"#粉丝年龄分布\" class=\"headerlink\" title=\"粉丝年龄分布\"></a>粉丝年龄分布</h2><p>总体来说年轻粉丝（&lt;&#x3D;35岁）比较多，尤其是18-25岁的群体，表明越来越多的年轻人正在或者已经踏入生信领域，是一股不可忽视的新生力量。不可思议的是有2.96%的大龄粉丝，生信在国内起步相对较晚，对于46-60岁这部分的粉丝群体，生信应该是一个新事物。还记得当年在南昌培训的时候，一位老教师（估计60岁左右）对着电脑在很认真的操作，并不断地提出问题，这种精神非常令人钦佩。其实，他大可不必，完全可以让学生来学习就好了。他真的是用实践做到了“活到老，学到老”。向以这位老教师为代表的大龄粉丝致敬。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"粉丝年龄分布\"></p>\n<h2 id=\"粉丝性别分布\"><a href=\"#粉丝性别分布\" class=\"headerlink\" title=\"粉丝性别分布\"></a>粉丝性别分布</h2><p>粉丝基本上处于男女平衡，男性略多（高11.21%）。表明推文内容在性别上的无偏性。当然，还存在0.72%的没有站队的粉丝。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_3.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_3.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"粉丝性别分布\"></p>\n<h2 id=\"粉丝语言分布\"><a href=\"#粉丝语言分布\" class=\"headerlink\" title=\"粉丝语言分布\"></a>粉丝语言分布</h2><p>不出意外，简体中文占比最高。还有使用繁体中文的同胞粉。我很好奇1.79%的英文粉丝是如何看推文内容的，也会用软件translate一下吗？</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_4.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_4.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"粉丝语言分布\"></p>\n<h2 id=\"终端分布\"><a href=\"#终端分布\" class=\"headerlink\" title=\"终端分布\"></a>终端分布</h2><p>顾名思义，就是粉丝用的哪种手机系统。安卓系统粉丝数最多，这应该也与安卓的市场份额大有关吧，当然用苹果的也不在少数，就是不知道微信公众平台什么时候能把咱们的鸿蒙系统也统计进来。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_5.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_5.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"终端分布\"></p>\n<h2 id=\"常读用户数变化\"><a href=\"#常读用户数变化\" class=\"headerlink\" title=\"常读用户数变化\"></a>常读用户数变化</h2><p>虽然有千余号粉丝，但常读人数却不多，这可能与我少更新有关。好在从近几个月的趋势来看，常读用户数在稳步增多，最近的涨粉速度也还可以。不过，还是那句话，对于一个个人公众号来说，能帮助到那么几个人也就够了，毕竟我不靠这个盈利。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_6.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/85ad_6.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"常读用户数变化\"></p>\n<h1 id=\"关于盈利\"><a href=\"#关于盈利\" class=\"headerlink\" title=\"关于盈利\"></a>关于盈利</h1><p>穷的时候，也不是没想着通过公众号来盈利。我没有深入研究过。据我所知，大概有几种盈利方式：</p>\n<p><strong>（1）内容付费</strong>，即推文的前部分可以免费阅读，后面的精彩部分需要付费阅读。在知识付费的时代，这是合情合理的，无可厚非。我支持这种方式，但是我没有采用。</p>\n<p><strong>（2）接入广告</strong>，也就是在内容中间插入一些广告，或者带货链接。这种方式不影响读者阅读内容，我目前采用的就是该方式。每个月可以赚到两三毛钱。</p>\n<p><strong>（3）合作卖课</strong>，也有一些人找到我要合作，即通过我来卖他们的生信培训课，提成还是挺可观的。但是我无法掌握其课程质量如何（没有时间去检查），因此，目前也是没有接类似的活。</p>\n<p><strong>（4）粉丝打赏</strong>，这是比较神奇的事情，不是钱的问题，是来自于粉丝的肯定。2021年12月女朋友赞赏了5元；2022年4月同校（HZAU）的张胜利赞赏10元；2023年6月网名“遠空”的粉丝赞赏5元。</p>\n<p><strong>总之</strong>，本号的定位就不是为了盈利，单纯的分享罢了。想挣大钱，还是要认认真真学习，踏踏实实工作。</p>\n<h1 id=\"给新手的建议\"><a href=\"#给新手的建议\" class=\"headerlink\" title=\"给新手的建议\"></a>给新手的建议</h1><p><strong>（0） 自己领域的生物学背景要扎实</strong><br>生信一定离不开生物学，所以做生信要做到博学，最起码将自己领域的生物学学到位，不然，数据摆到面前也看不懂。</p>\n<p><strong>（1）基本功要扎实</strong><br>生信躲不开学习LINUX系统、编程（Perl&#x2F;Python二选一）、R语言，不要迷恋各种云平台，真正想做前沿的东西，还是要靠自己。</p>\n<p><strong>（2）要有耐心</strong></p>\n<p>大多数软件都有官方的说明书，要扎下心去阅读，只有在自己啃不透的情况下再去问大佬，如对某些参数把握不准的时候。当然，有些软件开发者确实很懒，不写文档。</p>\n<p><strong>（3）善用网络教程</strong></p>\n<p>现在网上教程有很多，多去查一下资料，跟着教程进行练习，要认真仔细地跟着教程来，经常是一个空格或者符号的错误就会导致结果重复不出来。这种小错误往往是新手最容易犯的。</p>\n<p><strong>（4）提问的技巧</strong></p>\n<p>我常年混迹于各种生信群里，发现很多人提问题，却很少有人回答。问题的关键在于提问者没有描述好问题，即群友们看不懂你问的是什么。大家都很忙，没有时间和你交流把问题本身搞清楚。所以提问前自己要把问题描述清楚，附上自己的运行代码以及报错信息，最好是附上示例数据集。</p>\n<p><strong>（5）要有信心</strong></p>\n<p>前两天有粉丝在和我交流的过程中一直无法解决遇到的问题，进而说自己愚钝。我是不赞成的，在面对一个新领域的时候，我们都会感到束手无策。我相信都读到研究生阶段了，没有一个不聪明的。问题的关键在于不要怕出错，也不要怕在解决问题的过程中花费了多少时间，每解决一个问题都在促进我们的成长。所以，打起精神，持续钻研，终有一天再回首，哪些坎坎坷坷也会成为人生靓丽的风景。</p>\n<p><strong>（6）保持学习</strong></p>\n<p>在技术爆发的时代，一天不学习，感觉就要被时代抛弃。这一点在生信领域尤其明显。各种组学层出不穷，新技术、新手段、新方法、新算法、新软件让人眼花缭乱。虽然不断学习看起来很辛苦，但这也暗示着生物信息依然火爆，生物信息与大数据及AI的碰撞在未来的数年乃至十年将会迸发出耀眼的火花。</p>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注“生信之巅”公众号和小程序。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n","raw":null,"categories":[{"name":"闲谈","path":"api/categories/闲谈.json"}],"tags":[{"name":"公众号","path":"api/tags/公众号.json"}]},{"title":"走向多标签分类：机器学习在微生物组研究中的下一步","slug":"走向多标签分类：机器学习在微生物组研究中的下一步","date":"2023-05-28T07:30:13.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/走向多标签分类：机器学习在微生物组研究中的下一步.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_1.PNG","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p><code>微生物组</code>分析描述了复杂微生物群落的动态特征，从而为研究微生物图谱与人类疾病[1–3]之间的关系提供了机会。</p>\n<p><code>机器学习</code>（ML）算法揭示了不同状态下微生物组特征的独特模式，从而促进了基于微生物组的疾病检测和治疗[8–10]。作为机器学习的一项重要技术，监督分类已被广泛应用于<code>炎症性肠病（IBD）</code>[11,12]、<code>癌症</code>[13,14]、<code>糖尿病</code>[15]、<code>牙龈炎</code>[16,17]等疾病的预测。</p>\n<p>通过使用来自患者及其健康对照的分类学或功能轮廓作为训练数据来构建分类器和模型，ML分类器可据此推断新样本的状态（健康&#x2F;疾病）。此外，一些ML方法，如<font color=#FF0000>支持向量机（SVM）[20]和随机森林（RF）[21]，可以进一步衡量模型训练过程中每个特征的重要性，这可以识别对分类[2,22,23]有重要贡献的微生物生物标志物。</font></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_1.PNG\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_1.PNG\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图1 单标签分类与多标签分类的比较。 a.单标签分类要求一个样本有一个标签（状态）。 b.多标签分类可以检测到每个样本的多个状态。\"></p>\n<p>为了清楚地了解微生物和健康状态之间的相互作用，以前的研究队列总是设计得很好，其中<u>一个样本只有一个描述其健康状态的精确标签</u>，例如一个样本要么是健康，要么与一种确定的疾病相关（图1a）。然而，这种策略<u>在实际和临床应用中存在其局限性，因为一个患者可能有多个标签（多种疾病，也表示为并发症或共病；图1b）</u>。在这种情况下，常规的分类器不能很好地进行预测，这可能会受到多种疾病的协同作用和相互作用的显著干扰。更重要的是，由于预测结果中只出现单一标签（例如特定疾病），<font color=#FF0000>单标签ML模型[2,22]总是遗漏或忽略共病或并发症</font>。</p>\n<p>这项工作总结了微生物组研究的典型和经典的机器学习方法，并利用美国肠道项目数据集证明了它们在疾病识别方面的局限性。然后，我们希望利用一系列有前途的<code>多标签分类</code>[25–28]策略来进一步解决上述问题。最后，提出并讨论了将多标签分类应用于微生物识别疾病检测的一些关键技术问题。</p>\n<h2 id=\"微生物组研究中的单标签分类\"><a href=\"#微生物组研究中的单标签分类\" class=\"headerlink\" title=\"微生物组研究中的单标签分类\"></a>微生物组研究中的单标签分类</h2><p>在这里，我们回顾了常用的单标签分类方法，包括逻辑回归、支持向量机、k最近邻、随机森林、梯度增强树和神经网络（表1）。</p>\n<p><strong>表 1</strong> 广泛用于基于微生物组疾病检测的机器学习方法特征</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">ML approach</th>\n<th align=\"left\">Feature importance measurement</th>\n<th align=\"left\">Interpretability</th>\n<th align=\"left\">Package and applicable programming language</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">LR</td>\n<td align=\"left\">Y</td>\n<td align=\"left\">Excellent</td>\n<td align=\"left\">Scikit-learn (Python)[33]</td>\n</tr>\n<tr>\n<td align=\"left\">SVM</td>\n<td align=\"left\">Y</td>\n<td align=\"left\">Good</td>\n<td align=\"left\">Scikit-learn (Python), LibSVM(Python&#x2F;R&#x2F;Java)[34]</td>\n</tr>\n<tr>\n<td align=\"left\">k-NN</td>\n<td align=\"left\">N</td>\n<td align=\"left\">Weak</td>\n<td align=\"left\">Scikit-learn (Python)</td>\n</tr>\n<tr>\n<td align=\"left\">RF</td>\n<td align=\"left\">Y</td>\n<td align=\"left\">Good</td>\n<td align=\"left\">Scikit-learn (Python) randomForest (R) [35]</td>\n</tr>\n<tr>\n<td align=\"left\">GBDT</td>\n<td align=\"left\">Y</td>\n<td align=\"left\">Good</td>\n<td align=\"left\">Xgboost (Python&#x2F;R&#x2F;C++) [36,37] Lightgbm (Python&#x2F;R&#x2F;C++) [38] Catboost Python&#x2F;R&#x2F;C++) [39]</td>\n</tr>\n<tr>\n<td align=\"left\">Neural Networks</td>\n<td align=\"left\">N</td>\n<td align=\"left\">Weak</td>\n<td align=\"left\">Tensorflow (Python&#x2F;Java) [40] PyTorch (Python) [41] Keras (Python) [42]</td>\n</tr>\n</tbody></table>\n<p> <code>逻辑回归</code>（Logistic regression，LR）是一种典型的二元分类线性模型，它利用逻辑函数对二元变量建模[43]。基本上，它计算了一个特定事件发生的概率，例如，一个微生物组样本是健康的或疾病的。由于其在效率和可解释性方面的优势，它通常被用作基于微生物识别的疾病检测的基准[9,44]，尽管其性能不如其他方法。</p>\n<p> 与LR不同，<code>支持向量机</code>（SVM）捕获微生物组谱和宿主状态的<code>非线性关联</code>，以最大限度地提高健康和疾病样本之间的边际[20]，这获得了比LR更好的性能。值得注意的是，LR和SVM作为二值分类器，<strong>也可以通过为每种疾病分配一个各自的分类器扩展为多类别分类器</strong>。</p>\n<p><code>最近邻</code>（k-NN）直接用它的k个最近邻来标记一个新的样本[45]。k-NN的一个关键问题是如何通过基于几何的距离度量，如Bray-Curtis、JSD、JCCARD[47]或基于系统发育的算法，如UniFrac [48]或Meta-Storms[49]，适当地测量微生物组之间的邻域（neighborship）[46]。</p>\n<p>最近，一种基于搜索的策略采用微生物组搜索引擎（MSE）[50]，通过离群新颖性评分将不健康的微生物组与健康的微生物组分离，然后通过基于系统发育距离的k-NN识别其详细的疾病类型，在灵敏度、鲁棒性和速度方面优于传统的ML实现[51]。</p>\n<p>为了进一步提高微生物组疾病检测的性能，通过集成单个ML方法，开发了集成分类方法[52,53]。<code>随机森林</code>（RF）作为一个集成分类器，通过在训练数据中随机选择样本和特征，构建多个决策树，然后通过投票组合新样本的预测状态[2,8,9,21]。与RF不同的是，<code>梯度增强决策树</code>（GBDT）为每个微生物组样本赋权重，以阶段方式构建树状模型，然后迭代更新参数以最小化估计误差[56]。<u>RF和GBDT不仅在精度上优于单个ML方法，而且还可以评价每种微生物特征对分类的贡献[22,23]</u>。</p>\n<p>在传统的ML中，从输入数据中提取特征是准确性和敏感性的基础，例如，选择在疾病发展过程中作为签名的生物标志物物种，而这种过程总是需要人工努力[57]。<code>深度学习</code><u>自动进行特征提取，并以端到端的方式训练深度神经网络[58]，这可以缓解微生物群落的复杂性所带来的高维性</u>。神经网络（如深度神经网络（DNNs）[59]、递归神经网络（RNNs）[60]、卷积神经网络（CNNs）[61]等）已成功地从图像分析过渡到微生物组研究。在计算机视觉中，CNNs对相邻像素进行卷积运算，生成新的变量。然而，微生物之间的邻居关系在一个群落中并没有得到明确的定义。因此，<font color=#FF0000>Sharma等人[62]开发了一种基于CNNs的新方法，通过分层方法将OTUs分组到门簇中（phylum clusters）。Lo等人[63]还以负二项分布对微生物组谱建模，并解决了CNNs中的数据增强技术的过拟合问题。</font></p>\n<h2 id=\"在真实微生物组数据集上的单标签分类的局限性\"><a href=\"#在真实微生物组数据集上的单标签分类的局限性\" class=\"headerlink\" title=\"在真实微生物组数据集上的单标签分类的局限性\"></a>在真实微生物组数据集上的单标签分类的局限性</h2><p>为了衡量单标签分类器在处理具有多个标签的微生物组中的可行性，我们使用美国肠道项目[24]队列的一个子集进行了疾病检测（详见材料和方法）。从3433个健康宿主和10826例患者中收集了16S rRNA扩增子微生物组，记录了5种靶疾病，包括肠易激综合征（IBS）、自身免疫性、肺部疾病、偏头痛和甲状腺（表2）。对于每个目标疾病，微生物组样本被分为两组： i)<code>单一疾病组（SD）</code>，包含对照和仅与该目标疾病有关的样本；ii)<code>多疾病组（MD）</code>，包含对照和与该目标疾病和其他共病的样本。每组从健康样本中随机抽取对照，健康样本数等于疾病样本。我们实现了RF和GBDT的两个集成单标签分类器，分别使用每组的OTU水平谱来检测目标疾病。通过使用5倍交叉验证（详细的配置和参数见材料和方法）的AUC（受试者工作特征曲线下的面积）来评估性能。</p>\n<p><strong>表 2</strong> 目标疾病样本总览</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Target disease</th>\n<th align=\"left\">Total number of disease samples</th>\n<th align=\"left\">Number of single-disease samples</th>\n<th align=\"left\">Number of comorbidities samples</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">IBS</td>\n<td align=\"left\">2351</td>\n<td align=\"left\">1064</td>\n<td align=\"left\">1287</td>\n</tr>\n<tr>\n<td align=\"left\">Autoimmune</td>\n<td align=\"left\">2301</td>\n<td align=\"left\">487</td>\n<td align=\"left\">1814</td>\n</tr>\n<tr>\n<td align=\"left\">Lung disease</td>\n<td align=\"left\">2251</td>\n<td align=\"left\">1248</td>\n<td align=\"left\">1003</td>\n</tr>\n<tr>\n<td align=\"left\">Migraine</td>\n<td align=\"left\">2109</td>\n<td align=\"left\">938</td>\n<td align=\"left\">1171</td>\n</tr>\n<tr>\n<td align=\"left\">Thyroid</td>\n<td align=\"left\">1814</td>\n<td align=\"left\">559</td>\n<td align=\"left\">1255</td>\n</tr>\n<tr>\n<td align=\"left\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_2.PNG\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_2.PNG\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图2 通过无分布独立性试验，从SD和MD中选择自身免疫性疾病的微生物生物标志物\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>结果如表3所示，<u>在检测单个疾病组中检测目标疾病时，SD训练的分类器优于MD</u>，这主要是由于消除了共病微生物群模式的额外变化。另一方面，<u>MD训练的分类器在多疾病样本上优于SD训练</u>。然后，我们进一步解剖了SD和MD之间的微生物生物标记物和ML模型，得到了这些结果。对自身免疫样本的无分布检验显示[64,65]，从SD中选择的生物标志物与MD共享（图2；在属水平上进行了分类注释；详见材料与方法）。然而，由GBDT二值分类器构建的决策树与由MD构建的决策树有很大的不同(图3；例如，MD树中节点之间的结构和相互作用更加复杂），暗示了单一疾病与多种疾病之间的微生物相互作用的变化。因此，<font color=#FF0000>在实际情况下，ML模型的设计和构建应考虑共病对微生物群的影响。值得注意的是，虽然目标疾病检测的精度可以得到优化，但这两种单标签ML分类器都不能检测出目标疾病以外的共病或并发症。</font></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_t3.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_t3.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"表3 单标签分类器对目标疾病检测的检测结果\"><br><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_3.PNG\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_3.PNG\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图3 由SD （A）构建的GBDT二值分类器的决策树比由MD （B）构建的更为复杂在每个树中，内部节点代表属级上的分类群，叶节点代表标签，分支权重代表决策的标准\"></p>\n<h2 id=\"多标签分类：为微生物组的机器学习向前迈进了一步\"><a href=\"#多标签分类：为微生物组的机器学习向前迈进了一步\" class=\"headerlink\" title=\"多标签分类：为微生物组的机器学习向前迈进了一步\"></a>多标签分类：为微生物组的机器学习向前迈进了一步</h2><p>与单标签ML分类器（图1a)不同，多标签分类允许每个样本具有多个状态（标签；图1b)。对于一个样本（患者），将多标签分类引入基于微生物组的疾病检测中，自然会可能有多种标签（共病或并发症）。本文介绍了两种多标签分类方案：<code>算法自适应</code>（algorithm adaption）和<code>问题变换</code>（problem transformation）[27]。</p>\n<p><code>算法自适应</code>通过直接修改单标签分类器来处理多标签数据。例如，ML-kNN（多标签k-最近邻）结合了k-NN和贝叶斯规则来确定一个新的样本的标签集[66]。另一个例子是一个名为C4.5的决策树算法 [67]，它使叶子代表一组标签，并修改类似熵的函数[68]，用于多标签分类。近年来，一种基于多项数据非参数预测推理模型的新的ML-DT（多标签决策树）算法，利用精确概率[69]实现了鲁棒性能。</p>\n<p><code>问题转换</code>通过二进制相关性、校准的标签排序或类链（ calibrated label ranking or class chains），将多标签问题转换为单标签问题。<code>二元相关性</code>基于一种一对一的策略，该策略将m个（m &gt; 1）标签转换为单独的m个二值分类问题，并通过二值分类器确定每个标签。虽然它提供了一个简单而有效的解决方案，<u>但二元相关性忽略了标签之间可能的相关性，从而导致错误的结果[70]</u>。为了解决该问题，<code>校准标签排序</code>通过考虑成对标签的相关性，构造m*(m-1)&#x2F;2二进制分类，将m个标签分类转换为标签排序问题[71]。因此，每个标签都由m-1个二值分类器进行投票表决。此外，还可以利用m-1二分类器的投票概率作为特征，训练新的二分类器，进一步提高性能。此外，一个标签可能依赖于其他一些标签，例如，心血管疾病的诊断和治疗与IBD [72]的标签有关。在这种情况下，将依赖标签作为二值分类器的特征的类链将是一个理想的选择[73]。</p>\n<h2 id=\"基于微生物组的疾病检测的多标签分类的关键技术问题\"><a href=\"#基于微生物组的疾病检测的多标签分类的关键技术问题\" class=\"headerlink\" title=\"基于微生物组的疾病检测的多标签分类的关键技术问题\"></a>基于微生物组的疾病检测的多标签分类的关键技术问题</h2><p><font color=#FF0000>由于其数据复杂性高、数据异质性和微生物-疾病相互作用，完善的多标签分类方法在处理微生物组数据集方面也存在不足</font>。在过去的几年中，已经研究和报道了数百种微生物组-疾病之间的相互作用，例如，<u>Disbiome数据库[74]收集了372种疾病和1622种微生物之间的10,934种经实验验证的微生物-疾病关联</u>。一个普遍的挑战是，如此多的标签可能会导致意想不到的高计算成本（图4a）。例如，为了训练一个100标签分类模型（一个样本含有100种疾病中的多种疾病），二值相关方法（binary relevance approach）需要100个二值分类器，校准标签排名（calibrated label ranking）需要多达4950个分类器。最近，<code>嵌入方法</code>，如SLEEC（Sparse Local Embeddings for Extreme Classification，稀疏局部嵌入的极端分类）算法[75]被提出以应对多标签挑战。它将标签投影到低维空间向量中，为每个标签构建一个回归，并通过压缩技术对预测的标签进行解码。为了拟合大规模的数据集，SLEEC在投影步骤之前使用无监督的k-means算法将训练数据划分为几个更小的子集。但是，由于忽略了标签信息，预分割可能会影响后续投影的质量。因此，通过使用<code>图嵌入算法</code>（graph embedding algorithm）[76]和一种<code>自适应特征聚合技术</code>，如 DEFRAG（Daptive Extreme FeatuRe AGglomeration，适应的极端特征）[77]，结合特征向量和标签信息，进一步改进了嵌入方法。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_4.PNG\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/801d_4.PNG\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图4 多标签分类中的三个关键技术问题。 a.在训练数据中使用太多的标签会导致意想不到的高计算成本。 b.缺少的标签会降低检测的灵敏度。 c.模糊的标签会引入假阳性结果\"></p>\n<p><font color=#FF0000>标签缺失是多标签分类化中的另一个常见问题（图4b）</font>。在美国肠道项目队列中，一些多疾病样本可能因临床检查不充分而被错误地归入SD，使元数据中产生某些疾病的“阴性”或“未提供”记录。这种标签缺失也可能发生在多标签分类结果中，因为在同时检测多个状态的结果时灵敏度较低。本文介绍了<u><code>基于图</code>（ graph-based）的方法和<code>低秩</code>（ low-rank）方法两种替代方法来提高灵敏度</u>。基于图的方法估计来自标签特定图（ label-specific graph）[78]或标签向量（label vectors）[79]的综合标签。低秩方法将多标签学习定义为一个包含边信息[80]的矩阵补全问题，可以通过经验风险最小化框架（empirical risk minimization framework）[81]进行估计，以避免标签缺失。</p>\n<p><font color=#FF0000>在现实世界中，疾病元数据可能是基于宿主的个人经验或其他不可靠的结论，而没有得到临床诊断或来自医疗专业人员的确认。训练数据中这种不明确的标签（图4c）可能会引入假阳性结果</font>。部分多标签方法可以消除由模糊或错误的标签造成的错误，主要是通过<u>保持每个候选标签[82]的置信度值</u>。根据置信值的计算方法，部分多标签方法一般分为<code>两阶段</code>（two-stage）方法和<code>端到端学习</code>（end-to-end learning）方法。<code>两阶段方法</code>通过迭代标签传播（propagation）来估计每个样本的候选标签的置信度，然后使用具有高置信度[83]的可信标签来训练多标签分类器。然而，<u>由于消除歧义不足，这个简单的概念很容易出错</u>。与分离置信度估计（ separating confidence estimation）和分类器构建分为两个阶段不同，<code>端到端方法</code><u>将置信度值视为模型训练函数[82,84,85]的权值，并通过将两个阶段合并成一个统一的框架来增强标签的歧义消除</u>。</p>\n<h2 id=\"讨论\"><a href=\"#讨论\" class=\"headerlink\" title=\"讨论\"></a>讨论</h2><p><font color=#FF0000>ML分类器还没有有效地考虑到微生物之间的相互作用</font>。尽管来自单一疾病和共病的生物标志物分数相似（图1），但它们在GBDT决策树中的层次是高度多样化的（图2），可能是由微生物之间的不同相互作用指导的。近年来，微生物在各种生态系统中的共现或相关性得到了广泛的研究[86-89]，从生物学的角度调查了微生物与微生物之间的相互作用。然而，<u>如何有效地将这些生物信息整合到ML分类器中仍然是[22,90]进一步工作的一个开放问题</u>。</p>\n<p><font color=#FF0000>少有研究致力于在微生物组研究中关注ML模型的可解释性，但其对解释疾病预测结果有意义</font>。在单标签分类方法中，逻辑回归具有最好的可解释性和最低的性能，而NNs则相反。虽然RF和GBDT也输出特征的重要性，但计算过于粗糙，无法进行进一步的因果解释。先进的统计方法，如<u>单指数模型（single index model），它将建模的灵活性和（线性）系数[91,92]的可解释性相结合，可能为平衡可解释性和性能提供了一个潜在的解决方案</u>。同时，宿主在年龄、性别、饮食、生活方式等因素上的异质性[93]，以及微生物组数据的稀疏性、方差和高维（high-dimensionality）[94]也会混淆疾病的检测和解释，这在实验设计和ML分析中应进行评估和考虑。</p>\n<h2 id=\"材料与方法\"><a href=\"#材料与方法\" class=\"headerlink\" title=\"材料与方法\"></a>材料与方法</h2><h3 id=\"实验设计和数据集\"><a href=\"#实验设计和数据集\" class=\"headerlink\" title=\"实验设计和数据集\"></a>实验设计和数据集</h3><p>美国肠道项目队列包含29,344名受试者，其中包括15,799名健康对照者和13,545名患者。每个受试者的疾病状态均来自基于问卷的原始元数据，该元数据包括饮食、健康状况和卫生等信息。从Qiita [95]下载肠道微生物群的16S rRNA OTU profiles，使用GreenGenes13-8数据库[96]使用Parallel-META 3[31]获取属水平的分类注释。通过序列计数直接计算OTU和属水平上的相对丰度，然后用PICRUSt 2 [97]的16S rRNA基因拷贝数进行归一化。我们还删除了没有微生物组样本的受试者。</p>\n<p>如果受试者在元数据中被记录为“由医疗专业人员（医生、医生助理）诊断”为特定的疾病，则被视为患者；如果将所有疾病标记为“我没有这种情况”，则被视为健康。最后，我们收集了3433份健康样本和10,826例患者的数据。对于每个目标疾病，选择微生物组样本并分为两组：单一疾病组（SD）包含对照和仅与目标疾病有关的样本；多疾病组（MD）包含对照和与目标疾病和其他共病有关的样本。每组从3433个健康样本中随机抽取对照样本，样本数与疾病样本相等。</p>\n<p>对于每个目标疾病，我们进行了两个实验。首先，我们评估了ML分类器在区分疾病样本和健康对照组方面的效果。采用SD组和MD组构建分类器模型。具体来说，通过SD组训练的模型检测SD样本时采用5倍交叉验证（其中随机选择80%的样本作为模型构建的训练集，其余20%作为验证的测试集）。同时，在每5次折叠中，我们还从MD组中随机选择相同数量的样本，在相同的SD测试集中训练另一个模型进行目标疾病检测。记录SD-训练模型和MD-训练模型的AUCs进行比较。其次，我们评估了ML分类器在检测MD组中的作用，并在之前的过程中分别由SD组和MD组构建模型。</p>\n<h3 id=\"机器学习方法和生物标志物的选择\"><a href=\"#机器学习方法和生物标志物的选择\" class=\"headerlink\" title=\"机器学习方法和生物标志物的选择\"></a>机器学习方法和生物标志物的选择</h3><p>采用<code>随机森林</code>和<code>GBDT</code>两种流行的集成单标签分类方法构建单标签分类器。随机森林是由Python中的“scikit-learn”包实现的，“树数”设置为500，而其他参数作为默认配置。GBDT是由Python中的“lightgbm”包实现的，参数为“learning rate”&#x3D; 0.02，“maximum tree depth”&#x3D;6，“number of boosted<br>trees”&#x3D; 1000，“maximum tree leaves”&#x3D; 64，“subsample ratio”&#x3D;0.8和“colsample_bytree”&#x3D;0.8。生物标记物分析采用对疾病和对照样本之间的基因水平丰度进行 distribution-free test（python中的“mvtpy”包），选择p值&lt;0.01的检验统计量Top 10 taxa作为生物标记物。</p>\n<h3 id=\"代码和数据可用性\"><a href=\"#代码和数据可用性\" class=\"headerlink\" title=\"代码和数据可用性\"></a>代码和数据可用性</h3><p>本工作中的所有数据集和代码都可以在<a href=\"https://github.com/BruceQD/Microbiome-based-disease-detection\">https:&#x2F;&#x2F; github.com&#x2F;BruceQD&#x2F;Microbiome-based-disease-detection</a>上找到，所有其他相关资料均可根据要求提供。</p>\n<h1 id=\"重要参考文献\"><a href=\"#重要参考文献\" class=\"headerlink\" title=\"重要参考文献\"></a>重要参考文献</h1><ul>\n<li>[1] Knight R et al. Best practices for analysing microbiomes. Nat Rev Microbiol 2018;16(7):410–22.</li>\n<li>[2] LaPierre N et al. MetaPheno: a critical evaluation of deep learning and machine learning in metagenome-based disease prediction. Methods 2019;166:74–82.</li>\n<li>[3] Su X et al. Method development for cross-study microbiome data mining: challenges and opportunities. Computational and Structural. Biotechnol J 2020</li>\n<li>[8] Namkung J. Machine learning methods for microbiome studies. J Microbiol 2020;58(3):206–16.</li>\n<li>[9] Topçuog˘lu BD et al. A framework for effective application of machine learning to microbiome-based classification problems. Mbio 2020;11(3).</li>\n<li>[10] Cammarota G et al. Gut microbiome, big data and machine learning to promote precision medicine for cancer. Nat Rev Gastroenterol Hepatol 2020.</li>\n<li>[11] Gevers D et al. The treatment-naive microbiome in new-onset Crohn’s disease. Cell Host Microbe 2014;15(3):382–92.</li>\n<li>[12] Halfvarson J et al. Dynamics of the human gut microbiome in inflammatory bowel disease. Nat Microbiol 2017;2:17004.</li>\n<li>[13] Wirbel J et al. Meta-analysis of fecal metagenomes reveals global microbial signatures that are specific for colorectal cancer. Nat Med 2019;25(4):679.</li>\n<li>[14] Poore GD et al. Microbiome analyses of blood and tissues suggest cancer diagnostic approach. Nature 2020;579(7800):567–74.</li>\n<li>[15] Bajaj JS et al. Linkage of gut microbiome with cognition in hepatic encephalopathy. Am J Physiol Gastrointest Liver Physiol 2012;302(1): G168–75.</li>\n<li>[16] Huang S et al. Predictive modeling of gingivitis severity and susceptibility via oral microbiota. ISME J 2014;8(9):1768–80.</li>\n<li>[17] Huang S et al. Longitudinal multi-omics and microbiome meta-analysis identify an asymptomatic gingival state that links gingivitis, periodontitis, and aging. mBio 2021;12(2).</li>\n<li>[25] Liu, W., et al., The Emerging Trends of Multi-Label Learning. arXiv preprint arXiv:2011.11197; 2020.</li>\n<li>[26] Tsoumakas G, Katakis I. Multi-label classification: an overview. Int J Data Warehous Min (IJDWM) 2007;3(3):1–13.</li>\n<li>[27] Zhang M-L, Zhou Z-H. A review on multi-label learning algorithms. IEEE Trans Knowl Data Eng 2013;26(8):1819–37.</li>\n<li>[28] Gibaja E, Ventura S. Multi-label learning: a review of the state of the art and ongoing research. Wiley Interdiscip Rev: Data Min Knowledge Disc 2014;4(6):411–44.</li>\n<li>[33] Pedregosa F et al. Scikit-learn: machine learning in Python. J Mach Learn Res 2011;12:2825–30.</li>\n<li>[34] Chang C-C, Lin C-J. LIBSVM: a library for support vector machines. ACM Trans Intell Syst Technol (TIST) 2011;2(3):1–27.</li>\n<li>[35] RColorBrewer S, Liaw MA. Package ‘randomForest’. Berkeley, CA, USA: University of California, Berkeley; 2018.</li>\n<li>[36] Chen T, Guestrin C. Xgboost: A scalable tree boosting system. Proceedings of the 22nd acm sigkdd international conference on knowledge discovery and data mining, 2016.</li>\n<li>[37] Chen, T., et al., Xgboost: extreme gradient boosting. R package version 0.4-2, 2015: p. 1–4.</li>\n<li>[38] Ke G, et al. Lightgbm: A highly efficient gradient boosting decision tree. in Advances in neural information processing systems; 2017.</li>\n<li>[39] Prokhorenkova L, et al. CatBoost: unbiased boosting with categorical features. in Advances in neural information processing systems. 2018.</li>\n<li>[40] Abadi M, et al. Tensorflow: A system for large-scale machine learning. in 12th {USENIX} symposium on operating systems design and implementation ({OSDI} 16); 2016.</li>\n<li>[41] Paszke A, et al., Pytorch: An imperative style, high-performance deep learning library. arXiv preprint arXiv:1912.01703, 2019.</li>\n<li>[42] Ketkar N. Introduction to keras. In: Deep learning with Python. Springer; 2017. p. 97–111.</li>\n<li>[50] Jing G et al. Microbiome search engine 2: a Platform for taxonomic and functional search of global microbiomes on the whole-microbiome level. mSystems 2021;6(1).</li>\n<li>[51] Su X et al. Multiple-disease detection and classification across cohorts via microbiome search. Msystems 2020;5(2).</li>\n<li>[59] Deng Y et al. A hierarchical fused fuzzy deep neural network for data classification. IEEE Trans Fuzzy Syst 2016;25(4):1006–12.</li>\n<li>[60] Mou L, Ghamisi P, Zhu XX. Deep recurrent neural networks for hyperspectral image classification. IEEE Trans Geosci Remote Sens 2017;55(7):3639–55.</li>\n<li>[61] Gu J et al. Recent advances in convolutional neural networks. Pattern Recogn 2018;77:354–77.</li>\n<li>[62] Sharma D, Paterson AD, Xu W. TaxoNN: ensemble of neural networks on stratified microbiome data for disease prediction. Bioinformatics 2020.</li>\n<li>[66] Zhang M-L, Zhou Z-H. ML-KNN: A lazy learning approach to multi-label learning. Pattern Recogn 2007;40(7):2038–48.</li>\n<li>[67] Quinlan JR. C4. 5: programs for machine learning. 2014: Elsevier.</li>\n<li>[68] Clare A, King RD. Knowledge discovery in multi-label phenotype data. European conference on principles of data mining and knowledge discovery. Springer; 2001.</li>\n<li>[69] Moral-García S et al. Non-parametric predictive inference for solving multi-label classification. Appl Soft Comput 2020;88:106011.</li>\n<li>[70] Zhang M-L et al. Binary relevance for multi-label learning: an overview. Front Comp Sci 2018;12(2):191–202.</li>\n<li>[71] Dery, L., Multi-label Ranking: Mining Multi-label and Label Ranking Data. arXiv preprint arXiv:2101.00583, 2021.</li>\n<li>[72] Argollo M et al. Comorbidities in inflammatory bowel disease: a call for action. Lancet Gastroenterol Hepatol 2019;4(8):643–54.</li>\n<li>[73] Read J et al. Classifier chains for multi-label classification. Machine Learn 2011;85(3):333.</li>\n<li>[74] Janssens Y et al. Disbiome database: linking the microbiome to disease. BMC Microbiol 2018;18(1):1–6.</li>\n<li>[75] Bhatia, K., et al. Sparse Local Embeddings for Extreme Multi-label Classification. in NIPS. 2015.</li>\n<li>[76] Tagami, Annexml Y. Approximate nearest neighbor search for extreme multi\u0002label classification. Proceedings of the 23rd ACM SIGKDD international conference on knowledge discovery and data mining, 2017.</li>\n<li>[77] Jalan A, Kar P. Accelerating extreme classification via adaptive feature agglomeration. arXiv preprint arXiv:1905.11769; 2019.</li>\n<li>[78] Sun Y-Y, Zhang Y, Zhou Z-H. Multi-label learning with weak label. Proceedings of the AAAI Conference on Artificial Intelligence, 2010.</li>\n<li>[79] Wu B et al. Multi-label learning with missing labels. 22nd International Conference on Pattern Recognition. IEEE; 2014.</li>\n<li>[80] Xu M, Jin R, Zhou Z-H. Speedup matrix completion with side information: Application to multi-label learning. In: Advances in neural information processing systems. 2013.</li>\n<li>[81] Yu H-F, et al. Large-scale multi-label learning with missing labels. in International conference on machine learning; 2014. PMLR.</li>\n<li>[82] Xie M-K, Huang S-J. Partial multi-label learning. Proceedings of the AAAI Conference on Artificial Intelligence, 2018.</li>\n<li>[83] Fang J-P, Zhang M-L. Partial multi-label learning via credible label elicitation. Proceedings of the AAAI Conference on Artificial Intelligence, 2019.</li>\n<li>[90] Jackson MA et al. Gut microbiota associations with common diseases and prescription medications in a population-based cohort. Nat Commun 2018;9(1):1–8.</li>\n<li>[91] Liang H et al. Estimation and testing for partially linear single-index models. Ann Stat 2010;38(6):3811.</li>\n<li>[92] Yang Y, Tong T, Li G. SIMEX estimation for single-index model with covariate measurement error. AStA Adv Statist Anal 2019;103(1):137–61.</li>\n</ul>\n<h2 id=\"原文\"><a href=\"#原文\" class=\"headerlink\" title=\"原文\"></a>原文</h2><p>Shunyao Wu et al., Towards multi-label classification: Next step of machine learning for microbiome research. <em>Computational and Structural Biotechnology Journal</em> 19 (2021) 2742–2749. DOI: <a href=\"https://doi.org/10.1016/j.csbj.2021.04.054\">https://doi.org/10.1016/j.csbj.2021.04.054</a></p>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n","raw":null,"categories":[{"name":"机器学习","path":"api/categories/机器学习.json"}],"tags":[{"name":"ML与微生物组","path":"api/tags/ML与微生物组.json"},{"name":"ML与疾病诊断","path":"api/tags/ML与疾病诊断.json"}]},{"title":"批量下载某研究方向重要文献","slug":"批量下载某研究方向重要文献","date":"2023-04-24T14:15:30.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/批量下载某研究方向重要文献.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper.jpg","content":"<h1 id=\"安装Python及依赖包\"><a href=\"#安装Python及依赖包\" class=\"headerlink\" title=\"安装Python及依赖包\"></a>安装Python及依赖包</h1><h2 id=\"python下载安装\"><a href=\"#python下载安装\" class=\"headerlink\" title=\"python下载安装\"></a>python下载安装</h2><ul>\n<li><p>windows用户请到Python官网<a href=\"https://www.python.org/downloads/\">https://www.python.org/downloads</a>下载相应的版本，本教程在<code>version 3.10.0</code>测试可行，建议安装3.7以上版本。</p>\n</li>\n<li><p>Linux系统自带python，一般不需单独安装，除非版本太低，则需升级。</p>\n</li>\n</ul>\n<h2 id=\"依赖包安装\"><a href=\"#依赖包安装\" class=\"headerlink\" title=\"依赖包安装\"></a>依赖包安装</h2><h3 id=\"BeautifulSoup\"><a href=\"#BeautifulSoup\" class=\"headerlink\" title=\"BeautifulSoup\"></a>BeautifulSoup</h3><p>以下命令可以在Windows中的CMD&#x2F;Powershell或Linux终端中运行。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install BeautifulSoup4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"requests\"><a href=\"#requests\" class=\"headerlink\" title=\"requests\"></a>requests</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install requests</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"xlrd\"><a href=\"#xlrd\" class=\"headerlink\" title=\"xlrd\"></a>xlrd</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install xlrd</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"通过AI搜索关键词获取文献列表\"><a href=\"#通过AI搜索关键词获取文献列表\" class=\"headerlink\" title=\"通过AI搜索关键词获取文献列表\"></a>通过AI搜索关键词获取文献列表</h1><p>假设我们需要查找<code>代谢组学</code>和<code>微生物组</code>联合研究的文章，进入AI based文献检索网站<a href=\"https://www.citexs.com/Paperpicky\">https://www.citexs.com/Paperpicky</a>，输入关键词 “metabolomics;metabolome” 和 “microbiome”，并点击批量下载，保存为Excel格式（如下图所示）。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"AI文献检索\"></p>\n<p>下载后会得到“文献.csv”，打开文件检查各列是否与下图匹配。从左至右依次为Title、Journal、IF、DOI、PMID、Pub_Date、Url，若不匹配，请先修改，如果第二例为作者信息，那么可将该列删除。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper2.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper2.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"文献.csv内容\"></p>\n<h1 id=\"爬取文献保存至本地\"><a href=\"#爬取文献保存至本地\" class=\"headerlink\" title=\"爬取文献保存至本地\"></a>爬取文献保存至本地</h1><p>本教程脚本基于<code>大阔同学</code>脚本修改而来，添加了参数，避免用户修改源代码；增加了随机user-agent，避免下载次数过多被屏蔽。原理是基于文献DOI，利用爬虫通过SCI-HUB下载文献。因此，必需要在<code>文献.csv</code>中提供DOI。有些文章不在SCI-HUB中，或者网络环境较差，则会下载失败，失败信息写入<code>error.log</code>中。</p>\n<p>将<code>DownloadPaper.py</code>和<code>文献.csv</code>放在同一目录下，并在该目录下<code>shift+右键</code>打开Powershell窗口（俗称cmd），输入下面的命令，回车即可下载。如果电脑安装了WSL Ubuntu，也可以进入Linux终端。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python DownloadPaper.py -f 文献.csv -o Papers -c 20</span><br></pre></td></tr></table></figure>\n\n<p><strong>参数解析</strong>：</p>\n<ul>\n<li>f：指定包含文献信息的文件</li>\n<li>o：将文献下载至该参数指定的路径中</li>\n<li>c：影响因子阈值，低于该阈值的文献将不会下载</li>\n</ul>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper3.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/downloadPaper3.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"下载结果\"></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><p><a href=\"https://mp.weixin.qq.com/s/OA8TN453sk7kV95XSiTsug\">快速获取某方向研究重要文献并批量下载\n</a></p>\n</li>\n<li><p><a href=\"https://github.com/DaKuoXueShengXin/DaKuoXueShengXin_essay_code/tree/main/2023\">Github</a></p>\n</li>\n</ul>\n<h1 id=\"代码获取\"><a href=\"#代码获取\" class=\"headerlink\" title=\"代码获取\"></a>代码获取</h1><p>关注公众号“生信之巅”，聊天窗口回复“29bf”获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"NCBI - 下载 - NCBI","path":"api/tags/NCBI - 下载 - NCBI.json"}]},{"title":"基于TidyMass的非靶向代谢组学分析","slug":"基于TidyMass的非靶向代谢组学分析","date":"2023-04-19T07:45:39.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/基于TidyMass的非靶向代谢组学分析.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/metabolomics/LC-QTOF.png","content":"<h1 id=\"代谢组学常用仪器特点\"><a href=\"#代谢组学常用仪器特点\" class=\"headerlink\" title=\"代谢组学常用仪器特点\"></a>代谢组学常用仪器特点</h1><table border=\"1\">\n<tr>\n<th>仪器</th>\n<th>特点</th>\n</tr>\n<tr>\n<td>GC-MS</td>\n<td>易挥发，低极性，热稳定的小分子化合物；需衍生化</td>\n</tr>\n<tr>\n<td>LC-MS</td>\n<td>具有一定极性的有机化合物；无需衍生化</td>\n</tr>\n<tr>\n<td>NMR</td>\n<td>无偏性，无损检测；•无需繁琐前处理，便于活体、原位的动态检测</td>\n</tr>\n<tr>\n<td>CE-MS</td>\n<td>高极性化合物，如核酸，蛋白等</td>\n</tr>\n<tr>\n<td>ICP-MS</td>\n<td>无机化合物</td>\n</tr>\n</table>\n\n<h1 id=\"LC-QTOF原理\"><a href=\"#LC-QTOF原理\" class=\"headerlink\" title=\"LC-QTOF原理\"></a>LC-QTOF原理</h1><p>Q-TOF全称为四极飞行时间质谱仪（Quadrupole Time-of-Flight Mass Spectrometer）。其基本原理是将样品离子通过四极杆进行质量筛选，然后进入飞行时间质谱器（Time-of-Flight Mass Analyzer，ToF），测定其离子的飞行时间，从而得到样品中离子的质量信息。Q-TOF有正离子模式（positive ion mode, POS）和负离子模式（negative ion mode, NEG）两种电离方式，在检测代谢组时结合使用两种方式可以使代谢物覆盖率更高，检测效果也更好。</p>\n<p>Q-TOF的工作过程包含以下步骤：</p>\n<p><strong>离子化</strong>：样品通过电喷雾或者MALDI等方法被电离成为离子。</p>\n<p><strong>生成离子束</strong>：离子经过引出阱、加速器、光栅偏转镜等装置，形成一个带电的离子束。</p>\n<p><strong>四极杆质量筛选</strong>：离子束进入四极杆，通过高频交变电压（RF）和直流电压（DC）的控制，将不同质量的离子分离出来。</p>\n<p><strong>飞行时间质谱分析</strong>：通过激光或者其他方法对分散的离子束施加助推、聚焦和分析，并且测定其到达检测器所需的时间。不同质量的离子抵达检测器所需要的时间不同，从而可以得到离子的质量信息。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/metabolomics/LC-QTOF.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/metabolomics/LC-QTOF.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"LC-QTOF原理\"><br><font color=\"#FF0000\"><strong>FAQ</strong>：POS和NEG数据的利用。</font><br>负离子和正离子是数据采集时的时候的两种模式生成两套数据，一级分析（MS）结果中是提供 POS 和 NEG 两个检测结果列表的，但是在二级分析（MSMS）结果中，我们将鉴定正负离子模式下鉴定到的物质进行了合并，所以二级分析是针对代谢物来做的，不区分正负离子模式。</p>\n<p><font color=\"#FF0000\"><strong>FAQ</strong>: 当正负离子模式下都检测到了某种物质，如何对该物质的结果进行呈现？</font><br>会根据匹配参数进行取舍，选用匹配参数更好的模式下的数据在二级结果中进行分析。</p>\n<h1 id=\"数据分析\"><a href=\"#数据分析\" class=\"headerlink\" title=\"数据分析\"></a>数据分析</h1><h2 id=\"下机数据格式转换\"><a href=\"#下机数据格式转换\" class=\"headerlink\" title=\"下机数据格式转换\"></a>下机数据格式转换</h2><p>以下两个软件二选一，Windows下建议使用ProteoWizard，其用法可参考<a href=\"https://liaochenlanruo.fun/post/df57.html\">用metid构建代谢组数据库</a>。Linux下建议使用massconverter。</p>\n<h3 id=\"ProteoWizard\"><a href=\"#ProteoWizard\" class=\"headerlink\" title=\"ProteoWizard\"></a><a href=\"https://github.com/ProteoWizard\">ProteoWizard</a></h3><p>将raw data转换为<code>mzXML</code>格式。</p>\n<h3 id=\"massconverter\"><a href=\"#massconverter\" class=\"headerlink\" title=\"massconverter\"></a><a href=\"https://tidymass.github.io/massconverter/\">massconverter</a></h3><p>将raw data转换为<code>mzXML</code>格式。</p>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>require<span class=\"punctuation\">(</span>remotes<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;remotes&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">remotes<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;tidymass/massconverter&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取pwiz</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>massconverter<span class=\"punctuation\">)</span></span><br><span class=\"line\">docker_pull_pwiz<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>Debug</strong>：如果报错<code>Error in docker_pull_pwiz() :   Please install docker first (https://www.docker.com/get-started)</code>，则首先确认系统是否已安装docker，如果未安装，请先安装docker；如已经安装，则是因为普通用户无运行docker的权限，将其添加到docker用户组中即可。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">root模式下运行如下shell命令，将用户lhl添加到docker组中</span></span><br><span class=\"line\">gpasswd -a lhl docker</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启docker生效</span></span><br><span class=\"line\">service docker restart</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"设置转换参数\"><a href=\"#设置转换参数\" class=\"headerlink\" title=\"设置转换参数\"></a>设置转换参数</h4><p>此处调用MSConvert进行格式转换，期间进行了过滤，主要采用了<code>Peak Picking</code>，<code>Subset</code>，和<code>Zero Samples</code>方法。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">parameter <span class=\"operator\">=</span></span><br><span class=\"line\">  massconverter<span class=\"operator\">::</span>create_msconvert_parameter<span class=\"punctuation\">(</span></span><br><span class=\"line\">    output_format <span class=\"operator\">=</span> <span class=\"string\">&quot;mzXML&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># &quot;mzXML&quot;, &quot;mzML&quot;, &quot;mz5&quot;, &quot;mgf&quot;, &quot;text&quot;, &quot;ms1&quot;, &quot;cms1&quot;, &quot;ms2&quot;, &quot;cms2&quot;</span></span><br><span class=\"line\">    binary_encoding_precision <span class=\"operator\">=</span> <span class=\"string\">&quot;64&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    zlib <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    write_index <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    peak_picking_algorithm <span class=\"operator\">=</span> <span class=\"string\">&quot;cwt&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># &quot;vendor&quot; or &quot;cwt&quot;</span></span><br><span class=\"line\">    vendor_mslevels <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"literal\">NA</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"comment\"># 当前调用的是cwt，此参数可能无效</span></span><br><span class=\"line\">    cwt_mslevels <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"literal\">NA</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"comment\"># 如此设置即可</span></span><br><span class=\"line\">    cwt_min_snr <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">,</span><span class=\"comment\"># minimum signal-to-noise ratio，设为0.1即可</span></span><br><span class=\"line\">    cwt_min_peak_spacing <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">,</span><span class=\"comment\"># minimum peak spacing，设为0.1即可</span></span><br><span class=\"line\">    subset_polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;positive&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># &quot;any&quot;, &quot;positive&quot; or &quot;negative&quot;，根据模式选择</span></span><br><span class=\"line\">    subset_scan_number <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"literal\">NA</span><span class=\"punctuation\">,</span> <span class=\"literal\">NA</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"comment\"># A two numeric vector. Can be c(NA, NA) if don&#x27;t use this</span></span><br><span class=\"line\">    subset_scan_time <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">60</span><span class=\"punctuation\">,</span> <span class=\"number\">300</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"comment\"># A two numeric vector. Can be c(NA, NA) if don&#x27;t use this</span></span><br><span class=\"line\">    subset_mslevels <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"comment\"># A two numeric vector. Second can be set as NA</span></span><br><span class=\"line\">    zero_samples_mode <span class=\"operator\">=</span> <span class=\"string\">&quot;removeExtra&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># &quot;no&quot;, &quot;removeExtra&quot;, or &quot;addMissing&quot;</span></span><br><span class=\"line\">    zero_samples_mslevels <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"literal\">NA</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"comment\"># A two numeric vector. Second can be set as NA</span></span><br><span class=\"line\">    zero_samples_add_missing_flanking_zero_count <span class=\"operator\">=</span> <span class=\"number\">5</span><span class=\"comment\"># 默认5即可</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"开始转换\"><a href=\"#开始转换\" class=\"headerlink\" title=\"开始转换\"></a>开始转换</h4><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">convert_raw_data<span class=\"punctuation\">(</span>input_path <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_data/raw_data&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                 output_path <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_data/mzxml&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                 msconvert_parameter <span class=\"operator\">=</span> parameter<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                 docker_parameters <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                 process_all <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"安装tidyMass\"><a href=\"#安装tidyMass\" class=\"headerlink\" title=\"安装tidyMass\"></a>安装<a href=\"https://tidymass.tidymass.org/\">tidyMass</a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mamba install gcc_linux-64 gxx_linux-64 gfortran_linux-64</span><br><span class=\"line\">mamba install bioconductor-msnbase bioconductor-rdisop r-openxlsx bioconductor-mzr bioconductor-xcms r-rvest r-tidyr r-stringi r-tidyversedyve r-hexbin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>require<span class=\"punctuation\">(</span>remotes<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;remotes&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">remotes<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;tidymass/masstools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">remotes<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;tidymass/tidymass&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"原始数据处理\"><a href=\"#原始数据处理\" class=\"headerlink\" title=\"原始数据处理\"></a>原始数据处理</h2><p>调用<a href=\"https://massprocesser.tidymass.org/\">massprocesser</a>包进行原始数据处理，进行峰检测与对齐，输出peak table包括：<br>原始数据导入（read spectra from file）、峰检测（detect mass traces &amp; detect  chromatographic peaks）、校正保留时间（Correcting rentention time）、对已鉴定的色谱峰进行保留时间校正、Grouping peaks across samples、输出peak table。</p>\n<p><strong>数据目录结构</strong></p>\n<ul>\n<li>mzxml&#x2F;mzxml_ms1_data&#x2F;<ul>\n<li>POS&#x2F;<ul>\n<li>Case&#x2F;*.mzXML</li>\n<li>Control&#x2F;*.mzXML</li>\n<li>QC&#x2F;*.mzXML</li>\n</ul>\n</li>\n<li>NEG&#x2F;<ul>\n<li>Case&#x2F;*.mzXML</li>\n<li>Control&#x2F;*.mzXML</li>\n<li>QC&#x2F;*.mzXML</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>mzxml&#x2F;mgf_ms2_data&#x2F;mgf_ms2_data&#x2F;<ul>\n<li>POS&#x2F;*.mgf</li>\n<li>NEG&#x2F;*.mgf</li>\n</ul>\n</li>\n<li>mzxml&#x2F;sample_info&#x2F;<ul>\n<li>sample_info_pos.csv</li>\n<li>sample_info_neg.csv</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"正离子模式\"><a href=\"#正离子模式\" class=\"headerlink\" title=\"正离子模式\"></a>正离子模式</h3><p><font color=#FF0000>注意：path指定的路径名不可以数字开头！</font></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>tidymass<span class=\"punctuation\">)</span></span><br><span class=\"line\">process_data<span class=\"punctuation\">(</span></span><br><span class=\"line\">  path <span class=\"operator\">=</span> <span class=\"string\">&quot;mzxml_ms1_data/POS&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># 路径根据实际情况定</span></span><br><span class=\"line\">  polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;positive&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ppm <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  peakwidth <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">10</span><span class=\"punctuation\">,</span> <span class=\"number\">60</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  threads <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  output_tic <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  output_bpc <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  output_rt_correction_plot <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  min_fraction <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  group_for_figure <span class=\"operator\">=</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  snthresh <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  prefilter <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">3</span><span class=\"punctuation\">,</span> <span class=\"number\">500</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  fitgauss <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  integrate <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  mzdiff <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  noise <span class=\"operator\">=</span> <span class=\"number\">500</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  binSize <span class=\"operator\">=</span> <span class=\"number\">0.025</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  bw <span class=\"operator\">=</span> <span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  fill_peaks <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>ppm</strong>：numeric defining the maximal tolerated m&#x2F;z deviation in consecutive scans in parts per million (ppm) for the initial regions-of-interest (ROI)  definition。<font color=#FF0000>此处的ppm来源于xcms包，但在xcms中不同的函数中，含义貌似不一样，需进一步确认。</font></li>\n<li><strong>peakwith</strong>：峰宽，取决于柱子（column）和LC系统。numeric(2) with the expected approximate peak width in chromatographic space. Given as a range (min, max) in seconds.</li>\n<li><strong>min_fraction</strong>：如果一个峰出现在至少一组样本中<code>min_fraction</code>样本以上（按比例），则将保留该峰值。</li>\n<li><strong>snthresh</strong> ：信噪比阈值。</li>\n<li><strong>prefilter</strong>：c(k, I) 在第一次分析步骤（ROI检测）中指定预筛选步骤。仅保留包含至少强度&gt;&#x3D;I的k个峰的的质量轨迹（Mass traces）。</li>\n<li><strong>fitgauss</strong> ：是否应对每个峰拟合高斯分布。主要影响峰的保留时间位置。</li>\n<li><strong>integrate</strong>：积分方法（1或2）。对于 integrate&#x3D;1，Peak limits通过在mexican hat 过滤后的数据上下降（descent）来确定；而对于 integrate&#x3D;2，则在原始数据上进行下降处理。后一种方法更准确但容易受到噪声的影响，而前一种方法更稳健但不太精确。</li>\n<li><strong>mzdiff</strong> ：representing the minimum difference in m&#x2F;z dimension required for peaks with overlapping retention times; can be negative to allow overlap. During peak post-processing, peaks defined to be overlapping are reduced to the one peak with the largest signal.</li>\n<li><strong>noise</strong>：设定第一步分析中需要的质心（centroids ）最小强度（intensity &lt; noise的质心将被省略在感兴趣区域检测之外）。</li>\n<li><strong>binSize</strong> ：将m&#x2F;z轴按照binSize划分为多个区间，再对各区间内的离子信号进行聚合。较小的binSize使得峰检测更加准确，检测到更多features，需要更多计算资源。</li>\n<li><strong>bw</strong>：带宽，通常在5-50间，这是用于峰值检测的核密度估计 （KDE） 算法中使用的参数。bw 控制估计的 KDE 曲线的平滑度，并确定峰的解析程度。较小的bw值将产生更详细的基础峰形表示，在紧密间隔或重叠的峰之间具有更好的分辨率，但也可能产生更高水平的噪声。相反，较大的bw值将导致对峰形的估计更平滑、更广义，这有助于降低噪声和杂散检测，但在某些情况下也可能导致峰分辨率降低。bw 值的选择将取决于所分析数据的具体特征以及分析的目标。通常，有必要试验一系列 bw 值，以找到给定数据集的最佳设置。</li>\n<li><strong>fill_peaks</strong>：Fill peaks NA or not。</li>\n</ul>\n<p><strong>结果</strong>：</p>\n<ul>\n<li><p>POS&#x2F;Result&#x2F;</p>\n<ul>\n<li><p>object：用于下一步分析</p>\n</li>\n<li><p>Peak_table.csv：用于下一步分析的峰表</p>\n</li>\n<li><p>Peak_table_for_cleaning.csv：删除了<code>Peak_table.csv</code>中无用的列，可直接用于后续的数据清洗</p>\n</li>\n<li><p>BPC.pdf：Base peak chromatogram，仅展示<code>group_for_figure</code>参数指定组内的样本<br><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_1.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_1.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"BPC.pdf\"></p>\n</li>\n<li><p>TIC.pdf：Total ion peak chromatogram，经色谱分离流出的组分不断进入质谱，质谱连续扫描采集数据，每一次扫描得到一张质谱图，将每一张质谱图中所有离子强度相加得到总离子流强度。然后以总离子强度为纵坐标，时间为横坐标绘图。<br><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_2.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_2.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"TIC.pdf\"></p>\n</li>\n<li><p>RT correction plot.pdf<br><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_3.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_3.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"RT correction plot.pdf\"></p>\n</li>\n<li><p>intermediate_data：中间文件目录，如果需要重新运行data processing，则需先删除该目录。</p>\n</li>\n</ul>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载对象</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;mzxml_ms1_data/POS/Result/object&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看metabolic features数量</span></span><br><span class=\"line\">object</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取互动图，在Rstudio中才能显示</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;mzxml_ms1_data/POS/Result/intermediate_data/xdata2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">plot <span class=\"operator\">=</span> massprocesser<span class=\"operator\">::</span>plot_adjusted_rt<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> xdata2<span class=\"punctuation\">,</span> group_for_figure <span class=\"operator\">=</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">interactive</span> <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">plot</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"负离子模式\"><a href=\"#负离子模式\" class=\"headerlink\" title=\"负离子模式\"></a>负离子模式</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">massprocesser<span class=\"operator\">::</span>process_data<span class=\"punctuation\">(</span></span><br><span class=\"line\">  path <span class=\"operator\">=</span> <span class=\"string\">&quot;mzxml_ms1_data/NEG&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;negative&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ppm <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  peakwidth <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">10</span><span class=\"punctuation\">,</span> <span class=\"number\">60</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  threads <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  output_tic <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  output_bpc <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  output_rt_correction_plot <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  min_fraction <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  group_for_figure <span class=\"operator\">=</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   snthresh <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  prefilter <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">3</span><span class=\"punctuation\">,</span> <span class=\"number\">500</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  fitgauss <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  integrate <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  mzdiff <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  noise <span class=\"operator\">=</span> <span class=\"number\">500</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  binSize <span class=\"operator\">=</span> <span class=\"number\">0.025</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  bw <span class=\"operator\">=</span> <span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  fill_peaks <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载对象</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;mzxml_ms1_data/NEG/Result/object&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看metabolic features数量</span></span><br><span class=\"line\">object</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Explore-data\"><a href=\"#Explore-data\" class=\"headerlink\" title=\"Explore data\"></a>Explore data</h2><p>将peak table和样本信息（元数据）整合，得到<code>mass_dataset</code> class对象。获取数据的总结信息。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_0.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_0.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"样本信息表示例 sample_info_pos.csv\"></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>tidyverse<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"正离子模式-1\"><a href=\"#正离子模式-1\" class=\"headerlink\" title=\"正离子模式\"></a>正离子模式</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载对象</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;mzxml_ms1_data/POS/Result/object&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> object</span><br><span class=\"line\">object_pos</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入样本信息</span></span><br><span class=\"line\">sample_info_pos <span class=\"operator\">&lt;-</span> readr<span class=\"operator\">::</span>read_csv<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample_info/sample_info_pos.csv&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  查看object_pos中的元数据</span></span><br><span class=\"line\">object_pos <span class=\"operator\">%&gt;%</span>  extract_sample_info<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;    sample_id group   class injection.order</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 1  sample_06  Case Subject               1</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 2 sample_103  Case Subject               2</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 3  sample_11  Case Subject               3</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 4 sample_112  Case Subject               4</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 5 sample_117  Case Subject               5</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 6  sample_12  Case Subject               6</span></span><br><span class=\"line\"><span class=\"comment\">#?? 为何还没整合的情况下object_pos中就存在了部分元数据列？</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 移除object_pos中的&quot;group&quot;, &quot;class&quot;, &quot;injection.order&quot;</span></span><br><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>select<span class=\"punctuation\">(</span><span class=\"operator\">-</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;group&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;class&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;injection.order&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将sample_info_pos 中的所有列整合到object_pos 中</span></span><br><span class=\"line\">object_pos <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> left_join<span class=\"punctuation\">(</span>sample_info_pos<span class=\"punctuation\">,</span> by <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_id&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看元数据信息</span></span><br><span class=\"line\">object_pos <span class=\"operator\">%&gt;%</span> extract_sample_info<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;    sample_id injection.order   class batch  subject_id group</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 1  sample_06               4 Subject     1 subject_414  Case</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 2 sample_103              71 Subject     1 subject_330  Case</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 3  sample_11               6 Subject     1 subject_125  Case</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 4 sample_112              78 Subject     1 subject_295  Case</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 5 sample_117              80 Subject     1 subject_793  Case</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 6  sample_12               8 Subject     1 subject_387  Case</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存数据</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;data_cleaning/POS&quot;</span><span class=\"punctuation\">,</span> showWarnings <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> recursive <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>object_pos<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;data_cleaning/POS/object_pos&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 统计样本数和variables数</span></span><br><span class=\"line\">object_pos</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 根据class统计样本数量，可将class换成group或batch等</span></span><br><span class=\"line\">object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>count<span class=\"punctuation\">(</span><span class=\"built_in\">class</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取peak分布图</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/peak_distributation_plot_positive.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> object_pos <span class=\"operator\">%&gt;%</span> `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">10</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> show_mz_rt_plot<span class=\"punctuation\">(</span>hex <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span> </span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.01</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看总缺失值数量</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#[1] 786005</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看各样本内的缺失值</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> by <span class=\"operator\">=</span> <span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># sample_06 sample_103  sample_11 sample_112 sample_117  sample_12</span></span><br><span class=\"line\"><span class=\"comment\">#      4017       2713       4064       2981       2920       3846</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看各variable的缺失值</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> by <span class=\"operator\">=</span> <span class=\"string\">&quot;variable&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#M70T73_POS  M70T53_POS M70T183_POS M70T527_POS M71T695_POS M71T183_POS</span></span><br><span class=\"line\"><span class=\"comment\">#        129          16         155          54         133         169</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图展示缺失值信息，可在下一节生成</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/total_MVs.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">show_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> show_column_names <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> show_row_names <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图展示各样本缺失值信息，可在下一节生成</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/Samples_MVs.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">show_sample_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> color_by <span class=\"operator\">=</span> <span class=\"string\">&quot;class&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图展示各variables缺失值信息，可在下一节生成</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/Variables_MVs.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> show_variable_missing_values<span class=\"punctuation\">(</span></span><br><span class=\"line\">  object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span></span><br><span class=\"line\">  percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  show_x_text <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  show_x_ticks <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  color_by <span class=\"operator\">=</span> <span class=\"string\">&quot;mz&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span> </span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.01</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_4.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_4.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"峰分布图\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_5.svg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_5.svg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"各variable的缺失值数量\"><br>黑色代表缺失值。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_6.svg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_6.svg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"各样本的缺失值比例\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_7.svg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_7.svg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"各variable的缺失值比例\"></p>\n<h3 id=\"负离子模式-1\"><a href=\"#负离子模式-1\" class=\"headerlink\" title=\"负离子模式\"></a>负离子模式</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载对象</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;mzxml_ms1_data/NEG/Result/object&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">object_neg <span class=\"operator\">&lt;-</span> object</span><br><span class=\"line\">object_neg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入样本信息</span></span><br><span class=\"line\">sample_info_neg <span class=\"operator\">&lt;-</span> readr<span class=\"operator\">::</span>read_csv<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample_info/sample_info_neg.csv&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg <span class=\"operator\">%&gt;%</span>  extract_sample_info<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#   sample_id group   class injection.order</span></span><br><span class=\"line\"><span class=\"comment\">#1  sample_06  Case Subject               1</span></span><br><span class=\"line\"><span class=\"comment\">#2 sample_103  Case Subject               2</span></span><br><span class=\"line\"><span class=\"comment\">#3  sample_11  Case Subject               3</span></span><br><span class=\"line\"><span class=\"comment\">#4 sample_112  Case Subject               4</span></span><br><span class=\"line\"><span class=\"comment\">#5 sample_117  Case Subject               5</span></span><br><span class=\"line\"><span class=\"comment\">#6  sample_12  Case Subject               6</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg <span class=\"operator\">&lt;-</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>select<span class=\"punctuation\">(</span><span class=\"operator\">-</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;group&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;class&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;injection.order&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将sample_info_neg添加至object_neg</span></span><br><span class=\"line\">object_neg <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> left_join<span class=\"punctuation\">(</span>sample_info_neg<span class=\"punctuation\">,</span> by <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_id&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg <span class=\"operator\">%&gt;%</span> extract_sample_info<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#   sample_id injection.order   class batch  subject_id group</span></span><br><span class=\"line\"><span class=\"comment\">#1  sample_06               4 Subject     1 subject_414  Case</span></span><br><span class=\"line\"><span class=\"comment\">#2 sample_103              71 Subject     1 subject_330  Case</span></span><br><span class=\"line\"><span class=\"comment\">#3  sample_11               6 Subject     1 subject_125  Case</span></span><br><span class=\"line\"><span class=\"comment\">#4 sample_112              78 Subject     1 subject_295  Case</span></span><br><span class=\"line\"><span class=\"comment\">#5 sample_117              80 Subject     1 subject_793  Case</span></span><br><span class=\"line\"><span class=\"comment\">#6  sample_12               8 Subject     1 subject_387  Case</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存数据</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;data_cleaning/NEG&quot;</span><span class=\"punctuation\">,</span> showWarnings <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> recursive <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>object_neg<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;data_cleaning/NEG/object_neg&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 统计样本数和variables数</span></span><br><span class=\"line\">object_neg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 根据class统计样本数量，可将class换成group或batch等</span></span><br><span class=\"line\">object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>count<span class=\"punctuation\">(</span><span class=\"built_in\">class</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取peak分布图</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/peak_distributation_plot_negtive.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg <span class=\"operator\">%&gt;%</span> `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">10</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> show_mz_rt_plot<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.01</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看总缺失值数量</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#[1] 748237</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看各样本内的缺失值</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> by <span class=\"operator\">=</span> <span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># sample_06 sample_103  sample_11 sample_112 sample_117  sample_12</span></span><br><span class=\"line\"><span class=\"comment\">#      3029       2766       3298       3100       2912       3053</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看各variable的缺失值</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> by <span class=\"operator\">=</span> <span class=\"string\">&quot;variable&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#M70T712_NEG M70T527_NEG M70T587_NEG  M70T47_NEG M71T587_NEG M71T641_NEG</span></span><br><span class=\"line\"><span class=\"comment\">#         16         137           2         146          41          19</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图展示缺失值信息，可在下一节生成</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/total_MVs.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">show_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> show_column_names <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图展示各样本缺失值信息，可在下一节生成</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/Samples_MVs.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">show_sample_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘图展示各variables缺失值信息，可在下一节生成</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/Variables_MVs.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> show_variable_missing_values<span class=\"punctuation\">(</span></span><br><span class=\"line\">  object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span></span><br><span class=\"line\">  percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  show_x_text <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  show_x_ticks <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span> </span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.01</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据清洗（Data-cleaning）\"><a href=\"#数据清洗（Data-cleaning）\" class=\"headerlink\" title=\"数据清洗（Data cleaning）\"></a>数据清洗（Data cleaning）</h2><h3 id=\"查看质量\"><a href=\"#查看质量\" class=\"headerlink\" title=\"查看质量\"></a>查看质量</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载数据</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;data_cleaning/POS/object_pos&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;data_cleaning/NEG/object_neg&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将批次号改为字符串</span></span><br><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>mutate<span class=\"punctuation\">(</span>batch <span class=\"operator\">=</span> <span class=\"built_in\">as.character</span><span class=\"punctuation\">(</span>batch<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg <span class=\"operator\">&lt;-</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>mutate<span class=\"punctuation\">(</span>batch <span class=\"operator\">=</span> <span class=\"built_in\">as.character</span><span class=\"punctuation\">(</span>batch<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 先评估数据质量</span></span><br><span class=\"line\">massqc<span class=\"operator\">::</span>massqc_report<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> path <span class=\"operator\">=</span> <span class=\"string\">&quot;data_cleaning/POS/data_quality_before_data_cleaning&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">massqc<span class=\"operator\">::</span>massqc_report<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> path <span class=\"operator\">=</span> <span class=\"string\">&quot;data_cleaning/NEG/data_quality_before_data_cleaning&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_8.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_8.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"正离子PCA\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_9.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_9.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"负离子PCA\"><br><font color=\"#FF0000\">从上两图可看出正离子模式下存在严重的批次效应，负离子模式下不存在明显的批次效应。</font></p>\n<h3 id=\"开始清洗\"><a href=\"#开始清洗\" class=\"headerlink\" title=\"开始清洗\"></a>开始清洗</h3><h4 id=\"移除噪音代谢features——缺失值过滤。\"><a href=\"#移除噪音代谢features——缺失值过滤。\" class=\"headerlink\" title=\"移除噪音代谢features——缺失值过滤。\"></a>移除噪音代谢features——缺失值过滤。</h4><p>移除超过20% QC样本中含有MVs以及至少在50%实验组或对照组样本中含有MVs的variables。</p>\n<ul>\n<li><p>正离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看各分组样本量</span></span><br><span class=\"line\">object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>count<span class=\"punctuation\">(</span>group<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;     group   n</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 1    Case 110</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 2 Control 110</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 3      QC  39</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># QC样本中的MV占比</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/MVpercentQC.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> show_variable_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span><span class=\"built_in\">class</span> <span class=\"operator\">==</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span> </span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.01</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计QC中的MV占比</span></span><br><span class=\"line\">qc_id <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span><span class=\"built_in\">class</span> <span class=\"operator\">==</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计对照组中的MV占比</span></span><br><span class=\"line\">control_id <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Control&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计实验组中的MV占比</span></span><br><span class=\"line\">case_id <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Case&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 整合以上统计信息</span></span><br><span class=\"line\">object_pos <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> mutate_variable_na_freq<span class=\"punctuation\">(</span>according_to_samples <span class=\"operator\">=</span> qc_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> mutate_variable_na_freq<span class=\"punctuation\">(</span>according_to_samples <span class=\"operator\">=</span> control_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> mutate_variable_na_freq<span class=\"punctuation\">(</span>according_to_samples <span class=\"operator\">=</span> case_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>extract_variable_info<span class=\"punctuation\">(</span>object_pos<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#variable_id       mz        rt    na_freq na_freq.1 na_freq.2</span></span><br><span class=\"line\"><span class=\"comment\">#1  M70T73_POS 70.04074  73.31705 0.28205128 0.6000000 0.4727273</span></span><br><span class=\"line\"><span class=\"comment\">#2  M70T53_POS 70.06596  52.78542 0.00000000 0.1454545 0.0000000</span></span><br><span class=\"line\"><span class=\"comment\">#3 M70T183_POS 70.19977 182.87981 0.00000000 0.6636364 0.7454545</span></span><br><span class=\"line\"><span class=\"comment\">#4 M70T527_POS 70.36113 526.76657 0.02564103 0.1818182 0.3000000</span></span><br><span class=\"line\"><span class=\"comment\">#5 M71T695_POS 70.56911 694.84592 0.02564103 0.6454545 0.5545455</span></span><br><span class=\"line\"><span class=\"comment\">#6 M71T183_POS 70.75034 182.77790 0.05128205 0.7272727 0.7909091</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 移除variables</span></span><br><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>na_freq <span class=\"operator\">&lt;</span> <span class=\"number\">0.2</span> <span class=\"operator\">&amp;</span> <span class=\"punctuation\">(</span>na_freq.1 <span class=\"operator\">&lt;</span> <span class=\"number\">0.5</span> <span class=\"operator\">|</span> na_freq.2 <span class=\"operator\">&lt;</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_pos</span><br></pre></td></tr></table></figure>\n\n<p> <strong>注</strong>：na_freq、na_freq.1和na_freq.2在此处分别代表某variables 在QC样本、对照组样本和实验组样本中缺失值MV所占的百分比。</p>\n<p> <img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_19.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_19.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"MVpercentQC\"></p>\n</li>\n<li><p>负离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看各分组样本量</span></span><br><span class=\"line\">object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> dplyr<span class=\"operator\">::</span>count<span class=\"punctuation\">(</span>group<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;     group   n</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 1    Case 110</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 2 Control 110</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 3      QC  39</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># QC样本中的MV占比</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/MVpercentQC.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> show_variable_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span><span class=\"built_in\">class</span> <span class=\"operator\">==</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.01</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计QC中的MV占比</span></span><br><span class=\"line\">qc_id <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span><span class=\"built_in\">class</span> <span class=\"operator\">==</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计对照组中的MV占比</span></span><br><span class=\"line\">control_id <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Control&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计实验组中的MV占比</span></span><br><span class=\"line\">case_id <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Case&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 整合以上统计信息</span></span><br><span class=\"line\">object_neg <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> mutate_variable_na_freq<span class=\"punctuation\">(</span>according_to_samples <span class=\"operator\">=</span> qc_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> mutate_variable_na_freq<span class=\"punctuation\">(</span>according_to_samples <span class=\"operator\">=</span> control_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> mutate_variable_na_freq<span class=\"punctuation\">(</span>according_to_samples <span class=\"operator\">=</span> case_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>extract_variable_info<span class=\"punctuation\">(</span>object_neg<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#variable_id       mz        rt    na_freq na_freq.1 na_freq.2</span></span><br><span class=\"line\"><span class=\"comment\">#1 M70T712_NEG 70.05911 711.97894 0.05128205 0.109090909 0.018181818</span></span><br><span class=\"line\"><span class=\"comment\">#2 M70T527_NEG 70.13902 526.85416 0.33333333 0.509090909 0.618181818</span></span><br><span class=\"line\"><span class=\"comment\">#3 M70T587_NEG 70.31217 587.25330 0.00000000 0.009090909 0.009090909</span></span><br><span class=\"line\"><span class=\"comment\">#4  M70T47_NEG 70.33835  46.57537 0.84615385 0.936363636 0.090909091</span></span><br><span class=\"line\"><span class=\"comment\">#5 M71T587_NEG 70.56315 587.02570 0.17948718 0.145454545 0.163636364</span></span><br><span class=\"line\"><span class=\"comment\">#6 M71T641_NEG 70.70657 641.16672 0.10256410 0.063636364 0.072727273</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 移除variables</span></span><br><span class=\"line\">object_neg <span class=\"operator\">&lt;-</span> object_neg <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>na_freq <span class=\"operator\">&lt;</span> <span class=\"number\">0.2</span> <span class=\"operator\">&amp;</span> <span class=\"punctuation\">(</span>na_freq.1 <span class=\"operator\">&lt;</span> <span class=\"number\">0.5</span> <span class=\"operator\">|</span> na_freq.2 <span class=\"operator\">&lt;</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h4 id=\"过滤离群样本（Filter-outlier-samples）\"><a href=\"#过滤离群样本（Filter-outlier-samples）\" class=\"headerlink\" title=\"过滤离群样本（Filter outlier samples）\"></a>过滤离群样本（Filter outlier samples）</h4><ul>\n<li><p>正离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 总览</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/MVpercentALL.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">massdataset<span class=\"operator\">::</span>show_sample_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> color_by <span class=\"operator\">=</span> <span class=\"string\">&quot;group&quot;</span><span class=\"punctuation\">,</span> order_by <span class=\"operator\">=</span> <span class=\"string\">&quot;injection.order&quot;</span><span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>size <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.1</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> ggsci<span class=\"operator\">::</span>scale_color_aaas<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测离群样本</span></span><br><span class=\"line\">outlier_samples <span class=\"operator\">=</span> object_pos <span class=\"operator\">%&gt;%</span> `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> scale<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> detect_outlier<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_samples</span><br><span class=\"line\"><span class=\"comment\">#--------------------</span></span><br><span class=\"line\"><span class=\"comment\">#masscleaner</span></span><br><span class=\"line\"><span class=\"comment\">#--------------------</span></span><br><span class=\"line\"><span class=\"comment\">#1 according_to_na : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#2 according_to_pc_sd : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#3 according_to_pc_mad : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#4 accordint_to_distance : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#4 accordint_to_distance : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#extract all outlier table using extract_outlier_table()</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_table <span class=\"operator\">&lt;-</span> extract_outlier_table<span class=\"punctuation\">(</span>outlier_samples<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_table <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#           according_to_na pc_sd pc_mad accordint_to_distance</span></span><br><span class=\"line\"><span class=\"comment\">#sample_06            FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_103           FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_11            FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_112           FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_117           FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_12            FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_table <span class=\"operator\">%&gt;%</span> apply<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span> <span class=\"built_in\">sum</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span>  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> `&gt;`<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> which<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># #named integer(0)</span></span><br><span class=\"line\"><span class=\"comment\">##无离群样本</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 删除离群样本，如果有的话</span></span><br><span class=\"line\">need_id_pos <span class=\"operator\">&lt;-</span> <span class=\"built_in\">names</span><span class=\"punctuation\">(</span>outlier_table <span class=\"operator\">%&gt;%</span> apply<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span> <span class=\"built_in\">sum</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span>  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> `==`<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> which<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> object_pos <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>sample_id <span class=\"operator\">%in%</span> need_id_pos<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_20.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_20.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"MVpercentALL\"></p>\n</li>\n<li><p>负离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 总览</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/MVpercentALL.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> massdataset<span class=\"operator\">::</span>show_sample_missing_values<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> color_by <span class=\"operator\">=</span> <span class=\"string\">&quot;group&quot;</span><span class=\"punctuation\">,</span> order_by <span class=\"operator\">=</span> <span class=\"string\">&quot;injection.order&quot;</span><span class=\"punctuation\">,</span> percentage <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>size <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.1</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> ggsci<span class=\"operator\">::</span>scale_color_aaas<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测离群样本</span></span><br><span class=\"line\">outlier_samples <span class=\"operator\">=</span> object_neg <span class=\"operator\">%&gt;%</span> `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> scale<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> detect_outlier<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_samples</span><br><span class=\"line\"><span class=\"comment\">#--------------------</span></span><br><span class=\"line\"><span class=\"comment\">#masscleaner</span></span><br><span class=\"line\"><span class=\"comment\">#--------------------</span></span><br><span class=\"line\"><span class=\"comment\">#1 according_to_na : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#2 according_to_pc_sd : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#3 according_to_pc_mad : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#4 accordint_to_distance : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#4 accordint_to_distance : 0 outlier samples.</span></span><br><span class=\"line\"><span class=\"comment\">#extract all outlier table using extract_outlier_table()</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_table <span class=\"operator\">&lt;-</span> extract_outlier_table<span class=\"punctuation\">(</span>outlier_samples<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_table <span class=\"operator\">%&gt;%</span> head<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#           according_to_na pc_sd pc_mad accordint_to_distance</span></span><br><span class=\"line\"><span class=\"comment\">#sample_06            FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_103           FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_11            FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_112           FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_117           FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"><span class=\"comment\">#sample_12            FALSE FALSE  FALSE                 FALSE</span></span><br><span class=\"line\"></span><br><span class=\"line\">outlier_table <span class=\"operator\">%&gt;%</span> apply<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span> <span class=\"built_in\">sum</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span>  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> `&gt;`<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> which<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># #named integer(0)</span></span><br><span class=\"line\"><span class=\"comment\">##无离群样本</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"缺失值填充（Missing-value-imputation）\"><a href=\"#缺失值填充（Missing-value-imputation）\" class=\"headerlink\" title=\"缺失值填充（Missing value imputation）\"></a>缺失值填充（Missing value imputation）</h2><p>对原始数据中的缺失值进行模拟（missing value recoding）。方法包括：”knn”, “rf” (missForest), “mean”, “median”, “zero”, “minimum”, “bpca”, “svdImpute”, “ppca”。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取正离子模式下的MV数量</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object_pos<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; [1] 148907</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 填充正离子模式缺失值</span></span><br><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> impute_mv<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;knn&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取正离子模式下填充后的MV数量</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object_pos<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; [1] 0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取负离子模式下的MV数量</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object_neg<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; [1] 146409</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 填充正离子模式缺失值</span></span><br><span class=\"line\">object_neg <span class=\"operator\">&lt;-</span> impute_mv<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_neg<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;knn&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取正离子模式下填充后的MV数量</span></span><br><span class=\"line\">get_mv_number<span class=\"punctuation\">(</span>object_neg<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; [1] 0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据标准化与整合（Data-normalization-and-integration）\"><a href=\"#数据标准化与整合（Data-normalization-and-integration）\" class=\"headerlink\" title=\"数据标准化与整合（Data normalization and integration）\"></a>数据标准化与整合（Data normalization and integration）</h2><p>数据标准化处理， 利用内标（internal standard, IS）进行归一化<font color=\"#FF0000\">待确认是否通过IS实现</font>。</p>\n<ul>\n<li><p>正离子模式</p>\n<p>标准化方法包括：”svr”, “total”, “median”, “mean”, “pqn”, “loess”；整合方法包括：”qc_mean”, “qc_median”, “subject_mean”, “subject_median”。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_pos <span class=\"operator\">&lt;-</span> normalize_data<span class=\"punctuation\">(</span>object_pos<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;median&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_pos2 <span class=\"operator\">&lt;-</span> integrate_data<span class=\"punctuation\">(</span>object_pos<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;subject_median&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 按批次分组绘制PCA图</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/POS/PC_batch_intergrated.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_pos2 <span class=\"operator\">%&gt;%</span> `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> massqc<span class=\"operator\">::</span>massqc_pca<span class=\"punctuation\">(</span>color_by <span class=\"operator\">=</span> <span class=\"string\">&quot;batch&quot;</span><span class=\"punctuation\">,</span> line <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_10.svg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_10.svg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"标准化后正离子PCA\"></p>\n<ul>\n<li><p>负离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_neg <span class=\"operator\">&lt;-</span> normalize_data<span class=\"punctuation\">(</span>object_neg<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;median&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg2 <span class=\"operator\">&lt;-</span> integrate_data<span class=\"punctuation\">(</span>object_neg<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;subject_median&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 按批次分组绘制PCA图</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;data_cleaning/NEG/PC_batch_intergrated.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg2 <span class=\"operator\">%&gt;%</span> `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> massqc<span class=\"operator\">::</span>massqc_pca<span class=\"punctuation\">(</span>color_by <span class=\"operator\">=</span> <span class=\"string\">&quot;batch&quot;</span><span class=\"punctuation\">,</span> line <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_11.svg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_11.svg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"标准化后负离子PCA\"></p>\n<p><strong>保存数据</strong></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">save<span class=\"punctuation\">(</span>object_pos2<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;data_cleaning/POS/object_pos2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>object_neg2<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;data_cleaning/NEG/object_neg2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代谢物注释\"><a href=\"#代谢物注释\" class=\"headerlink\" title=\"代谢物注释\"></a>代谢物注释</h2><h3 id=\"加载数据\"><a href=\"#加载数据\" class=\"headerlink\" title=\"加载数据\"></a>加载数据</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;data_cleaning/POS/object_pos2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;data_cleaning/NEG/object_neg2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"将MS2数据添加到mass-dataset\"><a href=\"#将MS2数据添加到mass-dataset\" class=\"headerlink\" title=\"将MS2数据添加到mass_dataset\"></a>将MS2数据添加到mass_dataset</h3><p><strong>如果没有MS2数据，此步不执行应该也可以！</strong><br><font color=\"#FF0000\">？？只有QC样的MS2数据，MS2数据是怎么来的？</font></p>\n<ul>\n<li><p>正离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_pos2 <span class=\"operator\">&lt;-</span> mutate_ms2<span class=\"punctuation\">(</span></span><br><span class=\"line\">  object <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">,</span></span><br><span class=\"line\">  column <span class=\"operator\">=</span> <span class=\"string\">&quot;rp&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\"># rp or hilic，对应RPLC（反相色谱）和HILIC（亲水相互作用色谱）</span></span><br><span class=\"line\">  polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;positive&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ms1.ms2.match.mz.tol <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span><span class=\"comment\"># ppm</span></span><br><span class=\"line\">  ms1.ms2.match.rt.tol <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span><span class=\"comment\"># seconds</span></span><br><span class=\"line\">  path <span class=\"operator\">=</span> <span class=\"string\">&quot;mgf_ms2_data/mgf_ms2_data/POS&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#1043 out of 5101 variable have MS2 spectra.</span></span><br><span class=\"line\"><span class=\"comment\">#Selecting the most intense MS2 spectrum for each peak...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># summary</span></span><br><span class=\"line\">extract_ms2_data<span class=\"punctuation\">(</span>object_pos2<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>负离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_neg2 <span class=\"operator\">&lt;-</span> mutate_ms2<span class=\"punctuation\">(</span></span><br><span class=\"line\">  object <span class=\"operator\">=</span> object_neg2<span class=\"punctuation\">,</span></span><br><span class=\"line\">  column <span class=\"operator\">=</span> <span class=\"string\">&quot;rp&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;negative&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ms1.ms2.match.mz.tol <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ms1.ms2.match.rt.tol <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  path <span class=\"operator\">=</span> <span class=\"string\">&quot;mgf_ms2_data/mgf_ms2_data/NEG&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#1092 out of 4104 variable have MS2 spectra.</span></span><br><span class=\"line\"><span class=\"comment\">#Selecting the most intense MS2 spectrum for each peak...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># summary</span></span><br><span class=\"line\">extract_ms2_data<span class=\"punctuation\">(</span>object_neg2<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"代谢物注释-1\"><a href=\"#代谢物注释-1\" class=\"headerlink\" title=\"代谢物注释\"></a>代谢物注释</h3><p><font color=#FF0000>需要考虑数据库是RPLC还是HILIC。</font></p>\n<ul>\n<li><p>正离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Annotate features using snyder_database_rplc0.0.3</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;metabolite_annotation/snyder_database_rplc0.0.3.rda&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 查看数据库信息</span></span><br><span class=\"line\">snyder_database_rplc0.0.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 注释</span></span><br><span class=\"line\">object_pos2 <span class=\"operator\">&lt;-</span> annotate_metabolites_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    ms1.match.ppm <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    rt.match.tol <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;positive&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    database <span class=\"operator\">=</span> snyder_database_rplc0.0.3<span class=\"punctuation\">,</span></span><br><span class=\"line\"> threads <span class=\"operator\">=</span><span class=\"number\">30</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Annotate features using orbitrap_database0.0.3</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;metabolite_annotation/orbitrap_database0.0.3.rda&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 查看数据库信息</span></span><br><span class=\"line\">orbitrap_database0.0.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 注释</span></span><br><span class=\"line\">object_pos2 <span class=\"operator\">&lt;-</span> annotate_metabolites_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    ms1.match.ppm <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;positive&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    database <span class=\"operator\">=</span> orbitrap_database0.0.3<span class=\"punctuation\">,</span></span><br><span class=\"line\"> threads <span class=\"operator\">=</span><span class=\"number\">30</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Annotate features using mona_database0.0.3</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;metabolite_annotation/mona_database0.0.3.rda&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 查看数据库信息</span></span><br><span class=\"line\">mona_database0.0.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 注释</span></span><br><span class=\"line\">object_pos2 <span class=\"operator\">&lt;-</span> annotate_metabolites_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    ms1.match.ppm <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;positive&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    database <span class=\"operator\">=</span> mona_database0.0.3<span class=\"punctuation\">,</span></span><br><span class=\"line\"> threads <span class=\"operator\">=</span><span class=\"number\">30</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>annotate_metabolites_mass_dataset 参数解析</strong>：</p>\n<ul>\n<li><strong>ms1.match.ppm</strong>：Precursor match ppm tolerance [25].</li>\n<li><strong>ms2.match.ppm</strong>：Fragment ion match ppm tolerance [30].</li>\n<li><strong>mz.ppm.thr</strong>：Accurate mass tolerance for m&#x2F;z error calculation [400].</li>\n<li><strong>ms2.match.tol</strong>：MS2 match (MS2 similarity) tolerance [0.5].</li>\n<li><strong>fraction.weight</strong>：The weight for matched fragments [0.3].</li>\n<li><strong>dp.forward.weight</strong>：Forward dot product weight [0.6].</li>\n<li><strong>dp.reverse.weight</strong>：Reverse dot product weight [0.1].</li>\n<li><strong>remove_fragment_intensity_cutoff</strong>：remove_fragment_intensity_cutoff [0].</li>\n<li><strong>rt.match.tol</strong>：RT match tolerance [30].</li>\n<li><strong>polarity</strong>：The polarity of data, “positive”or “negative”.</li>\n<li><strong>ce</strong>：Collision energy. Please confirm the CE values in your database. [all].</li>\n<li><strong>column</strong>：”hilic” (HILIC column) or “rp” (reverse phase).</li>\n<li><strong>ms1.match.weight</strong>：The weight of MS1 match for total score calculation [0.25].</li>\n<li><strong>rt.match.weight</strong>：The weight of RT match for total score calculation [0.25].</li>\n<li><strong>ms2.match.weight</strong>：The weight of MS2 match for total score calculation [0.5]</li>\n<li><strong>total.score.tol</strong>：Total score tolerance. The total score are referring to MS-DIAL [0.5]</li>\n<li><strong>candidate.num</strong>：The number of candidate [3]</li>\n</ul>\n</li>\n<li><p>负离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Annotate features using snyder_database_rplc0.0.3</span></span><br><span class=\"line\">object_neg2 <span class=\"operator\">&lt;-</span> annotate_metabolites_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> object_neg2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    ms1.match.ppm <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    rt.match.tol <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;negative&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    database <span class=\"operator\">=</span> snyder_database_rplc0.0.3<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Annotate features using orbitrap_database0.0.3</span></span><br><span class=\"line\">object_neg2 <span class=\"operator\">&lt;-</span> annotate_metabolites_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> object_neg2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    ms1.match.ppm <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;negative&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    database <span class=\"operator\">=</span> orbitrap_database0.0.3<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Annotate features using mona_database0.0.3</span></span><br><span class=\"line\">object_neg2 <span class=\"operator\">&lt;-</span> annotate_metabolites_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> object_neg2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    ms1.match.ppm <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    polarity <span class=\"operator\">=</span> <span class=\"string\">&quot;negative&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    database <span class=\"operator\">=</span> mona_database0.0.3<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"查看注释结果\"><a href=\"#查看注释结果\" class=\"headerlink\" title=\"查看注释结果\"></a>查看注释结果</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">head<span class=\"punctuation\">(</span>extract_annotation_table<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">variable_info_pos <span class=\"operator\">&lt;-</span> extract_variable_info<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>variable_info_pos<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">table<span class=\"punctuation\">(</span>variable_info_pos<span class=\"operator\">$</span>Level<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">table<span class=\"punctuation\">(</span>variable_info_pos<span class=\"operator\">$</span>Database<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"保存数据\"><a href=\"#保存数据\" class=\"headerlink\" title=\"保存数据\"></a>保存数据</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">save<span class=\"punctuation\">(</span>object_pos2<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;metabolite_annotation/object_pos2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>object_neg2<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;metabolite_annotation/object_neg2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"统计分析\"><a href=\"#统计分析\" class=\"headerlink\" title=\"统计分析\"></a>统计分析</h2><h3 id=\"加载数据-1\"><a href=\"#加载数据-1\" class=\"headerlink\" title=\"加载数据\"></a>加载数据</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>tidymass<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>tidyverse<span class=\"punctuation\">)</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;metabolite_annotation/object_pos2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;metabolite_annotation/object_neg2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"移除未被注释的features\"><a href=\"#移除未被注释的features\" class=\"headerlink\" title=\"移除未被注释的features\"></a>移除未被注释的features</h3><ul>\n<li><p>正离子模式</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_pos2 <span class=\"operator\">&lt;-</span> object_pos2 <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;annotation_table&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.na</span><span class=\"punctuation\">(</span>Level<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>Level <span class=\"operator\">==</span> <span class=\"number\">1</span> <span class=\"operator\">|</span> Level <span class=\"operator\">==</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_pos2</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>负离子模式</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_neg2 <span class=\"operator\">&lt;-</span> object_neg2 <span class=\"operator\">%&gt;%</span> activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;annotation_table&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.na</span><span class=\"punctuation\">(</span>Level<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>Level <span class=\"operator\">==</span> <span class=\"number\">1</span> <span class=\"operator\">|</span> Level <span class=\"operator\">==</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object_neg2</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"合并POS和NEG数据\"><a href=\"#合并POS和NEG数据\" class=\"headerlink\" title=\"合并POS和NEG数据\"></a>合并POS和NEG数据</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># inner merge for samples and full merge for variables</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span> </span><br><span class=\"line\">merge_mass_dataset<span class=\"punctuation\">(</span></span><br><span class=\"line\">    x <span class=\"operator\">=</span> object_pos2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    y <span class=\"operator\">=</span> object_neg2<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    sample_direction <span class=\"operator\">=</span> <span class=\"string\">&quot;inner&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># left, right, inner or full，此处用inner较合理</span></span><br><span class=\"line\">    variable_direction <span class=\"operator\">=</span> <span class=\"string\">&quot;full&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># left, right, inner or full，此处用full合理</span></span><br><span class=\"line\">    sample_by <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_id&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\"># merge samples by what columns from sample_info</span></span><br><span class=\"line\">    variable_by <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;variable_id&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;mz&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;rt&quot;</span><span class=\"punctuation\">)</span><span class=\"comment\"># merge variables by what columns from variable_info</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object</span><br></pre></td></tr></table></figure>\n\n<p><strong>名词解释：</strong></p>\n<ul>\n<li>**左连接 (Left join)**：将左表中的所有记录都保留下来，而右表中与左表中记录没有匹配的部分则丢弃。</li>\n<li>**右连接 (Right join)**：将右表中的所有记录都保留下来，而左表中与右表中记录没有匹配的部分则丢弃。</li>\n<li>**内连接 (Inner join)**：只有两个表中都存在的记录才保留下来，否则丢弃。</li>\n<li>**全连接 (Full join)**：将左表和右表中的所有记录都保留下来，如果某个表中的记录没有匹配到另一个表中的记录，则用NULL填充。</li>\n</ul>\n<h3 id=\"Trace-processing-information-of-object\"><a href=\"#Trace-processing-information-of-object\" class=\"headerlink\" title=\"Trace processing information of object\"></a>Trace processing information of object</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dir.create<span class=\"punctuation\">(</span>path <span class=\"operator\">=</span> <span class=\"string\">&quot;statistical_analysis&quot;</span><span class=\"punctuation\">,</span> showWarnings <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">report_parameters<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span> path <span class=\"operator\">=</span> <span class=\"string\">&quot;statistical_analysis/&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"基于level和score移除冗余注释代谢物\"><a href=\"#基于level和score移除冗余注释代谢物\" class=\"headerlink\" title=\"基于level和score移除冗余注释代谢物\"></a>基于level和score移除冗余注释代谢物</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object <span class=\"operator\">&lt;-</span> object <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;annotation_table&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  group_by<span class=\"punctuation\">(</span>Compound.name<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>Level <span class=\"operator\">==</span> <span class=\"built_in\">min</span><span class=\"punctuation\">(</span>Level<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>SS <span class=\"operator\">==</span> <span class=\"built_in\">max</span><span class=\"punctuation\">(</span>SS<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  slice_head<span class=\"punctuation\">(</span>n <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span> object <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;annotation_table&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  group_by<span class=\"punctuation\">(</span>variable_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>Level <span class=\"operator\">==</span> <span class=\"built_in\">min</span><span class=\"punctuation\">(</span>Level<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>SS <span class=\"operator\">==</span> <span class=\"built_in\">max</span><span class=\"punctuation\">(</span>SS<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  slice_head<span class=\"punctuation\">(</span>n <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><font color=#FF0000>为何要选最小的level？SS是什么score？</font></p>\n<h3 id=\"样本聚类\"><a href=\"#样本聚类\" class=\"headerlink\" title=\"样本聚类\"></a>样本聚类</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;statistical_analysis/object_final&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 排除QC样本</span></span><br><span class=\"line\">temp_object <span class=\"operator\">&lt;-</span> object_final <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>group <span class=\"operator\">!=</span> <span class=\"string\">&quot;QC&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  scale<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ComplexHeatmap<span class=\"punctuation\">)</span></span><br><span class=\"line\">h1 <span class=\"operator\">&lt;-</span> HeatmapAnnotation<span class=\"punctuation\">(</span><span class=\"built_in\">class</span> <span class=\"operator\">=</span> extract_sample_info<span class=\"punctuation\">(</span>temp_object<span class=\"punctuation\">)</span><span class=\"operator\">$</span>group<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;statistical_analysis/Samples_heatmap.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">massstat<span class=\"operator\">::</span>Heatmap<span class=\"punctuation\">(</span>matrix <span class=\"operator\">=</span> temp_object<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                  name <span class=\"operator\">=</span> <span class=\"string\">&quot;z-score&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                  row_names_gp <span class=\"operator\">=</span> gpar<span class=\"punctuation\">(</span>cex <span class=\"operator\">=</span> <span class=\"number\">0.2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                  column_names_gp <span class=\"operator\">=</span> gpar<span class=\"punctuation\">(</span>cex <span class=\"operator\">=</span> <span class=\"number\">0.2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                  top_annotation <span class=\"operator\">=</span> h1<span class=\"punctuation\">)</span></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_16.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_16.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"样本聚类热图\"></p>\n<h3 id=\"差异表达代谢物\"><a href=\"#差异表达代谢物\" class=\"headerlink\" title=\"差异表达代谢物\"></a>差异表达代谢物</h3><p><font color=#FF0000>如果有多组数据，需要适当增加相应下述代码。“mutate_fc”的逻辑是每运行一次，则在object中增加一列“fc”，当有多个实验组时，可以将先前生成的fc重命名，因此，object中可以包含多个组间比较的fc结果。</font></p>\n<ul>\n<li><p>计算变化倍数</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取对照组样本名列表</span></span><br><span class=\"line\">control_sample_id <span class=\"operator\">=</span> object <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Control&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取实验组样本名列表</span></span><br><span class=\"line\">case_sample_id <span class=\"operator\">=</span> object <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Case&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#! 如果有多个实验组，参照以上格式在此列出，假设有实验组Case2</span></span><br><span class=\"line\">case2_sample_id <span class=\"operator\">=</span> object <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">filter<span class=\"punctuation\">(</span>group <span class=\"operator\">==</span> <span class=\"string\">&quot;Case2&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span></span><br><span class=\"line\">pull<span class=\"punctuation\">(</span>sample_id<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Calculate fold change，每次只能计算两个分组，如果有多个实验组，则依次将其与对照组比较</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span> mutate_fc<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span> </span><br><span class=\"line\">          control_sample_id <span class=\"operator\">=</span> control_sample_id<span class=\"punctuation\">,</span> </span><br><span class=\"line\">          case_sample_id <span class=\"operator\">=</span> case_sample_id<span class=\"punctuation\">,</span> </span><br><span class=\"line\">          mean_median <span class=\"operator\">=</span> <span class=\"string\">&quot;mean&quot;</span><span class=\"punctuation\">)</span><span class=\"comment\">#可选&quot;mean&quot;, &quot;median&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 control samples.</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 case samples.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#! 如果有多个实验组，则需要在此更改fc列的默认名，假设将默认的“fc”改为“fc_case1_vs_control”</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span>  object <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">dplyr<span class=\"operator\">::</span>rename<span class=\"punctuation\">(</span>fc_case1_vs_control <span class=\"operator\">=</span> fc<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#! Calculate fold change，每次只能计算两个分组，如果有多个实验组，则依次将其与对照组比较，此处计算Case2与Control</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span> mutate_fc<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span> </span><br><span class=\"line\">          control_sample_id <span class=\"operator\">=</span> control_sample_id<span class=\"punctuation\">,</span> </span><br><span class=\"line\">          case_sample_id <span class=\"operator\">=</span> case2_sample_id<span class=\"punctuation\">,</span> </span><br><span class=\"line\">          mean_median <span class=\"operator\">=</span> <span class=\"string\">&quot;mean&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 control samples.</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 case samples.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#! 如果有多个实验组，则需要在此更改fc列的默认名，假设将默认的“fc”改为“fc_case2_vs_control”</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span>  object <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">dplyr<span class=\"operator\">::</span>rename<span class=\"punctuation\">(</span>fc_case2_vs_control <span class=\"operator\">=</span> fc<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>计算p值<br><font color=\"#FF0000\">同理，当有多个实验组时，也可以分别计算p值，并将默认的列名“p_value”和“p_value_adjust”重命名，以在object中容纳多组相互比较的p值。</font></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object <span class=\"operator\">&lt;-</span> mutate_p_value<span class=\"punctuation\">(</span></span><br><span class=\"line\">  object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span></span><br><span class=\"line\">  control_sample_id <span class=\"operator\">=</span> control_sample_id<span class=\"punctuation\">,</span></span><br><span class=\"line\">  case_sample_id <span class=\"operator\">=</span> case_sample_id<span class=\"punctuation\">,</span></span><br><span class=\"line\">  method <span class=\"operator\">=</span> <span class=\"string\">&quot;t.test&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># &quot;t.test&quot;, &quot;wilcox.test&quot;</span></span><br><span class=\"line\">  p_adjust_methods <span class=\"operator\">=</span> <span class=\"string\">&quot;BH&quot;</span><span class=\"comment\"># &quot;holm&quot;, &quot;hochberg&quot;, &quot;hommel&quot;, &quot;bonferroni&quot;, &quot;BH&quot;, &quot;BY&quot;, &quot;fdr&quot;, &quot;none&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 control samples.</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 case samples.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#! 如果涉及多组间的比较，则需重命名默认表头</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span>  object <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">dplyr<span class=\"operator\">::</span>rename<span class=\"punctuation\">(</span>p_value_case1_vs_control <span class=\"operator\">=</span> p_value<span class=\"punctuation\">,</span></span><br><span class=\"line\">       p_value_adjust_case1_vs_control <span class=\"operator\">=</span> p_value_adjust<span class=\"punctuation\">)</span></span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"comment\">#! 假设存在Case2组</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span> mutate_p_value<span class=\"punctuation\">(</span></span><br><span class=\"line\">  object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span></span><br><span class=\"line\">  control_sample_id <span class=\"operator\">=</span> control_sample_id<span class=\"punctuation\">,</span></span><br><span class=\"line\">  case_sample_id <span class=\"operator\">=</span> case2_sample_id<span class=\"punctuation\">,</span></span><br><span class=\"line\">  method <span class=\"operator\">=</span> <span class=\"string\">&quot;t.test&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  p_adjust_methods <span class=\"operator\">=</span> <span class=\"string\">&quot;BH&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 control samples.</span></span><br><span class=\"line\"><span class=\"comment\">#&gt; 110 case samples.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#! 如果涉及多组间的比较，则需重命名默认表头</span></span><br><span class=\"line\">object <span class=\"operator\">&lt;-</span>  object <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">dplyr<span class=\"operator\">::</span>rename<span class=\"punctuation\">(</span>p_value_case2_vs_control <span class=\"operator\">=</span> p_value<span class=\"punctuation\">,</span></span><br><span class=\"line\">       p_value_adjust_case2_vs_control <span class=\"operator\">=</span> p_value_adjust<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>绘制火山图</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;statistical_analysis/Volcano.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  p<span class=\"operator\">&lt;-</span> volcano_plot<span class=\"punctuation\">(</span></span><br><span class=\"line\">      object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span></span><br><span class=\"line\">      fc_column_name <span class=\"operator\">=</span> <span class=\"string\">&quot;fc&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t  p_value_column_name <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value_adjust&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t  fc_up_cutoff <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">\t  fc_down_cutoff <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t  p_value_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      add_text <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      text_from <span class=\"operator\">=</span> <span class=\"string\">&quot;Compound.name&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">      point_size_scale <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value_adjust&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span> </span><br><span class=\"line\">  </span><br><span class=\"line\">  p <span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.5</span><span class=\"punctuation\">,</span> <span class=\"number\">5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_12.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_12.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"火山图\"></p>\n<p><font color=\"#FF0000\">假设存在Case2，绘制火山图。</font></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;statistical_analysis/Volcano2.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">&lt;-</span> volcano_plot<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object<span class=\"punctuation\">,</span></span><br><span class=\"line\">    fc_column_name <span class=\"operator\">=</span> <span class=\"string\">&quot;fc_case2_vs_control&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># 重命名后</span></span><br><span class=\"line\"> p_value_column_name <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value_adjust_case2_vs_control&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\"># 重命名后</span></span><br><span class=\"line\"> fc_up_cutoff <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\"> fc_down_cutoff <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"> p_value_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">           add_text <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">           text_from <span class=\"operator\">=</span> <span class=\"string\">&quot;Compound.name&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">           point_size_scale <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value_adjust_case2_vs_control&quot;</span><span class=\"punctuation\">)</span> <span class=\"comment\"># 重命名后</span></span><br><span class=\"line\"></span><br><span class=\"line\">p <span class=\"operator\">+</span> scale_size_continuous<span class=\"punctuation\">(</span><span class=\"built_in\">range</span> <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">0.5</span><span class=\"punctuation\">,</span> <span class=\"number\">5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"保存结果\"><a href=\"#保存结果\" class=\"headerlink\" title=\"保存结果\"></a>保存结果</h3><ul>\n<li><p>保存差异表达代谢物结果。如果有多个实验组，则将下述代码中的“fc”和“p_value_adjust”更改为重命名后的名称，并分别保存到不同的文件中。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">differential_metabolites <span class=\"operator\">&lt;-</span> extract_variable_info<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> object<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>fc <span class=\"operator\">&gt;</span> <span class=\"number\">2</span> <span class=\"operator\">|</span> fc <span class=\"operator\">&lt;</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> filter<span class=\"punctuation\">(</span>p_value_adjust <span class=\"operator\">&lt;</span> <span class=\"number\">0.05</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">readr<span class=\"operator\">::</span>write_csv<span class=\"punctuation\">(</span>differential_metabolites<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;statistical_analysis/differential_metabolites.csv&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>保存结果对象</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object_final <span class=\"operator\">&lt;-</span> object</span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>object_final<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;statistical_analysis/object_final&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"绘制热图\"><a href=\"#绘制热图\" class=\"headerlink\" title=\"绘制热图\"></a>绘制热图</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp_object <span class=\"operator\">&lt;-</span> object_final <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>sample_id <span class=\"operator\">%in%</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span>control_sample_id<span class=\"punctuation\">,</span> case_sample_id<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>variable_id <span class=\"operator\">%in%</span> differential_metabolites<span class=\"operator\">$</span>variable_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  scale<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ComplexHeatmap<span class=\"punctuation\">)</span></span><br><span class=\"line\">h1 <span class=\"operator\">&lt;-</span> HeatmapAnnotation<span class=\"punctuation\">(</span><span class=\"built_in\">class</span> <span class=\"operator\">=</span> extract_sample_info<span class=\"punctuation\">(</span>temp_object<span class=\"punctuation\">)</span><span class=\"operator\">$</span>group<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;statistical_analysis/diff_heatmap.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">massstat<span class=\"operator\">::</span>Heatmap<span class=\"punctuation\">(</span>matrix <span class=\"operator\">=</span> temp_object<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                  name <span class=\"operator\">=</span> <span class=\"string\">&quot;z-score&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                  row_names_gp <span class=\"operator\">=</span> gpar<span class=\"punctuation\">(</span>cex <span class=\"operator\">=</span> <span class=\"number\">0.4</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                  column_names_gp <span class=\"operator\">=</span> gpar<span class=\"punctuation\">(</span>cex <span class=\"operator\">=</span> <span class=\"number\">0.2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                  top_annotation <span class=\"operator\">=</span> h1<span class=\"punctuation\">,</span></span><br><span class=\"line\">                  row_labels <span class=\"operator\">=</span> extract_variable_info<span class=\"punctuation\">(</span>temp_object<span class=\"punctuation\">)</span><span class=\"operator\">$</span>Compound.name<span class=\"punctuation\">,</span></span><br><span class=\"line\">                  border <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>  <img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_17.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_17.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"显著差异代谢物热图\"></p>\n<h2 id=\"代谢通路富集\"><a href=\"#代谢通路富集\" class=\"headerlink\" title=\"代谢通路富集\"></a>代谢通路富集</h2><h3 id=\"导入数据\"><a href=\"#导入数据\" class=\"headerlink\" title=\"导入数据\"></a>导入数据</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>tidymass<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>tidyverse<span class=\"punctuation\">)</span></span><br><span class=\"line\">load<span class=\"punctuation\">(</span><span class=\"string\">&quot;statistical_analysis/object_final&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"富集\"><a href=\"#富集\" class=\"headerlink\" title=\"富集\"></a>富集</h4><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dir.create<span class=\"punctuation\">(</span>path <span class=\"operator\">=</span> <span class=\"string\">&quot;pathway_enrichment&quot;</span><span class=\"punctuation\">,</span> showWarnings <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">diff_metabolites <span class=\"operator\">&lt;-</span> object_final <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>p_value_adjust <span class=\"operator\">&lt;</span> <span class=\"number\">0.05</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  extract_variable_info<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>diff_metabolites<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"加载KEGG-human-pathway数据库\"><a href=\"#加载KEGG-human-pathway数据库\" class=\"headerlink\" title=\"加载KEGG human pathway数据库\"></a>加载KEGG human pathway数据库</h3><p><font color=#FF0000>可选数据库：kegg_hsa_pathway，keggMS1database，query_id_kegg，hmdb_pathway，hmdbMS1Database，query_id_hmdb。</font></p>\n<p><strong>？？这些数据库的区别是什么？</strong></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data<span class=\"punctuation\">(</span><span class=\"string\">&quot;kegg_hsa_pathway&quot;</span><span class=\"punctuation\">,</span> package <span class=\"operator\">=</span> <span class=\"string\">&quot;metpath&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">kegg_hsa_pathway</span><br><span class=\"line\"></span><br><span class=\"line\">get_pathway_class<span class=\"punctuation\">(</span>kegg_hsa_pathway<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 移除疾病相关通路!根据课题选择是否移除？</span></span><br><span class=\"line\">pathway_class <span class=\"operator\">=</span> metpath<span class=\"operator\">::</span>pathway_class<span class=\"punctuation\">(</span>kegg_hsa_pathway<span class=\"punctuation\">)</span></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>pathway_class<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">remain_idx <span class=\"operator\">=</span> pathway_class <span class=\"operator\">%&gt;%</span> unlist<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> stringr<span class=\"operator\">::</span>str_detect<span class=\"punctuation\">(</span><span class=\"string\">&quot;Disease&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> `!`<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> which<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pathway_database <span class=\"operator\">=</span> kegg_hsa_pathway<span class=\"punctuation\">[</span>remain_idx<span class=\"punctuation\">]</span></span><br><span class=\"line\">pathway_database</span><br><span class=\"line\"></span><br><span class=\"line\">kegg_id <span class=\"operator\">&lt;-</span>  diff_metabolites<span class=\"operator\">$</span>KEGG.ID </span><br><span class=\"line\">kegg_id <span class=\"operator\">&lt;-</span>  kegg_id<span class=\"punctuation\">[</span><span class=\"operator\">!</span><span class=\"built_in\">is.na</span><span class=\"punctuation\">(</span>kegg_id<span class=\"punctuation\">)</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">result <span class=\"operator\">&lt;-</span> enrich_kegg<span class=\"punctuation\">(</span></span><br><span class=\"line\">    query_id <span class=\"operator\">=</span> kegg_id<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    query_type <span class=\"operator\">=</span> <span class=\"string\">&quot;compound&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    id_type <span class=\"operator\">=</span> <span class=\"string\">&quot;KEGG&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    pathway_database <span class=\"operator\">=</span> pathway_database<span class=\"punctuation\">,</span> </span><br><span class=\"line\">    p_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    p_adjust_method <span class=\"operator\">=</span> <span class=\"string\">&quot;BH&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    threads <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">result</span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>result<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;pathway_enrichment/result&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"绘制结果\"><a href=\"#绘制结果\" class=\"headerlink\" title=\"绘制结果\"></a>绘制结果</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  bar plot</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;pathway_enrichment/barplot.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">enrich_bar_plot<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> result<span class=\"punctuation\">,</span> x_axis <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value&quot;</span><span class=\"punctuation\">,</span> cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># scatter plot</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;pathway_enrichment/scatter_plot.pdf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">enrich_scatter_plot<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> result<span class=\"punctuation\">,</span> y_axis <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value&quot;</span><span class=\"punctuation\">,</span> y_axis_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># network</span></span><br><span class=\"line\">tiff<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;pathway_enrichment/network.tiff&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">enrich_network<span class=\"punctuation\">(</span>object <span class=\"operator\">=</span> result<span class=\"punctuation\">,</span> point_size <span class=\"operator\">=</span> <span class=\"string\">&quot;p_value&quot;</span><span class=\"punctuation\">,</span> p_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span> only_significant_pathway <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_13.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_13.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"KEGG富集bar plot\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_14.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_14.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"KEGG富集scatter plot\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_15.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_15.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"KEGG富集network\"></p>\n<h2 id=\"Correlation-network-analysis\"><a href=\"#Correlation-network-analysis\" class=\"headerlink\" title=\"Correlation network analysis\"></a>Correlation network analysis</h2><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp_object <span class=\"operator\">&lt;-</span> object_final <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;sample_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>sample_id <span class=\"operator\">%in%</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span>control_sample_id<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  activate_mass_dataset<span class=\"punctuation\">(</span>what <span class=\"operator\">=</span> <span class=\"string\">&quot;variable_info&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  filter<span class=\"punctuation\">(</span>variable_id <span class=\"operator\">%in%</span> diff_metabolites<span class=\"operator\">$</span>variable_id<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  `+`<span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  <span class=\"built_in\">log</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  scale<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggraph<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>tidygraph<span class=\"punctuation\">)</span></span><br><span class=\"line\">graph_data <span class=\"operator\">&lt;-</span> convert_mass_dataset2graph<span class=\"punctuation\">(</span></span><br><span class=\"line\">    object <span class=\"operator\">=</span> temp_object<span class=\"punctuation\">,</span></span><br><span class=\"line\">    margin <span class=\"operator\">=</span> <span class=\"string\">&quot;variable&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    cor_method <span class=\"operator\">=</span> <span class=\"string\">&quot;spearman&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    p_adjust_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    p_value_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    pos_cor_cutoff <span class=\"operator\">=</span> <span class=\"number\">0.7</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    neg_cor_cutoff <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">0.7</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> </span><br><span class=\"line\">  mutate<span class=\"punctuation\">(</span>Degree <span class=\"operator\">=</span> centrality_degree<span class=\"punctuation\">(</span>mode <span class=\"operator\">=</span> <span class=\"string\">&#x27;all&#x27;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>extrafont<span class=\"punctuation\">)</span></span><br><span class=\"line\">loadfonts<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>showtext<span class=\"punctuation\">)</span></span><br><span class=\"line\">showtext_auto<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">plot <span class=\"operator\">&lt;-</span> </span><br><span class=\"line\">ggraph<span class=\"punctuation\">(</span>graph <span class=\"operator\">=</span> graph_data<span class=\"punctuation\">,</span> layout <span class=\"operator\">=</span> <span class=\"string\">&quot;kk&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">  geom_edge_fan<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>color <span class=\"operator\">=</span> correlation<span class=\"punctuation\">,</span></span><br><span class=\"line\">                    <span class=\"comment\">#width = -log((p_adjust+0.1), 10)),</span></span><br><span class=\"line\">                show.legend <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">  geom_node_point<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>size <span class=\"operator\">=</span> Degree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">  shadowtext<span class=\"operator\">::</span>geom_shadowtext<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>x <span class=\"operator\">=</span> x<span class=\"punctuation\">,</span> y <span class=\"operator\">=</span> y<span class=\"punctuation\">,</span></span><br><span class=\"line\">                                  label <span class=\"operator\">=</span> Compound.name<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                              bg.colour <span class=\"operator\">=</span> <span class=\"string\">&quot;white&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                              colour <span class=\"operator\">=</span> <span class=\"string\">&quot;black&quot;</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">  theme_graph<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">  scale_edge_color_gradient2<span class=\"punctuation\">(</span>low <span class=\"operator\">=</span> <span class=\"string\">&quot;darkblue&quot;</span><span class=\"punctuation\">,</span> mid <span class=\"operator\">=</span> <span class=\"string\">&quot;white&quot;</span><span class=\"punctuation\">,</span> high <span class=\"operator\">=</span> <span class=\"string\">&quot;red&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>plot<span class=\"punctuation\">,</span> filename <span class=\"operator\">=</span> <span class=\"string\">&quot;pathway_enrichment/cor_network.pdf&quot;</span><span class=\"punctuation\">,</span> width <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">,</span> height <span class=\"operator\">=</span> <span class=\"number\">7</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_18.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/0_18.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"代谢物Correlation network\"></p>\n<h1 id=\"术语\"><a href=\"#术语\" class=\"headerlink\" title=\"术语\"></a>术语</h1><ul>\n<li><strong>HILIC</strong>（亲水相互作用色谱）&amp; <strong>RPLC</strong>（反相色谱）：RPLC 色谱柱主要使用非极性固定相（C18、C8 等），而 HILIC 色谱柱则使用极性固定相（二氧化硅、酰胺等）。两种技术采用的流动相通常由乙腈和水组成，这使得两种液相色谱模式之间可以实现轻松切换。HILIC 和 RPLC 流动相的主要区别在于溶剂洗脱强度。对于 RPLC，乙腈是强洗脱溶剂。但对于HILIC，水是强洗脱溶剂。对于 RPLC，得到的色谱图通常是极性分析物到非极性分析物，而 HILIC 则相反。这种相反的洗脱顺序使 HILIC 成为更常用的 RPLC 的一个很好的补充技术。对于极性分析物和离子化分析物尤其如此，它们在 HILIC 模式下的保留时间更长。</li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://www.bioengx.com/%E8%B4%A8%E8%B0%B1%E5%88%86%E6%9E%90%E6%9C%AF%E8%AF%AD%E6%9C%80%E5%85%A8%E8%A7%A3%E8%AF%BB/\">质谱分析术语最全解读</a></li>\n<li><a href=\"https://www.tidymass.org/start/whole_workflow/\">Whole workflow using tidymass</a></li>\n<li><a href=\"https://www.agilent.com/cs/library/applications/application-note-hilic%20versus-rplc-5994-1137zh-cn-agilent.pdf\">极性分子的保留和分离 ― 关于何时使用 HILIC 与反相液相色谱柱的详细研究</a></li>\n</ul>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"生信软件","path":"api/tags/生信软件.json"},{"name":"代谢组","path":"api/tags/代谢组.json"}]},{"title":"用metid构建代谢组数据库","slug":"用metid构建代谢组数据库","date":"2023-04-17T09:15:39.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/用metid构建代谢组数据库.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_1.jpg","content":"<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><p>metid包能够用于in-house代谢物库构建，并可利用MS2 spectra进行代谢物鉴定。metid自带数据库，来自于公共数据库的整合。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>require<span class=\"punctuation\">(</span>remotes<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;remotes&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">remotes<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;tidymass/metid&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"数据库构建和使用\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_1.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_1.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"数据库构建和使用\"></p>\n<h1 id=\"建库\"><a href=\"#建库\" class=\"headerlink\" title=\"建库\"></a>建库</h1><h2 id=\"构建内部库\"><a href=\"#构建内部库\" class=\"headerlink\" title=\"构建内部库\"></a>构建内部库</h2><h3 id=\"质谱数据准备\"><a href=\"#质谱数据准备\" class=\"headerlink\" title=\"质谱数据准备\"></a>质谱数据准备</h3><p>将标准品原始质谱数据用<a href=\"http://www.proteowizard.org/download.html\">ProteoWizard</a>转换为mzXM格式.</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_2.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_2.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"格式转换\"></p>\n<h3 id=\"标准品信息表\"><a href=\"#标准品信息表\" class=\"headerlink\" title=\"标准品信息表\"></a>标准品信息表</h3><p>将标准品信息整理至csv格式表格中，参考如下。<br>共11列：“Lab.ID”, “Compound.name”, “mz”, “RT”, “CAS.ID”, “HMDB.ID”, “KEGG.ID”, “Formula”, “mz.pos”, “mz.neg”, “Submitter”。也可以添加更多的信息，如“Family”, “Sub.pathway” 和“Note”。</p>\n<p>Lab.ID: 不可重复</p>\n<p>mz: 化合物准确的mass</p>\n<p>RT: 保留时间，以秒为单位</p>\n<p>mz.pos: 正离子模式下化合物的mz，如M+H。可设为NA</p>\n<p>mz.neg: 负离子模式下化合物的mz，如M-H。可设为NA</p>\n<p>Submitter: 个人或组织名称，可设为NA</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_3.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_3.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"info.csv\"></p>\n<p>新建目录<code>database_construction</code>，将正离子数据放在<code>database_construction/POS</code>中，将负离子数据放在<code>database_construction/NEG</code>中，标准品信息表<code>metabolite.info_RPLC.csv</code>放在<code>database_construction</code>中。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_4.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/df57_4.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"数据集\"></p>\n<p><strong>注意</strong>：每个文件名必须包含碰撞能（collision energy），如<code>test_NCE25.mzXML</code>。</p>\n<h3 id=\"建库-1\"><a href=\"#建库-1\" class=\"headerlink\" title=\"建库\"></a>建库</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>metid<span class=\"punctuation\">)</span></span><br><span class=\"line\">datapath<span class=\"operator\">&lt;-</span>file.path<span class=\"punctuation\">(</span><span class=\"string\">&quot;./database_construction&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">mydb <span class=\"operator\">&lt;-</span> construct_database<span class=\"punctuation\">(</span></span><br><span class=\"line\">    path <span class=\"operator\">=</span> datapath<span class=\"punctuation\">,</span></span><br><span class=\"line\">\tversion <span class=\"operator\">=</span> <span class=\"string\">&quot;0.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\tmetabolite.info.name <span class=\"operator\">=</span> <span class=\"string\">&quot;metabolite.info_RPLC.csv&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\tsource <span class=\"operator\">=</span> <span class=\"string\">&quot;my lab&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\tlink <span class=\"operator\">=</span> <span class=\"string\">&quot;http://xxx.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\tcreater <span class=\"operator\">=</span> <span class=\"string\">&quot;someone&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\temail <span class=\"operator\">=</span> <span class=\"string\">&quot;x@126.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\trt <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> <span class=\"comment\"># Do the metabolites have RT information or not?</span></span><br><span class=\"line\">\tmz.tol <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">,</span> <span class=\"comment\"># m/z tolerance for the match between metabolites and precursor m/z of MS2 spectra.</span></span><br><span class=\"line\">\trt.tol <span class=\"operator\">=</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span> <span class=\"comment\"># RT tolerance for the match between metabolites and precursor m/z of MS2 spectra.</span></span><br><span class=\"line\">\tthreads <span class=\"operator\">=</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存数据库</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>mydb<span class=\"punctuation\">,</span> file<span class=\"operator\">=</span><span class=\"string\">&quot;mydb&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：保存时前后名字必须一样。</p>\n<h2 id=\"构建公共库\"><a href=\"#构建公共库\" class=\"headerlink\" title=\"构建公共库\"></a>构建公共库</h2><h3 id=\"安装massdatabase\"><a href=\"#安装massdatabase\" class=\"headerlink\" title=\"安装massdatabase\"></a>安装<a href=\"https://massdatabase.tidymass.org/index.html\">massdatabase</a></h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">remotes<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;tidymass/massdatabase&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>可将msp格式的数据库转换为metid数据库。<font color=#FF0000>目前有bug：Error in `dplyr::select()`: ! Can’t subset columns that don’t exist. ✖ Column `Name` doesn’t exist.</font></p>\n<p>bug解决前可以下载已经构建好的公共库：<a href=\"https://tidymass.github.io/metid/articles/public_databases.html\">Database provided for metid</a>。</p>\n<h3 id=\"MassBank\"><a href=\"#MassBank\" class=\"headerlink\" title=\"MassBank\"></a><a href=\"https://github.com/MassBank/MassBank-data/releases\">MassBank</a></h3><p>下载最新的release <a href=\"https://github.com/MassBank/MassBank-data/releases/download/2022.12.1/MassBank_NIST.msp\">MassBank_NIST.msp</a>，将其放在当前目录下。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;C:/Users/liu/Downloads&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>metid<span class=\"punctuation\">)</span></span><br><span class=\"line\">massbank_database_2022.12.01 <span class=\"operator\">&lt;-</span> construct_mona_database<span class=\"punctuation\">(</span></span><br><span class=\"line\">  file <span class=\"operator\">=</span> <span class=\"string\">&quot;MassBank_NIST.msp&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  path <span class=\"operator\">=</span> <span class=\"string\">&quot;.&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  version <span class=\"operator\">=</span> <span class=\"string\">&quot;2022.12.01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  source <span class=\"operator\">=</span> <span class=\"string\">&quot;MassBank&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  link <span class=\"operator\">=</span> <span class=\"string\">&quot;https://github.com/MassBank/MassBank-data/releases&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  creater <span class=\"operator\">=</span> <span class=\"string\">&quot;Hualin Liu&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  email <span class=\"operator\">=</span> <span class=\"string\">&quot;LHL371@126.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  rt <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  threads <span class=\"operator\">=</span> <span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>massbank_database_2022.12.01<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;massbank_database_2022.12.01&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MoNA\"><a href=\"#MoNA\" class=\"headerlink\" title=\"MoNA\"></a><a href=\"https://mona.fiehnlab.ucdavis.edu/downloads\">MoNA</a></h3><p>下载对应数据库，如此处下载<code>LC-MS Spectra (153,242 spectra)</code>，截至<a href=\"https://mona.fiehnlab.ucdavis.edu/spectra/statistics\">2023.04.16</a>。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>metid<span class=\"punctuation\">)</span></span><br><span class=\"line\">mona_database_2023.04.16 <span class=\"operator\">&lt;-</span> construct_mona_database<span class=\"punctuation\">(</span></span><br><span class=\"line\">  file <span class=\"operator\">=</span> <span class=\"string\">&quot;MoNA-export-LC-MS_Spectra.msp&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  path <span class=\"operator\">=</span> <span class=\"string\">&quot;.&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  version <span class=\"operator\">=</span> <span class=\"string\">&quot;2023.04.16&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  source <span class=\"operator\">=</span> <span class=\"string\">&quot;MoNA&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  link <span class=\"operator\">=</span> <span class=\"string\">&quot;https://mona.fiehnlab.ucdavis.edu/&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  creater <span class=\"operator\">=</span> <span class=\"string\">&quot;Hualin Liu&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  email <span class=\"operator\">=</span> <span class=\"string\">&quot;LHL371@126.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  rt <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  threads <span class=\"operator\">=</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>mona_database_2023.04.16<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> <span class=\"string\">&quot;mona_database_2023.04.16&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>massdatabase<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">data <span class=\"operator\">&lt;-</span> massdatabase<span class=\"operator\">::</span>read_msp_data<span class=\"punctuation\">(</span><span class=\"string\">&quot;MoNA-export-LC-MS_Spectra.msp&quot;</span><span class=\"punctuation\">,</span> source <span class=\"operator\">=</span> <span class=\"string\">&quot;mona&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">massdatabase<span class=\"operator\">::</span>convert_mona2metid<span class=\"punctuation\">(</span>data <span class=\"operator\">=</span> data<span class=\"punctuation\">,</span> path <span class=\"operator\">=</span> <span class=\"string\">&quot;.&quot;</span><span class=\"punctuation\">,</span> threads <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://tidymass.github.io/metid/articles/database_construction.html\">Construct in-house MS2 datbase using metid</a></li>\n<li><a href=\"https://tidymass.github.io/metid/articles/public_database_construction.html\">Construct public MS2 datbase using metid</a></li>\n</ul>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"生信软件","path":"api/tags/生信软件.json"},{"name":"代谢组学","path":"api/tags/代谢组学.json"}]}]}