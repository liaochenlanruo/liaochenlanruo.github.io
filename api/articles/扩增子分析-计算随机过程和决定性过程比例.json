{"title":"扩增子分析--计算随机过程和决定性过程比例","slug":"扩增子分析-计算随机过程和决定性过程比例","date":"2021-03-25T08:42:06.000Z","updated":"2024-03-11T13:07:17.362Z","comments":true,"path":"api/articles/扩增子分析-计算随机过程和决定性过程比例.json","excerpt":"确定性过程（deterministic processes）和随机性过程（stochastic processes)是两个影响微生物群落结构系统发育组装的重要过程，本文介绍计算二者所占比例的方法。","covers":null,"content":"<p>确定性过程（deterministic processes）和随机性过程（stochastic processes)是两个影响微生物群落结构系统发育组装的重要过程，本文介绍计算二者所占比例的方法。</p>\n<span id=\"more\"></span>\n<h1 id=\"1-软件\"><a href=\"#1-软件\" class=\"headerlink\" title=\"1. 软件\"></a><font color=#FF0000 >1. 软件</font></h1><ul>\n<li>NST</li>\n<li>iCAMP</li>\n<li>ape 用于读取进化树文件</li>\n<li>picante</li>\n</ul>\n<h1 id=\"2-文件准备\"><a href=\"#2-文件准备\" class=\"headerlink\" title=\"2. 文件准备\"></a><font color=#FF0000 >2. 文件准备</font></h1><h2 id=\"2-1-Feature-Table\"><a href=\"#2-1-Feature-Table\" class=\"headerlink\" title=\"2.1 Feature Table\"></a><font color=#FF0000 >2.1 Feature Table</font></h2><p>行为OTUs&#x2F;ASVs，列为样本。</p>\n<table>\n<thead>\n<tr>\n<th>TaxonID</th>\n<th>Sample 1</th>\n<th>Sample 2</th>\n<th>Sample 3</th>\n<th>Sample 4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>232.0</td>\n<td>209.0</td>\n<td>349.0</td>\n<td>256.0</td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>75.0</td>\n<td>35.0</td>\n<td>44.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>237.0</td>\n<td>224.0</td>\n<td>291.0</td>\n<td>353.0</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>371.0</td>\n<td>80.0</td>\n<td>319.0</td>\n<td>345.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-2-Group-File\"><a href=\"#2-2-Group-File\" class=\"headerlink\" title=\"2.2 Group File\"></a><font color=#FF0000 >2.2 Group File</font></h2><p>该文件描述了所有样本的分组情况，如实验组和对照组，或者其他分组。</p>\n<table>\n<thead>\n<tr>\n<th>Sample_ID</th>\n<th>Group</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-3-Tree-File\"><a href=\"#2-3-Tree-File\" class=\"headerlink\" title=\"2.3 Tree File\"></a><font color=#FF0000 >2.3 Tree File</font></h2><p>包含Feature table中所有OTUs&#x2F;ASVs的系统发育树文件，理想条件下仅包含Feature table中的OTUs&#x2F;ASVs，不过大部分情况下还会包含数据库中的一些物种，在随后的分析中需要去除多余的物种（后续会讲到）。</p>\n<h1 id=\"3-开始分析\"><a href=\"#3-开始分析\" class=\"headerlink\" title=\"3. 开始分析\"></a><font color=#FF0000 >3. 开始分析</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">########################</span></span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># version 20200919</span></span><br><span class=\"line\"><span class=\"comment\"># Step 1. 文件、路径和参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定包含输入文件的目录路径，注意区分Windows和Linux的路径写法</span></span><br><span class=\"line\">wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定结果文件的保存路径</span></span><br><span class=\"line\">save.wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick/Result2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建文件保存路径</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span> recursive <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定Feature table（OTU表）的文件名</span></span><br><span class=\"line\">com.file<span class=\"operator\">=</span><span class=\"string\">&quot;feature-table.tsv&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定样本分组文件，每行为一个样本</span></span><br><span class=\"line\">group.file<span class=\"operator\">=</span><span class=\"string\">&quot;treatment.txt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定NWK格式的系统发育树文件</span></span><br><span class=\"line\">tree.file<span class=\"operator\">=</span><span class=\"string\">&quot;tree.nwk&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置并行运算使用的线程数</span></span><br><span class=\"line\">nworker<span class=\"operator\">=</span><span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># randomization time for null model analysis. 真实分析的时候一般设置为1000，如果测试的话可以设20</span></span><br><span class=\"line\">rand.time<span class=\"operator\">=</span><span class=\"number\">999</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出文件的前缀名，随便设置</span></span><br><span class=\"line\">prefix<span class=\"operator\">=</span><span class=\"string\">&quot;Lujia&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 2. 加载R包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 确保已经安装过所需的R包</span></span><br><span class=\"line\"><span class=\"comment\">#install.packages(&quot;NST&quot;) </span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ape<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>iCAMP<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>NST<span class=\"punctuation\">)</span> <span class=\"comment\"># need to be NST &gt;=3.0.3</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 3. 加载数据并匹配IDs</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入Feature Table，注意自己文件的列与列之间的分隔符是什么，制表符用sep = &quot;\\t&quot;，逗号用sep = &quot;,&quot;</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>read.table<span class=\"punctuation\">(</span>com.file<span class=\"punctuation\">,</span>header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入分组文件，同样注意设置分隔符</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span>group.file<span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果tree中的OTUs和Feature Table中的OTUs一一对应，可以直接用下面一个命令读入tree（注意去掉###），否则的话则运行下面LHL加入的3行命令</span></span><br><span class=\"line\"><span class=\"comment\">###tree=ape::read.tree(file = tree.file) # if you have tree</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下3行是LHL加入的</span></span><br><span class=\"line\">phy<span class=\"operator\">&lt;-</span>read.tree<span class=\"punctuation\">(</span>tree.file<span class=\"punctuation\">)</span><span class=\"comment\"># 读入树文件</span></span><br><span class=\"line\">prune_tree<span class=\"operator\">&lt;-</span>prune.sample<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">,</span>phy<span class=\"punctuation\">)</span><span class=\"comment\"># 使树文件和OTU表文件一一对齐</span></span><br><span class=\"line\">tree<span class=\"operator\">=</span>prune_tree <span class=\"comment\"># 此刻的Tree干净了，可用于后续分析而不会报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的样本名称是否与分组文件中的样本名一一对应</span></span><br><span class=\"line\">samp.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>rn.list<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span>group<span class=\"operator\">=</span>group<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span>colSums<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">)</span><span class=\"operator\">&gt;</span><span class=\"number\">0</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>group</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的OTUs名称是否与Tree中的OTUs名一一对应</span></span><br><span class=\"line\">tax.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>cn.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>tree.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>tree<span class=\"operator\">=</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"comment\"># if you have tree</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">tree<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>tree</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 4. Grouping way and metacommunity seting</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选择分组，如果拥有多种分组方式，每次运行时选择其中的一组。此处选择的时分组文件中的第二列</span></span><br><span class=\"line\">groupi<span class=\"operator\">=</span>group<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重新定义输出文件的前缀，以分组的名称来命名，此处以分组文件第二列的表头“Group”为前缀</span></span><br><span class=\"line\">prefixi<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>prefix<span class=\"punctuation\">,</span><span class=\"string\">&quot;.Group&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if treatment and control are from different metacommunities, you may set meta.groupi=groupi，默认为NULL</span></span><br><span class=\"line\"><span class=\"comment\">#meta.groupi=NULL</span></span><br><span class=\"line\">meta.groupi<span class=\"operator\">=</span>groupi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5. taxonomic NST</span></span><br><span class=\"line\"><span class=\"comment\"># Step 5.1 calculate tNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定计算距离矩阵的方法，&quot;jaccard&quot; and &quot;bray&quot; are preferred.</span></span><br><span class=\"line\">dist.method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录运行时间</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入输出目录</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算tNST</span></span><br><span class=\"line\">tnst<span class=\"operator\">=</span>tNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> meta.com<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> dist.method<span class=\"operator\">=</span>dist.method<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> LB<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> null.model<span class=\"operator\">=</span><span class=\"string\">&quot;PF&quot;</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以R data格式保存tNST的输出 </span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnst<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存其他tNST结果到多个文件中</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.2 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bootstrapping</span></span><br><span class=\"line\">tnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.3 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">tnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Steo 6. phylogenetic NST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.1 phylogentic distance matrix # use bigmemory for big dataset</span></span><br><span class=\"line\"></span><br><span class=\"line\">wd.pd<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span><span class=\"string\">&quot;/pdbig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>dir.exists<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span>dir.create<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span>file.exists<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.desc&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\"># if already done before, directly use it.</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>tip.label<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.wd<span class=\"operator\">=</span>wd.pd</span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.desc&quot;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.name.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"keyword\">else</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span>iCAMP<span class=\"operator\">::</span>pdist.big<span class=\"punctuation\">(</span>tree <span class=\"operator\">=</span> tree<span class=\"punctuation\">,</span> wd <span class=\"operator\">=</span> wd.pd<span class=\"punctuation\">,</span> nworker <span class=\"operator\">=</span> nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.2 calculate pNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># to count time cost</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnst<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>pNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> pd.desc<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.file<span class=\"punctuation\">,</span> pd.wd<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.wd<span class=\"punctuation\">,</span></span><br><span class=\"line\">pd.spname<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>tip.label<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> taxo.null.model<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> phylo.shuffle<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> exclude.conspecifics<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save pNST output in R data format</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnst<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.3 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.4 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-结果解读\"><a href=\"#4-结果解读\" class=\"headerlink\" title=\"4. 结果解读\"></a><font color=#FF0000 >4. 结果解读</font></h1><h2 id=\"4-1-确定性过程和随机性过程的相对重要性\"><a href=\"#4-1-确定性过程和随机性过程的相对重要性\" class=\"headerlink\" title=\"4.1 确定性过程和随机性过程的相对重要性\"></a><font color=#FF0000 >4.1 确定性过程和随机性过程的相对重要性</font></h2><ul>\n<li><p>An index, normalized stochasticity ratio (NST), was developed with 50% as the boundary point between more deterministic (&lt;50%) and more stochastic (&gt;50%) assembly. <font color=#2196F3>NST &gt; 50%时Stochastic Processes占主导，而NST &lt; 50%时，Deterministic Processes占主导。</font></p>\n</li>\n<li><p>用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。同质性和变异性选择应分别造成小于和大于预期的群落更替;βNTI &lt;−2或&gt; + 2进一步解释为表明同质性或变异性选择分别占主导地位;</p>\n</li>\n</ul>\n<h2 id=\"4-2-通过RCbray判断随机过程中各种过程的贡献\"><a href=\"#4-2-通过RCbray判断随机过程中各种过程的贡献\" class=\"headerlink\" title=\"4.2 通过RCbray判断随机过程中各种过程的贡献\"></a><font color=#FF0000 >4.2 通过RCbray判断随机过程中各种过程的贡献</font></h2><p>Modified Raup-Crick index (RCbray) is subsequently calculated by comparing empirically observed Bray-Curtis and simulated null distribution. Thus, according to themodified Raup-Crick index (RCbray), stochastic processes could be classified into 3 ecological processes: 均质分散homogenizing dispersal (RCbray &lt; −0.95), 分散限制dispersal limitation (RCbray &gt; +0.95) and 生态漂变ecological drift (−0.95&lt; RCbray &lt; +0.95) <a href=\"https://doi.org/10.1038/ismej.2012.22\">Stegen et al., 2012</a>;  <a href=\"https://doi.org/10.1038/ismej.2013.93\">Stegen et al., 2013</a>.</p>\n","more":"<h1 id=\"1-软件\"><a href=\"#1-软件\" class=\"headerlink\" title=\"1. 软件\"></a><font color=#FF0000 >1. 软件</font></h1><ul>\n<li>NST</li>\n<li>iCAMP</li>\n<li>ape 用于读取进化树文件</li>\n<li>picante</li>\n</ul>\n<h1 id=\"2-文件准备\"><a href=\"#2-文件准备\" class=\"headerlink\" title=\"2. 文件准备\"></a><font color=#FF0000 >2. 文件准备</font></h1><h2 id=\"2-1-Feature-Table\"><a href=\"#2-1-Feature-Table\" class=\"headerlink\" title=\"2.1 Feature Table\"></a><font color=#FF0000 >2.1 Feature Table</font></h2><p>行为OTUs&#x2F;ASVs，列为样本。</p>\n<table>\n<thead>\n<tr>\n<th>TaxonID</th>\n<th>Sample 1</th>\n<th>Sample 2</th>\n<th>Sample 3</th>\n<th>Sample 4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>232.0</td>\n<td>209.0</td>\n<td>349.0</td>\n<td>256.0</td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>75.0</td>\n<td>35.0</td>\n<td>44.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>237.0</td>\n<td>224.0</td>\n<td>291.0</td>\n<td>353.0</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>371.0</td>\n<td>80.0</td>\n<td>319.0</td>\n<td>345.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-2-Group-File\"><a href=\"#2-2-Group-File\" class=\"headerlink\" title=\"2.2 Group File\"></a><font color=#FF0000 >2.2 Group File</font></h2><p>该文件描述了所有样本的分组情况，如实验组和对照组，或者其他分组。</p>\n<table>\n<thead>\n<tr>\n<th>Sample_ID</th>\n<th>Group</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-3-Tree-File\"><a href=\"#2-3-Tree-File\" class=\"headerlink\" title=\"2.3 Tree File\"></a><font color=#FF0000 >2.3 Tree File</font></h2><p>包含Feature table中所有OTUs&#x2F;ASVs的系统发育树文件，理想条件下仅包含Feature table中的OTUs&#x2F;ASVs，不过大部分情况下还会包含数据库中的一些物种，在随后的分析中需要去除多余的物种（后续会讲到）。</p>\n<h1 id=\"3-开始分析\"><a href=\"#3-开始分析\" class=\"headerlink\" title=\"3. 开始分析\"></a><font color=#FF0000 >3. 开始分析</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">########################</span></span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># version 20200919</span></span><br><span class=\"line\"><span class=\"comment\"># Step 1. 文件、路径和参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定包含输入文件的目录路径，注意区分Windows和Linux的路径写法</span></span><br><span class=\"line\">wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定结果文件的保存路径</span></span><br><span class=\"line\">save.wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick/Result2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建文件保存路径</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span> recursive <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定Feature table（OTU表）的文件名</span></span><br><span class=\"line\">com.file<span class=\"operator\">=</span><span class=\"string\">&quot;feature-table.tsv&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定样本分组文件，每行为一个样本</span></span><br><span class=\"line\">group.file<span class=\"operator\">=</span><span class=\"string\">&quot;treatment.txt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定NWK格式的系统发育树文件</span></span><br><span class=\"line\">tree.file<span class=\"operator\">=</span><span class=\"string\">&quot;tree.nwk&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置并行运算使用的线程数</span></span><br><span class=\"line\">nworker<span class=\"operator\">=</span><span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># randomization time for null model analysis. 真实分析的时候一般设置为1000，如果测试的话可以设20</span></span><br><span class=\"line\">rand.time<span class=\"operator\">=</span><span class=\"number\">999</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出文件的前缀名，随便设置</span></span><br><span class=\"line\">prefix<span class=\"operator\">=</span><span class=\"string\">&quot;Lujia&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 2. 加载R包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 确保已经安装过所需的R包</span></span><br><span class=\"line\"><span class=\"comment\">#install.packages(&quot;NST&quot;) </span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ape<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>iCAMP<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>NST<span class=\"punctuation\">)</span> <span class=\"comment\"># need to be NST &gt;=3.0.3</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 3. 加载数据并匹配IDs</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入Feature Table，注意自己文件的列与列之间的分隔符是什么，制表符用sep = &quot;\\t&quot;，逗号用sep = &quot;,&quot;</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>read.table<span class=\"punctuation\">(</span>com.file<span class=\"punctuation\">,</span>header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入分组文件，同样注意设置分隔符</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span>group.file<span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果tree中的OTUs和Feature Table中的OTUs一一对应，可以直接用下面一个命令读入tree（注意去掉###），否则的话则运行下面LHL加入的3行命令</span></span><br><span class=\"line\"><span class=\"comment\">###tree=ape::read.tree(file = tree.file) # if you have tree</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下3行是LHL加入的</span></span><br><span class=\"line\">phy<span class=\"operator\">&lt;-</span>read.tree<span class=\"punctuation\">(</span>tree.file<span class=\"punctuation\">)</span><span class=\"comment\"># 读入树文件</span></span><br><span class=\"line\">prune_tree<span class=\"operator\">&lt;-</span>prune.sample<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">,</span>phy<span class=\"punctuation\">)</span><span class=\"comment\"># 使树文件和OTU表文件一一对齐</span></span><br><span class=\"line\">tree<span class=\"operator\">=</span>prune_tree <span class=\"comment\"># 此刻的Tree干净了，可用于后续分析而不会报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的样本名称是否与分组文件中的样本名一一对应</span></span><br><span class=\"line\">samp.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>rn.list<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span>group<span class=\"operator\">=</span>group<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span>colSums<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">)</span><span class=\"operator\">&gt;</span><span class=\"number\">0</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>group</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的OTUs名称是否与Tree中的OTUs名一一对应</span></span><br><span class=\"line\">tax.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>cn.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>tree.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>tree<span class=\"operator\">=</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"comment\"># if you have tree</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">tree<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>tree</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 4. Grouping way and metacommunity seting</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选择分组，如果拥有多种分组方式，每次运行时选择其中的一组。此处选择的时分组文件中的第二列</span></span><br><span class=\"line\">groupi<span class=\"operator\">=</span>group<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重新定义输出文件的前缀，以分组的名称来命名，此处以分组文件第二列的表头“Group”为前缀</span></span><br><span class=\"line\">prefixi<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>prefix<span class=\"punctuation\">,</span><span class=\"string\">&quot;.Group&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if treatment and control are from different metacommunities, you may set meta.groupi=groupi，默认为NULL</span></span><br><span class=\"line\"><span class=\"comment\">#meta.groupi=NULL</span></span><br><span class=\"line\">meta.groupi<span class=\"operator\">=</span>groupi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5. taxonomic NST</span></span><br><span class=\"line\"><span class=\"comment\"># Step 5.1 calculate tNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定计算距离矩阵的方法，&quot;jaccard&quot; and &quot;bray&quot; are preferred.</span></span><br><span class=\"line\">dist.method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录运行时间</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入输出目录</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算tNST</span></span><br><span class=\"line\">tnst<span class=\"operator\">=</span>tNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> meta.com<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> dist.method<span class=\"operator\">=</span>dist.method<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> LB<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> null.model<span class=\"operator\">=</span><span class=\"string\">&quot;PF&quot;</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以R data格式保存tNST的输出 </span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnst<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存其他tNST结果到多个文件中</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.2 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bootstrapping</span></span><br><span class=\"line\">tnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.3 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">tnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Steo 6. phylogenetic NST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.1 phylogentic distance matrix # use bigmemory for big dataset</span></span><br><span class=\"line\"></span><br><span class=\"line\">wd.pd<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span><span class=\"string\">&quot;/pdbig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>dir.exists<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span>dir.create<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span>file.exists<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.desc&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\"># if already done before, directly use it.</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>tip.label<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.wd<span class=\"operator\">=</span>wd.pd</span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.desc&quot;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.name.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"keyword\">else</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span>iCAMP<span class=\"operator\">::</span>pdist.big<span class=\"punctuation\">(</span>tree <span class=\"operator\">=</span> tree<span class=\"punctuation\">,</span> wd <span class=\"operator\">=</span> wd.pd<span class=\"punctuation\">,</span> nworker <span class=\"operator\">=</span> nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.2 calculate pNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># to count time cost</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnst<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>pNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> pd.desc<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.file<span class=\"punctuation\">,</span> pd.wd<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.wd<span class=\"punctuation\">,</span></span><br><span class=\"line\">pd.spname<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>tip.label<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> taxo.null.model<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> phylo.shuffle<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> exclude.conspecifics<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save pNST output in R data format</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnst<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.3 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.4 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-结果解读\"><a href=\"#4-结果解读\" class=\"headerlink\" title=\"4. 结果解读\"></a><font color=#FF0000 >4. 结果解读</font></h1><h2 id=\"4-1-确定性过程和随机性过程的相对重要性\"><a href=\"#4-1-确定性过程和随机性过程的相对重要性\" class=\"headerlink\" title=\"4.1 确定性过程和随机性过程的相对重要性\"></a><font color=#FF0000 >4.1 确定性过程和随机性过程的相对重要性</font></h2><ul>\n<li><p>An index, normalized stochasticity ratio (NST), was developed with 50% as the boundary point between more deterministic (&lt;50%) and more stochastic (&gt;50%) assembly. <font color=#2196F3>NST &gt; 50%时Stochastic Processes占主导，而NST &lt; 50%时，Deterministic Processes占主导。</font></p>\n</li>\n<li><p>用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。同质性和变异性选择应分别造成小于和大于预期的群落更替;βNTI &lt;−2或&gt; + 2进一步解释为表明同质性或变异性选择分别占主导地位;</p>\n</li>\n</ul>\n<h2 id=\"4-2-通过RCbray判断随机过程中各种过程的贡献\"><a href=\"#4-2-通过RCbray判断随机过程中各种过程的贡献\" class=\"headerlink\" title=\"4.2 通过RCbray判断随机过程中各种过程的贡献\"></a><font color=#FF0000 >4.2 通过RCbray判断随机过程中各种过程的贡献</font></h2><p>Modified Raup-Crick index (RCbray) is subsequently calculated by comparing empirically observed Bray-Curtis and simulated null distribution. Thus, according to themodified Raup-Crick index (RCbray), stochastic processes could be classified into 3 ecological processes: 均质分散homogenizing dispersal (RCbray &lt; −0.95), 分散限制dispersal limitation (RCbray &gt; +0.95) and 生态漂变ecological drift (−0.95&lt; RCbray &lt; +0.95) <a href=\"https://doi.org/10.1038/ismej.2012.22\">Stegen et al., 2012</a>;  <a href=\"https://doi.org/10.1038/ismej.2013.93\">Stegen et al., 2013</a>.</p>","categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"}]}