{"title":"扩增子可视化专题","slug":"扩增子可视化专题","date":"2021-09-15T03:23:28.000Z","updated":"2022-01-08T02:16:28.447Z","comments":true,"path":"api/articles/扩增子可视化专题.json","excerpt":null,"covers":null,"content":"<p>扩增子分析较常用的软件是 QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将 QIIME2 生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a class=\"markdownIt-Anchor\" href=\"#准备数据\"></a> 准备数据</h1>\n<ul>\n<li>特征表（Feature table），或者叫做 OTU 表，本教程中文件名为<strong> feature-table.tsv</strong>。该文件可由 QIIME2 生成，由 biome 格式转换而来。</li>\n</ul>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2_1\tH2_2\tH2_3\tH2_4\tH2_5\tH2_6\tI1_1\tI1_2\tI1_3\tI1_4\tI1_5\tI1_6\n3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\nd2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0\n4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0\n0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0\n7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0\nb624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0\n60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong> sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite\nF01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF\nF02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF\nF03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF\nF04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF\nF05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF\nF06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF\nH2_1\tH2_1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2\nH2_2\tH2_2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2\nH2_3\tH2_3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2\nH2_4\tH2_4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2\nH2_5\tH2_5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2\nH2_6\tH2_6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2\nI1_1\tI1_1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1\nI1_2\tI1_2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1\nI1_3\tI1_3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1\nI1_4\tI1_4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1\nI1_5\tI1_5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1\nI1_6\tI1_6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>分类信息，本教程中文件名为<strong> taxonomy.tsv</strong>。该文件可由 QIIME2 生成。</li>\n</ul>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">Feature ID\tTaxon\tConfidence\n9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045\n2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394\n5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067\ncc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506\n5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154\nd62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316\n920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409\nb5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555\n43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367\n0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901\n430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459\n0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>进化树，本教程中文件名为<strong> tree.nwk</strong>。该文件可由 QIIME2 生成，Newick 格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr />\n<h1 id=\"alpha-diversity\"><a class=\"markdownIt-Anchor\" href=\"#alpha-diversity\"></a> Alpha diversity</h1>\n<h2 id=\"shannon-richness-simpson-chao1-ace-pielou-pd_whole_tree指数的计算与可视化\"><a class=\"markdownIt-Anchor\" href=\"#shannon-richness-simpson-chao1-ace-pielou-pd_whole_tree指数的计算与可视化\"></a> Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree 指数的计算与可视化</h2>\n<h3 id=\"输入文件\"><a class=\"markdownIt-Anchor\" href=\"#输入文件\"></a> 输入文件</h3>\n<ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步计算多样性\"><a class=\"markdownIt-Anchor\" href=\"#第一步计算多样性\"></a> 第一步：计算多样性</h3>\n<p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\"><span class=\"token comment\">#!/usr/bin/env R</span>\n<span class=\"token comment\">#定义函数</span>\nlibrary<span class=\"token punctuation\">(</span>picante<span class=\"token punctuation\">)</span>       <span class=\"token comment\">#picante 包加载时默认同时加载 vegan</span>\n \nalpha <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> tree <span class=\"token operator\">=</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span> base <span class=\"token operator\">=</span> exp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        est <span class=\"token operator\">&lt;-</span> estimateR<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n        Richness <span class=\"token operator\">&lt;-</span> est<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span>\n        Chao1 <span class=\"token operator\">&lt;-</span> est<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span>\n        ACE <span class=\"token operator\">&lt;-</span> est<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span>\n        Shannon <span class=\"token operator\">&lt;-</span> diversity<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">'shannon'</span><span class=\"token punctuation\">,</span> base <span class=\"token operator\">=</span> base<span class=\"token punctuation\">)</span>\n        Simpson <span class=\"token operator\">&lt;-</span> diversity<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">'simpson'</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">#Gini-Simpson 指数</span>\n        Pielou <span class=\"token operator\">&lt;-</span> Shannon <span class=\"token operator\">/</span> log<span class=\"token punctuation\">(</span>Richness<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">)</span>\n        goods_coverage <span class=\"token operator\">&lt;-</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> rowSums<span class=\"token punctuation\">(</span>x <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> rowSums<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n        \n        result <span class=\"token operator\">&lt;-</span> data.frame<span class=\"token punctuation\">(</span>Richness<span class=\"token punctuation\">,</span> Shannon<span class=\"token punctuation\">,</span> Simpson<span class=\"token punctuation\">,</span> Pielou<span class=\"token punctuation\">,</span> Chao1<span class=\"token punctuation\">,</span> ACE<span class=\"token punctuation\">,</span> goods_coverage<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is.null<span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                PD_whole_tree <span class=\"token operator\">&lt;-</span> pd<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> tree<span class=\"token punctuation\">,</span> include.root <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n                names<span class=\"token punctuation\">(</span>PD_whole_tree<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> <span class=\"token string\">'PD_whole_tree'</span>\n                result <span class=\"token operator\">&lt;-</span> cbind<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> PD_whole_tree<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        result\n<span class=\"token punctuation\">&#125;</span>\n \n<span class=\"token comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span>\n<span class=\"token comment\">#加载 OTU 丰度表和进化树文件</span>\notu <span class=\"token operator\">&lt;-</span> read.delim<span class=\"token punctuation\">(</span><span class=\"token string\">'feature-table.tsv'</span><span class=\"token punctuation\">,</span> row.names <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">'\\t'</span><span class=\"token punctuation\">,</span> stringsAsFactors <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> check.names <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span>\notu <span class=\"token operator\">&lt;-</span> t<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">)</span>\ntree <span class=\"token operator\">&lt;-</span> read.tree<span class=\"token punctuation\">(</span><span class=\"token string\">'tree.nwk'</span><span class=\"token punctuation\">)</span>\n \n<span class=\"token comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span>\n<span class=\"token comment\">##alpha_all &lt;- alpha(otu, base = 2)</span>\n<span class=\"token comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span>\nalpha_all <span class=\"token operator\">&lt;-</span> alpha<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">,</span> tree<span class=\"token punctuation\">,</span> base <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n \n<span class=\"token comment\">#输出保存在本地</span>\nwrite.table<span class=\"token punctuation\">(</span>alpha_all<span class=\"token punctuation\">,</span> <span class=\"token string\">'alpha.txt'</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> quote <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"第二步制图\"><a class=\"markdownIt-Anchor\" href=\"#第二步制图\"></a> 第二步：制图</h3>\n<p>这一步需要在 Rstudio 中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出 7 个 PDF 图形文件。</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\"><span class=\"token comment\">#!/usr/bin/env R</span>\n<span class=\"token comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">,</span> quietly <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install.packages<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 加载github包安装工具</span>\nlibrary<span class=\"token punctuation\">(</span>devtools<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 检测amplicon包是否安装，没有从源码安装</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"amplicon\"</span><span class=\"token punctuation\">,</span> quietly <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install_github<span class=\"token punctuation\">(</span><span class=\"token string\">\"liaochenlanruo/amplicon\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span>\n\n<span class=\"token comment\"># library加载包，suppress不显示消息和警告信息</span>\nsuppressWarnings<span class=\"token punctuation\">(</span>suppressMessages<span class=\"token punctuation\">(</span>library<span class=\"token punctuation\">(</span>amplicon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 设置工作目录，根据实际情况设定</span>\nsetwd<span class=\"token punctuation\">(</span><span class=\"token string\">\"用户自己的工作目录\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span>\nmetadata <span class=\"token operator\">=</span> read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"sample-metadata.tsv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors <span class=\"token operator\">=</span> F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span>\n<span class=\"token comment\">#alpha_div = read.table(\"alpha.txt\", header=T, row.names=1, sep=\"\\t\", comment.char=\"\")</span>\nalpha_div <span class=\"token operator\">&lt;-</span> read.delim<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha.txt\"</span><span class=\"token punctuation\">,</span> quote<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span>\n<span class=\"token punctuation\">(</span>p1 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Shannon\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">##物种丰富度 Richness 指数</span>\n<span class=\"token punctuation\">(</span>p2 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Richness\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span>\n<span class=\"token punctuation\">(</span>p3 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Simpson\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#Chao1 指数</span>\n<span class=\"token punctuation\">(</span>p4 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Chao1\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#ACE 指数</span>\n<span class=\"token punctuation\">(</span>p5 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"ACE\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#Shannon 均匀度（Pielou 均匀度）</span>\n<span class=\"token punctuation\">(</span>p6 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Pielou\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">##谱系多样性</span>\n<span class=\"token punctuation\">(</span>p7 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"PD_whole_tree\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_shannon.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p1<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Richness.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p2<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Simpson.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p3<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Chao1.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p4<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_ACE.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p5<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Pielou.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p6<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_PD_whole_tree.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p7<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"演示视频\"><a class=\"markdownIt-Anchor\" href=\"#演示视频\"></a> 演示视频</h3>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n<hr />\n<h2 id=\"物种多样性条形图的绘制\"><a class=\"markdownIt-Anchor\" href=\"#物种多样性条形图的绘制\"></a> 物种多样性条形图的绘制</h2>\n<h3 id=\"输入文件-2\"><a class=\"markdownIt-Anchor\" href=\"#输入文件-2\"></a> 输入文件</h3>\n<ul>\n<li>处理后的 Feature Table</li>\n</ul>\n<p>从 QIIME2 可视化网站上下载的各 level 的物种丰度表，此处以 level-2（Phylum 水平）为例，命名为 “level-2.csv”。该文件可以用 excel 或 WPS 打开，然后复制所有内容至一个新建的名字为 “level-2.txt” 的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">index\tspecies1\tspecies2\tspecies3\tspecies4\nSample1\t0\t8152\t11\t65\nSample2\t12\t97\t1097\t1315\n...\nSamplex\t15\t46\t2928\t1011<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a class=\"markdownIt-Anchor\" href=\"#绘图\"></a> 绘图</h3>\n<p>以下代码在 Rstudio 中逐步输入运行</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\">setwd<span class=\"token punctuation\">(</span><span class=\"token string\">\"用户自己的路径\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">,</span> quietly<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install.packages<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">)</span>\nlibrary<span class=\"token punctuation\">(</span>devtools<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"amplicon\"</span><span class=\"token punctuation\">,</span> quietly<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install_github<span class=\"token punctuation\">(</span><span class=\"token string\">\"microbiota/amplicon\"</span><span class=\"token punctuation\">)</span>\nsuppressWarnings<span class=\"token punctuation\">(</span>suppressMessages<span class=\"token punctuation\">(</span>library<span class=\"token punctuation\">(</span>amplicon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 从文件读取元数据，特征表和物种注释</span>\nmetadata<span class=\"token operator\">=</span>read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"sample-metadata.tsv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\ntaxonomy<span class=\"token operator\">=</span>read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"taxonomy.tsv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\notutab2<span class=\"token operator\">=</span>read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"level-2.txt\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span>\n<span class=\"token comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span>\notutab2<span class=\"token operator\">=</span>t<span class=\"token punctuation\">(</span>otutab2<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>ps<span class=\"token operator\">=</span>tax_stackplot<span class=\"token punctuation\">(</span>otutab2<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID<span class=\"token operator\">=</span><span class=\"token string\">\"Site\"</span><span class=\"token punctuation\">,</span> topN<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"sample\"</span><span class=\"token punctuation\">,</span> sorted<span class=\"token operator\">=</span><span class=\"token string\">\"abundance\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nps2 <span class=\"token operator\">=</span> ps <span class=\"token operator\">+</span> scale_fill_manual<span class=\"token punctuation\">(</span>values <span class=\"token operator\">=</span> rev<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"#1f77b4\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#aec7e8\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#ff7f0e\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#ffbb78\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#2ca02c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#98df8a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#d62728\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#ff9896\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#9467bd\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#c5b0d5\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#8c564b\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#c49c94\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#e377c2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#f7b6d2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#7f7f7f\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#c7c7c7\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#bcbd22\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#dbdb8d\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#17becf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#9edae5\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> theme<span class=\"token punctuation\">(</span>axis.text.x <span class=\"token operator\">=</span> element_text<span class=\"token punctuation\">(</span>angle <span class=\"token operator\">=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span> hjust <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> vjust <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nps2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"演示视频-2\"><a class=\"markdownIt-Anchor\" href=\"#演示视频-2\"></a> 演示视频</h3>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n<hr />\n<h1 id=\"beta多样性\"><a class=\"markdownIt-Anchor\" href=\"#beta多样性\"></a> Beta 多样性</h1>\n<h2 id=\"nmds分析及可视化\"><a class=\"markdownIt-Anchor\" href=\"#nmds分析及可视化\"></a> NMDS 分析及可视化</h2>\n<h3 id=\"输入文件-3\"><a class=\"markdownIt-Anchor\" href=\"#输入文件-3\"></a> 输入文件</h3>\n<ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a class=\"markdownIt-Anchor\" href=\"#分析过程\"></a> 分析过程</h3>\n<p>在 Rstudio 中运行如下代码：</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\">setwd<span class=\"token punctuation\">(</span><span class=\"token string\">\"用户的工作目录\"</span><span class=\"token punctuation\">)</span>\nlibrary<span class=\"token punctuation\">(</span><span class=\"token string\">\"vegan\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span>\notu <span class=\"token operator\">&lt;-</span> read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"feature-table.tsv\"</span><span class=\"token punctuation\">,</span>row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span>check.names<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\ndesign <span class=\"token operator\">&lt;-</span> read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"sample-metadata.tsv\"</span><span class=\"token punctuation\">,</span>header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span>row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>check.names<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 数据调整为列名是OTU，行名是样本名</span>\notu<span class=\"token operator\">=</span>t<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span>\nvare.hel<span class=\"token operator\">&lt;-</span>decostand<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">,</span>method<span class=\"token operator\">=</span><span class=\"token string\">\"hellinger\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 计算Bray-curtis距离矩阵</span>\nvare.dis <span class=\"token operator\">&lt;-</span> vegdist<span class=\"token punctuation\">(</span>vare.hel<span class=\"token punctuation\">,</span>method<span class=\"token operator\">=</span><span class=\"token string\">\"bray\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 使用NMDS的方法</span>\nvare.mds <span class=\"token operator\">&lt;-</span> metaMDS<span class=\"token punctuation\">(</span>vare.hel<span class=\"token punctuation\">,</span>distance <span class=\"token operator\">=</span> <span class=\"token string\">\"bray\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 首先提取前两轴坐标</span>\npoint <span class=\"token operator\">=</span> scores<span class=\"token punctuation\">(</span>vare.mds<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 将分组文件和得分文件合并</span>\nindex <span class=\"token operator\">=</span> merge<span class=\"token punctuation\">(</span>design<span class=\"token punctuation\">,</span> point<span class=\"token punctuation\">,</span>by<span class=\"token operator\">=</span><span class=\"token string\">\"row.names\"</span><span class=\"token punctuation\">,</span>all<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 查看Stress值</span>\n<span class=\"token comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span>\nvare.mds\n\n<span class=\"token comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span>\n\n<span class=\"token comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span>\nanosim.result<span class=\"token operator\">&lt;-</span>anosim<span class=\"token punctuation\">(</span>vare.dis<span class=\"token punctuation\">,</span> design<span class=\"token operator\">$</span>Depth<span class=\"token punctuation\">,</span>permutations <span class=\"token operator\">=</span><span class=\"token number\">999</span><span class=\"token punctuation\">)</span>\n\nsummary<span class=\"token punctuation\">(</span>anosim.result<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span>\n<span class=\"token comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span>\n\n<span class=\"token comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span>\n<span class=\"token comment\">#tiff(file=\"beta_bray_NMDS.tiff\", res = 300, compression =\"none\", width=180,height=140,units= \"mm\")</span>\n\n<span class=\"token comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span>\npdf<span class=\"token punctuation\">(</span>file<span class=\"token operator\">=</span><span class=\"token string\">\"beta_bray_NMDS.pdf\"</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">180</span><span class=\"token punctuation\">,</span>height<span class=\"token operator\">=</span><span class=\"token number\">140</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#开始出图，代码如下：</span>\nlibrary<span class=\"token punctuation\">(</span><span class=\"token string\">\"ggplot2\"</span><span class=\"token punctuation\">)</span>\n\np <span class=\"token operator\">=</span> ggplot<span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> aes<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>NMDS1<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>NMDS2<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span>as.factor<span class=\"token punctuation\">(</span>Depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n      geom_point<span class=\"token punctuation\">(</span>size<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     <span class=\"token comment\">#scale_colour_manual(values = c(\"red\",\"blue\", \"green\")) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span>\n     labs<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"NMDS1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"NMDS2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span>\n\np<span class=\"token operator\">+</span>stat_ellipse<span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"t\"</span><span class=\"token punctuation\">,</span> linetype <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> level <span class=\"token operator\">=</span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">,</span> show.legend <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n    annotate<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">2.5</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1.25</span><span class=\"token punctuation\">,</span>parse<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>label<span class=\"token operator\">=</span><span class=\"token string\">\"'R: '*0.8036\"</span><span class=\"token punctuation\">,</span>family<span class=\"token operator\">=</span><span class=\"token string\">\"serif\"</span><span class=\"token punctuation\">,</span>fontface<span class=\"token operator\">=</span><span class=\"token string\">\"italic\"</span><span class=\"token punctuation\">,</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"darkred\"</span><span class=\"token punctuation\">,</span>hjust <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n    annotate<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">2.5</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1.35</span><span class=\"token punctuation\">,</span>parse<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>label<span class=\"token operator\">=</span><span class=\"token string\">\"'p: '*0.001\"</span><span class=\"token punctuation\">,</span>family<span class=\"token operator\">=</span><span class=\"token string\">\"serif\"</span><span class=\"token punctuation\">,</span>fontface<span class=\"token operator\">=</span><span class=\"token string\">\"italic\"</span><span class=\"token punctuation\">,</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"darkred\"</span><span class=\"token punctuation\">,</span>hjust <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n    annotate<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">2.5</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1.45</span><span class=\"token punctuation\">,</span>parse<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>label<span class=\"token operator\">=</span><span class=\"token string\">\"'Stress: '*0.075\"</span><span class=\"token punctuation\">,</span>family<span class=\"token operator\">=</span><span class=\"token string\">\"serif\"</span><span class=\"token punctuation\">,</span>fontface<span class=\"token operator\">=</span><span class=\"token string\">\"italic\"</span><span class=\"token punctuation\">,</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"darkred\"</span><span class=\"token punctuation\">,</span>hjust <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> geom_point<span class=\"token punctuation\">(</span>aes<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>NMDS1<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>NMDS2<span class=\"token punctuation\">,</span> shape<span class=\"token operator\">=</span>Site<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n\t<span class=\"token comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span>\n    theme_classic<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ndev.off<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"演示视频-3\"><a class=\"markdownIt-Anchor\" href=\"#演示视频-3\"></a> 演示视频</h3>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n<h1 id=\"参考\"><a class=\"markdownIt-Anchor\" href=\"#参考\"></a> 参考</h1>\n<ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","more":"<p>扩增子分析较常用的软件是 QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将 QIIME2 生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a class=\"markdownIt-Anchor\" href=\"#准备数据\"></a> 准备数据</h1>\n<ul>\n<li>特征表（Feature table），或者叫做 OTU 表，本教程中文件名为<strong> feature-table.tsv</strong>。该文件可由 QIIME2 生成，由 biome 格式转换而来。</li>\n</ul>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2_1\tH2_2\tH2_3\tH2_4\tH2_5\tH2_6\tI1_1\tI1_2\tI1_3\tI1_4\tI1_5\tI1_6\n3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\nd2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0\n4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0\n0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0\n7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0\nb624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0\n60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\n33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong> sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite\nF01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF\nF02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF\nF03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF\nF04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF\nF05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF\nF06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF\nH2_1\tH2_1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2\nH2_2\tH2_2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2\nH2_3\tH2_3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2\nH2_4\tH2_4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2\nH2_5\tH2_5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2\nH2_6\tH2_6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2\nI1_1\tI1_1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1\nI1_2\tI1_2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1\nI1_3\tI1_3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1\nI1_4\tI1_4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1\nI1_5\tI1_5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1\nI1_6\tI1_6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>分类信息，本教程中文件名为<strong> taxonomy.tsv</strong>。该文件可由 QIIME2 生成。</li>\n</ul>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">Feature ID\tTaxon\tConfidence\n9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045\n2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394\n5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067\ncc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506\n5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154\nd62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316\n920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409\nb5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555\n43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367\n0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901\n430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459\n0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>进化树，本教程中文件名为<strong> tree.nwk</strong>。该文件可由 QIIME2 生成，Newick 格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr />\n<h1 id=\"alpha-diversity\"><a class=\"markdownIt-Anchor\" href=\"#alpha-diversity\"></a> Alpha diversity</h1>\n<h2 id=\"shannon-richness-simpson-chao1-ace-pielou-pd_whole_tree指数的计算与可视化\"><a class=\"markdownIt-Anchor\" href=\"#shannon-richness-simpson-chao1-ace-pielou-pd_whole_tree指数的计算与可视化\"></a> Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree 指数的计算与可视化</h2>\n<h3 id=\"输入文件\"><a class=\"markdownIt-Anchor\" href=\"#输入文件\"></a> 输入文件</h3>\n<ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步计算多样性\"><a class=\"markdownIt-Anchor\" href=\"#第一步计算多样性\"></a> 第一步：计算多样性</h3>\n<p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\"><span class=\"token comment\">#!/usr/bin/env R</span>\n<span class=\"token comment\">#定义函数</span>\nlibrary<span class=\"token punctuation\">(</span>picante<span class=\"token punctuation\">)</span>       <span class=\"token comment\">#picante 包加载时默认同时加载 vegan</span>\n \nalpha <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> tree <span class=\"token operator\">=</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span> base <span class=\"token operator\">=</span> exp<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        est <span class=\"token operator\">&lt;-</span> estimateR<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n        Richness <span class=\"token operator\">&lt;-</span> est<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span>\n        Chao1 <span class=\"token operator\">&lt;-</span> est<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span>\n        ACE <span class=\"token operator\">&lt;-</span> est<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span>\n        Shannon <span class=\"token operator\">&lt;-</span> diversity<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">'shannon'</span><span class=\"token punctuation\">,</span> base <span class=\"token operator\">=</span> base<span class=\"token punctuation\">)</span>\n        Simpson <span class=\"token operator\">&lt;-</span> diversity<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">'simpson'</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">#Gini-Simpson 指数</span>\n        Pielou <span class=\"token operator\">&lt;-</span> Shannon <span class=\"token operator\">/</span> log<span class=\"token punctuation\">(</span>Richness<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">)</span>\n        goods_coverage <span class=\"token operator\">&lt;-</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> rowSums<span class=\"token punctuation\">(</span>x <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> rowSums<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n        \n        result <span class=\"token operator\">&lt;-</span> data.frame<span class=\"token punctuation\">(</span>Richness<span class=\"token punctuation\">,</span> Shannon<span class=\"token punctuation\">,</span> Simpson<span class=\"token punctuation\">,</span> Pielou<span class=\"token punctuation\">,</span> Chao1<span class=\"token punctuation\">,</span> ACE<span class=\"token punctuation\">,</span> goods_coverage<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is.null<span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                PD_whole_tree <span class=\"token operator\">&lt;-</span> pd<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> tree<span class=\"token punctuation\">,</span> include.root <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n                names<span class=\"token punctuation\">(</span>PD_whole_tree<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> <span class=\"token string\">'PD_whole_tree'</span>\n                result <span class=\"token operator\">&lt;-</span> cbind<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> PD_whole_tree<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        result\n<span class=\"token punctuation\">&#125;</span>\n \n<span class=\"token comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span>\n<span class=\"token comment\">#加载 OTU 丰度表和进化树文件</span>\notu <span class=\"token operator\">&lt;-</span> read.delim<span class=\"token punctuation\">(</span><span class=\"token string\">'feature-table.tsv'</span><span class=\"token punctuation\">,</span> row.names <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">'\\t'</span><span class=\"token punctuation\">,</span> stringsAsFactors <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> check.names <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span>\notu <span class=\"token operator\">&lt;-</span> t<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">)</span>\ntree <span class=\"token operator\">&lt;-</span> read.tree<span class=\"token punctuation\">(</span><span class=\"token string\">'tree.nwk'</span><span class=\"token punctuation\">)</span>\n \n<span class=\"token comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span>\n<span class=\"token comment\">##alpha_all &lt;- alpha(otu, base = 2)</span>\n<span class=\"token comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span>\nalpha_all <span class=\"token operator\">&lt;-</span> alpha<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">,</span> tree<span class=\"token punctuation\">,</span> base <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n \n<span class=\"token comment\">#输出保存在本地</span>\nwrite.table<span class=\"token punctuation\">(</span>alpha_all<span class=\"token punctuation\">,</span> <span class=\"token string\">'alpha.txt'</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> quote <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"第二步制图\"><a class=\"markdownIt-Anchor\" href=\"#第二步制图\"></a> 第二步：制图</h3>\n<p>这一步需要在 Rstudio 中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出 7 个 PDF 图形文件。</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\"><span class=\"token comment\">#!/usr/bin/env R</span>\n<span class=\"token comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">,</span> quietly <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install.packages<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 加载github包安装工具</span>\nlibrary<span class=\"token punctuation\">(</span>devtools<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 检测amplicon包是否安装，没有从源码安装</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"amplicon\"</span><span class=\"token punctuation\">,</span> quietly <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install_github<span class=\"token punctuation\">(</span><span class=\"token string\">\"liaochenlanruo/amplicon\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span>\n\n<span class=\"token comment\"># library加载包，suppress不显示消息和警告信息</span>\nsuppressWarnings<span class=\"token punctuation\">(</span>suppressMessages<span class=\"token punctuation\">(</span>library<span class=\"token punctuation\">(</span>amplicon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 设置工作目录，根据实际情况设定</span>\nsetwd<span class=\"token punctuation\">(</span><span class=\"token string\">\"用户自己的工作目录\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span>\nmetadata <span class=\"token operator\">=</span> read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"sample-metadata.tsv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors <span class=\"token operator\">=</span> F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span>\n<span class=\"token comment\">#alpha_div = read.table(\"alpha.txt\", header=T, row.names=1, sep=\"\\t\", comment.char=\"\")</span>\nalpha_div <span class=\"token operator\">&lt;-</span> read.delim<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha.txt\"</span><span class=\"token punctuation\">,</span> quote<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span>\n<span class=\"token punctuation\">(</span>p1 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Shannon\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">##物种丰富度 Richness 指数</span>\n<span class=\"token punctuation\">(</span>p2 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Richness\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span>\n<span class=\"token punctuation\">(</span>p3 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Simpson\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#Chao1 指数</span>\n<span class=\"token punctuation\">(</span>p4 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Chao1\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#ACE 指数</span>\n<span class=\"token punctuation\">(</span>p5 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"ACE\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#Shannon 均匀度（Pielou 均匀度）</span>\n<span class=\"token punctuation\">(</span>p6 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"Pielou\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">##谱系多样性</span>\n<span class=\"token punctuation\">(</span>p7 <span class=\"token operator\">=</span> alpha_boxplot<span class=\"token punctuation\">(</span>alpha_div<span class=\"token punctuation\">,</span> index <span class=\"token operator\">=</span> <span class=\"token string\">\"PD_whole_tree\"</span><span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID <span class=\"token operator\">=</span> <span class=\"token string\">\"Depth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_shannon.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p1<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Richness.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p2<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Simpson.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p3<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Chao1.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p4<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_ACE.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p5<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_Pielou.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p6<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span>\nggsave<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"alpha_boxplot_PD_whole_tree.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p7<span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">89</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">75</span><span class=\"token punctuation\">,</span> units<span class=\"token operator\">=</span><span class=\"token string\">\"mm\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"演示视频\"><a class=\"markdownIt-Anchor\" href=\"#演示视频\"></a> 演示视频</h3>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n<hr />\n<h2 id=\"物种多样性条形图的绘制\"><a class=\"markdownIt-Anchor\" href=\"#物种多样性条形图的绘制\"></a> 物种多样性条形图的绘制</h2>\n<h3 id=\"输入文件-2\"><a class=\"markdownIt-Anchor\" href=\"#输入文件-2\"></a> 输入文件</h3>\n<ul>\n<li>处理后的 Feature Table</li>\n</ul>\n<p>从 QIIME2 可视化网站上下载的各 level 的物种丰度表，此处以 level-2（Phylum 水平）为例，命名为 “level-2.csv”。该文件可以用 excel 或 WPS 打开，然后复制所有内容至一个新建的名字为 “level-2.txt” 的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">index\tspecies1\tspecies2\tspecies3\tspecies4\nSample1\t0\t8152\t11\t65\nSample2\t12\t97\t1097\t1315\n...\nSamplex\t15\t46\t2928\t1011<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a class=\"markdownIt-Anchor\" href=\"#绘图\"></a> 绘图</h3>\n<p>以下代码在 Rstudio 中逐步输入运行</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\">setwd<span class=\"token punctuation\">(</span><span class=\"token string\">\"用户自己的路径\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">,</span> quietly<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install.packages<span class=\"token punctuation\">(</span><span class=\"token string\">\"devtools\"</span><span class=\"token punctuation\">)</span>\nlibrary<span class=\"token punctuation\">(</span>devtools<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>requireNamespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"amplicon\"</span><span class=\"token punctuation\">,</span> quietly<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    install_github<span class=\"token punctuation\">(</span><span class=\"token string\">\"microbiota/amplicon\"</span><span class=\"token punctuation\">)</span>\nsuppressWarnings<span class=\"token punctuation\">(</span>suppressMessages<span class=\"token punctuation\">(</span>library<span class=\"token punctuation\">(</span>amplicon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 从文件读取元数据，特征表和物种注释</span>\nmetadata<span class=\"token operator\">=</span>read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"sample-metadata.tsv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\ntaxonomy<span class=\"token operator\">=</span>read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"taxonomy.tsv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\notutab2<span class=\"token operator\">=</span>read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"level-2.txt\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> comment.char<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> stringsAsFactors<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span>\n<span class=\"token comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span>\notutab2<span class=\"token operator\">=</span>t<span class=\"token punctuation\">(</span>otutab2<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>ps<span class=\"token operator\">=</span>tax_stackplot<span class=\"token punctuation\">(</span>otutab2<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span> groupID<span class=\"token operator\">=</span><span class=\"token string\">\"Site\"</span><span class=\"token punctuation\">,</span> topN<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"sample\"</span><span class=\"token punctuation\">,</span> sorted<span class=\"token operator\">=</span><span class=\"token string\">\"abundance\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nps2 <span class=\"token operator\">=</span> ps <span class=\"token operator\">+</span> scale_fill_manual<span class=\"token punctuation\">(</span>values <span class=\"token operator\">=</span> rev<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"#1f77b4\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#aec7e8\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#ff7f0e\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#ffbb78\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#2ca02c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#98df8a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#d62728\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#ff9896\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#9467bd\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#c5b0d5\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#8c564b\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#c49c94\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#e377c2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#f7b6d2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#7f7f7f\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#c7c7c7\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#bcbd22\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#dbdb8d\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#17becf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#9edae5\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> theme<span class=\"token punctuation\">(</span>axis.text.x <span class=\"token operator\">=</span> element_text<span class=\"token punctuation\">(</span>angle <span class=\"token operator\">=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span> hjust <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> vjust <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nps2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"演示视频-2\"><a class=\"markdownIt-Anchor\" href=\"#演示视频-2\"></a> 演示视频</h3>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n<hr />\n<h1 id=\"beta多样性\"><a class=\"markdownIt-Anchor\" href=\"#beta多样性\"></a> Beta 多样性</h1>\n<h2 id=\"nmds分析及可视化\"><a class=\"markdownIt-Anchor\" href=\"#nmds分析及可视化\"></a> NMDS 分析及可视化</h2>\n<h3 id=\"输入文件-3\"><a class=\"markdownIt-Anchor\" href=\"#输入文件-3\"></a> 输入文件</h3>\n<ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a class=\"markdownIt-Anchor\" href=\"#分析过程\"></a> 分析过程</h3>\n<p>在 Rstudio 中运行如下代码：</p>\n<pre class=\"line-numbers language-r\" data-language=\"r\"><code class=\"language-r\">setwd<span class=\"token punctuation\">(</span><span class=\"token string\">\"用户的工作目录\"</span><span class=\"token punctuation\">)</span>\nlibrary<span class=\"token punctuation\">(</span><span class=\"token string\">\"vegan\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span>\notu <span class=\"token operator\">&lt;-</span> read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"feature-table.tsv\"</span><span class=\"token punctuation\">,</span>row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span>check.names<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\ndesign <span class=\"token operator\">&lt;-</span> read.table<span class=\"token punctuation\">(</span><span class=\"token string\">\"sample-metadata.tsv\"</span><span class=\"token punctuation\">,</span>header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span>row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>check.names<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 数据调整为列名是OTU，行名是样本名</span>\notu<span class=\"token operator\">=</span>t<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span>\nvare.hel<span class=\"token operator\">&lt;-</span>decostand<span class=\"token punctuation\">(</span>otu<span class=\"token punctuation\">,</span>method<span class=\"token operator\">=</span><span class=\"token string\">\"hellinger\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 计算Bray-curtis距离矩阵</span>\nvare.dis <span class=\"token operator\">&lt;-</span> vegdist<span class=\"token punctuation\">(</span>vare.hel<span class=\"token punctuation\">,</span>method<span class=\"token operator\">=</span><span class=\"token string\">\"bray\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 使用NMDS的方法</span>\nvare.mds <span class=\"token operator\">&lt;-</span> metaMDS<span class=\"token punctuation\">(</span>vare.hel<span class=\"token punctuation\">,</span>distance <span class=\"token operator\">=</span> <span class=\"token string\">\"bray\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 首先提取前两轴坐标</span>\npoint <span class=\"token operator\">=</span> scores<span class=\"token punctuation\">(</span>vare.mds<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 将分组文件和得分文件合并</span>\nindex <span class=\"token operator\">=</span> merge<span class=\"token punctuation\">(</span>design<span class=\"token punctuation\">,</span> point<span class=\"token punctuation\">,</span>by<span class=\"token operator\">=</span><span class=\"token string\">\"row.names\"</span><span class=\"token punctuation\">,</span>all<span class=\"token operator\">=</span>F<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 查看Stress值</span>\n<span class=\"token comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span>\nvare.mds\n\n<span class=\"token comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span>\n\n<span class=\"token comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span>\nanosim.result<span class=\"token operator\">&lt;-</span>anosim<span class=\"token punctuation\">(</span>vare.dis<span class=\"token punctuation\">,</span> design<span class=\"token operator\">$</span>Depth<span class=\"token punctuation\">,</span>permutations <span class=\"token operator\">=</span><span class=\"token number\">999</span><span class=\"token punctuation\">)</span>\n\nsummary<span class=\"token punctuation\">(</span>anosim.result<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span>\n<span class=\"token comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span>\n\n<span class=\"token comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span>\n<span class=\"token comment\">#tiff(file=\"beta_bray_NMDS.tiff\", res = 300, compression =\"none\", width=180,height=140,units= \"mm\")</span>\n\n<span class=\"token comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span>\npdf<span class=\"token punctuation\">(</span>file<span class=\"token operator\">=</span><span class=\"token string\">\"beta_bray_NMDS.pdf\"</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">180</span><span class=\"token punctuation\">,</span>height<span class=\"token operator\">=</span><span class=\"token number\">140</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#开始出图，代码如下：</span>\nlibrary<span class=\"token punctuation\">(</span><span class=\"token string\">\"ggplot2\"</span><span class=\"token punctuation\">)</span>\n\np <span class=\"token operator\">=</span> ggplot<span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> aes<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>NMDS1<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>NMDS2<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span>as.factor<span class=\"token punctuation\">(</span>Depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n      geom_point<span class=\"token punctuation\">(</span>size<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     <span class=\"token comment\">#scale_colour_manual(values = c(\"red\",\"blue\", \"green\")) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span>\n     labs<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"NMDS1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"NMDS2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span>\n\np<span class=\"token operator\">+</span>stat_ellipse<span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"t\"</span><span class=\"token punctuation\">,</span> linetype <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> level <span class=\"token operator\">=</span> <span class=\"token number\">0.95</span><span class=\"token punctuation\">,</span> show.legend <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n    annotate<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">2.5</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1.25</span><span class=\"token punctuation\">,</span>parse<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>label<span class=\"token operator\">=</span><span class=\"token string\">\"'R: '*0.8036\"</span><span class=\"token punctuation\">,</span>family<span class=\"token operator\">=</span><span class=\"token string\">\"serif\"</span><span class=\"token punctuation\">,</span>fontface<span class=\"token operator\">=</span><span class=\"token string\">\"italic\"</span><span class=\"token punctuation\">,</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"darkred\"</span><span class=\"token punctuation\">,</span>hjust <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n    annotate<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">2.5</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1.35</span><span class=\"token punctuation\">,</span>parse<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>label<span class=\"token operator\">=</span><span class=\"token string\">\"'p: '*0.001\"</span><span class=\"token punctuation\">,</span>family<span class=\"token operator\">=</span><span class=\"token string\">\"serif\"</span><span class=\"token punctuation\">,</span>fontface<span class=\"token operator\">=</span><span class=\"token string\">\"italic\"</span><span class=\"token punctuation\">,</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"darkred\"</span><span class=\"token punctuation\">,</span>hjust <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n    annotate<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">2.5</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1.45</span><span class=\"token punctuation\">,</span>parse<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>label<span class=\"token operator\">=</span><span class=\"token string\">\"'Stress: '*0.075\"</span><span class=\"token punctuation\">,</span>family<span class=\"token operator\">=</span><span class=\"token string\">\"serif\"</span><span class=\"token punctuation\">,</span>fontface<span class=\"token operator\">=</span><span class=\"token string\">\"italic\"</span><span class=\"token punctuation\">,</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"darkred\"</span><span class=\"token punctuation\">,</span>hjust <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> geom_point<span class=\"token punctuation\">(</span>aes<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>NMDS1<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>NMDS2<span class=\"token punctuation\">,</span> shape<span class=\"token operator\">=</span>Site<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>\n\t<span class=\"token comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span>\n    theme_classic<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ndev.off<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"演示视频-3\"><a class=\"markdownIt-Anchor\" href=\"#演示视频-3\"></a> 演示视频</h3>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n<h1 id=\"参考\"><a class=\"markdownIt-Anchor\" href=\"#参考\"></a> 参考</h1>\n<ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"},{"name":"扩增子","path":"api/tags/扩增子.json"}]}