{"title":"扩增子可视化专题","slug":"扩增子可视化专题","date":"2021-09-15T03:23:28.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子可视化专题.json","excerpt":null,"covers":null,"content":"<p>扩增子分析较常用的软件是QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将QIIME2生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a href=\"#准备数据\" class=\"headerlink\" title=\"准备数据\"></a>准备数据</h1><ul>\n<li>特征表（Feature table），或者叫做OTU表，本教程中文件名为<strong>feature-table.tsv</strong>。该文件可由QIIME2生成，由biome格式转换而来。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>6</span><br><span class=\"line\">3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">d2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">b624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0</span><br><span class=\"line\">60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong>sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite</span><br><span class=\"line\">F01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>6\tH2<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>分类信息，本教程中文件名为<strong>taxonomy.tsv</strong>。该文件可由QIIME2生成。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature ID\tTaxon\tConfidence</span><br><span class=\"line\">9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045</span><br><span class=\"line\">2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394</span><br><span class=\"line\">5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067</span><br><span class=\"line\">cc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506</span><br><span class=\"line\">5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154</span><br><span class=\"line\">d62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316</span><br><span class=\"line\">920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409</span><br><span class=\"line\">b5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555</span><br><span class=\"line\">43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367</span><br><span class=\"line\">0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901</span><br><span class=\"line\">430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459</span><br><span class=\"line\">0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>进化树，本教程中文件名为<strong>tree.nwk</strong>。该文件可由QIIME2生成，Newick格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr>\n<h1 id=\"Alpha-diversity\"><a href=\"#Alpha-diversity\" class=\"headerlink\" title=\"Alpha diversity\"></a>Alpha diversity</h1><h2 id=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\"><a href=\"#Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\" class=\"headerlink\" title=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化\"></a>Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化</h2><h3 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步：计算多样性\"><a href=\"#第一步：计算多样性\" class=\"headerlink\" title=\"第一步：计算多样性\"></a>第一步：计算多样性</h3><p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\">#定义函数</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span>       <span class=\"comment\">#picante 包加载时默认同时加载 vegan</span></span><br><span class=\"line\"> </span><br><span class=\"line\">alpha <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"built_in\">exp</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        est <span class=\"operator\">&lt;-</span> estimateR<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Richness <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Chao1 <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        ACE <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Shannon <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;shannon&#x27;</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Simpson <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;simpson&#x27;</span><span class=\"punctuation\">)</span>    <span class=\"comment\">#Gini-Simpson 指数</span></span><br><span class=\"line\">        Pielou <span class=\"operator\">&lt;-</span> Shannon <span class=\"operator\">/</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        goods_coverage <span class=\"operator\">&lt;-</span> 1 <span class=\"operator\">-</span> rowSums<span class=\"punctuation\">(</span>x <span class=\"operator\">==</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">/</span> rowSums<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        result <span class=\"operator\">&lt;-</span> data.frame<span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> Shannon<span class=\"punctuation\">,</span> Simpson<span class=\"punctuation\">,</span> Pielou<span class=\"punctuation\">,</span> Chao1<span class=\"punctuation\">,</span> ACE<span class=\"punctuation\">,</span> goods_coverage<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                PD_whole_tree <span class=\"operator\">&lt;-</span> pd<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> include.root <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">                <span class=\"built_in\">names</span><span class=\"punctuation\">(</span>PD_whole_tree<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"string\">&#x27;PD_whole_tree&#x27;</span></span><br><span class=\"line\">                result <span class=\"operator\">&lt;-</span> cbind<span class=\"punctuation\">(</span>result<span class=\"punctuation\">,</span> PD_whole_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        result</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#加载 OTU 丰度表和进化树文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&#x27;feature-table.tsv&#x27;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&#x27;\\t&#x27;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> check.names <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\">tree <span class=\"operator\">&lt;-</span> read.tree<span class=\"punctuation\">(</span><span class=\"string\">&#x27;tree.nwk&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\"><span class=\"comment\">##alpha_all &lt;- alpha(otu, base = 2)</span></span><br><span class=\"line\"><span class=\"comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\">alpha_all <span class=\"operator\">&lt;-</span> alpha<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#输出保存在本地</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>alpha_all<span class=\"punctuation\">,</span> <span class=\"string\">&#x27;alpha.txt&#x27;</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第二步：制图\"><a href=\"#第二步：制图\" class=\"headerlink\" title=\"第二步：制图\"></a>第二步：制图</h3><p>这一步需要在Rstudio中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出7个PDF图形文件。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载github包安装工具</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测amplicon包是否安装，没有从源码安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># library加载包，suppress不显示消息和警告信息</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，根据实际情况设定</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span></span><br><span class=\"line\">metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#alpha_div = read.table(&quot;alpha.txt&quot;, header=T, row.names=1, sep=&quot;\\t&quot;, comment.char=&quot;&quot;)</span></span><br><span class=\"line\">alpha_div <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha.txt&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p1 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Shannon&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##物种丰富度 Richness 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p2 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Richness&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p3 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Simpson&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Chao1 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p4 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ACE 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p5 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;ACE&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Shannon 均匀度（Pielou 均匀度）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p6 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Pielou&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##谱系多样性</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p7 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;PD_whole_tree&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_shannon.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p1<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Richness.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p2<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Simpson.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p3<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Chao1.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p4<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_ACE.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p5<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Pielou.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p6<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_PD_whole_tree.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p7<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"演示视频\"><a href=\"#演示视频\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h2 id=\"物种多样性条形图的绘制\"><a href=\"#物种多样性条形图的绘制\" class=\"headerlink\" title=\"物种多样性条形图的绘制\"></a>物种多样性条形图的绘制</h2><h3 id=\"输入文件-1\"><a href=\"#输入文件-1\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>处理后的Feature Table</li>\n</ul>\n<p>从QIIME2可视化网站上下载的各level的物种丰度表，此处以level-2（Phylum水平）为例，命名为“level-2.csv”。该文件可以用excel或WPS打开，然后复制所有内容至一个新建的名字为“level-2.txt”的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index\tspecies1\tspecies2\tspecies3\tspecies4</span><br><span class=\"line\">Sample1\t0\t8152\t11\t65</span><br><span class=\"line\">Sample2\t12\t97\t1097\t1315</span><br><span class=\"line\">...</span><br><span class=\"line\">Samplex\t15\t46\t2928\t1011</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a href=\"#绘图\" class=\"headerlink\" title=\"绘图\"></a>绘图</h3><p>以下代码在Rstudio中逐步输入运行</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的路径&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;microbiota/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据，特征表和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.txt&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-1\"><a href=\"#演示视频-1\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h1 id=\"Beta多样性\"><a href=\"#Beta多样性\" class=\"headerlink\" title=\"Beta多样性\"></a>Beta多样性</h1><h2 id=\"NMDS分析及可视化\"><a href=\"#NMDS分析及可视化\" class=\"headerlink\" title=\"NMDS分析及可视化\"></a>NMDS分析及可视化</h2><h3 id=\"输入文件-2\"><a href=\"#输入文件-2\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h3><p>在Rstudio中运行如下代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;vegan&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;feature-table.tsv&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">design <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span>header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据调整为列名是OTU，行名是样本名</span></span><br><span class=\"line\">otu<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span></span><br><span class=\"line\">vare.hel<span class=\"operator\">&lt;-</span>decostand<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;hellinger&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bray-curtis距离矩阵</span></span><br><span class=\"line\">vare.dis <span class=\"operator\">&lt;-</span> vegdist<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用NMDS的方法</span></span><br><span class=\"line\">vare.mds <span class=\"operator\">&lt;-</span> metaMDS<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>distance <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 首先提取前两轴坐标</span></span><br><span class=\"line\">point <span class=\"operator\">=</span> scores<span class=\"punctuation\">(</span>vare.mds<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将分组文件和得分文件合并</span></span><br><span class=\"line\">index <span class=\"operator\">=</span> merge<span class=\"punctuation\">(</span>design<span class=\"punctuation\">,</span> point<span class=\"punctuation\">,</span>by<span class=\"operator\">=</span><span class=\"string\">&quot;row.names&quot;</span><span class=\"punctuation\">,</span><span class=\"built_in\">all</span><span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看Stress值</span></span><br><span class=\"line\"><span class=\"comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span></span><br><span class=\"line\">vare.mds</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span></span><br><span class=\"line\">anosim.result<span class=\"operator\">&lt;-</span>anosim<span class=\"punctuation\">(</span>vare.dis<span class=\"punctuation\">,</span> design<span class=\"operator\">$</span>Depth<span class=\"punctuation\">,</span>permutations <span class=\"operator\">=</span><span class=\"number\">999</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">summary<span class=\"punctuation\">(</span>anosim.result<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"><span class=\"comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span></span><br><span class=\"line\"><span class=\"comment\">#tiff(file=&quot;beta_bray_NMDS.tiff&quot;, res = 300, compression =&quot;none&quot;, width=180,height=140,units= &quot;mm&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;beta_bray_NMDS.pdf&quot;</span><span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">180</span><span class=\"punctuation\">,</span>height<span class=\"operator\">=</span><span class=\"number\">140</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开始出图，代码如下：</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggplot2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p <span class=\"operator\">=</span> ggplot<span class=\"punctuation\">(</span>index<span class=\"punctuation\">,</span> aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> color<span class=\"operator\">=</span>as.factor<span class=\"punctuation\">(</span>Depth<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">      geom_point<span class=\"punctuation\">(</span>size<span class=\"operator\">=</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">     <span class=\"comment\">#scale_colour_manual(values = c(&quot;red&quot;,&quot;blue&quot;, &quot;green&quot;)) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span></span><br><span class=\"line\">     labs<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS1&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> title<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span>stat_ellipse<span class=\"punctuation\">(</span>type <span class=\"operator\">=</span> <span class=\"string\">&quot;t&quot;</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> level <span class=\"operator\">=</span> <span class=\"number\">0.95</span><span class=\"punctuation\">,</span> show.legend <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.25</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;R: &#x27;*0.8036&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.35</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;p: &#x27;*0.001&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.45</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;Stress: &#x27;*0.075&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_point<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> shape<span class=\"operator\">=</span>Site<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> size<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">\t<span class=\"comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span></span><br><span class=\"line\">    theme_classic<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-2\"><a href=\"#演示视频-2\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","more":"<p>扩增子分析较常用的软件是QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将QIIME2生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a href=\"#准备数据\" class=\"headerlink\" title=\"准备数据\"></a>准备数据</h1><ul>\n<li>特征表（Feature table），或者叫做OTU表，本教程中文件名为<strong>feature-table.tsv</strong>。该文件可由QIIME2生成，由biome格式转换而来。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>6</span><br><span class=\"line\">3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">d2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">b624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0</span><br><span class=\"line\">60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong>sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite</span><br><span class=\"line\">F01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>6\tH2<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>分类信息，本教程中文件名为<strong>taxonomy.tsv</strong>。该文件可由QIIME2生成。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature ID\tTaxon\tConfidence</span><br><span class=\"line\">9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045</span><br><span class=\"line\">2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394</span><br><span class=\"line\">5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067</span><br><span class=\"line\">cc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506</span><br><span class=\"line\">5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154</span><br><span class=\"line\">d62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316</span><br><span class=\"line\">920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409</span><br><span class=\"line\">b5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555</span><br><span class=\"line\">43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367</span><br><span class=\"line\">0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901</span><br><span class=\"line\">430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459</span><br><span class=\"line\">0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>进化树，本教程中文件名为<strong>tree.nwk</strong>。该文件可由QIIME2生成，Newick格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr>\n<h1 id=\"Alpha-diversity\"><a href=\"#Alpha-diversity\" class=\"headerlink\" title=\"Alpha diversity\"></a>Alpha diversity</h1><h2 id=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\"><a href=\"#Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\" class=\"headerlink\" title=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化\"></a>Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化</h2><h3 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步：计算多样性\"><a href=\"#第一步：计算多样性\" class=\"headerlink\" title=\"第一步：计算多样性\"></a>第一步：计算多样性</h3><p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\">#定义函数</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span>       <span class=\"comment\">#picante 包加载时默认同时加载 vegan</span></span><br><span class=\"line\"> </span><br><span class=\"line\">alpha <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"built_in\">exp</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        est <span class=\"operator\">&lt;-</span> estimateR<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Richness <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Chao1 <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        ACE <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Shannon <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;shannon&#x27;</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Simpson <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;simpson&#x27;</span><span class=\"punctuation\">)</span>    <span class=\"comment\">#Gini-Simpson 指数</span></span><br><span class=\"line\">        Pielou <span class=\"operator\">&lt;-</span> Shannon <span class=\"operator\">/</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        goods_coverage <span class=\"operator\">&lt;-</span> 1 <span class=\"operator\">-</span> rowSums<span class=\"punctuation\">(</span>x <span class=\"operator\">==</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">/</span> rowSums<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        result <span class=\"operator\">&lt;-</span> data.frame<span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> Shannon<span class=\"punctuation\">,</span> Simpson<span class=\"punctuation\">,</span> Pielou<span class=\"punctuation\">,</span> Chao1<span class=\"punctuation\">,</span> ACE<span class=\"punctuation\">,</span> goods_coverage<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                PD_whole_tree <span class=\"operator\">&lt;-</span> pd<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> include.root <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">                <span class=\"built_in\">names</span><span class=\"punctuation\">(</span>PD_whole_tree<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"string\">&#x27;PD_whole_tree&#x27;</span></span><br><span class=\"line\">                result <span class=\"operator\">&lt;-</span> cbind<span class=\"punctuation\">(</span>result<span class=\"punctuation\">,</span> PD_whole_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        result</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#加载 OTU 丰度表和进化树文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&#x27;feature-table.tsv&#x27;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&#x27;\\t&#x27;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> check.names <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\">tree <span class=\"operator\">&lt;-</span> read.tree<span class=\"punctuation\">(</span><span class=\"string\">&#x27;tree.nwk&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\"><span class=\"comment\">##alpha_all &lt;- alpha(otu, base = 2)</span></span><br><span class=\"line\"><span class=\"comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\">alpha_all <span class=\"operator\">&lt;-</span> alpha<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#输出保存在本地</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>alpha_all<span class=\"punctuation\">,</span> <span class=\"string\">&#x27;alpha.txt&#x27;</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第二步：制图\"><a href=\"#第二步：制图\" class=\"headerlink\" title=\"第二步：制图\"></a>第二步：制图</h3><p>这一步需要在Rstudio中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出7个PDF图形文件。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载github包安装工具</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测amplicon包是否安装，没有从源码安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># library加载包，suppress不显示消息和警告信息</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，根据实际情况设定</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span></span><br><span class=\"line\">metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#alpha_div = read.table(&quot;alpha.txt&quot;, header=T, row.names=1, sep=&quot;\\t&quot;, comment.char=&quot;&quot;)</span></span><br><span class=\"line\">alpha_div <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha.txt&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p1 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Shannon&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##物种丰富度 Richness 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p2 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Richness&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p3 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Simpson&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Chao1 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p4 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ACE 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p5 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;ACE&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Shannon 均匀度（Pielou 均匀度）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p6 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Pielou&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##谱系多样性</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p7 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;PD_whole_tree&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_shannon.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p1<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Richness.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p2<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Simpson.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p3<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Chao1.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p4<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_ACE.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p5<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Pielou.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p6<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_PD_whole_tree.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p7<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"演示视频\"><a href=\"#演示视频\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h2 id=\"物种多样性条形图的绘制\"><a href=\"#物种多样性条形图的绘制\" class=\"headerlink\" title=\"物种多样性条形图的绘制\"></a>物种多样性条形图的绘制</h2><h3 id=\"输入文件-1\"><a href=\"#输入文件-1\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>处理后的Feature Table</li>\n</ul>\n<p>从QIIME2可视化网站上下载的各level的物种丰度表，此处以level-2（Phylum水平）为例，命名为“level-2.csv”。该文件可以用excel或WPS打开，然后复制所有内容至一个新建的名字为“level-2.txt”的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index\tspecies1\tspecies2\tspecies3\tspecies4</span><br><span class=\"line\">Sample1\t0\t8152\t11\t65</span><br><span class=\"line\">Sample2\t12\t97\t1097\t1315</span><br><span class=\"line\">...</span><br><span class=\"line\">Samplex\t15\t46\t2928\t1011</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a href=\"#绘图\" class=\"headerlink\" title=\"绘图\"></a>绘图</h3><p>以下代码在Rstudio中逐步输入运行</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的路径&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;microbiota/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据，特征表和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.txt&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-1\"><a href=\"#演示视频-1\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h1 id=\"Beta多样性\"><a href=\"#Beta多样性\" class=\"headerlink\" title=\"Beta多样性\"></a>Beta多样性</h1><h2 id=\"NMDS分析及可视化\"><a href=\"#NMDS分析及可视化\" class=\"headerlink\" title=\"NMDS分析及可视化\"></a>NMDS分析及可视化</h2><h3 id=\"输入文件-2\"><a href=\"#输入文件-2\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h3><p>在Rstudio中运行如下代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;vegan&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;feature-table.tsv&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">design <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span>header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据调整为列名是OTU，行名是样本名</span></span><br><span class=\"line\">otu<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span></span><br><span class=\"line\">vare.hel<span class=\"operator\">&lt;-</span>decostand<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;hellinger&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bray-curtis距离矩阵</span></span><br><span class=\"line\">vare.dis <span class=\"operator\">&lt;-</span> vegdist<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用NMDS的方法</span></span><br><span class=\"line\">vare.mds <span class=\"operator\">&lt;-</span> metaMDS<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>distance <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 首先提取前两轴坐标</span></span><br><span class=\"line\">point <span class=\"operator\">=</span> scores<span class=\"punctuation\">(</span>vare.mds<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将分组文件和得分文件合并</span></span><br><span class=\"line\">index <span class=\"operator\">=</span> merge<span class=\"punctuation\">(</span>design<span class=\"punctuation\">,</span> point<span class=\"punctuation\">,</span>by<span class=\"operator\">=</span><span class=\"string\">&quot;row.names&quot;</span><span class=\"punctuation\">,</span><span class=\"built_in\">all</span><span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看Stress值</span></span><br><span class=\"line\"><span class=\"comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span></span><br><span class=\"line\">vare.mds</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span></span><br><span class=\"line\">anosim.result<span class=\"operator\">&lt;-</span>anosim<span class=\"punctuation\">(</span>vare.dis<span class=\"punctuation\">,</span> design<span class=\"operator\">$</span>Depth<span class=\"punctuation\">,</span>permutations <span class=\"operator\">=</span><span class=\"number\">999</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">summary<span class=\"punctuation\">(</span>anosim.result<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"><span class=\"comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span></span><br><span class=\"line\"><span class=\"comment\">#tiff(file=&quot;beta_bray_NMDS.tiff&quot;, res = 300, compression =&quot;none&quot;, width=180,height=140,units= &quot;mm&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;beta_bray_NMDS.pdf&quot;</span><span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">180</span><span class=\"punctuation\">,</span>height<span class=\"operator\">=</span><span class=\"number\">140</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开始出图，代码如下：</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggplot2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p <span class=\"operator\">=</span> ggplot<span class=\"punctuation\">(</span>index<span class=\"punctuation\">,</span> aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> color<span class=\"operator\">=</span>as.factor<span class=\"punctuation\">(</span>Depth<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">      geom_point<span class=\"punctuation\">(</span>size<span class=\"operator\">=</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">     <span class=\"comment\">#scale_colour_manual(values = c(&quot;red&quot;,&quot;blue&quot;, &quot;green&quot;)) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span></span><br><span class=\"line\">     labs<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS1&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> title<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span>stat_ellipse<span class=\"punctuation\">(</span>type <span class=\"operator\">=</span> <span class=\"string\">&quot;t&quot;</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> level <span class=\"operator\">=</span> <span class=\"number\">0.95</span><span class=\"punctuation\">,</span> show.legend <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.25</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;R: &#x27;*0.8036&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.35</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;p: &#x27;*0.001&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.45</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;Stress: &#x27;*0.075&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_point<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> shape<span class=\"operator\">=</span>Site<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> size<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">\t<span class=\"comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span></span><br><span class=\"line\">    theme_classic<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-2\"><a href=\"#演示视频-2\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]}