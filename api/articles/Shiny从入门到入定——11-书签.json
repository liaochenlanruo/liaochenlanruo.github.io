{"title":"Shiny从入门到入定——11-书签","slug":"Shiny从入门到入定——11-书签","date":"2024-04-27T09:53:52.000Z","updated":"2024-04-27T09:55:47.969Z","comments":true,"path":"api/articles/Shiny从入门到入定——11-书签.json","excerpt":null,"covers":["https://d33wubrfki0l68.cloudfront.net/6ad93d80475f1ebc6d632c1293f210174da9b9d6/f576b/demos/action-bookmark/pendulum.png","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png"],"content":"<h1 id=\"11-书签\"><a href=\"#11-书签\" class=\"headerlink\" title=\"11 书签\"></a>11 书签</h1><p>与大多数网站相比，Shiny应用程序有一个主要的缺点：您无法为应用程序添加书签以便将来返回同一位置，也无法通过电子邮件中的链接与他人分享您的工作。这是因为，默认情况下，Shiny不会在URL中公开应用程序的当前状态。然而，幸运的是，通过一些额外的工作，您可以更改此行为，本章将向您展示如何操作。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"11-1-基本思路\"><a href=\"#11-1-基本思路\" class=\"headerlink\" title=\"11.1 基本思路\"></a>11.1 基本思路</h2><p>让我们用一个简单的应用程序来演示如何使其具有书签功能。这个应用程序绘制了利萨茹曲线，这些曲线复制了摆锤的运动。这个应用程序可以生成各种有趣的图案，您可能想要与他人分享。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  sidebarLayout<span class=\"punctuation\">(</span></span><br><span class=\"line\">    sidebarPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">      sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0.9</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.001</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      numericInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    mainPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">      plotOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;fig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  t <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span>seq<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">,</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span><span class=\"punctuation\">,</span> length.out <span class=\"operator\">=</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span> <span class=\"operator\">*</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  x <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>omega <span class=\"operator\">*</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> input<span class=\"operator\">$</span>delta<span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  y <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  output<span class=\"operator\">$</span>fig <span class=\"operator\">&lt;-</span> renderPlot<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    plot<span class=\"punctuation\">(</span>x<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> axes <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> xlab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> ylab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> type <span class=\"operator\">=</span> <span class=\"string\">&quot;l&quot;</span><span class=\"punctuation\">,</span> lwd <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> res <span class=\"operator\">=</span> <span class=\"number\">96</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/6ad93d80475f1ebc6d632c1293f210174da9b9d6/f576b/demos/action-bookmark/pendulum.png\" class=\"lazyload placeholder\" data-srcset=\"https://d33wubrfki0l68.cloudfront.net/6ad93d80475f1ebc6d632c1293f210174da9b9d6/f576b/demos/action-bookmark/pendulum.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"图11.1 这个应用程序允许您使用摆锤模型生成有趣的图案。如果能和朋友分享一个链接，岂不是很酷？\"></p>\n<p>为了使这个应用程序具有书签功能，我们需要做三件事情：</p>\n<ol>\n<li><p>在用户界面中添加一个<a href=\"https://rdrr.io/pkg/shiny/man/bookmarkButton.html\">bookmarkButton()</a>。这将生成一个按钮，用户点击后生成可书签的URL。</p>\n</li>\n<li><p>将ui变为一个函数。您需要这样做是因为书签化的应用程序必须重新播放书签化的值：实际上，Shiny会修改每个输入控件的默认<code>value</code>。这意味着不再有一个单一的静态用户界面，而是可能有多个依赖于URL中参数的用户界面，因此它必须是一个函数。</p>\n</li>\n<li><p>在<a href=\"https://rdrr.io/pkg/shiny/man/shinyApp.html\">shinyApp()</a>调用中添加<code>enableBookmarking = &quot;url&quot;</code>。</p>\n</li>\n</ol>\n<p>进行这些更改后，我们得到：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>request<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">    sidebarLayout<span class=\"punctuation\">(</span></span><br><span class=\"line\">      sidebarPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">        sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0.9</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.001</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        numericInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        bookmarkButton<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">      <span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      mainPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">        plotOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;fig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">      <span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">,</span> enableBookmarking <span class=\"operator\">=</span> <span class=\"string\">&quot;url&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>您可以在<a href=\"https://hadley.shinyapps.io/ms-bookmark-url\">https://hadley.shinyapps.io/ms-bookmark-url</a>尝试一下。如果您在应用程序中操作并书签了一些有趣的状态，您会发现生成的URL看起来像这样：</p>\n<ul>\n<li><p><a href=\"https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&damping=1&delta=1&length=100&omega=1\">https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&amp;damping=1&amp;delta=1&amp;length=100&amp;omega=1</a></p>\n</li>\n<li><p><a href=\"https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&damping=0.966&delta=1.25&length=100&omega=-0.54\">https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&amp;damping=0.966&amp;delta=1.25&amp;length=100&amp;omega=-0.54</a></p>\n</li>\n<li><p><a href=\"https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&damping=0.997&delta=1.37&length=500&omega=-0.9\">https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&amp;damping=0.997&amp;delta=1.37&amp;length=500&amp;omega=-0.9</a></p>\n</li>\n</ul>\n<p>为了理解发生了什么，让我们以第一个URL为例，将其分解成几个部分：</p>\n<ul>\n<li><p><code>http://</code> 是与应用程序通信时使用的“协议”。这始终是<code>http</code>或<code>https</code>。</p>\n</li>\n<li><p><code>hadley.shinyapps.io/ms-bookmark-url</code> 是应用程序的位置。</p>\n</li>\n</ul>\n<p>问号<code>?</code>之后的所有内容都是“参数”。每个参数之间用<code>&amp;</code>分隔，如果将其分解，您可以看到应用程序中每个输入的值：</p>\n<ul>\n<li><p>damping&#x3D;1</p>\n</li>\n<li><p>delta&#x3D;1</p>\n</li>\n<li><p>length&#x3D;100</p>\n</li>\n<li><p>omega&#x3D;1</p>\n</li>\n</ul>\n<p>因此，“生成书签”意味着在URL的参数中记录输入的当前值。如果您在本地进行操作，URL看起来会略有不同：</p>\n<ul>\n<li><p><a href=\"http://127.0.0.1:4087/?_inputs_&damping=1&delta=1&length=100&omega=1\">http://127.0.0.1:4087/?_inputs_&amp;damping=1&amp;delta=1&amp;length=100&amp;omega=1</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_inputs_&damping=0.966&delta=1.25&length=100&omega=-0.54\">http://127.0.0.1:4087/?_inputs_&amp;damping=0.966&amp;delta=1.25&amp;length=100&amp;omega=-0.54</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_inputs_&damping=0.997&delta=1.37&length=500&omega=-0.9\">http://127.0.0.1:4087/?_inputs_&amp;damping=0.997&amp;delta=1.37&amp;length=500&amp;omega=-0.9</a></p>\n</li>\n</ul>\n<p>除了将<code>hadley.shinyapps.io/ms-bookmark-url</code>替换为类似<code>127.0.0.1:4087</code>的内容外，大多数部分都是相同的。<code>127.0.0.1</code>是一个特殊地址，始终指向您自己的计算机，而<code>4087</code>是一个随机分配的端口。通常，不同的应用程序会获得不同的路径或IP地址，但如果您在自己的计算机上托管多个应用程序，则无法做到这一点。</p>\n<h3 id=\"11-1-1-更新URL\"><a href=\"#11-1-1-更新URL\" class=\"headerlink\" title=\"11.1.1 更新URL\"></a>11.1.1 更新URL</h3><p>除了提供一个明确的按钮外，另一种选择是自动更新浏览器中的URL。这允许用户在其浏览器中使用用户书签命令，或者从地址栏复制和粘贴URL。</p>\n<p>自动更新URL需要在服务器函数中编写一些模板代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Automatically bookmark every time an input changes</span></span><br><span class=\"line\">observe<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  reactiveValuesToList<span class=\"punctuation\">(</span>input<span class=\"punctuation\">)</span></span><br><span class=\"line\">  session<span class=\"operator\">$</span>doBookmark<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># Update the query string</span></span><br><span class=\"line\">onBookmarked<span class=\"punctuation\">(</span>updateQueryString<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>这给我们提供了一个更新后的服务器函数，如下所示：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  t <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span>seq<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">,</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span><span class=\"punctuation\">,</span> <span class=\"built_in\">length</span> <span class=\"operator\">=</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span> <span class=\"operator\">*</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  x <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>omega <span class=\"operator\">*</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> input<span class=\"operator\">$</span>delta<span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  y <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  output<span class=\"operator\">$</span>fig <span class=\"operator\">&lt;-</span> renderPlot<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    plot<span class=\"punctuation\">(</span>x<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> axes <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> xlab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> ylab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> type <span class=\"operator\">=</span> <span class=\"string\">&quot;l&quot;</span><span class=\"punctuation\">,</span> lwd <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> res <span class=\"operator\">=</span> <span class=\"number\">96</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  observe<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    reactiveValuesToList<span class=\"punctuation\">(</span>input<span class=\"punctuation\">)</span></span><br><span class=\"line\">    session<span class=\"operator\">$</span>doBookmark<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  onBookmarked<span class=\"punctuation\">(</span>updateQueryString<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">,</span> enableBookmarking <span class=\"operator\">=</span> <span class=\"string\">&quot;url&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>这会产生<a href=\"https://hadley.shinyapps.io/ms-bookmark-auto\">https://hadley.shinyapps.io/ms-bookmark-auto</a>——由于URL现在会自动更新，您可以从用户界面中删除书签按钮。</p>\n<h3 id=\"11-1-2-存储更丰富的状态\"><a href=\"#11-1-2-存储更丰富的状态\" class=\"headerlink\" title=\"11.1.2 存储更丰富的状态\"></a>11.1.2 存储更丰富的状态</h3><p>到目前为止，我们使用了<code>enableBookmarking = &quot;url&quot;</code>，它直接在URL中存储状态。这是一个很好的起点，因为它非常简单，可以在您可能部署Shiny应用的任何地方工作。然而，可以想象，如果您有大量的输入，URL会变得非常长，而且显然无法捕获上传的文件。</p>\n<p>对于这些情况，您可能想要使用<code>enableBookmarking = &quot;server&quot;</code>，它将状态保存到服务器上的<code>.rds</code>文件。这总是生成一个简短的、不透明的URL，但需要在服务器上额外存储。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">,</span> enableBookmarking <span class=\"operator\">=</span> <span class=\"string\">&quot;server&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>目前，shinyapps.io尚不支持服务器端书签，因此您需要在本地尝试。如果您这样做，您会看到书签按钮生成类似以下的URL：</p>\n<ul>\n<li><p><a href=\"http://127.0.0.1:4087/?_state_id_=0d645f1b28f05c97\">http://127.0.0.1:4087/?_state_id_=0d645f1b28f05c97</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_state_id_=87b56383d8a1062c\">http://127.0.0.1:4087/?_state_id_=87b56383d8a1062c</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_state_id_=c8b0291ba622b69c\">http://127.0.0.1:4087/?_state_id_=c8b0291ba622b69c</a></p>\n</li>\n</ul>\n<p>这些URL与您工作目录中匹配的目录配对：</p>\n<ul>\n<li><p>shiny_bookmarks&#x2F;0d645f1b28f05c97</p>\n</li>\n<li><p>shiny_bookmarks&#x2F;87b56383d8a1062c</p>\n</li>\n<li><p>shiny_bookmarks&#x2F;c8b0291ba622b69c</p>\n</li>\n</ul>\n<p>服务器端书签的主要缺点是它需要在服务器上保存文件，而且不清楚这些文件需要保留多长时间。如果您正在书签化复杂的状态并且从未删除这些文件，那么随着时间的推移，您的应用将占用越来越多的磁盘空间。如果您删除文件，一些旧书签将停止工作。</p>\n<h2 id=\"11-2-书签挑战\"><a href=\"#11-2-书签挑战\" class=\"headerlink\" title=\"11.2 书签挑战\"></a>11.2 书签挑战</h2><p>自动书签功能依赖于响应式图表。它使用保存的值初始化输入，然后重新播放所有的响应式表达式和输出，只要您的应用的响应式图表简单明了，就会产生与您看到的相同的应用。本节简要介绍了一些需要特别注意的情况：</p>\n<ul>\n<li><p>如果您的应用使用了随机数，即使所有输入都相同，结果也可能不同。如果确保每次生成相同的数字非常重要，您需要思考如何使随机过程可重复。最简单的方法是使用<a href=\"https://rdrr.io/pkg/shiny/man/repeatable.html\">repeatable()</a>函数；有关更多详细信息，请参阅相关文档。</p>\n</li>\n<li><p>如果您有选项卡，并希望书签和恢复活动选项卡，请确保在调用<a href=\"https://rdrr.io/pkg/shiny/man/tabsetPanel.html\">tabsetPanel()</a>时提供一个id。</p>\n</li>\n<li><p>如果有不应被书签记录的输入，例如它们包含不应共享的个人信息，请在服务器函数的某个位置调用<a href=\"https://rdrr.io/pkg/shiny/man/setBookmarkExclude.html\">setBookmarkExclude()</a>。例如，<code>setBookmarkExclude(c(&quot;secret1&quot;, &quot;secret2&quot;))</code>将确保<code>secret1</code>和<code>secret2</code>输入不会被书签记录。</p>\n</li>\n<li><p>如果您在自己的<a href=\"https://rdrr.io/pkg/shiny/man/reactiveValues.html\">reactiveValues()</a>对象中手动管理响应式状态（我们将在第<code>16</code>章中讨论），则需要使用<a href=\"https://rdrr.io/pkg/shiny/man/onBookmark.html\">onBookmark()</a>和<a href=\"https://rdrr.io/pkg/shiny/man/onBookmark.html\">onRestore()</a>回调来手动保存和加载额外的状态。有关更多详细信息，请参阅<a href=\"https://shiny.rstudio.com/articles/advanced-bookmarking.html\">高级书签</a>。</p>\n</li>\n</ul>\n<h2 id=\"11-3-练习\"><a href=\"#11-3-练习\" class=\"headerlink\" title=\"11.3 练习\"></a>11.3 练习</h2><ol>\n<li><p>为<a href=\"https://ambient.data-imaginist.com/reference/noise_simplex.html\">ambient::noise_simplex()</a>的结果生成可视化应用。您的应用应允许用户控制频率、分形、间隙和增益，并且应支持书签功能。如何确保从书签重新加载时图像看起来完全相同？（考虑seed参数的含义）。</p>\n</li>\n<li><p>创建一个简单的应用，允许您上传CSV文件，并为其添加书签。上传几个文件，然后查看<code>shiny_bookmarks</code>。这些文件是如何与书签对应的？（提示：您可以使用<a href=\"https://rdrr.io/r/base/readRDS.html\">readRDS()</a>来查看Shiny生成的缓存文件的内容）。</p>\n</li>\n</ol>\n<h2 id=\"11-4-总结\"><a href=\"#11-4-总结\" class=\"headerlink\" title=\"11.4 总结\"></a>11.4 总结</h2><p>本章介绍了如何为您的应用程序启用书签功能。书签功能对您的用户来说是一个很好的特性，因为它允许他们轻松地将自己的工作与他人分享。接下来，我们将讨论如何在Shiny应用程序中使用整洁评估。整洁评估是许多tidyverse函数的一个特性，如果您希望允许用户在（例如）dplyr管道或ggplot2图形中更改变量，那么您需要了解这个特性。</p>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","more":"<h1 id=\"11-书签\"><a href=\"#11-书签\" class=\"headerlink\" title=\"11 书签\"></a>11 书签</h1><p>与大多数网站相比，Shiny应用程序有一个主要的缺点：您无法为应用程序添加书签以便将来返回同一位置，也无法通过电子邮件中的链接与他人分享您的工作。这是因为，默认情况下，Shiny不会在URL中公开应用程序的当前状态。然而，幸运的是，通过一些额外的工作，您可以更改此行为，本章将向您展示如何操作。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>shiny<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"11-1-基本思路\"><a href=\"#11-1-基本思路\" class=\"headerlink\" title=\"11.1 基本思路\"></a>11.1 基本思路</h2><p>让我们用一个简单的应用程序来演示如何使其具有书签功能。这个应用程序绘制了利萨茹曲线，这些曲线复制了摆锤的运动。这个应用程序可以生成各种有趣的图案，您可能想要与他人分享。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">  sidebarLayout<span class=\"punctuation\">(</span></span><br><span class=\"line\">    sidebarPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">      sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0.9</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.001</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      numericInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    mainPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">      plotOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;fig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">)</span></span><br><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  t <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span>seq<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">,</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span><span class=\"punctuation\">,</span> length.out <span class=\"operator\">=</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span> <span class=\"operator\">*</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  x <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>omega <span class=\"operator\">*</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> input<span class=\"operator\">$</span>delta<span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  y <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  output<span class=\"operator\">$</span>fig <span class=\"operator\">&lt;-</span> renderPlot<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    plot<span class=\"punctuation\">(</span>x<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> axes <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> xlab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> ylab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> type <span class=\"operator\">=</span> <span class=\"string\">&quot;l&quot;</span><span class=\"punctuation\">,</span> lwd <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> res <span class=\"operator\">=</span> <span class=\"number\">96</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://d33wubrfki0l68.cloudfront.net/6ad93d80475f1ebc6d632c1293f210174da9b9d6/f576b/demos/action-bookmark/pendulum.png\" alt=\"图11.1 这个应用程序允许您使用摆锤模型生成有趣的图案。如果能和朋友分享一个链接，岂不是很酷？\"></p>\n<p>为了使这个应用程序具有书签功能，我们需要做三件事情：</p>\n<ol>\n<li><p>在用户界面中添加一个<a href=\"https://rdrr.io/pkg/shiny/man/bookmarkButton.html\">bookmarkButton()</a>。这将生成一个按钮，用户点击后生成可书签的URL。</p>\n</li>\n<li><p>将ui变为一个函数。您需要这样做是因为书签化的应用程序必须重新播放书签化的值：实际上，Shiny会修改每个输入控件的默认<code>value</code>。这意味着不再有一个单一的静态用户界面，而是可能有多个依赖于URL中参数的用户界面，因此它必须是一个函数。</p>\n</li>\n<li><p>在<a href=\"https://rdrr.io/pkg/shiny/man/shinyApp.html\">shinyApp()</a>调用中添加<code>enableBookmarking = &quot;url&quot;</code>。</p>\n</li>\n</ol>\n<p>进行这些更改后，我们得到：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ui <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>request<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  fluidPage<span class=\"punctuation\">(</span></span><br><span class=\"line\">    sidebarLayout<span class=\"punctuation\">(</span></span><br><span class=\"line\">      sidebarPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">        sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;omega&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;delta&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        sliderInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;damping&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"built_in\">min</span> <span class=\"operator\">=</span> <span class=\"number\">0.9</span><span class=\"punctuation\">,</span> <span class=\"built_in\">max</span> <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> step <span class=\"operator\">=</span> <span class=\"number\">0.001</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        numericInput<span class=\"punctuation\">(</span><span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;length&quot;</span><span class=\"punctuation\">,</span> value <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        bookmarkButton<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">      <span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      mainPanel<span class=\"punctuation\">(</span></span><br><span class=\"line\">        plotOutput<span class=\"punctuation\">(</span><span class=\"string\">&quot;fig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">      <span class=\"punctuation\">)</span></span><br><span class=\"line\">    <span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">,</span> enableBookmarking <span class=\"operator\">=</span> <span class=\"string\">&quot;url&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>您可以在<a href=\"https://hadley.shinyapps.io/ms-bookmark-url\">https://hadley.shinyapps.io/ms-bookmark-url</a>尝试一下。如果您在应用程序中操作并书签了一些有趣的状态，您会发现生成的URL看起来像这样：</p>\n<ul>\n<li><p><a href=\"https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&damping=1&delta=1&length=100&omega=1\">https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&amp;damping=1&amp;delta=1&amp;length=100&amp;omega=1</a></p>\n</li>\n<li><p><a href=\"https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&damping=0.966&delta=1.25&length=100&omega=-0.54\">https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&amp;damping=0.966&amp;delta=1.25&amp;length=100&amp;omega=-0.54</a></p>\n</li>\n<li><p><a href=\"https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&damping=0.997&delta=1.37&length=500&omega=-0.9\">https://hadley.shinyapps.io/ms-bookmark-url/?_inputs_&amp;damping=0.997&amp;delta=1.37&amp;length=500&amp;omega=-0.9</a></p>\n</li>\n</ul>\n<p>为了理解发生了什么，让我们以第一个URL为例，将其分解成几个部分：</p>\n<ul>\n<li><p><code>http://</code> 是与应用程序通信时使用的“协议”。这始终是<code>http</code>或<code>https</code>。</p>\n</li>\n<li><p><code>hadley.shinyapps.io/ms-bookmark-url</code> 是应用程序的位置。</p>\n</li>\n</ul>\n<p>问号<code>?</code>之后的所有内容都是“参数”。每个参数之间用<code>&amp;</code>分隔，如果将其分解，您可以看到应用程序中每个输入的值：</p>\n<ul>\n<li><p>damping&#x3D;1</p>\n</li>\n<li><p>delta&#x3D;1</p>\n</li>\n<li><p>length&#x3D;100</p>\n</li>\n<li><p>omega&#x3D;1</p>\n</li>\n</ul>\n<p>因此，“生成书签”意味着在URL的参数中记录输入的当前值。如果您在本地进行操作，URL看起来会略有不同：</p>\n<ul>\n<li><p><a href=\"http://127.0.0.1:4087/?_inputs_&damping=1&delta=1&length=100&omega=1\">http://127.0.0.1:4087/?_inputs_&amp;damping=1&amp;delta=1&amp;length=100&amp;omega=1</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_inputs_&damping=0.966&delta=1.25&length=100&omega=-0.54\">http://127.0.0.1:4087/?_inputs_&amp;damping=0.966&amp;delta=1.25&amp;length=100&amp;omega=-0.54</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_inputs_&damping=0.997&delta=1.37&length=500&omega=-0.9\">http://127.0.0.1:4087/?_inputs_&amp;damping=0.997&amp;delta=1.37&amp;length=500&amp;omega=-0.9</a></p>\n</li>\n</ul>\n<p>除了将<code>hadley.shinyapps.io/ms-bookmark-url</code>替换为类似<code>127.0.0.1:4087</code>的内容外，大多数部分都是相同的。<code>127.0.0.1</code>是一个特殊地址，始终指向您自己的计算机，而<code>4087</code>是一个随机分配的端口。通常，不同的应用程序会获得不同的路径或IP地址，但如果您在自己的计算机上托管多个应用程序，则无法做到这一点。</p>\n<h3 id=\"11-1-1-更新URL\"><a href=\"#11-1-1-更新URL\" class=\"headerlink\" title=\"11.1.1 更新URL\"></a>11.1.1 更新URL</h3><p>除了提供一个明确的按钮外，另一种选择是自动更新浏览器中的URL。这允许用户在其浏览器中使用用户书签命令，或者从地址栏复制和粘贴URL。</p>\n<p>自动更新URL需要在服务器函数中编写一些模板代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Automatically bookmark every time an input changes</span></span><br><span class=\"line\">observe<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  reactiveValuesToList<span class=\"punctuation\">(</span>input<span class=\"punctuation\">)</span></span><br><span class=\"line\">  session<span class=\"operator\">$</span>doBookmark<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># Update the query string</span></span><br><span class=\"line\">onBookmarked<span class=\"punctuation\">(</span>updateQueryString<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>这给我们提供了一个更新后的服务器函数，如下所示：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>input<span class=\"punctuation\">,</span> output<span class=\"punctuation\">,</span> session<span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  t <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span>seq<span class=\"punctuation\">(</span><span class=\"number\">0</span><span class=\"punctuation\">,</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span><span class=\"punctuation\">,</span> <span class=\"built_in\">length</span> <span class=\"operator\">=</span> input<span class=\"operator\">$</span><span class=\"built_in\">length</span> <span class=\"operator\">*</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  x <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>input<span class=\"operator\">$</span>omega <span class=\"operator\">*</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> input<span class=\"operator\">$</span>delta<span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  y <span class=\"operator\">&lt;-</span> reactive<span class=\"punctuation\">(</span><span class=\"built_in\">sin</span><span class=\"punctuation\">(</span>t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span> input<span class=\"operator\">$</span>damping <span class=\"operator\">^</span> t<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  output<span class=\"operator\">$</span>fig <span class=\"operator\">&lt;-</span> renderPlot<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    plot<span class=\"punctuation\">(</span>x<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> axes <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> xlab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> ylab <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> type <span class=\"operator\">=</span> <span class=\"string\">&quot;l&quot;</span><span class=\"punctuation\">,</span> lwd <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> res <span class=\"operator\">=</span> <span class=\"number\">96</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  observe<span class=\"punctuation\">(</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    reactiveValuesToList<span class=\"punctuation\">(</span>input<span class=\"punctuation\">)</span></span><br><span class=\"line\">    session<span class=\"operator\">$</span>doBookmark<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  onBookmarked<span class=\"punctuation\">(</span>updateQueryString<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">,</span> enableBookmarking <span class=\"operator\">=</span> <span class=\"string\">&quot;url&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>这会产生<a href=\"https://hadley.shinyapps.io/ms-bookmark-auto\">https://hadley.shinyapps.io/ms-bookmark-auto</a>——由于URL现在会自动更新，您可以从用户界面中删除书签按钮。</p>\n<h3 id=\"11-1-2-存储更丰富的状态\"><a href=\"#11-1-2-存储更丰富的状态\" class=\"headerlink\" title=\"11.1.2 存储更丰富的状态\"></a>11.1.2 存储更丰富的状态</h3><p>到目前为止，我们使用了<code>enableBookmarking = &quot;url&quot;</code>，它直接在URL中存储状态。这是一个很好的起点，因为它非常简单，可以在您可能部署Shiny应用的任何地方工作。然而，可以想象，如果您有大量的输入，URL会变得非常长，而且显然无法捕获上传的文件。</p>\n<p>对于这些情况，您可能想要使用<code>enableBookmarking = &quot;server&quot;</code>，它将状态保存到服务器上的<code>.rds</code>文件。这总是生成一个简短的、不透明的URL，但需要在服务器上额外存储。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shinyApp<span class=\"punctuation\">(</span>ui<span class=\"punctuation\">,</span> server<span class=\"punctuation\">,</span> enableBookmarking <span class=\"operator\">=</span> <span class=\"string\">&quot;server&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>目前，shinyapps.io尚不支持服务器端书签，因此您需要在本地尝试。如果您这样做，您会看到书签按钮生成类似以下的URL：</p>\n<ul>\n<li><p><a href=\"http://127.0.0.1:4087/?_state_id_=0d645f1b28f05c97\">http://127.0.0.1:4087/?_state_id_=0d645f1b28f05c97</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_state_id_=87b56383d8a1062c\">http://127.0.0.1:4087/?_state_id_=87b56383d8a1062c</a></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:4087/?_state_id_=c8b0291ba622b69c\">http://127.0.0.1:4087/?_state_id_=c8b0291ba622b69c</a></p>\n</li>\n</ul>\n<p>这些URL与您工作目录中匹配的目录配对：</p>\n<ul>\n<li><p>shiny_bookmarks&#x2F;0d645f1b28f05c97</p>\n</li>\n<li><p>shiny_bookmarks&#x2F;87b56383d8a1062c</p>\n</li>\n<li><p>shiny_bookmarks&#x2F;c8b0291ba622b69c</p>\n</li>\n</ul>\n<p>服务器端书签的主要缺点是它需要在服务器上保存文件，而且不清楚这些文件需要保留多长时间。如果您正在书签化复杂的状态并且从未删除这些文件，那么随着时间的推移，您的应用将占用越来越多的磁盘空间。如果您删除文件，一些旧书签将停止工作。</p>\n<h2 id=\"11-2-书签挑战\"><a href=\"#11-2-书签挑战\" class=\"headerlink\" title=\"11.2 书签挑战\"></a>11.2 书签挑战</h2><p>自动书签功能依赖于响应式图表。它使用保存的值初始化输入，然后重新播放所有的响应式表达式和输出，只要您的应用的响应式图表简单明了，就会产生与您看到的相同的应用。本节简要介绍了一些需要特别注意的情况：</p>\n<ul>\n<li><p>如果您的应用使用了随机数，即使所有输入都相同，结果也可能不同。如果确保每次生成相同的数字非常重要，您需要思考如何使随机过程可重复。最简单的方法是使用<a href=\"https://rdrr.io/pkg/shiny/man/repeatable.html\">repeatable()</a>函数；有关更多详细信息，请参阅相关文档。</p>\n</li>\n<li><p>如果您有选项卡，并希望书签和恢复活动选项卡，请确保在调用<a href=\"https://rdrr.io/pkg/shiny/man/tabsetPanel.html\">tabsetPanel()</a>时提供一个id。</p>\n</li>\n<li><p>如果有不应被书签记录的输入，例如它们包含不应共享的个人信息，请在服务器函数的某个位置调用<a href=\"https://rdrr.io/pkg/shiny/man/setBookmarkExclude.html\">setBookmarkExclude()</a>。例如，<code>setBookmarkExclude(c(&quot;secret1&quot;, &quot;secret2&quot;))</code>将确保<code>secret1</code>和<code>secret2</code>输入不会被书签记录。</p>\n</li>\n<li><p>如果您在自己的<a href=\"https://rdrr.io/pkg/shiny/man/reactiveValues.html\">reactiveValues()</a>对象中手动管理响应式状态（我们将在第<code>16</code>章中讨论），则需要使用<a href=\"https://rdrr.io/pkg/shiny/man/onBookmark.html\">onBookmark()</a>和<a href=\"https://rdrr.io/pkg/shiny/man/onBookmark.html\">onRestore()</a>回调来手动保存和加载额外的状态。有关更多详细信息，请参阅<a href=\"https://shiny.rstudio.com/articles/advanced-bookmarking.html\">高级书签</a>。</p>\n</li>\n</ul>\n<h2 id=\"11-3-练习\"><a href=\"#11-3-练习\" class=\"headerlink\" title=\"11.3 练习\"></a>11.3 练习</h2><ol>\n<li><p>为<a href=\"https://ambient.data-imaginist.com/reference/noise_simplex.html\">ambient::noise_simplex()</a>的结果生成可视化应用。您的应用应允许用户控制频率、分形、间隙和增益，并且应支持书签功能。如何确保从书签重新加载时图像看起来完全相同？（考虑seed参数的含义）。</p>\n</li>\n<li><p>创建一个简单的应用，允许您上传CSV文件，并为其添加书签。上传几个文件，然后查看<code>shiny_bookmarks</code>。这些文件是如何与书签对应的？（提示：您可以使用<a href=\"https://rdrr.io/r/base/readRDS.html\">readRDS()</a>来查看Shiny生成的缓存文件的内容）。</p>\n</li>\n</ol>\n<h2 id=\"11-4-总结\"><a href=\"#11-4-总结\" class=\"headerlink\" title=\"11.4 总结\"></a>11.4 总结</h2><p>本章介绍了如何为您的应用程序启用书签功能。书签功能对您的用户来说是一个很好的特性，因为它允许他们轻松地将自己的工作与他人分享。接下来，我们将讨论如何在Shiny应用程序中使用整洁评估。整洁评估是许多tidyverse函数的一个特性，如果您希望允许用户在（例如）dplyr管道或ggplot2图形中更改变量，那么您需要了解这个特性。</p>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"编程","path":"api/tags/编程.json"},{"name":"Shiny入门系列","path":"api/tags/Shiny入门系列.json"}]}