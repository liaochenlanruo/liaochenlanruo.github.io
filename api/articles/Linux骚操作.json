{"title":"Linux骚操作","slug":"Linux骚操作","date":"2021-01-15T07:37:43.000Z","updated":"2022-01-08T02:16:28.405Z","comments":true,"path":"api/articles/Linux骚操作.json","excerpt":"记录一些平时遇到的 Linux 问题及解决方法！","covers":["https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill2.png","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill3.png"],"content":"<p>记录一些平时遇到的 Linux 问题及解决方法！</p>\n<span id=\"more\"></span>\n<h1 id=\"骚操作1查杀僵尸进程\"><a class=\"markdownIt-Anchor\" href=\"#骚操作1查杀僵尸进程\"></a> 骚操作 1：查杀僵尸进程</h1>\n<h2 id=\"通过top命令发现了僵尸进程\"><a class=\"markdownIt-Anchor\" href=\"#通过top命令发现了僵尸进程\"></a> 通过 top 命令发现了僵尸进程</h2>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"发现僵尸进程\" /></p>\n<p>这里的 aragorn 和 prodigal 为僵尸进程。</p>\n<h2 id=\"寻找僵尸进程的父进程\"><a class=\"markdownIt-Anchor\" href=\"#寻找僵尸进程的父进程\"></a> 寻找僵尸进程的父进程</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ps</span> -A -ostat,ppid,pid,cmd <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -e <span class=\"token string\">'^[Zz]'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill2.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill2.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"寻找父进程ppid\" /></p>\n<p>aragorn 和 prodigal 的父进程的 ppid 为 133619。</p>\n<h2 id=\"杀死父进程\"><a class=\"markdownIt-Anchor\" href=\"#杀死父进程\"></a> 杀死父进程</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">kill</span> -9 <span class=\"token number\">133619</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill3.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill3.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"僵尸进程已被杀死\" /></p>\n<p>之所以选择杀死父进程是因为僵尸进程本身很难被杀掉！</p>\n<h1 id=\"骚操作2使用sudo或nohup运行bash报错\"><a class=\"markdownIt-Anchor\" href=\"#骚操作2使用sudo或nohup运行bash报错\"></a> 骚操作 2：使用 sudo 或 nohup 运行 bash 报错</h1>\n<h2 id=\"错误\"><a class=\"markdownIt-Anchor\" href=\"#错误\"></a> 错误</h2>\n<p>在终端里使用 sudo 或 nohup 运行 bash 的时候经常报错：-bash: syntax error near unexpected token 'do'。</p>\n<h2 id=\"解决方案\"><a class=\"markdownIt-Anchor\" href=\"#解决方案\"></a> 解决方案</h2>\n<p>将要运行的命令加到如下语句中：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\">#用超级用户运行时</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">bash</span> -c <span class=\"token string\">'your commands'</span>\n\n<span class=\"token comment\">#服务器投后台运行</span>\n<span class=\"token function\">nohup</span> <span class=\"token function\">bash</span> -c <span class=\"token string\">'your commands'</span> <span class=\"token operator\">&amp;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"骚操作3centos升级gcc\"><a class=\"markdownIt-Anchor\" href=\"#骚操作3centos升级gcc\"></a> 骚操作 3：CentOS 升级 GCC</h1>\n<h2 id=\"安装scl第三方软件选集\"><a class=\"markdownIt-Anchor\" href=\"#安装scl第三方软件选集\"></a> 安装 SCL（第三方软件选集）</h2>\n<p>使用下面命令安装 SCL<br />\nSCL 可以在不覆盖原有软件包的情况下与其共存，缺点就是仅支持 64 位<br />\n SCL 仅支持安装 devtoolset-4（gcc 5.2）（不含）之后的 gcc 版本</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y centos-release-scl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"安装gcc\"><a class=\"markdownIt-Anchor\" href=\"#安装gcc\"></a> 安装 gcc</h2>\n<p>使用以下命令安装 gcc，其中的 9 表示大版本号，默认安装大版本下的最新稳定版本</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"将gcc加入环境变量\"><a class=\"markdownIt-Anchor\" href=\"#将gcc加入环境变量\"></a> 将 gcc 加入环境变量</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"source /opt/rh/devtoolset-9/enable\"</span> <span class=\"token operator\">>></span> /etc/profile\n<span class=\"token builtin class-name\">source</span> /etc/profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h1 id=\"骚操作4centos-7防火墙\"><a class=\"markdownIt-Anchor\" href=\"#骚操作4centos-7防火墙\"></a> 骚操作 4：CentOS 7 防火墙</h1>\n<h2 id=\"启动防火墙\"><a class=\"markdownIt-Anchor\" href=\"#启动防火墙\"></a> 启动防火墙</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">启动： systemctl start firewalld<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"开启端口\"><a class=\"markdownIt-Anchor\" href=\"#开启端口\"></a> 开启端口</h2>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">firewall-cmd --zone&#x3D;public --add-port&#x3D;80&#x2F;tcp --permanent <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"重新载入\"><a class=\"markdownIt-Anchor\" href=\"#重新载入\"></a> 重新载入</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">firewall-cmd --reload<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"查看防火墙状态\"><a class=\"markdownIt-Anchor\" href=\"#查看防火墙状态\"></a> 查看防火墙状态</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl status firewalld.service\n\nfirewall-cmd --state<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"查看当前开了哪些端口\"><a class=\"markdownIt-Anchor\" href=\"#查看当前开了哪些端口\"></a> 查看当前开了哪些端口</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">firewall-cmd --list-services<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"查看所有打开的端口\"><a class=\"markdownIt-Anchor\" href=\"#查看所有打开的端口\"></a> 查看所有打开的端口</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">firewall-cmd --zone<span class=\"token operator\">=</span>public --list-ports<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"骚操作5linux基本指令丢失修复办法\"><a class=\"markdownIt-Anchor\" href=\"#骚操作5linux基本指令丢失修复办法\"></a> 骚操作 5：Linux 基本指令丢失修复办法</h1>\n<p>如输入 ls、cd、cat 等基本指令提示找不到命令，可以通过以下命令修复：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n","more":"<h1 id=\"骚操作1查杀僵尸进程\"><a class=\"markdownIt-Anchor\" href=\"#骚操作1查杀僵尸进程\"></a> 骚操作 1：查杀僵尸进程</h1>\n<h2 id=\"通过top命令发现了僵尸进程\"><a class=\"markdownIt-Anchor\" href=\"#通过top命令发现了僵尸进程\"></a> 通过 top 命令发现了僵尸进程</h2>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill1.png\" alt=\"发现僵尸进程\" /></p>\n<p>这里的 aragorn 和 prodigal 为僵尸进程。</p>\n<h2 id=\"寻找僵尸进程的父进程\"><a class=\"markdownIt-Anchor\" href=\"#寻找僵尸进程的父进程\"></a> 寻找僵尸进程的父进程</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ps</span> -A -ostat,ppid,pid,cmd <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -e <span class=\"token string\">'^[Zz]'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill2.png\" alt=\"寻找父进程ppid\" /></p>\n<p>aragorn 和 prodigal 的父进程的 ppid 为 133619。</p>\n<h2 id=\"杀死父进程\"><a class=\"markdownIt-Anchor\" href=\"#杀死父进程\"></a> 杀死父进程</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">kill</span> -9 <span class=\"token number\">133619</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/LinuxKill3.png\" alt=\"僵尸进程已被杀死\" /></p>\n<p>之所以选择杀死父进程是因为僵尸进程本身很难被杀掉！</p>\n<h1 id=\"骚操作2使用sudo或nohup运行bash报错\"><a class=\"markdownIt-Anchor\" href=\"#骚操作2使用sudo或nohup运行bash报错\"></a> 骚操作 2：使用 sudo 或 nohup 运行 bash 报错</h1>\n<h2 id=\"错误\"><a class=\"markdownIt-Anchor\" href=\"#错误\"></a> 错误</h2>\n<p>在终端里使用 sudo 或 nohup 运行 bash 的时候经常报错：-bash: syntax error near unexpected token 'do'。</p>\n<h2 id=\"解决方案\"><a class=\"markdownIt-Anchor\" href=\"#解决方案\"></a> 解决方案</h2>\n<p>将要运行的命令加到如下语句中：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\">#用超级用户运行时</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">bash</span> -c <span class=\"token string\">'your commands'</span>\n\n<span class=\"token comment\">#服务器投后台运行</span>\n<span class=\"token function\">nohup</span> <span class=\"token function\">bash</span> -c <span class=\"token string\">'your commands'</span> <span class=\"token operator\">&amp;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"骚操作3centos升级gcc\"><a class=\"markdownIt-Anchor\" href=\"#骚操作3centos升级gcc\"></a> 骚操作 3：CentOS 升级 GCC</h1>\n<h2 id=\"安装scl第三方软件选集\"><a class=\"markdownIt-Anchor\" href=\"#安装scl第三方软件选集\"></a> 安装 SCL（第三方软件选集）</h2>\n<p>使用下面命令安装 SCL<br />\nSCL 可以在不覆盖原有软件包的情况下与其共存，缺点就是仅支持 64 位<br />\n SCL 仅支持安装 devtoolset-4（gcc 5.2）（不含）之后的 gcc 版本</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y centos-release-scl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"安装gcc\"><a class=\"markdownIt-Anchor\" href=\"#安装gcc\"></a> 安装 gcc</h2>\n<p>使用以下命令安装 gcc，其中的 9 表示大版本号，默认安装大版本下的最新稳定版本</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"将gcc加入环境变量\"><a class=\"markdownIt-Anchor\" href=\"#将gcc加入环境变量\"></a> 将 gcc 加入环境变量</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"source /opt/rh/devtoolset-9/enable\"</span> <span class=\"token operator\">>></span> /etc/profile\n<span class=\"token builtin class-name\">source</span> /etc/profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h1 id=\"骚操作4centos-7防火墙\"><a class=\"markdownIt-Anchor\" href=\"#骚操作4centos-7防火墙\"></a> 骚操作 4：CentOS 7 防火墙</h1>\n<h2 id=\"启动防火墙\"><a class=\"markdownIt-Anchor\" href=\"#启动防火墙\"></a> 启动防火墙</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">启动： systemctl start firewalld<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"开启端口\"><a class=\"markdownIt-Anchor\" href=\"#开启端口\"></a> 开启端口</h2>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">firewall-cmd --zone&#x3D;public --add-port&#x3D;80&#x2F;tcp --permanent <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"重新载入\"><a class=\"markdownIt-Anchor\" href=\"#重新载入\"></a> 重新载入</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">firewall-cmd --reload<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"查看防火墙状态\"><a class=\"markdownIt-Anchor\" href=\"#查看防火墙状态\"></a> 查看防火墙状态</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl status firewalld.service\n\nfirewall-cmd --state<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"查看当前开了哪些端口\"><a class=\"markdownIt-Anchor\" href=\"#查看当前开了哪些端口\"></a> 查看当前开了哪些端口</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">firewall-cmd --list-services<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"查看所有打开的端口\"><a class=\"markdownIt-Anchor\" href=\"#查看所有打开的端口\"></a> 查看所有打开的端口</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">firewall-cmd --zone<span class=\"token operator\">=</span>public --list-ports<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"骚操作5linux基本指令丢失修复办法\"><a class=\"markdownIt-Anchor\" href=\"#骚操作5linux基本指令丢失修复办法\"></a> 骚操作 5：Linux 基本指令丢失修复办法</h1>\n<p>如输入 ls、cd、cat 等基本指令提示找不到命令，可以通过以下命令修复：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"}]}