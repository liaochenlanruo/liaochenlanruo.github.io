{"title":"WSL安装Docker避坑指北","slug":"WSL安装Docker避坑指北","date":"2022-03-10T02:43:42.000Z","updated":"2022-03-10T03:14:47.936Z","comments":true,"path":"api/articles/WSL安装Docker避坑指北.json","excerpt":null,"covers":["https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png"],"content":"<h1 id=\"升级wsl\"><a class=\"markdownIt-Anchor\" href=\"#升级wsl\"></a> 升级 WSL</h1>\n<ul>\n<li>\n<p>查看已安装的 WSL 版本 (Windows PowerShell 中运行)</p>\n  <pre class=\"line-numbers language-none\"><code class=\"language-none\">wsl.exe -l -v\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>显示如下：</p>\n  <pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">  NAME                   STATE           VERSION\n* Ubuntu-20.04           Running         1\n  docker-desktop-data    Stopped         2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>看到安装的为 WSL1，据说 WSL1 不支持 Docker，所以换成 WSL2，至于 WSL1 和 WSL2 的异同可参考<a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions\">比较 WSL 1 和 WSL 2</a>。</p>\n</li>\n<li>\n<p>安装 WSL2 (Windows PowerShell 中运行)</p>\n  <pre class=\"line-numbers language-none\"><code class=\"language-none\">wsl.exe --set-version ubuntu-20.04 2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>显示如下：</p>\n  <pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">正在进行转换，这可能需要几分钟时间...\n有关与 WSL 2 的主要区别的信息，请访问 https:&#x2F;&#x2F;aka.ms&#x2F;wsl2\n转换完成。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<h1 id=\"安装docker\"><a class=\"markdownIt-Anchor\" href=\"#安装docker\"></a> 安装 Docker</h1>\n<p>在 WSL 中运行如下命令：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> remove docker docker-engine docker.io\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> apt-transport-https ca-certificates <span class=\"token function\">curl</span> software-properties-common\n<span class=\"token function\">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\n<span class=\"token function\">sudo</span> apt-key fingerprint 0EBFCD88\n<span class=\"token function\">sudo</span> add-apt-repository <span class=\"token string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class=\"token variable\"><span class=\"token variable\">$(</span>lsb_release -cs<span class=\"token variable\">)</span></span> stable\"</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> docker-ce<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"root用户启动docker\"><a class=\"markdownIt-Anchor\" href=\"#root用户启动docker\"></a> Root 用户启动 Docker</h1>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">su</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_HOST</span><span class=\"token operator\">=</span>tcp://localhost:2375\n<span class=\"token function\">service</span> docker start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>显示如下：</p>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">* Starting Docker: docker<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"测试还是在root用户\"><a class=\"markdownIt-Anchor\" href=\"#测试还是在root用户\"></a> 测试 (还是在 root 用户)</h1>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"报错\"><a class=\"markdownIt-Anchor\" href=\"#报错\"></a> 报错</h1>\n<p>以下是报错信息：</p>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">Client: Docker Engine - Community\n Version:           20.10.12\n API version:       1.41\n Go version:        go1.16.12\n Git commit:        e91ed57\n Built:             Mon Dec 13 11:45:33 2021\n OS&#x2F;Arch:           linux&#x2F;amd64\n Context:           default\n Experimental:      true\nCannot connect to the Docker daemon at tcp:&#x2F;&#x2F;localhost:2375. Is the docker daemon running?<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"修复\"><a class=\"markdownIt-Anchor\" href=\"#修复\"></a> 修复</h1>\n<p><strong>回到普通用户运行</strong></p>\n<ul>\n<li>\n<p>编辑环境变量</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> ~/.bashrc\n\n<span class=\"token comment\"># 在最下面添加一行：</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_HOST</span><span class=\"token operator\">=</span><span class=\"token string\">'unix:///var/run/docker.sock'</span>\n<span class=\"token builtin class-name\">source</span> ~/.bashrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li>\n<p>再次测试</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>显示如下表明成功：</p>\n  <pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">Client: Docker Engine - Community\n Version:           20.10.12\n API version:       1.41\n Go version:        go1.16.12\n Git commit:        e91ed57\n Built:             Mon Dec 13 11:45:33 2021\n OS&#x2F;Arch:           linux&#x2F;amd64\n Context:           default\n Experimental:      true\n\nServer: Docker Engine - Community\n Engine:\n  Version:          20.10.12\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.16.12\n  Git commit:       459d0df\n  Built:            Mon Dec 13 11:43:42 2021\n  OS&#x2F;Arch:          linux&#x2F;amd64\n  Experimental:     false\n containerd:\n  Version:          1.4.13\n  GitCommit:        9cc61520f4cd876b86e77edfeb88fbcd536d1f9d\n runc:\n  Version:          1.0.3\n  GitCommit:        v1.0.3-0-gf46b6ba\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<h1 id=\"参考\"><a class=\"markdownIt-Anchor\" href=\"#参考\"></a> 参考</h1>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_44701736/article/details/119411485\">WSL 安装 docker</a></li>\n<li><a href=\"https://www.jianshu.com/p/7c0084fd9003\">Cannot connect to the Docker daemon at tcp://localhost:2375. Is the docker daemon running?</a></li>\n</ul>\n<h1 id=\"代码获取\"><a class=\"markdownIt-Anchor\" href=\"#代码获取\"></a> 代码获取</h1>\n<p>关注公众号 “生信之巅”，聊天窗口回复 “” 获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","more":"<h1 id=\"升级wsl\"><a class=\"markdownIt-Anchor\" href=\"#升级wsl\"></a> 升级 WSL</h1>\n<ul>\n<li>\n<p>查看已安装的 WSL 版本 (Windows PowerShell 中运行)</p>\n  <pre class=\"line-numbers language-none\"><code class=\"language-none\">wsl.exe -l -v\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>显示如下：</p>\n  <pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">  NAME                   STATE           VERSION\n* Ubuntu-20.04           Running         1\n  docker-desktop-data    Stopped         2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>看到安装的为 WSL1，据说 WSL1 不支持 Docker，所以换成 WSL2，至于 WSL1 和 WSL2 的异同可参考<a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions\">比较 WSL 1 和 WSL 2</a>。</p>\n</li>\n<li>\n<p>安装 WSL2 (Windows PowerShell 中运行)</p>\n  <pre class=\"line-numbers language-none\"><code class=\"language-none\">wsl.exe --set-version ubuntu-20.04 2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>显示如下：</p>\n  <pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">正在进行转换，这可能需要几分钟时间...\n有关与 WSL 2 的主要区别的信息，请访问 https:&#x2F;&#x2F;aka.ms&#x2F;wsl2\n转换完成。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<h1 id=\"安装docker\"><a class=\"markdownIt-Anchor\" href=\"#安装docker\"></a> 安装 Docker</h1>\n<p>在 WSL 中运行如下命令：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> remove docker docker-engine docker.io\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> apt-transport-https ca-certificates <span class=\"token function\">curl</span> software-properties-common\n<span class=\"token function\">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\n<span class=\"token function\">sudo</span> apt-key fingerprint 0EBFCD88\n<span class=\"token function\">sudo</span> add-apt-repository <span class=\"token string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class=\"token variable\"><span class=\"token variable\">$(</span>lsb_release -cs<span class=\"token variable\">)</span></span> stable\"</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> docker-ce<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"root用户启动docker\"><a class=\"markdownIt-Anchor\" href=\"#root用户启动docker\"></a> Root 用户启动 Docker</h1>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">su</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_HOST</span><span class=\"token operator\">=</span>tcp://localhost:2375\n<span class=\"token function\">service</span> docker start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>显示如下：</p>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">* Starting Docker: docker<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"测试还是在root用户\"><a class=\"markdownIt-Anchor\" href=\"#测试还是在root用户\"></a> 测试 (还是在 root 用户)</h1>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h1 id=\"报错\"><a class=\"markdownIt-Anchor\" href=\"#报错\"></a> 报错</h1>\n<p>以下是报错信息：</p>\n<pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">Client: Docker Engine - Community\n Version:           20.10.12\n API version:       1.41\n Go version:        go1.16.12\n Git commit:        e91ed57\n Built:             Mon Dec 13 11:45:33 2021\n OS&#x2F;Arch:           linux&#x2F;amd64\n Context:           default\n Experimental:      true\nCannot connect to the Docker daemon at tcp:&#x2F;&#x2F;localhost:2375. Is the docker daemon running?<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"修复\"><a class=\"markdownIt-Anchor\" href=\"#修复\"></a> 修复</h1>\n<p><strong>回到普通用户运行</strong></p>\n<ul>\n<li>\n<p>编辑环境变量</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> ~/.bashrc\n\n<span class=\"token comment\"># 在最下面添加一行：</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_HOST</span><span class=\"token operator\">=</span><span class=\"token string\">'unix:///var/run/docker.sock'</span>\n<span class=\"token builtin class-name\">source</span> ~/.bashrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li>\n<p>再次测试</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>显示如下表明成功：</p>\n  <pre class=\"line-numbers language-tex\" data-language=\"tex\"><code class=\"language-tex\">Client: Docker Engine - Community\n Version:           20.10.12\n API version:       1.41\n Go version:        go1.16.12\n Git commit:        e91ed57\n Built:             Mon Dec 13 11:45:33 2021\n OS&#x2F;Arch:           linux&#x2F;amd64\n Context:           default\n Experimental:      true\n\nServer: Docker Engine - Community\n Engine:\n  Version:          20.10.12\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.16.12\n  Git commit:       459d0df\n  Built:            Mon Dec 13 11:43:42 2021\n  OS&#x2F;Arch:          linux&#x2F;amd64\n  Experimental:     false\n containerd:\n  Version:          1.4.13\n  GitCommit:        9cc61520f4cd876b86e77edfeb88fbcd536d1f9d\n runc:\n  Version:          1.0.3\n  GitCommit:        v1.0.3-0-gf46b6ba\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<h1 id=\"参考\"><a class=\"markdownIt-Anchor\" href=\"#参考\"></a> 参考</h1>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_44701736/article/details/119411485\">WSL 安装 docker</a></li>\n<li><a href=\"https://www.jianshu.com/p/7c0084fd9003\">Cannot connect to the Docker daemon at tcp://localhost:2375. Is the docker daemon running?</a></li>\n</ul>\n<h1 id=\"代码获取\"><a class=\"markdownIt-Anchor\" href=\"#代码获取\"></a> 代码获取</h1>\n<p>关注公众号 “生信之巅”，聊天窗口回复 “” 获取下载链接。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"系统","path":"api/tags/系统.json"},{"name":"虚拟机","path":"api/tags/虚拟机.json"}]}