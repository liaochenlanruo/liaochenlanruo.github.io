{"title":"用MaAsLin2包做微生物组多变量线性模型关联分析","slug":"用MaAsLin2包做微生物组多变量线性模型关联分析","date":"2024-07-30T14:41:21.000Z","updated":"2024-08-12T13:51:57.224Z","comments":true,"path":"api/articles/用MaAsLin2包做微生物组多变量线性模型关联分析.json","excerpt":null,"covers":["https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/sigresults_screenshot.png","https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/scatterplot_screenshot.png","https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/boxplot_screenshot.png","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png"],"content":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>MaAsLin 2 是 MaAsLin（微生物组多变量线性模型关联，Microbiome Multivariable Association with Linear Models）的下一代产品。</p>\n<p>MaAsLin 2 是一个全面的 R 语言软件包，用于高效地确定表型、环境、暴露、协变量和微生物组元组学特征之间的多变量关联。MaAsLin 2 依赖于一般线性模型来适应大多数现代流行病学研究设计，包括横断面和纵向研究，以及多种数据探索、标准化和转换方法。</p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;BiocManager&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;BiocManager&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">BiocManager<span class=\"operator\">::</span>install<span class=\"punctuation\">(</span><span class=\"string\">&quot;Maaslin2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"微生物组关联检测\"><a href=\"#微生物组关联检测\" class=\"headerlink\" title=\"微生物组关联检测\"></a>微生物组关联检测</h1><h2 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h2><h3 id=\"微生物组特征数据或功能数据\"><a href=\"#微生物组特征数据或功能数据\" class=\"headerlink\" title=\"微生物组特征数据或功能数据\"></a>微生物组特征数据或功能数据</h3><ul>\n<li>以制表符分隔列</li>\n<li>行为样本，列为特征（微生物&#x2F;基因&#x2F;功能……）</li>\n</ul>\n<div style=\"overflow-x:auto;\">\n<table>\n    <thead>\n        <tr>\n            <th>ID</th>\n            <th>Bifidobacterium adolescentis</th>\n            <th>Bifidobacterium bifidum</th>\n            <th>Bifidobacterium longum</th>\n            <th>Bifidobacterium pseudocatenulatum</th>\n            <th>Collinsella aerofaciens</th>\n            <th>Bacteroides caccae</th>\n            <th>Bacteroides cellulosilyticus</th>\n            <th>Bacteroides dorei</th>\n            <th>Bacteroides eggerthii</th>\n            <th>Bacteroides faecis</th>\n            <th>Bacteroides finegoldii</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>CSM5FZ3N_P</td>\n            <td>Cedars-Sinai</td>\n            <td>43</td>\n            <td>CD</td>\n            <td>C3001</td>\n            <td>No</td>\n            <td>No</td>\n            <td>0.792314801112388</td>\n            <td>No</td>\n            <td>No</td>\n            <td>No</td>\n            <td>1</td>\n        </tr>\n        <!-- ... other rows ... -->\n        <tr>\n            <td>CSM5FZ4M_P</td> <!-- Added _P to make the ID consistent -->\n            <td>Cedars-Sinai</td>\n            <td>43</td>\n            <td>UC</td>\n            <td>C3003</td>\n            <td>No</td>\n            <td>No</td>\n            <td>0.761300183426806</td>\n            <td>No</td>\n            <td>No</td>\n            <td>No</td>\n            <td>6</td>\n        </tr>\n        <tr>\n            <td>CSM5LLGB_P</td>\n            <td>MGH</td>\n            <td>30</td>\n            <td>CD</td>\n            <td>M2014</td>\n            <td>No</td>\n            <td>No</td>\n            <td>0.730525895151516</td>\n            <td>No</td>\n            <td>No</td>\n            <td>No</td>\n            <td>8</td>\n        </tr>\n    </tbody>\n</table>\n</div>\n\n<h3 id=\"元数据\"><a href=\"#元数据\" class=\"headerlink\" title=\"元数据\"></a>元数据</h3><ul>\n<li>以制表符分隔列</li>\n<li>行为样本，列为特征</li>\n</ul>\n<div style=\"overflow-x:auto;\">  \n<table border=\"1\">  \n    <thead>  \n        <tr>  \n            <th>ID</th>  \n            <th>site</th>  \n            <th>age</th>  \n            <th>diagnosis</th>  \n            <th>subject</th>  \n            <th>antibiotics</th>  \n            <th>dysbiosis_binary</th>  \n            <th>dysbiosis</th>  \n            <th>dysbiosisnonIBD</th>  \n            <th>dysbiosisUC</th>  \n            <th>dysbiosisCD</th>  \n            <th>collection</th>  \n        </tr>  \n    </thead>  \n    <tbody>  \n                <tr>\n            <td>CSM5FZ3N_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.792314801112388</td><td>No</td><td>No</td><td>No</td><td>1</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3R_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.837923415694291</td><td>No</td><td>No</td><td>No</td><td>2</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3T_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.924296928419748</td><td>No</td><td>No</td><td>Yes</td><td>1</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3V_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.830400526852384</td><td>No</td><td>No</td><td>No</td><td>4</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3X_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.910966992923041</td><td>No</td><td>No</td><td>Yes</td><td>2</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3Z_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.912281677355966</td><td>No</td><td>No</td><td>Yes</td><td>3</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ42_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.903049136702093</td><td>No</td><td>No</td><td>Yes</td><td>4</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ44_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.87825476936449</td><td>No</td><td>No</td><td>Yes</td><td>5</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ46_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.92542872181954</td><td>No</td><td>No</td><td>Yes</td><td>6</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4A_P</td><td>Cedars-Sinai</td><td>47</td><td>UC</td><td>C3004</td><td>No</td><td>No</td><td>0.775160480913896</td><td>No</td><td>No</td><td>No</td><td>1</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4C_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.836244630681399</td><td>No</td><td>No</td><td>No</td><td>5</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4E_P</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>Yes</td><td>No</td><td>0.787616535915359</td><td>No</td><td>No</td><td>No</td><td>2</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4G_P</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>No</td><td>No</td><td>0.68128445477854</td><td>No</td><td>No</td><td>No</td><td>3</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4K_P</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>Yes</td><td>No</td><td>0.717164790084925</td><td>No</td><td>No</td><td>No</td><td>5</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4M</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>No</td><td>No</td><td>0.761300183426806</td><td>No</td><td>No</td><td>No</td><td>6</td>\n        </tr>\n        <tr>\n            <td>CSM5LLGB_P</td><td>MGH</td><td>30</td><td>CD</td><td>M2014</td><td>No</td><td>No</td><td>0.730525895151516</td><td>No</td><td>No</td><td>No</td><td>8</td>\n        </tr> \n    </tbody>  \n</table>  \n</div>\n\n<p>两个文件包含的样本可以不同，分析时只取二者共有的样本。样本顺序也无需一致。</p>\n<h3 id=\"读入文件\"><a href=\"#读入文件\" class=\"headerlink\" title=\"读入文件\"></a>读入文件</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df_input_data <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span>file             <span class=\"operator\">=</span> input_data<span class=\"punctuation\">,</span></span><br><span class=\"line\">                           header           <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_data<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span>file             <span class=\"operator\">=</span> input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               header           <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                               stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_metadata<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_path <span class=\"operator\">=</span> read.csv<span class=\"punctuation\">(</span><span class=\"string\">&quot;./pathabundance_relab.tsv&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_path<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行MaAsLin-2\"><a href=\"#运行MaAsLin-2\" class=\"headerlink\" title=\"运行MaAsLin 2\"></a>运行MaAsLin 2</h2><p>在MaAsLin中，可以使用几种不同类型的统计模型来进行关联测试（例如简单线性模型、零膨胀模型、基于计数的模型等）。作者在论文中评估了各种模型的优缺点，虽然默认模型通常适用于大多数分析，但在某些情况下，用户可能希望选择不同的模型。这同样适用于多种不同的微生物群落数据类型（taxonomy 或functional profiles）、环境（人类或其他）和测量方式（计数或相对比例），只要使用适当修改过的归一化&#x2F;转换方案即可。</p>\n<p>对于模型选择，如果你的输入是<code>计数数据</code>，那么你可以使用<code>NEGBIN</code>和<code>ZINB</code>模型；而对于<code>非计数数据</code>（如百分比、CPM或相对丰度）的输入，你可以使用<code>LM</code>和<code>CPLM</code>模型。</p>\n<p>在MaAsLin 2实现的归一化方法中，<u>TMM和CSS仅适用于计数数据，并且它们也返回归一化后的计数</u>，这与TSS和CLR不同。因此，如果你的输入是计数数据，你可以使用上述两种归一化方法（即TMM、CSS或NONE（如果数据已经归一化））而无需进一步转换（即transform &#x3D; NONE）。</p>\n<p><u>在非计数模型中，CPLM要求数据为正数</u>。因此，任何产生负值的转换通常都不适用于<code>CPLM</code>。</p>\n<p>由于所有非LM模型都与其与广义线性模型（GLM）的紧密联系而使用固有的对数链接转换，因此建议它们以<code>transform = NONE</code>的方式运行。</p>\n<p>除此之外，<u>LM是唯一能够处理正数和负数（在归一化&#x2F;转换之后）的模型</u>，并且（根据手稿）它通常对参数变化具有更强的鲁棒性（这是非LM模型的典型限制）。关于是否使用LM、CPLM或其他模型，直观上，<u>在存在零值的情况下，<code>CPLM</code>或<code>零膨胀替代模型</code>应该表现更好，但根据我们的基准测试，我们没有证据表明CPLM显著优于LM模型</u>。因此，<b>在选择模型时，应综合考虑数据的特性、研究目的以及模型的适用性和性能</b>。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Model (-m ANALYSIS_METHOD)</th>\n<th align=\"center\">Data type</th>\n<th align=\"center\">Normalization (-n NORMALIZATION)</th>\n<th align=\"center\">Transformation (-t TRANSFORM)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">LM</td>\n<td align=\"center\">count and non-count</td>\n<td align=\"center\">TSS, CLR, NONE</td>\n<td align=\"center\">LOG, LOGIT, AST, NONE</td>\n</tr>\n<tr>\n<td align=\"center\">CPLM</td>\n<td align=\"center\">count and non-count</td>\n<td align=\"center\">TSS, TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n<tr>\n<td align=\"center\">NEGBIN</td>\n<td align=\"center\">count</td>\n<td align=\"center\">TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n<tr>\n<td align=\"center\">ZINB</td>\n<td align=\"center\">count</td>\n<td align=\"center\">TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n</tbody></table>\n<p><strong>注</strong>：通常，还需要考虑用于过滤数据（即流行率和丰度阈值）的阈值，以减少异常值和假阳性。有关此方面的更多详细信息，请参阅MaAsLin 2中的第<a href=\"https://github.com/biobakery/biobakery/wiki/maaslin2#431-prevalence-and-abundance-filtering-in-maaslin2\">4.3.1节“流行率和丰度过滤”</a>。</p>\n<p>以下命令在HMP2数据上运行MaAsLin 2，执行多变量回归模型以测试微生物物种丰度与IBD诊断和<a href=\"https://www.nature.com/articles/s41586-019-1237-9\">菌群失调评分</a>之间的关联（<code>fixed_effects = c(&quot;diagnosis&quot;, &quot;dysbiosis&quot;)</code>）。对于具有超过2个水平的任何分类变量，还需要指定哪个变量应作为参考水平，方法是使用（<code>reference = c(&quot;diagnosis,nonIBD&quot;)</code>）。<strong>注</strong>：<font color=#FF0000>在变量和水平之间添加空格可能会导致使用错误的参考水平</font>。输出将生成在当前工作目录下的名为demo_output的文件夹中（<code>output = &quot;demo_output&quot;</code>）。在此示例中，输入数据已预先进行归一化和过滤，因此我们也将关闭默认的归一化和流行率过滤。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"输出\"><a href=\"#输出\" class=\"headerlink\" title=\"输出\"></a>输出</h2><h3 id=\"重要关联\"><a href=\"#重要关联\" class=\"headerlink\" title=\"重要关联\"></a>重要关联</h3><p>MaAsLin 2最重要的输出之一可能是重要关联的列表。这些关联在<code>significant_results.tsv</code>文件中提供：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/sigresults_screenshot.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/sigresults_screenshot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"significant_results.tsv\"></p>\n<p>这些是通过MaAsLin 2显著性阈值的全部关联列表，按照q值递增的顺序排序。列包括：</p>\n<ul>\n<li><p><strong>metadata</strong>：与微生物特征相关联的变量名。</p>\n</li>\n<li><p><strong>feature</strong>：微生物特征（分类群、基因、途径等）。</p>\n</li>\n<li><p><strong>value</strong>：对于分类特征，这是报告系数和关联显著性的具体特征水平。</p>\n</li>\n<li><p><strong>coef</strong>：模型系数值（效应大小）。对于分类变量，系数表示在value中指定的类别与参考类别之间的对比。</p>\n</li>\n<li><p><strong>stderr</strong>：模型的标准误差。</p>\n</li>\n<li><p><strong>N</strong>：用于此关联的模型中样本的总数（例如，因为可以排除缺失值）。</p>\n</li>\n<li><p><strong>N.not.0</strong>：在这些样本中，特征非零的总数。</p>\n</li>\n<li><p><strong>pval</strong>：此关联的名义显著性。</p>\n</li>\n<li><p><strong>qval</strong>：使用p.adjust函数和校正方法（如BH等）计算得到的校正显著性。</p>\n</li>\n<li><p><strong>问题</strong>：如何解释这个表格的第一行？</p>\n</li>\n</ul>\n<p>对于<code>significant_results.tsv</code>中的每个重要关联，MaAsLin 2还会生成可视化图表以供检查（分类变量的箱线图，连续变量的散点图）。这些图表命名为“metadata_name.pdf”。例如，从我们的分析运行中，我们得到了可视化文件<code>dysbiosis.pdf</code>和<code>diagnosis.pdf</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/scatterplot_screenshot.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/scatterplot_screenshot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"dysbiosis.pdf\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/boxplot_screenshot.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/boxplot_screenshot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"diagnosis.pdf\"></p>\n<h3 id=\"输出文件完整列表\"><a href=\"#输出文件完整列表\" class=\"headerlink\" title=\"输出文件完整列表\"></a>输出文件完整列表</h3><p>MaAsLin 2生成两种类型的输出文件：数据和可视化文件。</p>\n<ul>\n<li><p>数据输出文件</p>\n<ul>\n<li><p>significant_results.tsv</p>\n</li>\n<li><p>all_results.tsv</p>\n<ul>\n<li>与significant_results.tsv格式相同，但包含所有关联结果（而不仅仅是显著的结果）。</li>\n<li>您也可以在R中使用fit_data$results访问此表。</li>\n</ul>\n</li>\n<li><p>residuals.rds</p>\n<ul>\n<li>此文件包含一个包含每个特征残差的数据框。</li>\n</ul>\n</li>\n<li><p>maaslin2.log</p>\n<ul>\n<li>此文件包含运行的所有日志信息。</li>\n<li>它包括所有设置、警告、错误和运行的步骤。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>可视化输出文件</p>\n<ul>\n<li><p>heatmap.pdf</p>\n<ul>\n<li>此文件包含显著关联的热图。</li>\n</ul>\n</li>\n<li><p>[a-z&#x2F;0-9]+.pdf</p>\n<ul>\n<li>为每个显著关联生成一个图表。</li>\n<li>对于连续元数据，使用散点图。</li>\n<li>对于分类数据，使用箱线图。</li>\n<li>绘制的数据点已经过归一化、过滤和转换。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MaAsLin-2在功能谱上的应用\"><a href=\"#MaAsLin-2在功能谱上的应用\" class=\"headerlink\" title=\"MaAsLin 2在功能谱上的应用\"></a>MaAsLin 2在功能谱上的应用</h3><p>如果您的功能表是由HUMAnN生成的，并且已经使用<code>humann_renorm_table</code>脚本进行了归一化，那么您不需要执行任何额外的归一化——测序深度的影响已经被消除（这正是本教程中将使用的）。我们倾向于使用<code>CPM</code>单位，因为我们发现它们更方便，但在建模目的上，它们在数值上与相对丰度是等价的（<code>CPM = RA * 1e6</code>）。</p>\n<p>否则，可使用上述关于模型&#x2F;归一化&#x2F;转换的相同思路。</p>\n<p>在使用MaAsLin 2处理功能谱时的一些其他快速提示：</p>\n<ul>\n<li>为了减少特征数量，通常希望运行未分层的功能特征（或分层特征的过滤子集）。</li>\n<li>可能还想移除与特定分类群高度相关的功能特征（即可能由该微生物贡献），因为这些特征可以通过分类学变化得到更好的解释。</li>\n</ul>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#This can also be done with with the HUMAnN 3 untiliy `humann_split_stratified_table`</span></span><br><span class=\"line\">unstrat_pathways <span class=\"operator\">&lt;-</span><span class=\"keyword\">function</span><span class=\"punctuation\">(</span>dat_path<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  temp <span class=\"operator\">=</span> dat_path<span class=\"punctuation\">[</span><span class=\"operator\">!</span>grepl<span class=\"punctuation\">(</span><span class=\"string\">&quot;\\\\|&quot;</span><span class=\"punctuation\">,</span>rownames<span class=\"punctuation\">(</span>dat_path<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"built_in\">return</span><span class=\"punctuation\">(</span>temp<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_path <span class=\"operator\">=</span> unstrat_pathways<span class=\"punctuation\">(</span>df_input_path<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>在由<a href=\"https://github.com/biobakery/biobakery/wiki/biobakery_workflows\">bioBakery工作流程</a>生成的MetaCyc途径表上运行与上述相同的模型。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_func <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_path<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_functional&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    min_abundance  <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<p><strong>注意</strong>：在这里，我们有列中的样本和行中的特征，MaAsLin 2正确地识别了这一点，并且能够匹配样本。</p>\n<p>作者最近还发表了关于使用MaAsLin 2分析宏转录组学数据（MTX）中差异特征的研究，有关该主题的更多信息，请参阅<a href=\"https://academic.oup.com/bioinformatics/article/37/Supplement_1/i34/6319701\">最近的出版物</a>。</p>\n<h1 id=\"高级主题\"><a href=\"#高级主题\" class=\"headerlink\" title=\"高级主题\"></a>高级主题</h1><h2 id=\"交互作用\"><a href=\"#交互作用\" class=\"headerlink\" title=\"交互作用\"></a>交互作用</h2><p>许多统计分析都关注于测试某些变量之间的交互作用。不幸的是，MaAsLin 2目前尚未提供直接的界面来进行此操作。相反，用户需要创建人工交互列作为额外的fixed_effects项。以上面的拟合为例，为了测试诊断与菌群失调之间的交互作用，我可以创建两列额外的数据：CD_dysbiosis和UC_dysbiosis（因为诊断的参考是非IBD）。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df_input_metadata<span class=\"operator\">$</span>CD_dysbiosis <span class=\"operator\">=</span> <span class=\"punctuation\">(</span>df_input_metadata<span class=\"operator\">$</span>diagnosis <span class=\"operator\">==</span> <span class=\"string\">&quot;CD&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                                 df_input_metadata<span class=\"operator\">$</span>dysbiosis</span><br><span class=\"line\">df_input_metadata<span class=\"operator\">$</span>UC_dysbiosis <span class=\"operator\">=</span> <span class=\"punctuation\">(</span>df_input_metadata<span class=\"operator\">$</span>diagnosis <span class=\"operator\">==</span> <span class=\"string\">&quot;UC&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                                 df_input_metadata<span class=\"operator\">$</span>dysbiosis</span><br><span class=\"line\"></span><br><span class=\"line\">fit_data_ixn <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_interaction&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;CD_dysbiosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;UC_dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"随机效应\"><a href=\"#随机效应\" class=\"headerlink\" title=\"随机效应\"></a>随机效应</h2><p>某些研究自然地将样本观测值“分组”，例如在纵向设计中按受试者分组或在家庭设计中按家庭分组。对于统计分析来说，重要的是要处理属于同一组的样本之间的非独立性。MaAsLin 2 通过 <code>random_effects</code> 参数提供了一个简单的界面来处理这个问题，用户可以在其中指定分组变量来运行混合效应模型。例如，我们注意到 HMP2 是一个纵向设计，其中同一个受试者（列中的 subject）可以有多个样本。因此，我们要求 MaAsLin 2 使用 subject 作为其随机效应分组变量：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data_random <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_random&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           random_effects <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;subject&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你对在纵向研究中测试时间的影响感兴趣，那么在调用 MaAsLin 2 时，时间点变量应该包含在 <code>fixed_effects </code>中。</p>\n<ul>\n<li>问题：直觉上，你能想到为什么解决样本之间的非独立性很重要吗？<ul>\n<li>提示：想象一下一个简单的场景，你有两个受试者，一个病例和一个对照，每个受试者都有两个样本。</li>\n<li>当同一受试者的样本高度独立时，与它们高度相关时，有效样本大小是多少？</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"其他选项\"><a href=\"#其他选项\" class=\"headerlink\" title=\"其他选项\"></a>其他选项</h2><p>MaAsLin 2 提供了许多参数选项，用于不同的数据预处理（规范化、过滤、转换）和其他任务。这些选项的完整列表是：</p>\n<ul>\n<li><p>min_abundance</p>\n<ul>\n<li>每个特征的最小丰度 [ 默认值：0 ]</li>\n</ul>\n</li>\n<li><p>min_prevalence</p>\n<ul>\n<li>以最小丰度检测到一个特征的最小样本百分比 [ 默认值：0.1 ]</li>\n</ul>\n</li>\n<li><p>max_significance</p>\n<ul>\n<li>显著性的 q 值阈值 [ 默认值：0.25 ]</li>\n</ul>\n</li>\n<li><p>normalization</p>\n<ul>\n<li>要应用的规范化方法 [ 默认值：”TSS” ] [ 选项：”TSS”、”CLR”、”CSS”、”NONE”、”TMM” ]</li>\n</ul>\n</li>\n<li><p>transform</p>\n<ul>\n<li>要应用的转换 [ 默认值：”LOG” ] [ 选项：”LOG”、”LOGIT”、”AST”、”NONE” ]</li>\n</ul>\n</li>\n<li><p>analysis_method</p>\n<ul>\n<li>要应用的分析方法 [ 默认值：”LM” ] [ 选项：”LM”、”CPLM”、”ZICP”、”NEGBIN”、”ZINB” ]</li>\n</ul>\n</li>\n<li><p>correction</p>\n<ul>\n<li>计算 q 值的校正方法 [ 默认值：”BH” ]</li>\n</ul>\n</li>\n<li><p>standardize</p>\n<ul>\n<li>应用 z 分数，以便连续元数据在同一尺度上 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>plot_heatmap</p>\n<ul>\n<li>为显著关联生成热图 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>heatmap_first_n</p>\n<ul>\n<li>在热图中，绘制具有显著关联的前 N 个特征 [ 默认值：50 ]</li>\n</ul>\n</li>\n<li><p>plot_scatter</p>\n<ul>\n<li>为显著关联生成散点图 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>cores</p>\n<ul>\n<li>并行运行的 R 进程数 [ 默认值：1 ]</li>\n</ul>\n</li>\n<li><p>reference</p>\n<ul>\n<li>用作具有两个以上级别的变量的参考，以“变量,参考”的字符串形式提供，多个变量之间用分号分隔。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MaAsLin-2-中的流行率和丰度过滤\"><a href=\"#MaAsLin-2-中的流行率和丰度过滤\" class=\"headerlink\" title=\"MaAsLin 2 中的流行率和丰度过滤\"></a>MaAsLin 2 中的流行率和丰度过滤</h3><p>通常，只有在某个特征在“足够”多的时间内非零时，测试特征与元数据之间的关联才有意义。“足够”的具体比例可能因研究而异，但 10-50% 的最小流行率阈值并不罕见（高达 70-90% 也是合理的）。由于我们已经在使用一小部分精选的演示数据，我们将使用 <code>min_prevalence = 0.1</code> 来仅测试至少 10% 的非零值的特征。请注意：这是 MaAsLin 2 中的默认参数设置。</p>\n<p>类似地，通常只希望测试在这么多样本中达到最小丰度阈值的特征。默认情况下，MaAsLin 2 会认为任何非零值都是可靠的，如果你已经在数据集中进行了充分的质量控制（QC），那么这样做是合适的。然而，如果你想要进行更多过滤或采取保守态度，你可以设置一个最小丰度阈值，如 <code>min_abundance = 0.0001</code>，以仅测试达到这个（相对）丰度的特征。</p>\n<p>将这些参数组合起来，我们可以使用两者来运行 MaAsLin 2（并且速度会更快！）：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data_filter <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_filter&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           random_effects <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;subject&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           min_abundance  <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"命令行\"><a href=\"#命令行\" class=\"headerlink\" title=\"命令行\"></a>命令行</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Maaslin2.R --transform=AST --fixed_effects=<span class=\"string\">&quot;diagnosis,dysbiosis&quot;</span>  /usr/local/lib/R/site-library/Maaslin2/extdata/HMP2_taxonomy.tsv /usr/local/lib/R/site-library/Maaslin2/extdata/HMP2_metadata.tsv demo_output --reference=<span class=\"string\">&quot;diagnosis,nonIBD&quot;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ Maaslin2.R --help</span><br><span class=\"line\">Usage: ./R/Maaslin2.R [options] &lt;data.tsv&gt; &lt;metadata.tsv&gt; &lt;output_folder&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">    -h, --help</span><br><span class=\"line\">        Show this help message and exit</span><br><span class=\"line\"></span><br><span class=\"line\">    -a MIN_ABUNDANCE, --min_abundance=MIN_ABUNDANCE</span><br><span class=\"line\">        The minimum abundance for each feature [ Default: 0 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -p MIN_PREVALENCE, --min_prevalence=MIN_PREVALENCE</span><br><span class=\"line\">        The minimum percent of samples for which a feature </span><br><span class=\"line\">        is detected at minimum abundance [ Default: 0.1 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -s MAX_SIGNIFICANCE, --max_significance=MAX_SIGNIFICANCE</span><br><span class=\"line\">        The q-value threshold for significance [ Default: 0.25 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -n NORMALIZATION, --normalization=NORMALIZATION</span><br><span class=\"line\">        The normalization method to apply [ Default: TSS ]</span><br><span class=\"line\">        [ Choices: TSS, CLR, CSS, NONE, TMM ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -t TRANSFORM, --transform=TRANSFORM</span><br><span class=\"line\">        The transform to apply [ Default: LOG ]</span><br><span class=\"line\">        [ Choices: LOG, LOGIT, AST, NONE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -m ANALYSIS_METHOD, --analysis_method=ANALYSIS_METHOD</span><br><span class=\"line\">        The analysis method to apply [ Default: LM ]</span><br><span class=\"line\">        [ Choices: LM, CPLM, NEGBIN, ZINB ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -r RANDOM_EFFECTS, --random_effects=RANDOM_EFFECTS</span><br><span class=\"line\">        The random effects for the model, comma-delimited</span><br><span class=\"line\">        for multiple effects [ Default: none ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -f FIXED_EFFECTS, --fixed_effects=FIXED_EFFECTS</span><br><span class=\"line\">        The fixed effects for the model, comma-delimited</span><br><span class=\"line\">        for multiple effects [ Default: all ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -c CORRECTION, --correction=CORRECTION</span><br><span class=\"line\">        The correction method for computing the </span><br><span class=\"line\">        q-value [ Default: BH ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -z STANDARDIZE, --standardize=STANDARDIZE</span><br><span class=\"line\">        Apply z-score so continuous metadata are </span><br><span class=\"line\">        on the same scale [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -l PLOT_HEATMAP, --plot_heatmap=PLOT_HEATMAP</span><br><span class=\"line\">        Generate a heatmap for the significant </span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -i HEATMAP_FIRST_N, --heatmap_first_n=HEATMAP_FIRST_N</span><br><span class=\"line\">        In heatmap, plot top N features with significant </span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -o PLOT_SCATTER, --plot_scatter=PLOT_SCATTER</span><br><span class=\"line\">        Generate scatter plots for the significant</span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -e CORES, --cores=CORES</span><br><span class=\"line\">        The number of R processes to run in parallel</span><br><span class=\"line\">        [ Default: 1 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -r REFERENCE, --reference=&#x27;VARIABLE,REFERENCE&#x27;</span><br><span class=\"line\">        The factor to use as a reference for a </span><br><span class=\"line\">        variable with more than two levels </span><br><span class=\"line\">        provided as a string of &#x27;variable,reference&#x27; </span><br><span class=\"line\">        semi-colon delimited for multiple variables.</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ul>\n<li>Mallick H, Rahnavard A, McIver LJ, Ma S, Zhang Y, Nguyen LH, Tickle TL, Weingart G, Ren B, Schwager EH, Chatterjee S, Thompson KN, Wilkinson JE, Subramanian A, Lu Y, Waldron L, Paulson JN, Franzosa EA, Bravo HC, Huttenhower C (2021). <a href=\"https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1009442\">Multivariable Association Discovery in Population-scale Meta-omics Studies</a>. PLoS Computational Biology, 17(11):e1009442.</li>\n</ul>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n","more":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>MaAsLin 2 是 MaAsLin（微生物组多变量线性模型关联，Microbiome Multivariable Association with Linear Models）的下一代产品。</p>\n<p>MaAsLin 2 是一个全面的 R 语言软件包，用于高效地确定表型、环境、暴露、协变量和微生物组元组学特征之间的多变量关联。MaAsLin 2 依赖于一般线性模型来适应大多数现代流行病学研究设计，包括横断面和纵向研究，以及多种数据探索、标准化和转换方法。</p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;BiocManager&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;BiocManager&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">BiocManager<span class=\"operator\">::</span>install<span class=\"punctuation\">(</span><span class=\"string\">&quot;Maaslin2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"微生物组关联检测\"><a href=\"#微生物组关联检测\" class=\"headerlink\" title=\"微生物组关联检测\"></a>微生物组关联检测</h1><h2 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h2><h3 id=\"微生物组特征数据或功能数据\"><a href=\"#微生物组特征数据或功能数据\" class=\"headerlink\" title=\"微生物组特征数据或功能数据\"></a>微生物组特征数据或功能数据</h3><ul>\n<li>以制表符分隔列</li>\n<li>行为样本，列为特征（微生物&#x2F;基因&#x2F;功能……）</li>\n</ul>\n<div style=\"overflow-x:auto;\">\n<table>\n    <thead>\n        <tr>\n            <th>ID</th>\n            <th>Bifidobacterium adolescentis</th>\n            <th>Bifidobacterium bifidum</th>\n            <th>Bifidobacterium longum</th>\n            <th>Bifidobacterium pseudocatenulatum</th>\n            <th>Collinsella aerofaciens</th>\n            <th>Bacteroides caccae</th>\n            <th>Bacteroides cellulosilyticus</th>\n            <th>Bacteroides dorei</th>\n            <th>Bacteroides eggerthii</th>\n            <th>Bacteroides faecis</th>\n            <th>Bacteroides finegoldii</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>CSM5FZ3N_P</td>\n            <td>Cedars-Sinai</td>\n            <td>43</td>\n            <td>CD</td>\n            <td>C3001</td>\n            <td>No</td>\n            <td>No</td>\n            <td>0.792314801112388</td>\n            <td>No</td>\n            <td>No</td>\n            <td>No</td>\n            <td>1</td>\n        </tr>\n        <!-- ... other rows ... -->\n        <tr>\n            <td>CSM5FZ4M_P</td> <!-- Added _P to make the ID consistent -->\n            <td>Cedars-Sinai</td>\n            <td>43</td>\n            <td>UC</td>\n            <td>C3003</td>\n            <td>No</td>\n            <td>No</td>\n            <td>0.761300183426806</td>\n            <td>No</td>\n            <td>No</td>\n            <td>No</td>\n            <td>6</td>\n        </tr>\n        <tr>\n            <td>CSM5LLGB_P</td>\n            <td>MGH</td>\n            <td>30</td>\n            <td>CD</td>\n            <td>M2014</td>\n            <td>No</td>\n            <td>No</td>\n            <td>0.730525895151516</td>\n            <td>No</td>\n            <td>No</td>\n            <td>No</td>\n            <td>8</td>\n        </tr>\n    </tbody>\n</table>\n</div>\n\n<h3 id=\"元数据\"><a href=\"#元数据\" class=\"headerlink\" title=\"元数据\"></a>元数据</h3><ul>\n<li>以制表符分隔列</li>\n<li>行为样本，列为特征</li>\n</ul>\n<div style=\"overflow-x:auto;\">  \n<table border=\"1\">  \n    <thead>  \n        <tr>  \n            <th>ID</th>  \n            <th>site</th>  \n            <th>age</th>  \n            <th>diagnosis</th>  \n            <th>subject</th>  \n            <th>antibiotics</th>  \n            <th>dysbiosis_binary</th>  \n            <th>dysbiosis</th>  \n            <th>dysbiosisnonIBD</th>  \n            <th>dysbiosisUC</th>  \n            <th>dysbiosisCD</th>  \n            <th>collection</th>  \n        </tr>  \n    </thead>  \n    <tbody>  \n                <tr>\n            <td>CSM5FZ3N_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.792314801112388</td><td>No</td><td>No</td><td>No</td><td>1</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3R_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.837923415694291</td><td>No</td><td>No</td><td>No</td><td>2</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3T_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.924296928419748</td><td>No</td><td>No</td><td>Yes</td><td>1</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3V_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.830400526852384</td><td>No</td><td>No</td><td>No</td><td>4</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3X_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.910966992923041</td><td>No</td><td>No</td><td>Yes</td><td>2</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ3Z_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.912281677355966</td><td>No</td><td>No</td><td>Yes</td><td>3</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ42_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.903049136702093</td><td>No</td><td>No</td><td>Yes</td><td>4</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ44_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.87825476936449</td><td>No</td><td>No</td><td>Yes</td><td>5</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ46_P</td><td>Cedars-Sinai</td><td>76</td><td>CD</td><td>C3002</td><td>No</td><td>Yes</td><td>0.92542872181954</td><td>No</td><td>No</td><td>Yes</td><td>6</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4A_P</td><td>Cedars-Sinai</td><td>47</td><td>UC</td><td>C3004</td><td>No</td><td>No</td><td>0.775160480913896</td><td>No</td><td>No</td><td>No</td><td>1</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4C_P</td><td>Cedars-Sinai</td><td>43</td><td>CD</td><td>C3001</td><td>No</td><td>No</td><td>0.836244630681399</td><td>No</td><td>No</td><td>No</td><td>5</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4E_P</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>Yes</td><td>No</td><td>0.787616535915359</td><td>No</td><td>No</td><td>No</td><td>2</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4G_P</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>No</td><td>No</td><td>0.68128445477854</td><td>No</td><td>No</td><td>No</td><td>3</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4K_P</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>Yes</td><td>No</td><td>0.717164790084925</td><td>No</td><td>No</td><td>No</td><td>5</td>\n        </tr>\n        <tr>\n            <td>CSM5FZ4M</td><td>Cedars-Sinai</td><td>43</td><td>UC</td><td>C3003</td><td>No</td><td>No</td><td>0.761300183426806</td><td>No</td><td>No</td><td>No</td><td>6</td>\n        </tr>\n        <tr>\n            <td>CSM5LLGB_P</td><td>MGH</td><td>30</td><td>CD</td><td>M2014</td><td>No</td><td>No</td><td>0.730525895151516</td><td>No</td><td>No</td><td>No</td><td>8</td>\n        </tr> \n    </tbody>  \n</table>  \n</div>\n\n<p>两个文件包含的样本可以不同，分析时只取二者共有的样本。样本顺序也无需一致。</p>\n<h3 id=\"读入文件\"><a href=\"#读入文件\" class=\"headerlink\" title=\"读入文件\"></a>读入文件</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df_input_data <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span>file             <span class=\"operator\">=</span> input_data<span class=\"punctuation\">,</span></span><br><span class=\"line\">                           header           <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_data<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span>file             <span class=\"operator\">=</span> input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               header           <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                               stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_metadata<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_path <span class=\"operator\">=</span> read.csv<span class=\"punctuation\">(</span><span class=\"string\">&quot;./pathabundance_relab.tsv&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_path<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行MaAsLin-2\"><a href=\"#运行MaAsLin-2\" class=\"headerlink\" title=\"运行MaAsLin 2\"></a>运行MaAsLin 2</h2><p>在MaAsLin中，可以使用几种不同类型的统计模型来进行关联测试（例如简单线性模型、零膨胀模型、基于计数的模型等）。作者在论文中评估了各种模型的优缺点，虽然默认模型通常适用于大多数分析，但在某些情况下，用户可能希望选择不同的模型。这同样适用于多种不同的微生物群落数据类型（taxonomy 或functional profiles）、环境（人类或其他）和测量方式（计数或相对比例），只要使用适当修改过的归一化&#x2F;转换方案即可。</p>\n<p>对于模型选择，如果你的输入是<code>计数数据</code>，那么你可以使用<code>NEGBIN</code>和<code>ZINB</code>模型；而对于<code>非计数数据</code>（如百分比、CPM或相对丰度）的输入，你可以使用<code>LM</code>和<code>CPLM</code>模型。</p>\n<p>在MaAsLin 2实现的归一化方法中，<u>TMM和CSS仅适用于计数数据，并且它们也返回归一化后的计数</u>，这与TSS和CLR不同。因此，如果你的输入是计数数据，你可以使用上述两种归一化方法（即TMM、CSS或NONE（如果数据已经归一化））而无需进一步转换（即transform &#x3D; NONE）。</p>\n<p><u>在非计数模型中，CPLM要求数据为正数</u>。因此，任何产生负值的转换通常都不适用于<code>CPLM</code>。</p>\n<p>由于所有非LM模型都与其与广义线性模型（GLM）的紧密联系而使用固有的对数链接转换，因此建议它们以<code>transform = NONE</code>的方式运行。</p>\n<p>除此之外，<u>LM是唯一能够处理正数和负数（在归一化&#x2F;转换之后）的模型</u>，并且（根据手稿）它通常对参数变化具有更强的鲁棒性（这是非LM模型的典型限制）。关于是否使用LM、CPLM或其他模型，直观上，<u>在存在零值的情况下，<code>CPLM</code>或<code>零膨胀替代模型</code>应该表现更好，但根据我们的基准测试，我们没有证据表明CPLM显著优于LM模型</u>。因此，<b>在选择模型时，应综合考虑数据的特性、研究目的以及模型的适用性和性能</b>。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Model (-m ANALYSIS_METHOD)</th>\n<th align=\"center\">Data type</th>\n<th align=\"center\">Normalization (-n NORMALIZATION)</th>\n<th align=\"center\">Transformation (-t TRANSFORM)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">LM</td>\n<td align=\"center\">count and non-count</td>\n<td align=\"center\">TSS, CLR, NONE</td>\n<td align=\"center\">LOG, LOGIT, AST, NONE</td>\n</tr>\n<tr>\n<td align=\"center\">CPLM</td>\n<td align=\"center\">count and non-count</td>\n<td align=\"center\">TSS, TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n<tr>\n<td align=\"center\">NEGBIN</td>\n<td align=\"center\">count</td>\n<td align=\"center\">TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n<tr>\n<td align=\"center\">ZINB</td>\n<td align=\"center\">count</td>\n<td align=\"center\">TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n</tbody></table>\n<p><strong>注</strong>：通常，还需要考虑用于过滤数据（即流行率和丰度阈值）的阈值，以减少异常值和假阳性。有关此方面的更多详细信息，请参阅MaAsLin 2中的第<a href=\"https://github.com/biobakery/biobakery/wiki/maaslin2#431-prevalence-and-abundance-filtering-in-maaslin2\">4.3.1节“流行率和丰度过滤”</a>。</p>\n<p>以下命令在HMP2数据上运行MaAsLin 2，执行多变量回归模型以测试微生物物种丰度与IBD诊断和<a href=\"https://www.nature.com/articles/s41586-019-1237-9\">菌群失调评分</a>之间的关联（<code>fixed_effects = c(&quot;diagnosis&quot;, &quot;dysbiosis&quot;)</code>）。对于具有超过2个水平的任何分类变量，还需要指定哪个变量应作为参考水平，方法是使用（<code>reference = c(&quot;diagnosis,nonIBD&quot;)</code>）。<strong>注</strong>：<font color=#FF0000>在变量和水平之间添加空格可能会导致使用错误的参考水平</font>。输出将生成在当前工作目录下的名为demo_output的文件夹中（<code>output = &quot;demo_output&quot;</code>）。在此示例中，输入数据已预先进行归一化和过滤，因此我们也将关闭默认的归一化和流行率过滤。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"输出\"><a href=\"#输出\" class=\"headerlink\" title=\"输出\"></a>输出</h2><h3 id=\"重要关联\"><a href=\"#重要关联\" class=\"headerlink\" title=\"重要关联\"></a>重要关联</h3><p>MaAsLin 2最重要的输出之一可能是重要关联的列表。这些关联在<code>significant_results.tsv</code>文件中提供：</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/sigresults_screenshot.png\" alt=\"significant_results.tsv\"></p>\n<p>这些是通过MaAsLin 2显著性阈值的全部关联列表，按照q值递增的顺序排序。列包括：</p>\n<ul>\n<li><p><strong>metadata</strong>：与微生物特征相关联的变量名。</p>\n</li>\n<li><p><strong>feature</strong>：微生物特征（分类群、基因、途径等）。</p>\n</li>\n<li><p><strong>value</strong>：对于分类特征，这是报告系数和关联显著性的具体特征水平。</p>\n</li>\n<li><p><strong>coef</strong>：模型系数值（效应大小）。对于分类变量，系数表示在value中指定的类别与参考类别之间的对比。</p>\n</li>\n<li><p><strong>stderr</strong>：模型的标准误差。</p>\n</li>\n<li><p><strong>N</strong>：用于此关联的模型中样本的总数（例如，因为可以排除缺失值）。</p>\n</li>\n<li><p><strong>N.not.0</strong>：在这些样本中，特征非零的总数。</p>\n</li>\n<li><p><strong>pval</strong>：此关联的名义显著性。</p>\n</li>\n<li><p><strong>qval</strong>：使用p.adjust函数和校正方法（如BH等）计算得到的校正显著性。</p>\n</li>\n<li><p><strong>问题</strong>：如何解释这个表格的第一行？</p>\n</li>\n</ul>\n<p>对于<code>significant_results.tsv</code>中的每个重要关联，MaAsLin 2还会生成可视化图表以供检查（分类变量的箱线图，连续变量的散点图）。这些图表命名为“metadata_name.pdf”。例如，从我们的分析运行中，我们得到了可视化文件<code>dysbiosis.pdf</code>和<code>diagnosis.pdf</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/scatterplot_screenshot.png\" alt=\"dysbiosis.pdf\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data@master/assets/boxplot_screenshot.png\" alt=\"diagnosis.pdf\"></p>\n<h3 id=\"输出文件完整列表\"><a href=\"#输出文件完整列表\" class=\"headerlink\" title=\"输出文件完整列表\"></a>输出文件完整列表</h3><p>MaAsLin 2生成两种类型的输出文件：数据和可视化文件。</p>\n<ul>\n<li><p>数据输出文件</p>\n<ul>\n<li><p>significant_results.tsv</p>\n</li>\n<li><p>all_results.tsv</p>\n<ul>\n<li>与significant_results.tsv格式相同，但包含所有关联结果（而不仅仅是显著的结果）。</li>\n<li>您也可以在R中使用fit_data$results访问此表。</li>\n</ul>\n</li>\n<li><p>residuals.rds</p>\n<ul>\n<li>此文件包含一个包含每个特征残差的数据框。</li>\n</ul>\n</li>\n<li><p>maaslin2.log</p>\n<ul>\n<li>此文件包含运行的所有日志信息。</li>\n<li>它包括所有设置、警告、错误和运行的步骤。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>可视化输出文件</p>\n<ul>\n<li><p>heatmap.pdf</p>\n<ul>\n<li>此文件包含显著关联的热图。</li>\n</ul>\n</li>\n<li><p>[a-z&#x2F;0-9]+.pdf</p>\n<ul>\n<li>为每个显著关联生成一个图表。</li>\n<li>对于连续元数据，使用散点图。</li>\n<li>对于分类数据，使用箱线图。</li>\n<li>绘制的数据点已经过归一化、过滤和转换。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MaAsLin-2在功能谱上的应用\"><a href=\"#MaAsLin-2在功能谱上的应用\" class=\"headerlink\" title=\"MaAsLin 2在功能谱上的应用\"></a>MaAsLin 2在功能谱上的应用</h3><p>如果您的功能表是由HUMAnN生成的，并且已经使用<code>humann_renorm_table</code>脚本进行了归一化，那么您不需要执行任何额外的归一化——测序深度的影响已经被消除（这正是本教程中将使用的）。我们倾向于使用<code>CPM</code>单位，因为我们发现它们更方便，但在建模目的上，它们在数值上与相对丰度是等价的（<code>CPM = RA * 1e6</code>）。</p>\n<p>否则，可使用上述关于模型&#x2F;归一化&#x2F;转换的相同思路。</p>\n<p>在使用MaAsLin 2处理功能谱时的一些其他快速提示：</p>\n<ul>\n<li>为了减少特征数量，通常希望运行未分层的功能特征（或分层特征的过滤子集）。</li>\n<li>可能还想移除与特定分类群高度相关的功能特征（即可能由该微生物贡献），因为这些特征可以通过分类学变化得到更好的解释。</li>\n</ul>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#This can also be done with with the HUMAnN 3 untiliy `humann_split_stratified_table`</span></span><br><span class=\"line\">unstrat_pathways <span class=\"operator\">&lt;-</span><span class=\"keyword\">function</span><span class=\"punctuation\">(</span>dat_path<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  temp <span class=\"operator\">=</span> dat_path<span class=\"punctuation\">[</span><span class=\"operator\">!</span>grepl<span class=\"punctuation\">(</span><span class=\"string\">&quot;\\\\|&quot;</span><span class=\"punctuation\">,</span>rownames<span class=\"punctuation\">(</span>dat_path<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"built_in\">return</span><span class=\"punctuation\">(</span>temp<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_path <span class=\"operator\">=</span> unstrat_pathways<span class=\"punctuation\">(</span>df_input_path<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>在由<a href=\"https://github.com/biobakery/biobakery/wiki/biobakery_workflows\">bioBakery工作流程</a>生成的MetaCyc途径表上运行与上述相同的模型。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_func <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_path<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_functional&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    min_abundance  <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<p><strong>注意</strong>：在这里，我们有列中的样本和行中的特征，MaAsLin 2正确地识别了这一点，并且能够匹配样本。</p>\n<p>作者最近还发表了关于使用MaAsLin 2分析宏转录组学数据（MTX）中差异特征的研究，有关该主题的更多信息，请参阅<a href=\"https://academic.oup.com/bioinformatics/article/37/Supplement_1/i34/6319701\">最近的出版物</a>。</p>\n<h1 id=\"高级主题\"><a href=\"#高级主题\" class=\"headerlink\" title=\"高级主题\"></a>高级主题</h1><h2 id=\"交互作用\"><a href=\"#交互作用\" class=\"headerlink\" title=\"交互作用\"></a>交互作用</h2><p>许多统计分析都关注于测试某些变量之间的交互作用。不幸的是，MaAsLin 2目前尚未提供直接的界面来进行此操作。相反，用户需要创建人工交互列作为额外的fixed_effects项。以上面的拟合为例，为了测试诊断与菌群失调之间的交互作用，我可以创建两列额外的数据：CD_dysbiosis和UC_dysbiosis（因为诊断的参考是非IBD）。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df_input_metadata<span class=\"operator\">$</span>CD_dysbiosis <span class=\"operator\">=</span> <span class=\"punctuation\">(</span>df_input_metadata<span class=\"operator\">$</span>diagnosis <span class=\"operator\">==</span> <span class=\"string\">&quot;CD&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                                 df_input_metadata<span class=\"operator\">$</span>dysbiosis</span><br><span class=\"line\">df_input_metadata<span class=\"operator\">$</span>UC_dysbiosis <span class=\"operator\">=</span> <span class=\"punctuation\">(</span>df_input_metadata<span class=\"operator\">$</span>diagnosis <span class=\"operator\">==</span> <span class=\"string\">&quot;UC&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                                 df_input_metadata<span class=\"operator\">$</span>dysbiosis</span><br><span class=\"line\"></span><br><span class=\"line\">fit_data_ixn <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_interaction&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;CD_dysbiosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;UC_dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"随机效应\"><a href=\"#随机效应\" class=\"headerlink\" title=\"随机效应\"></a>随机效应</h2><p>某些研究自然地将样本观测值“分组”，例如在纵向设计中按受试者分组或在家庭设计中按家庭分组。对于统计分析来说，重要的是要处理属于同一组的样本之间的非独立性。MaAsLin 2 通过 <code>random_effects</code> 参数提供了一个简单的界面来处理这个问题，用户可以在其中指定分组变量来运行混合效应模型。例如，我们注意到 HMP2 是一个纵向设计，其中同一个受试者（列中的 subject）可以有多个样本。因此，我们要求 MaAsLin 2 使用 subject 作为其随机效应分组变量：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data_random <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_random&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           random_effects <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;subject&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你对在纵向研究中测试时间的影响感兴趣，那么在调用 MaAsLin 2 时，时间点变量应该包含在 <code>fixed_effects </code>中。</p>\n<ul>\n<li>问题：直觉上，你能想到为什么解决样本之间的非独立性很重要吗？<ul>\n<li>提示：想象一下一个简单的场景，你有两个受试者，一个病例和一个对照，每个受试者都有两个样本。</li>\n<li>当同一受试者的样本高度独立时，与它们高度相关时，有效样本大小是多少？</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"其他选项\"><a href=\"#其他选项\" class=\"headerlink\" title=\"其他选项\"></a>其他选项</h2><p>MaAsLin 2 提供了许多参数选项，用于不同的数据预处理（规范化、过滤、转换）和其他任务。这些选项的完整列表是：</p>\n<ul>\n<li><p>min_abundance</p>\n<ul>\n<li>每个特征的最小丰度 [ 默认值：0 ]</li>\n</ul>\n</li>\n<li><p>min_prevalence</p>\n<ul>\n<li>以最小丰度检测到一个特征的最小样本百分比 [ 默认值：0.1 ]</li>\n</ul>\n</li>\n<li><p>max_significance</p>\n<ul>\n<li>显著性的 q 值阈值 [ 默认值：0.25 ]</li>\n</ul>\n</li>\n<li><p>normalization</p>\n<ul>\n<li>要应用的规范化方法 [ 默认值：”TSS” ] [ 选项：”TSS”、”CLR”、”CSS”、”NONE”、”TMM” ]</li>\n</ul>\n</li>\n<li><p>transform</p>\n<ul>\n<li>要应用的转换 [ 默认值：”LOG” ] [ 选项：”LOG”、”LOGIT”、”AST”、”NONE” ]</li>\n</ul>\n</li>\n<li><p>analysis_method</p>\n<ul>\n<li>要应用的分析方法 [ 默认值：”LM” ] [ 选项：”LM”、”CPLM”、”ZICP”、”NEGBIN”、”ZINB” ]</li>\n</ul>\n</li>\n<li><p>correction</p>\n<ul>\n<li>计算 q 值的校正方法 [ 默认值：”BH” ]</li>\n</ul>\n</li>\n<li><p>standardize</p>\n<ul>\n<li>应用 z 分数，以便连续元数据在同一尺度上 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>plot_heatmap</p>\n<ul>\n<li>为显著关联生成热图 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>heatmap_first_n</p>\n<ul>\n<li>在热图中，绘制具有显著关联的前 N 个特征 [ 默认值：50 ]</li>\n</ul>\n</li>\n<li><p>plot_scatter</p>\n<ul>\n<li>为显著关联生成散点图 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>cores</p>\n<ul>\n<li>并行运行的 R 进程数 [ 默认值：1 ]</li>\n</ul>\n</li>\n<li><p>reference</p>\n<ul>\n<li>用作具有两个以上级别的变量的参考，以“变量,参考”的字符串形式提供，多个变量之间用分号分隔。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MaAsLin-2-中的流行率和丰度过滤\"><a href=\"#MaAsLin-2-中的流行率和丰度过滤\" class=\"headerlink\" title=\"MaAsLin 2 中的流行率和丰度过滤\"></a>MaAsLin 2 中的流行率和丰度过滤</h3><p>通常，只有在某个特征在“足够”多的时间内非零时，测试特征与元数据之间的关联才有意义。“足够”的具体比例可能因研究而异，但 10-50% 的最小流行率阈值并不罕见（高达 70-90% 也是合理的）。由于我们已经在使用一小部分精选的演示数据，我们将使用 <code>min_prevalence = 0.1</code> 来仅测试至少 10% 的非零值的特征。请注意：这是 MaAsLin 2 中的默认参数设置。</p>\n<p>类似地，通常只希望测试在这么多样本中达到最小丰度阈值的特征。默认情况下，MaAsLin 2 会认为任何非零值都是可靠的，如果你已经在数据集中进行了充分的质量控制（QC），那么这样做是合适的。然而，如果你想要进行更多过滤或采取保守态度，你可以设置一个最小丰度阈值，如 <code>min_abundance = 0.0001</code>，以仅测试达到这个（相对）丰度的特征。</p>\n<p>将这些参数组合起来，我们可以使用两者来运行 MaAsLin 2（并且速度会更快！）：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data_filter <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_filter&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           random_effects <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;subject&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           min_abundance  <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"命令行\"><a href=\"#命令行\" class=\"headerlink\" title=\"命令行\"></a>命令行</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Maaslin2.R --transform=AST --fixed_effects=<span class=\"string\">&quot;diagnosis,dysbiosis&quot;</span>  /usr/local/lib/R/site-library/Maaslin2/extdata/HMP2_taxonomy.tsv /usr/local/lib/R/site-library/Maaslin2/extdata/HMP2_metadata.tsv demo_output --reference=<span class=\"string\">&quot;diagnosis,nonIBD&quot;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ Maaslin2.R --help</span><br><span class=\"line\">Usage: ./R/Maaslin2.R [options] &lt;data.tsv&gt; &lt;metadata.tsv&gt; &lt;output_folder&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">    -h, --help</span><br><span class=\"line\">        Show this help message and exit</span><br><span class=\"line\"></span><br><span class=\"line\">    -a MIN_ABUNDANCE, --min_abundance=MIN_ABUNDANCE</span><br><span class=\"line\">        The minimum abundance for each feature [ Default: 0 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -p MIN_PREVALENCE, --min_prevalence=MIN_PREVALENCE</span><br><span class=\"line\">        The minimum percent of samples for which a feature </span><br><span class=\"line\">        is detected at minimum abundance [ Default: 0.1 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -s MAX_SIGNIFICANCE, --max_significance=MAX_SIGNIFICANCE</span><br><span class=\"line\">        The q-value threshold for significance [ Default: 0.25 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -n NORMALIZATION, --normalization=NORMALIZATION</span><br><span class=\"line\">        The normalization method to apply [ Default: TSS ]</span><br><span class=\"line\">        [ Choices: TSS, CLR, CSS, NONE, TMM ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -t TRANSFORM, --transform=TRANSFORM</span><br><span class=\"line\">        The transform to apply [ Default: LOG ]</span><br><span class=\"line\">        [ Choices: LOG, LOGIT, AST, NONE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -m ANALYSIS_METHOD, --analysis_method=ANALYSIS_METHOD</span><br><span class=\"line\">        The analysis method to apply [ Default: LM ]</span><br><span class=\"line\">        [ Choices: LM, CPLM, NEGBIN, ZINB ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -r RANDOM_EFFECTS, --random_effects=RANDOM_EFFECTS</span><br><span class=\"line\">        The random effects for the model, comma-delimited</span><br><span class=\"line\">        for multiple effects [ Default: none ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -f FIXED_EFFECTS, --fixed_effects=FIXED_EFFECTS</span><br><span class=\"line\">        The fixed effects for the model, comma-delimited</span><br><span class=\"line\">        for multiple effects [ Default: all ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -c CORRECTION, --correction=CORRECTION</span><br><span class=\"line\">        The correction method for computing the </span><br><span class=\"line\">        q-value [ Default: BH ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -z STANDARDIZE, --standardize=STANDARDIZE</span><br><span class=\"line\">        Apply z-score so continuous metadata are </span><br><span class=\"line\">        on the same scale [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -l PLOT_HEATMAP, --plot_heatmap=PLOT_HEATMAP</span><br><span class=\"line\">        Generate a heatmap for the significant </span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -i HEATMAP_FIRST_N, --heatmap_first_n=HEATMAP_FIRST_N</span><br><span class=\"line\">        In heatmap, plot top N features with significant </span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -o PLOT_SCATTER, --plot_scatter=PLOT_SCATTER</span><br><span class=\"line\">        Generate scatter plots for the significant</span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -e CORES, --cores=CORES</span><br><span class=\"line\">        The number of R processes to run in parallel</span><br><span class=\"line\">        [ Default: 1 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -r REFERENCE, --reference=&#x27;VARIABLE,REFERENCE&#x27;</span><br><span class=\"line\">        The factor to use as a reference for a </span><br><span class=\"line\">        variable with more than two levels </span><br><span class=\"line\">        provided as a string of &#x27;variable,reference&#x27; </span><br><span class=\"line\">        semi-colon delimited for multiple variables.</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ul>\n<li>Mallick H, Rahnavard A, McIver LJ, Ma S, Zhang Y, Nguyen LH, Tickle TL, Weingart G, Ren B, Schwager EH, Chatterjee S, Thompson KN, Wilkinson JE, Subramanian A, Lu Y, Waldron L, Paulson JN, Franzosa EA, Bravo HC, Huttenhower C (2021). <a href=\"https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1009442\">Multivariable Association Discovery in Population-scale Meta-omics Studies</a>. PLoS Computational Biology, 17(11):e1009442.</li>\n</ul>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n","categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"生信软件","path":"api/tags/生信软件.json"},{"name":"R语言","path":"api/tags/R语言.json"}]}