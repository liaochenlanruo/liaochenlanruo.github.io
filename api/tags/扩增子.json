{"name":"扩增子","postlist":[{"title":"16S扩增子测序及宏基因组测序","slug":"16S扩增子测序及宏基因组测序","date":"2023-11-13T01:15:23.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/16S扩增子测序及宏基因组测序.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg","content":"<h1 id=\"引言\"><a href=\"#引言\" class=\"headerlink\" title=\"引言\"></a>引言</h1><p>在本文中，我将着重介绍两种高通量测序技术：<code>16S rDNA扩增子测序</code>和<code>Shot-gun宏基因组测序</code>。我们的主要目的是帮助大家深入了解这些技术的原理、应用场景以及如何解读数据分析结果。</p>\n<p>随着高通量测序技术的快速发展，我们能够更全面、更深入地了解微生物群落结构和功能。16S rDNA扩增子测序作为一种常用的方法，可以通过对16S rRNA基因进行扩增和测序，快速揭示微生物群落的组成和多样性。而Shot-gun宏基因组测序则针对整个样本的全部基因组进行测序，提供了更全面的信息，包括微生物种类和功能丰度等。</p>\n<p>通过阅读本文，我们希望您能够掌握以下几个方面的内容：</p>\n<ul>\n<li>理解16S rDNA扩增子测序和Shot-gun宏基因组测序的基本原理和流程；</li>\n<li>了解两种技术在微生物学组学研究中的应用场景；</li>\n<li>学会收集、保存和运输样本时需要注意的细节；</li>\n<li>掌握如何解读和分析16S rDNA扩增子测序和Shot-gun宏基因组测序的数据结果。</li>\n</ul>\n<p>我相信，通过这次学习，您将能够更好地理解和应用这些高通量测序技术，并在自己的研究中获得更准确、全面的数据和结论。现在，让我们开始深入探索16S rDNA扩增子测序和Shot-gun宏基因组测序的世界吧！</p>\n<h1 id=\"高通量测序概述\"><a href=\"#高通量测序概述\" class=\"headerlink\" title=\"高通量测序概述\"></a>高通量测序概述</h1><p>高通量测序，也被称为下一代测序（Next Generation Sequencing, NGS），是一种革命性的DNA或RNA序列分析技术。与传统的Sanger测序方法相比，高通量测序具有更快、更便宜和更高通量的特点。</p>\n<p>高通量测序技术的核心原理是将待测样本中的DNA或RNA分子通过特定的方法进行扩增，并将其分成数百万个片段。然后，这些片段将被同时测序，产生大量的短序列片段，称为reads。这些reads可以根据其碱基序列进行排序和分析，以揭示样本中的遗传信息。</p>\n<h2 id=\"高通量测序在生物学研究中的重要性\"><a href=\"#高通量测序在生物学研究中的重要性\" class=\"headerlink\" title=\"高通量测序在生物学研究中的重要性\"></a>高通量测序在生物学研究中的重要性</h2><p>高通量测序技术在生物学研究中发挥着重要作用，对于我们理解生物系统的复杂性和多样性具有重要意义。以下是高通量测序在生物学研究中的几个重要应用：</p>\n<ul>\n<li><p><strong>基因组学研究</strong>：高通量测序可以帮助我们解析生物体的基因组组成、结构和功能，揭示基因与表型之间的关系。例如，它可以用于全基因组测序，鉴定和研究与疾病相关的基因突变。</p>\n</li>\n<li><p><strong>转录组学研究</strong>：通过高通量测序，我们可以了解到不同细胞或组织中正在表达的所有基因，进而研究基因的表达调控机制、信号通路以及与疾病相关的差异基因表达。</p>\n</li>\n<li><p><strong>蛋白质组学研究</strong>：高通量测序还可以用于蛋白质组学研究，帮助我们理解蛋白质的组成和功能。通过RNA测序和质谱分析相结合的方法，可以更全面地研究细胞内蛋白质的表达水平、亚细胞定位和相互作用网络等。</p>\n</li>\n<li><p><strong>微生物学研究</strong>：高通量测序在微生物学研究中广泛应用。通过对微生物群落DNA测序，我们可以揭示不同环境中微生物的多样性、组成和功能，为环境保护、药物开发和人类健康等领域提供重要依据。</p>\n</li>\n</ul>\n<p>总的来说，高通量测序技术推动了生物学研究的进步，并为我们提供了更全面、更深入的遗传信息。它为解决重要生物学问题和促进医学领域的发展提供了强大工具和资源。</p>\n<h1 id=\"16S-rDNA扩增子测序介绍\"><a href=\"#16S-rDNA扩增子测序介绍\" class=\"headerlink\" title=\"16S rDNA扩增子测序介绍\"></a>16S rDNA扩增子测序介绍</h1><p>16S rDNA是细菌和古细菌中的一个高度保守的基因区域，它编码了小亚基核糖体RNA（Small Subunit Ribosomal RNA），在细菌和古细菌的细胞中普遍存在。由于16S rDNA具有高度保守性和变异性的特点，它成为了研究微生物群落结构和多样性的理想标记。</p>\n<h2 id=\"16S-rDNA扩增子测序原理和流程：\"><a href=\"#16S-rDNA扩增子测序原理和流程：\" class=\"headerlink\" title=\"16S rDNA扩增子测序原理和流程：\"></a>16S rDNA扩增子测序原理和流程：</h2><ul>\n<li><strong>样品提取与PCR扩增：</strong> 首先，从样品中提取总DNA，包括微生物组成的DNA。然后，利用引物对16S rDNA进行PCR扩增，产生包含16S rDNA片段的扩增子。</li>\n<li><strong>文库构建：</strong> 将扩增子进行文库构建，即将其转化为适合高通量测序平台测序的文库。</li>\n<li><strong>高通量测序：</strong> 使用高通量测序技术（如Illumina MiSeq或Ion Torrent等）对文库进行测序，得到数百万个短序列片段，称为reads。</li>\n<li><strong>数据分析：</strong> 对测序数据进行质量控制、去除噪音和低质量reads，并对reads进行比对和聚类，得到OTU（Operational Taxonomic Unit）或ASV表格，用来表示不同的微生物分类单元。</li>\n<li><strong>分类学注释与功能预测：</strong> 对OTU&#x2F;ASV进行分类学注释，将其与已知的16S rDNA数据库比对，确定微生物群落的组成。此外，还可以使用相应的工具对OTU&#x2F;ASV进行功能预测，以了解微生物群落的功能潜力。</li>\n</ul>\n<h2 id=\"16S-rDNA扩增子测序在微生物群落分析中的应用：\"><a href=\"#16S-rDNA扩增子测序在微生物群落分析中的应用：\" class=\"headerlink\" title=\"16S rDNA扩增子测序在微生物群落分析中的应用：\"></a>16S rDNA扩增子测序在微生物群落分析中的应用：</h2><ul>\n<li><p><strong>多样性研究：</strong> 通过16S rDNA扩增子测序，我们可以了解到微生物群落的多样性、丰度和组成。这对于研究环境中的微生物生态系统、人体内的菌群结构和变化等具有重要意义。</p>\n</li>\n<li><p><strong>疾病相关研究：</strong> 微生物与宿主之间存在着复杂的相互关系，16S rDNA扩增子测序可帮助我们揭示微生物与疾病之间的关联。例如，可以研究肠道菌群在肠炎、肠癌等疾病中的变化，为疾病的早期诊断和治疗提供依据。</p>\n</li>\n<li><p><strong>环境监测：</strong> 通过16S rDNA扩增子测序，可以对环境中的微生物进行评估和监测。这有助于了解环境中的微生物多样性、菌群结构的变化等，为环境保护和资源管理提供科学依据。</p>\n<p>16S rDNA扩增子测序在微生物群落分析中的应用，有助于我们深入了解微生物的组成和功能特征，揭示微生物在各种生态系统中的作用和影响。</p>\n</li>\n</ul>\n<h1 id=\"Shot-gun宏基因组测序介绍\"><a href=\"#Shot-gun宏基因组测序介绍\" class=\"headerlink\" title=\"Shot-gun宏基因组测序介绍\"></a>Shot-gun宏基因组测序介绍</h1><h2 id=\"宏基因组测序概述\"><a href=\"#宏基因组测序概述\" class=\"headerlink\" title=\"宏基因组测序概述\"></a>宏基因组测序概述</h2><p>宏基因组测序是一种用于研究环境微生物的基因组的技术。与常规基因组测序不同，宏基因组测序可以同时测序一个样品中的所有DNA片段，而不仅仅是特定基因或区域。这使得我们能够获得更全面的宏基因组信息，了解生物群体的遗传多样性和功能潜力。</p>\n<h2 id=\"Shot-gun宏基因组测序原理和流程：\"><a href=\"#Shot-gun宏基因组测序原理和流程：\" class=\"headerlink\" title=\"Shot-gun宏基因组测序原理和流程：\"></a>Shot-gun宏基因组测序原理和流程：</h2><ul>\n<li><strong>样品提取与DNA纯化：</strong> 首先，从样品中提取总DNA（原核、真核、宿主等）。</li>\n<li><strong>文库构建：</strong> 将提取到的DNA进行碎片化处理，然后将其转化为适合高通量测序平台的文库，其中每个DNA片段都被连接到测序适配器上。</li>\n<li><strong>高通量测序：</strong> 利用高通量测序技术（如Illumina NovaSeq或PacBio等）对文库进行测序，产生海量的短读段或长读段。</li>\n<li><strong>数据处理与组装：</strong> 对测序数据进行质量控制（去宿主序列）、去除低质量reads，并将reads进行拼接组装，以重建原始DNA序列的完整性。</li>\n<li><strong>功能注释与分析：</strong> 对宏基因组进行进一步的数据处理和分析，包括基因预测、基因注释、物种注释、代谢通路分析等，以了解宏基因组的功能潜力。</li>\n</ul>\n<h2 id=\"Shot-gun宏基因组测序在宏基因组学研究中的应用：\"><a href=\"#Shot-gun宏基因组测序在宏基因组学研究中的应用：\" class=\"headerlink\" title=\"Shot-gun宏基因组测序在宏基因组学研究中的应用：\"></a>Shot-gun宏基因组测序在宏基因组学研究中的应用：</h2><ul>\n<li><strong>功能和代谢潜力分析：</strong> 通过Shot-gun宏基因组测序，我们可以预测宏生物体内存在的基因，并进一步推断其功能和代谢潜力。这有助于理解宏生物体对环境的适应性和功能特征。</li>\n<li><strong>群落结构和相互作用分析：</strong> 宏基因组测序可以揭示宏生物群落的组成和结构，以及不同种群之间的相互作用模式。这对于研究宏生态系统的稳定性、共生共存关系和复杂网络等方面具有重要意义。</li>\n</ul>\n<p>Shot-gun宏基因组测序提供了了解宏生物的遗传多样性、功能潜力和生态作用的强大工具。它在宏基因组学研究中发挥着重要作用，为我们深入了解生物的基因组特征和生态系统功能提供了新的视角。</p>\n<h1 id=\"16S-rDNA扩增子测序与Shot-gun宏基因组测序的区别\"><a href=\"#16S-rDNA扩增子测序与Shot-gun宏基因组测序的区别\" class=\"headerlink\" title=\"16S rDNA扩增子测序与Shot-gun宏基因组测序的区别\"></a>16S rDNA扩增子测序与Shot-gun宏基因组测序的区别</h1><table>\n<thead>\n<tr>\n<th>特点</th>\n<th>宏基因组测序</th>\n<th>16S测序</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>分析范围</td>\n<td>微生物群落中的所有微生物种类和全基因组信息</td>\n<td>微生物群落中的16S rRNA基因信息</td>\n</tr>\n<tr>\n<td>精度和分辨率</td>\n<td>高（种水平）</td>\n<td>相对较低（属水平）</td>\n</tr>\n<tr>\n<td>数据处理和分析复杂性</td>\n<td>复杂</td>\n<td>相对简单</td>\n</tr>\n<tr>\n<td>优势</td>\n<td>提供全面性信息，高分辨率，功能分析，适用于各种生态系统研究</td>\n<td>揭示微生物的多样性、群落结构、系统发育关系，成本低</td>\n</tr>\n<tr>\n<td>宿主影响</td>\n<td>易</td>\n<td>不易</td>\n</tr>\n<tr>\n<td>局限性</td>\n<td>昂贵，需要大量计算资源和专业知识</td>\n<td>仅提供关于16S rRNA基因（细菌和古细菌）的信息，分辨率有限，无法提供详细的功能和代谢潜力信息。</td>\n</tr>\n<tr>\n<td>以上是宏基因组测序和16S测序的主要差别。16S rDNA扩增子测序更加注重微生物群落的结构和多样性分析，尽管宏基因组测序具有更广泛的应用和更高的解析能力，但同时也存在着一些局限性，如成本高昂、数据处理和分析的复杂性以及对专业知识的依赖。因此，在选择使用哪种技术时，研究人员需要根据自身的研究目的、样品类型和预算进行权衡。</td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"样本收集保存和运输注意事项\"><a href=\"#样本收集保存和运输注意事项\" class=\"headerlink\" title=\"样本收集保存和运输注意事项\"></a>样本收集保存和运输注意事项</h1><h2 id=\"扩增子和宏基因组测序前样本的采集方法和注意事项：\"><a href=\"#扩增子和宏基因组测序前样本的采集方法和注意事项：\" class=\"headerlink\" title=\"扩增子和宏基因组测序前样本的采集方法和注意事项：\"></a>扩增子和宏基因组测序前样本的采集方法和注意事项：</h2><h3 id=\"样本采集方法：\"><a href=\"#样本采集方法：\" class=\"headerlink\" title=\"样本采集方法：\"></a>样本采集方法：</h3><ul>\n<li>对于微生物群落研究，例如16S rDNA扩增子测序，通常采集环境样品（如土壤、水体、肠道内容物）或临床样品（如口腔拭子、粪便样品）。</li>\n<li>采集时要避免污染，使用无菌工具（如消毒的手套、取样器具等）进行采集。</li>\n<li>采集前应了解目标生物的分布情况、适宜的时间和地点，并进行采样地点的描述和记录。</li>\n<li>宏基因组测序涉及更广泛的样品类型，包括细菌、古细菌、真核生物等。采集方法根据样品类型有所不同。</li>\n</ul>\n<h3 id=\"注意事项：\"><a href=\"#注意事项：\" class=\"headerlink\" title=\"注意事项：\"></a>注意事项：</h3><ul>\n<li>样品采集和处理过程中，必须遵守无菌操作规范，以减少外部污染对样品的影响。</li>\n<li>避免使用可能含有RNase或DNase酶的试剂和工具，以防止核酸降解。</li>\n<li>了解目标生物的生态环境和特性，选择合适的采集时间和地点，确保获得代表性的样品。</li>\n<li>根据不同采样类型，选择合适的容器（如离心管、冰袋、采集棒等）进行样品收集，并在收集后立即进行处理或冷冻保存。</li>\n<li>在采集样品前，将采样工具彻底清洁消毒，尽量避免重复采样和交叉污染。</li>\n<li>通过宏基因组测序研究宿主相关微生物时，需要注意尽可能避免采集到宿主组织，否则会导致测序数据中微生物序列占比过小。</li>\n</ul>\n<h2 id=\"样本保存和运输以保持完整性和稳定性：\"><a href=\"#样本保存和运输以保持完整性和稳定性：\" class=\"headerlink\" title=\"样本保存和运输以保持完整性和稳定性：\"></a>样本保存和运输以保持完整性和稳定性：</h2><ul>\n<li><p><strong>保存方法：</strong></p>\n<ul>\n<li>样品保存应根据实验需求和样品特性选择适当的方法。常见的保存方法包括低温冷冻、保护液保存等。</li>\n<li>对于微生物样品，通常将其迅速冷冻保存在-80°C的冰箱中，以减缓DNA降解和生物活性的损失。</li>\n</ul>\n</li>\n<li><p><strong>运输方法：</strong></p>\n<ul>\n<li>在样品运输过程中，应确保样品的温度稳定性和完整性。</li>\n<li>使用合适的运输容器，如冷箱、干冰盒等，以保持低温和防止样品破裂或泄漏。</li>\n<li>对于国际运输，遵守相关法规和运输限制，确保样品能够顺利通过海关和检疫。</li>\n</ul>\n</li>\n</ul>\n<p>在采集样本和进行扩增子或宏基因组测序之前，正确的采集方法和样品处理是确保数据质量和可靠性的重要步骤。选择适当的保存和运输方法可以确保样品的完整性和稳定性，并最大程度地保护其中的生物信息。</p>\n<p>请注意，不同类型的样品可能需要采用不同的保存和运输方法。因此，在进行扩增子或宏基因组测序之前，建议咨询专业人士或参考相关文献以获取针对特定样品类型的最佳实践建议。</p>\n<h1 id=\"数据分析结果解读\"><a href=\"#数据分析结果解读\" class=\"headerlink\" title=\"数据分析结果解读\"></a>数据分析结果解读</h1><h2 id=\"16S-rDNA和宏基因组数据分析的基本流程：\"><a href=\"#16S-rDNA和宏基因组数据分析的基本流程：\" class=\"headerlink\" title=\"16S rDNA和宏基因组数据分析的基本流程：\"></a>16S rDNA和宏基因组数据分析的基本流程：</h2><h3 id=\"16S-rDNA数据分析流程：\"><a href=\"#16S-rDNA数据分析流程：\" class=\"headerlink\" title=\"16S rDNA数据分析流程：\"></a>16S rDNA数据分析流程：</h3><ul>\n<li>质量控制：对原始测序数据进行质量过滤和去除接头、低质量序列。</li>\n<li>序列拼接：将质量控制后的序列根据重叠区域进行拼接，得到高质量的长序列。</li>\n<li>物种注释：使用参考数据库（如Greengenes、SILVA）进行物种注释，将序列与已知物种进行比对并分类。</li>\n<li>多样性分析：计算物种多样性指数、绘制稀释曲线、构建物种共生网络等。</li>\n<li>群落结构分析：通过聚类分析（如OTU聚类）和Beta多样性分析（如PCoA、NMDS）研究群落结构差异。</li>\n<li>寻找Biomarker：通过LESFE分析寻找差异物种。</li>\n<li>功能预测：通过软件（picrust2，FAPROTAX）预测群落功能。</li>\n</ul>\n<h3 id=\"宏基因组数据分析流程：\"><a href=\"#宏基因组数据分析流程：\" class=\"headerlink\" title=\"宏基因组数据分析流程：\"></a>宏基因组数据分析流程：</h3><ul>\n<li>质量控制：对原始测序数据进行质量过滤和去除低质量序列。</li>\n<li>去宿主序列：将质量控制后的序列与宿主参考基因组进行比对，剩余的为微生物序列。</li>\n<li>基因预测：对微生物序列进行基因预测。</li>\n<li>功能注释：使用参考数据库（如KEGG、COG、GO、CAZY）对预测的功能基因进行注释。</li>\n<li>Alpha和Beta多样性分析：计算Alpha多样性指数和Beta多样性，比较不同样本之间的功能结构差异。</li>\n</ul>\n<h3 id=\"常见的分析软件和工具：\"><a href=\"#常见的分析软件和工具：\" class=\"headerlink\" title=\"常见的分析软件和工具：\"></a>常见的分析软件和工具：</h3><ul>\n<li>16S rDNA数据分析：QIIME2，mothur，DADA2，UPARSE, RDPipeline，vegan，PICRUSt……</li>\n<li>宏基因组数据分析：MetaPhlAn, HUMAnN, MG-RAST, MEGAN, kraken2……</li>\n</ul>\n<h1 id=\"结论和展望\"><a href=\"#结论和展望\" class=\"headerlink\" title=\"结论和展望\"></a>结论和展望</h1><h2 id=\"16S-rDNA扩增子和Shot-gun宏基因组测序的特点和应用：\"><a href=\"#16S-rDNA扩增子和Shot-gun宏基因组测序的特点和应用：\" class=\"headerlink\" title=\"16S rDNA扩增子和Shot-gun宏基因组测序的特点和应用：\"></a>16S rDNA扩增子和Shot-gun宏基因组测序的特点和应用：</h2><h3 id=\"16S-rDNA扩增子测序特点和应用：\"><a href=\"#16S-rDNA扩增子测序特点和应用：\" class=\"headerlink\" title=\"16S rDNA扩增子测序特点和应用：\"></a>16S rDNA扩增子测序特点和应用：</h3><ul>\n<li>特点：通过放大和测序16S rDNA基因区域，可以研究微生物群落的组成和结构。</li>\n<li>应用：<ul>\n<li>揭示微生物群落的多样性和相对丰度，了解不同环境中的微生物群落变化。</li>\n<li>研究微生物与健康、疾病之间的关联，如肠道菌群与肠道疾病的关系。</li>\n<li>探索环境中未知微生物种类，发现新的微生物资源。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Shot-gun宏基因组测序特点和应用：\"><a href=\"#Shot-gun宏基因组测序特点和应用：\" class=\"headerlink\" title=\"Shot-gun宏基因组测序特点和应用：\"></a>Shot-gun宏基因组测序特点和应用：</h3><ul>\n<li>特点：对整个基因组进行测序，包括微生物和宿主的DNA，提供更全面的信息。</li>\n<li>应用：<ul>\n<li>研究微生物和宿主基因组之间的相互作用，如微生物的代谢功能对宿主健康的影响。</li>\n<li>分析微生物的功能潜力，如预测微生物群落参与的代谢途径和信号通路。</li>\n<li>研究微生物基因组的进化和遗传多样性，理解微生物演化和适应策略。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"未来发展方向和潜在的研究前景：\"><a href=\"#未来发展方向和潜在的研究前景：\" class=\"headerlink\" title=\"未来发展方向和潜在的研究前景：\"></a>未来发展方向和潜在的研究前景：</h2><h3 id=\"方法改进：\"><a href=\"#方法改进：\" class=\"headerlink\" title=\"方法改进：\"></a>方法改进：</h3><ul>\n<li>提高测序技术的精度和通量，降低成本，使得扩增子和宏基因组测序更加高效和经济。</li>\n<li>开发新的分析工具和算法，以提高数据处理和解释的准确性和效率。</li>\n</ul>\n<h3 id=\"整合多组学数据：\"><a href=\"#整合多组学数据：\" class=\"headerlink\" title=\"整合多组学数据：\"></a>整合多组学数据：</h3><ul>\n<li>结合16S rDNA&#x2F;宏基因组测序数据与转录组、蛋白质组和代谢组等多组学数据，构建全面的系统生物学模型，深入了解微生物与宿主之间的复杂相互关系。</li>\n</ul>\n<h3 id=\"功能预测和代谢网络建模：\"><a href=\"#功能预测和代谢网络建模：\" class=\"headerlink\" title=\"功能预测和代谢网络建模：\"></a>功能预测和代谢网络建模：</h3><ul>\n<li>进一步发展和完善基于宏基因组数据的功能预测方法，从而揭示微生物群落的代谢功能和关键信号通路。</li>\n<li>基于大规模宏基因组数据，构建微生物群落的代谢网络模型，深入理解微生物共生和协同作用的机制。</li>\n</ul>\n<h3 id=\"环境和临床应用：\"><a href=\"#环境和临床应用：\" class=\"headerlink\" title=\"环境和临床应用：\"></a>环境和临床应用：</h3><ul>\n<li>运用16S rDNA扩增子和宏基因组测序技术，研究不同环境（如土壤、水体、大气）中的微生物群落动态和功能。</li>\n<li>在临床领域，通过微生物组学的研究，探索微生物与健康、疾病之间的关系，并开发个性化微生物介入策略。</li>\n</ul>\n<p>总的来说，未来的发展方向包括技术改进、多组学数据整合、功能预测和代谢网络建模，以及在环境和临床应用方面的深入研究。这些发展将进一步推动微生物组学的应用和理解，为我们揭示微生物的奥秘提供更深入的视角。</p>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><p>关注公众号“生信之巅”。</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"测序","path":"api/tags/测序.json"},{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"宏基因组","path":"api/tags/宏基因组.json"}]},{"title":"Use microeco分析扩增子数据","slug":"Use_microeco分析扩增子数据","date":"2021-03-14T07:01:45.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/Use_microeco分析扩增子数据.json","excerpt":null,"keywords":null,"cover":"#/images/lujia/show_15_taxa_at_Class_level.jpg","content":"<p>本文阐述使用microeco分析扩增子数据……</p>\n<span id=\"more\"></span>\n\n<h1 id=\"1-安装microeco\"><a href=\"#1-安装microeco\" class=\"headerlink\" title=\"1. 安装microeco\"></a><font color=#FF0000 >1. 安装microeco</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># If devtools package is not installed, first install it</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># then install microeco</span></span><br><span class=\"line\">devtools<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;ChiLiubio/microeco&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span>install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">devtools<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;jbisanz/qiime2R&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-准备数据\"><a href=\"#2-准备数据\" class=\"headerlink\" title=\"2. 准备数据\"></a><font color=#FF0000 >2. 准备数据</font></h1><h2 id=\"otu-table\"><a href=\"#otu-table\" class=\"headerlink\" title=\"otu_table\"></a><font color=#FF9800 >otu_table</font></h2><p>OTU表</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Sample 1</th>\n<th>Sample 2</th>\n<th>Sample 3</th>\n<th>Sample 4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>232.0</td>\n<td>209.0</td>\n<td>349.0</td>\n<td>256.0</td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>75.0</td>\n<td>35.0</td>\n<td>44.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>237.0</td>\n<td>224.0</td>\n<td>291.0</td>\n<td>353.0</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>371.0</td>\n<td>80.0</td>\n<td>319.0</td>\n<td>345.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"taxonomy-table\"><a href=\"#taxonomy-table\" class=\"headerlink\" title=\"taxonomy_table\"></a><font color=#FF9800 >taxonomy_table</font></h2><p>分类表</p>\n<div style=\"overflow-x:auto;\">\n<table>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Kingdom</th>\n<th>Phylum</th>\n<th>Class</th>\n<th>Order</th>\n<th>Family</th>\n<th>Genus</th>\n<th>Species</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>d__Bacteria</td>\n<td>p__Desulfobacterota</td>\n<td>c__Desulfobacteria</td>\n<td>o__Desulfatiglandales</td>\n<td>f__Desulfatiglandaceae</td>\n<td>g__Desulfatiglans</td>\n<td></td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>d__Bacteria</td>\n<td>p__Sva0485</td>\n<td>c__Sva0485</td>\n<td>o__Sva0485</td>\n<td>f__Sva0485</td>\n<td>g__Sva0485</td>\n<td>s__uncultured_hydrocarbon</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>d__Bacteria</td>\n<td>p__Desulfobacterota</td>\n<td>c__Syntrophobacteria</td>\n<td>o__Syntrophobacterales</td>\n<td>f__uncultured</td>\n<td>g__uncultured</td>\n<td>s__uncultured_delta</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>d__Bacteria</td>\n<td>p__Myxococcota</td>\n<td>c__Polyangia</td>\n<td>o__Polyangiales</td>\n<td>f__Sandaracinaceae</td>\n<td>g__uncultured</td>\n<td></td>\n</tr>\n</tbody></table>\n</table>\n</div>\n\n<h2 id=\"sample-info\"><a href=\"#sample-info\" class=\"headerlink\" title=\"sample_info\"></a><font color=#FF9800 >sample_info</font></h2><p>样本元数据</p>\n<table>\n<thead>\n<tr>\n<th>SampleID</th>\n<th>Group</th>\n<th>Type</th>\n<th>Saline</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>G1</td>\n<td>T1</td>\n<td>Non-saline</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>G1</td>\n<td>T1</td>\n<td>Non-saline</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>G2</td>\n<td>T1</td>\n<td>Saline</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>G2</td>\n<td>T2</td>\n<td>Saline</td>\n</tr>\n</tbody></table>\n<h2 id=\"env-data\"><a href=\"#env-data\" class=\"headerlink\" title=\"env_data\"></a><font color=#FF9800 >env_data</font></h2><p>环境因子</p>\n<table>\n<thead>\n<tr>\n<th>SampleID</th>\n<th>Depth</th>\n<th>Longitude</th>\n<th>Latitude</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>0</td>\n<td>23.0</td>\n<td>20</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>10</td>\n<td>35.0</td>\n<td>44.0</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>20</td>\n<td>43.0</td>\n<td>70.0</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>30</td>\n<td>60.0</td>\n<td>69.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"phylo-tree\"><a href=\"#phylo-tree\" class=\"headerlink\" title=\"phylo_tree\"></a><font color=#FF9800 >phylo_tree</font></h2><p>进化树</p>\n<h1 id=\"3-导入数据\"><a href=\"#3-导入数据\" class=\"headerlink\" title=\"3. 导入数据\"></a><font color=#FF0000 >3. 导入数据</font></h1><ul>\n<li><p>加载R包</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span>microeco<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ape<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>qiime2R<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># use pipe operator in magrittr package</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>magrittr<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># set.seed is used to fix the random number generation to make the results repeatable</span></span><br><span class=\"line\">set.seed<span class=\"punctuation\">(</span><span class=\"number\">123</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># make the plotting background same with the tutorial</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\">theme_set<span class=\"punctuation\">(</span>theme_bw<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>导入数据</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 单独导入环境因子文件</span></span><br><span class=\"line\">env_data <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/Ordination_analyses/env4.txt&quot;</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 定义数据导入函数</span></span><br><span class=\"line\">qiimed2meco <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>ASV_data<span class=\"punctuation\">,</span> sample_data<span class=\"punctuation\">,</span> taxonomy_data<span class=\"punctuation\">,</span> phylo_tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\"># Read ASV data</span></span><br><span class=\"line\">\tASV <span class=\"operator\">&lt;-</span> as.data.frame<span class=\"punctuation\">(</span>read_qza<span class=\"punctuation\">(</span>ASV_data<span class=\"punctuation\">)</span><span class=\"operator\">$</span>data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\t<span class=\"comment\">#  Read metadata</span></span><br><span class=\"line\">\tmetadata <span class=\"operator\">&lt;-</span> read_q2metadata<span class=\"punctuation\">(</span>sample_data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\trownames<span class=\"punctuation\">(</span>metadata<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"built_in\">as.character</span><span class=\"punctuation\">(</span>metadata<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">\t<span class=\"comment\"># Read taxonomy table</span></span><br><span class=\"line\">\ttaxa_table <span class=\"operator\">&lt;-</span> read_qza<span class=\"punctuation\">(</span>taxonomy_data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\ttaxa_table <span class=\"operator\">&lt;-</span> parse_taxonomy<span class=\"punctuation\">(</span>taxa_table<span class=\"operator\">$</span>data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\t<span class=\"comment\"># Make the taxonomic table clean, this is very important.</span></span><br><span class=\"line\">\ttaxa_table <span class=\"operator\">%&lt;&gt;%</span> tidy_taxonomy</span><br><span class=\"line\">\t<span class=\"comment\"># Read phylo tree</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>phylo_tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t\tphylo_tree <span class=\"operator\">&lt;-</span> read_qza<span class=\"punctuation\">(</span>phylo_tree<span class=\"punctuation\">)</span><span class=\"operator\">$</span>data</span><br><span class=\"line\">\t<span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">\tdataset <span class=\"operator\">&lt;-</span> microtable<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>sample_table <span class=\"operator\">=</span> metadata<span class=\"punctuation\">,</span> tax_table <span class=\"operator\">=</span> taxa_table<span class=\"punctuation\">,</span> otu_table <span class=\"operator\">=</span> ASV<span class=\"punctuation\">,</span> phylo_tree <span class=\"operator\">=</span> phylo_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">\tdataset</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入本地数据，包括OTU表、样本元数据、分类表、tree文件。这几个文件均有QIIME2生成。</span></span><br><span class=\"line\">meco_dataset <span class=\"operator\">&lt;-</span> qiimed2meco<span class=\"punctuation\">(</span>ASV_data <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/dada2_table.qza&quot;</span><span class=\"punctuation\">,</span> sample_data <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/metadata.tsv&quot;</span><span class=\"punctuation\">,</span> taxonomy_data <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/taxonomy.qza&quot;</span><span class=\"punctuation\">,</span> phylo_tree <span class=\"operator\">=</span> <span class=\"string\">&quot;E:/Researches/lujia16S/Analysis_20200907/tree.qza&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">meco_dataset</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"4-数据预处理\"><a href=\"#4-数据预处理\" class=\"headerlink\" title=\"4. 数据预处理\"></a><font color=#FF0000 >4. 数据预处理</font></h1><ul>\n<li><p>移除未被分配到 “k__Archaea” 或 “k__Bacteria”的OTUs</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>tax_table <span class=\"operator\">%&lt;&gt;%</span> base<span class=\"operator\">::</span>subset<span class=\"punctuation\">(</span>Kingdom <span class=\"operator\">==</span> <span class=\"string\">&quot;k__Archaea&quot;</span> <span class=\"operator\">|</span> Kingdom <span class=\"operator\">==</span> <span class=\"string\">&quot;k__Bacteria&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">print<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>移除注释为线粒体和叶绿体的OTUs</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 移除tax_table中包含taxa名字的行，无论分类等级（taxonomic ranks），不区分大小写字母。简言之，taxa = c(&quot;mitochondria&quot;, &quot;chloroplast&quot;)定义了删除包含mitochondria和chloroplast的行。</span></span><br><span class=\"line\"></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>filter_pollution<span class=\"punctuation\">(</span>taxa <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;mitochondria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;chloroplast&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">print<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>为了使otu_table、tax_table和phylo_tree中的OTUs相同，我们再次使用tidy_dataset() 函数</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>tidy_dataset<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">print<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>调用sample_sums()检查各样本中的序列数量</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>sample_sums<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">range</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>有时，为了减少物种数目对多样性度量的影响，我们需要进行重采样，使每个样本中的序列数量相等。函数rarefy_samples可以在稀疏（rarefying）前后自动调用函数tidy_dataset。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># As an example, we use 20001 sequences in each sample</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>rarefy_samples<span class=\"punctuation\">(</span>sample.size <span class=\"operator\">=</span> <span class=\"number\">20001</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>sample_sums<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> <span class=\"built_in\">range</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"5-alpha多样性\"><a href=\"#5-alpha多样性\" class=\"headerlink\" title=\"5. alpha多样性\"></a><font color=#FF0000 >5. alpha多样性</font></h1><ul>\n<li><p>然后，我们使用cal_abund()计算每个分类等级的分类单元丰度（taxa abundance）。此函数返回一个名为taxa_abund的列表，其中包含每个分类等级上的丰度信息的多个数据框。列表自动存储在microtable object中。</p>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">meco_dataset<span class=\"operator\">$</span>cal_abund<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return dataset$taxa_abund</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>taxa_abund<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>通过save_abund()将taxa abundance保存至本地文件</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxa_abund&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>save_abund<span class=\"punctuation\">(</span>dirpath <span class=\"operator\">=</span> <span class=\"string\">&quot;taxa_abund&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>计算alpha多样性。结果自动存储在microtable object中。<font color=#2196F3>作为示例，此处未计算系统发育多样性（phylogenetic diversity）</font>。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 若要计算Faith&#x27;s phylogenetic diversity，设置PD = TRUE，计算速度会较慢</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>cal_alphadiv<span class=\"punctuation\">(</span>PD <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># return dataset$alpha_diversity</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>alpha_diversity<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save dataset$alpha_diversity to a directory</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_diversity&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>save_alphadiv<span class=\"punctuation\">(</span>dirpath <span class=\"operator\">=</span> <span class=\"string\">&quot;alpha_diversity&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"6-β多样性\"><a href=\"#6-β多样性\" class=\"headerlink\" title=\"6. β多样性\"></a><font color=#FF0000 >6. β多样性</font></h1><ul>\n<li><p>利用函数cal_betadiv()计算beta-多样性的距离矩阵。我们提供了四个最常用的索引：Bray-curtis、Jaccard、加权Unifrac和未加权Unifrac。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># If you do not want to calculate unifrac metrics, use unifrac = FALSE</span></span><br><span class=\"line\"><span class=\"comment\"># 需要GUniFrac package</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;GUniFrac&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>cal_betadiv<span class=\"punctuation\">(</span>unifrac <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return dataset$beta_diversity</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save dataset$beta_diversity to a directory</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span><span class=\"string\">&quot;beta_diversity&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>save_betadiv<span class=\"punctuation\">(</span>dirpath <span class=\"operator\">=</span> <span class=\"string\">&quot;beta_diversity&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"7-trans-abund-class\"><a href=\"#7-trans-abund-class\" class=\"headerlink\" title=\"7. trans_abund class\"></a><font color=#FF0000 >7. trans_abund class</font></h1><ul>\n<li><p>绘制Barplot。转换分类丰度数据，以便使用ggplot2包绘制分类单元丰度。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># create trans_abund object</span></span><br><span class=\"line\"><span class=\"comment\"># use 12 Phyla with the highest abundance in the dataset.</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1 object now include the transformed abundance data t1$abund_data and other elements for the following plotting</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>绘制Barplot. We remove the sample names in x axis and add the facet to show abundance according to groups.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>others_color <span class=\"operator\">=</span> <span class=\"string\">&quot;grey70&quot;</span><span class=\"punctuation\">,</span> facet <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> xtext_keep <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> legend_text_italic <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return a ggplot2 object</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取组内平均值。The groupmean parameter can be used to obtain the group-mean barplot.</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">,</span> groupmean <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>others_color <span class=\"operator\">=</span> <span class=\"string\">&quot;grey70&quot;</span><span class=\"punctuation\">,</span> legend_text_italic <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then alluvial plot is implemented in the plot_bar function.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggalluvial&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># use_alluvium = TRUE make the alluvial plot, clustering =TRUE can be used to reorder the samples by clustering</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>use_alluvium <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> clustering <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> xtext_type_hor <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> xtext_size <span class=\"operator\">=</span> <span class=\"number\">6</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>The box plot is an excellent way to intuitionally show data distribution across groups.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># show 15 taxa at Class level</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Class&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">15</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_box<span class=\"punctuation\">(</span>group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/show_15_taxa_at_Class_level.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/show_15_taxa_at_Class_level.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"show 15 taxa at Class level\"></p>\n<ul>\n<li><p>Then we show the heatmap with the high abundant genera.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># show 40 taxa at Genus level</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">40</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_heatmap<span class=\"punctuation\">(</span>facet <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> xtext_keep <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> withmargin <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then, we show the pie chart.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">6</span><span class=\"punctuation\">,</span> groupmean <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># all pie chart in one row</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_pie<span class=\"punctuation\">(</span>facet_nrow <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"8-trans-venn-class\"><a href=\"#8-trans-venn-class\" class=\"headerlink\" title=\"8. trans_venn class\"></a><font color=#FF0000 >8. trans_venn class</font></h1><ul>\n<li><p>The trans_venn class is used for venn analysis. To analyze the unique and shared OTUs of groups, we first merge samples according to the “Group” column of sample_table.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># merge samples as one community for each group</span></span><br><span class=\"line\">dataset1 <span class=\"operator\">&lt;-</span> meco_dataset<span class=\"operator\">$</span>merge_samples<span class=\"punctuation\">(</span>use_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># dataset1 is a new microtable object</span></span><br><span class=\"line\"><span class=\"comment\"># create trans_venn object</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_venn<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset1<span class=\"punctuation\">,</span> ratio <span class=\"operator\">=</span> <span class=\"string\">&quot;seqratio&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_venn<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># The integer data is OTU number</span></span><br><span class=\"line\"><span class=\"comment\"># The percentage data is the sequence number/total sequence number</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>When the groups are too many to show with venn plot, we can use petal plot.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use &quot;Type&quot; column in sample_table</span></span><br><span class=\"line\">dataset1 <span class=\"operator\">&lt;-</span> meco_dataset<span class=\"operator\">$</span>merge_samples<span class=\"punctuation\">(</span>use_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_venn<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset1<span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_venn<span class=\"punctuation\">(</span>petal_plot <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Sometimes, we are interested in the unique and shared species. In another words, the composition of the unique or shared species may account for the different and similar parts of ecological characteristics across groups[10]. For this goal, we first transform the results of venn plot to the traditional species-sample table, that is, another object of microtable class.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset1 <span class=\"operator\">&lt;-</span> meco_dataset<span class=\"operator\">$</span>merge_samples<span class=\"punctuation\">(</span>use_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_venn<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset1<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># transform venn results to the sample-species table, here do not consider abundance, only use presence/absence information.</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>trans_venn_com<span class=\"punctuation\">(</span>use_OTUs_frequency <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t2 is a new microtable class, each part is considered as a sample</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>t2<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We use bar plot to show the composition at the Genus level.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate taxa abundance, that is, the frequency</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_abund<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># transform and plot</span></span><br><span class=\"line\">t3 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> t2<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">12</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t3<span class=\"operator\">$</span>plot_bar<span class=\"punctuation\">(</span>bar_type <span class=\"operator\">=</span> <span class=\"string\">&quot;part&quot;</span><span class=\"punctuation\">,</span> legend_text_italic <span class=\"operator\">=</span> <span class=\"built_in\">T</span><span class=\"punctuation\">,</span> ylab_title <span class=\"operator\">=</span> <span class=\"string\">&quot;Frequency (%)&quot;</span><span class=\"punctuation\">,</span> xtext_type_hor <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We also try to use pie chart to show the compositions at the Phylum level</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t3 <span class=\"operator\">&lt;-</span> trans_abund<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> t2<span class=\"punctuation\">,</span> taxrank <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">,</span> ntaxa <span class=\"operator\">=</span> <span class=\"number\">8</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t3<span class=\"operator\">$</span>plot_pie<span class=\"punctuation\">(</span>facet_nrow <span class=\"operator\">=</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span> use_colors <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span>RColorBrewer<span class=\"operator\">::</span>brewer.pal<span class=\"punctuation\">(</span><span class=\"number\">8</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Dark2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;grey50&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"9-trans-alpha-class\"><a href=\"#9-trans-alpha-class\" class=\"headerlink\" title=\"9. trans_alpha class\"></a><font color=#FF0000 >9. trans_alpha class</font></h1><ul>\n<li><p>Alpha diversity can be transformed and plotted using trans_alpha class. Creating trans_alpha object can return two data frame: alpha_data and alpha_stat.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_alpha<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$alpha_stat</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>alpha_stat<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then, we test the differences among groups using the KW rank sum test and anova with multiple comparisons.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_diff<span class=\"punctuation\">(</span>method <span class=\"operator\">=</span> <span class=\"string\">&quot;KW&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_alpha_diff</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_alpha_diff<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Groups</th>\n<th>Measure</th>\n<th>Test method</th>\n<th>p.value</th>\n<th>Significance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>T16 vs T18</td>\n<td>Observed</td>\n<td>KW</td>\n<td>2.601895e-03</td>\n<td>**</td>\n</tr>\n<tr>\n<td>2</td>\n<td>T16 vs T20</td>\n<td>Observed</td>\n<td>KW</td>\n<td>3.011399e-08</td>\n<td>***</td>\n</tr>\n<tr>\n<td>3</td>\n<td>T16 vs T21</td>\n<td>Observed</td>\n<td>KW</td>\n<td>2.174162e-04</td>\n<td>***</td>\n</tr>\n<tr>\n<td>4</td>\n<td>T16 vs T17</td>\n<td>Observed</td>\n<td>KW</td>\n<td>1.234229e-03</td>\n<td>**</td>\n</tr>\n<tr>\n<td>5</td>\n<td>T18 vs T20</td>\n<td>Observed</td>\n<td>KW</td>\n<td>7.319258e-08</td>\n<td>***</td>\n</tr>\n</tbody></table>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_diff<span class=\"punctuation\">(</span>method <span class=\"operator\">=</span> <span class=\"string\">&quot;anova&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_alpha_diff</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_alpha_diff</span><br></pre></td></tr></table></figure>\n  <div style=\"overflow-x:auto;\">\n  <table>\n\n<table>\n<thead>\n<tr>\n<th>Observed</th>\n<th>Chao1</th>\n<th>ACE</th>\n<th>Shannon</th>\n<th>Simpson</th>\n<th>InvSimpson</th>\n<th>Fisher</th>\n<th>Coverage</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>T18</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n</tr>\n<tr>\n<td>T16</td>\n<td>b</td>\n<td>b</td>\n<td>b</td>\n<td>a</td>\n<td>a</td>\n<td>a</td>\n<td>b</td>\n</tr>\n<tr>\n<td>T17</td>\n<td>c</td>\n<td>c</td>\n<td>c</td>\n<td>b</td>\n<td>a</td>\n<td>b</td>\n<td>c</td>\n</tr>\n<tr>\n<td>T21</td>\n<td>d</td>\n<td>d</td>\n<td>d</td>\n<td>c</td>\n<td>a</td>\n<td>c</td>\n<td>d</td>\n</tr>\n<tr>\n<td>T20</td>\n<td>e</td>\n<td>e</td>\n<td>e</td>\n<td>d</td>\n<td>b</td>\n<td>d</td>\n<td>e</td>\n</tr>\n<tr>\n<td></table></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></div></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n</li>\n<li><p>Now, let us plot the mean and se of alpha diversity for each group, and add the duncan.test (agricolae package) result.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_alpha<span class=\"punctuation\">(</span>add_letter <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We can also use the boxplot to show the paired comparisons directly.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_alpha<span class=\"punctuation\">(</span>pair_compare <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"10-trans-beta-class\"><a href=\"#10-trans-beta-class\" class=\"headerlink\" title=\"10. trans_beta class\"></a><font color=#FF0000 >10. trans_beta class</font></h1><ul>\n<li><p>The distance matrix of beta diversity can be transformed and plotted using trans_beta class. The analysis referred to the beta diversity in this class mainly include ordination, group distance, clustering and manova. We first show the ordination using PCoA.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># we first create an object and select PCoA for ordination</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">,</span> ordination <span class=\"operator\">=</span> <span class=\"string\">&quot;PCoA&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_ordination is the ordination result list</span></span><br><span class=\"line\"><span class=\"built_in\">class</span><span class=\"punctuation\">(</span>t1<span class=\"operator\">$</span>res_ordination<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># plot the PCoA result</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_ordination<span class=\"punctuation\">(</span>plot_color <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> plot_shape <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> plot_group_ellipse <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then we plot and compare the group distances.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate and plot sample distances within groups</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_group_distance</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># calculate and plot sample distances between groups (报错：错误: Insufficient values in manual scale. 10 needed but only 8 provided.)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span>within_group <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Clustering plot is also a frequently used method.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use replace_name to set the label name, group parameter used to set the color (报错：找不到对象&#x27;dataset&#x27;)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_clustering<span class=\"punctuation\">(</span>group <span class=\"operator\">=</span> <span class=\"string\">&quot;Indexs&quot;</span><span class=\"punctuation\">,</span> replace_name <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;Water-depth(m)&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;Indexs&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>perMANOVA is often used in the differential test of distances among groups.</p>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># manova for all groups</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_manova<span class=\"punctuation\">(</span>cal_manova_all <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_manova<span class=\"operator\">$</span>aov.tab</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Permutation: free</th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Number of permutations: 999</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Terms added sequentially (first to last)</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Df</td>\n<td>SumsOfSqs</td>\n<td>MeanSqs</td>\n<td>F.Model</td>\n<td>R<sup>2</sup></td>\n<td>Pr(&gt;F)</td>\n</tr>\n<tr>\n<td>Site</td>\n<td>4</td>\n<td>15.669</td>\n<td>3.9173</td>\n<td>19.445</td>\n<td>0.48077</td>\n<td>0.001 ***</td>\n</tr>\n<tr>\n<td>Residuals</td>\n<td>84</td>\n<td>16.923</td>\n<td>0.2015</td>\n<td></td>\n<td>0.51923</td>\n<td></td>\n</tr>\n<tr>\n<td>Total</td>\n<td>88</td>\n<td>32.592</td>\n<td></td>\n<td></td>\n<td>1.00000</td>\n<td></td>\n</tr>\n</tbody></table>\n<p> &gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</p>\n</li>\n</ul>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># manova for each paired groups</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_manova<span class=\"punctuation\">(</span>cal_manova_paired <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_manova</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Groups</th>\n<th>measure</th>\n<th>permutations</th>\n<th>R<sup>2</sup></th>\n<th>p.value</th>\n<th>Significance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>T16 vs T18</td>\n<td>bray</td>\n<td>999</td>\n<td>0.2748773</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>2</td>\n<td>T16 vs T20</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4539103</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>3</td>\n<td>T16 vs T21</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4102009</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>4</td>\n<td>T16 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.2243404</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>5</td>\n<td>T18 vs T20</td>\n<td>bray</td>\n<td>999</td>\n<td>0.3736482</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>6</td>\n<td>T18 vs T21</td>\n<td>bray</td>\n<td>999</td>\n<td>0.3504104</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>7</td>\n<td>T18 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.2147055</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>8</td>\n<td>T20 vs T21</td>\n<td>bray</td>\n<td>999</td>\n<td>0.3575765</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>9</td>\n<td>T20 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4589248</td>\n<td>0.001</td>\n</tr>\n<tr>\n<td>10</td>\n<td>T21 vs T17</td>\n<td>bray</td>\n<td>999</td>\n<td>0.4395176</td>\n<td>0.001</td>\n</tr>\n</tbody></table>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># manova for specified group set: here &quot;Group + Type&quot;</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_manova<span class=\"punctuation\">(</span>cal_manova_set <span class=\"operator\">=</span> <span class=\"string\">&quot;Site+ Indexs&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_manova<span class=\"operator\">$</span>aov.tab</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Permutation: free</th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Number of permutations: 999</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Terms added sequentially (first to last)</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>Df</td>\n<td>SumsOfSqs</td>\n<td>MeanSqs</td>\n<td>F.Model</td>\n<td>R<sup>2</sup></td>\n<td>Pr(F)</td>\n</tr>\n<tr>\n<td>Site</td>\n<td>4</td>\n<td>15.669</td>\n<td>4</td>\n<td>0</td>\n<td>0.48077</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Indexs</td>\n<td>84</td>\n<td>16.923</td>\n<td>0</td>\n<td>0</td>\n<td>0.51923</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Residuals</td>\n<td>0</td>\n<td>0.000</td>\n<td>Inf</td>\n<td></td>\n<td>0.00000</td>\n<td></td>\n</tr>\n<tr>\n<td>Total</td>\n<td>88</td>\n<td>32.592</td>\n<td></td>\n<td></td>\n<td>1.00000</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"11-trans-diff-class\"><a href=\"#11-trans-diff-class\" class=\"headerlink\" title=\"11. trans_diff class\"></a><font color=#FF0000 >11. trans_diff class</font></h1><ul>\n<li><p>Differential abundance test is a very important part in the microbial community data analysis. It can be used to find the significant taxa in determining the community differences across groups. Currently, trans_diff class have three famous approaches to perform this analysis: metastat[11], LEfSe[12] and random forest. Metastat depends on the permutations and t-test and performs well on the sparse data. It is used for the comparisons between two groups.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># metastat analysis at Genus level</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;metastat&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> metastat_taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_metastat is the result</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_metastat_group_matrix is the group comparisons order for plotting</span></span><br><span class=\"line\"><span class=\"comment\"># plot the first paired groups, choose_group = 1</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_metastat<span class=\"punctuation\">(</span>use_number <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">10</span><span class=\"punctuation\">,</span> qvalue <span class=\"operator\">=</span> <span class=\"number\">0.05</span><span class=\"punctuation\">,</span> choose_group <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>LEfSe combines the non-parametric test and linear discriminant analysis. We implement this approach in this package instead of the python version.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;lefse&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> alpha <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span> lefse_subgroup <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_lefse is the LEfSe result</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_abund is the abundance information</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_lefse_bar<span class=\"punctuation\">(</span>LDA_score <span class=\"operator\">=</span> <span class=\"number\">4</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>We can also plot the abundance of taxa detected using LEfSe.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>plot_diff_abund<span class=\"punctuation\">(</span>use_number <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">30</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then, we show the cladogram of the differential features in the taxonomic tree. There are too many taxa in this dataset. As an example, we only use the highest 200 abundant taxa in the tree and 50 differential features. We only show the full taxonomic label at Phylum level and use letters at other levels to reduce the text overlap.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># clade_label_level 5 represent phylum level in this analysis</span></span><br><span class=\"line\"><span class=\"comment\"># require ggtree package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_lefse_cladogram<span class=\"punctuation\">(</span>use_taxa_num <span class=\"operator\">=</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> use_feature_num <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> clade_label_level <span class=\"operator\">=</span> <span class=\"number\">5</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>There may be a problem related with the taxonomic labels in the plot. When the levels used are too many, the taxonomic labels may have too much overlap. However, if we only indicate the Phylum labels, the taxa in the legend with marked letters are too many. At this time, you can select the taxa that you want to show in the plot manually like the following operation.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># choose some taxa according to the positions in the previous picture; those taxa labels have minimum overlap</span></span><br><span class=\"line\">use_labels <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;c__Deltaproteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Actinobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Rhizobiales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Proteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Bacteroidetes&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">\t<span class=\"string\">&quot;o__Micrococcales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Acidobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Verrucomicrobia&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;p__Firmicutes&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">\t<span class=\"string\">&quot;p__Chloroflexi&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Acidobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Gammaproteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__Betaproteobacteria&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;c__KD4-96&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;c__Bacilli&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Gemmatimonadales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;f__Gemmatimonadaceae&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Bacillales&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;o__Rhodobacterales&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># then use parameter select_show_labels to show</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_lefse_cladogram<span class=\"punctuation\">(</span>use_taxa_num <span class=\"operator\">=</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> use_feature_num <span class=\"operator\">=</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span> select_show_labels <span class=\"operator\">=</span> use_labels<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># Now we can see that more taxa names appear in the tree</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>If you are interested in taxonomic tree, you can also use metacoder package[13] to plot the taxonomic tree based on the selected taxa. We do not show the usage here.</p>\n</li>\n<li><p>The third approach is rf, which depends on the random forest[14, 15] and the non-parametric test. The current method can calculate random forest by bootstrapping like the method in LEfSe and only use the significant features. MeanDecreaseGini is selected as the indicator value in the analysis.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use Genus level for parameter rf_taxa_level, if you want to use all taxa, change to &quot;all&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># nresam = 1 and boots = 1 represent no bootstrapping and use all samples directly</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;rf&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> rf_taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rf is the result stored in the object</span></span><br><span class=\"line\"><span class=\"comment\"># plot the result</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>plot_diff_abund<span class=\"punctuation\">(</span>use_number <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> only_abund_plot <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">gridExtra<span class=\"operator\">::</span>grid.arrange<span class=\"punctuation\">(</span>t2<span class=\"operator\">$</span>p1<span class=\"punctuation\">,</span> t2<span class=\"operator\">$</span>p2<span class=\"punctuation\">,</span> ncol<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> nrow <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> widths <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"number\">2</span><span class=\"punctuation\">,</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># the middle asterisk represent the significances</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"12-trans-env-class\"><a href=\"#12-trans-env-class\" class=\"headerlink\" title=\"12. trans_env class\"></a><font color=#FF0000 >12. trans_env class</font></h1><ul>\n<li><p>分析环境因子对微生物群落结构和组装的影响：RDA分析(db-RDA和RDA).</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># add_data is used to add the environmental data</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">7</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># use bray-curtis distance to do dbrda</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_rda<span class=\"punctuation\">(</span>use_dbrda <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> use_measure <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rda is the result list stored in the object</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>trans_rda<span class=\"punctuation\">(</span>adjust_arrow_length <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> max_perc_env <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rda_trans is the transformed result for plotting</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_rda<span class=\"punctuation\">(</span>plot_color <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># use Genus</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_rda<span class=\"punctuation\">(</span>use_dbrda <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># As the main results of RDA are related with the projection and angles between different arrows,</span></span><br><span class=\"line\"><span class=\"comment\"># we adjust the length of the arrow to show them clearly using several parameters.</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>trans_rda<span class=\"punctuation\">(</span>show_taxa <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span> adjust_arrow_length <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> max_perc_env <span class=\"operator\">=</span> <span class=\"number\">1500</span><span class=\"punctuation\">,</span> max_perc_tax <span class=\"operator\">=</span> <span class=\"number\">3000</span><span class=\"punctuation\">,</span> min_perc_env <span class=\"operator\">=</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> min_perc_tax <span class=\"operator\">=</span> <span class=\"number\">300</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># t1$res_rda_trans is the transformed result for plotting</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_rda<span class=\"punctuation\">(</span>plot_color <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Mantel test 用于检测环境因子和距离矩阵之间是否具有显著的相关性。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_mantel<span class=\"punctuation\">(</span>use_measure <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_mantel</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_mantel</span><br></pre></td></tr></table></figure>\n\n  <div style=\"overflow-x:auto;\">\n  <table>\n  \n<table>\n<thead>\n<tr>\n<th></th>\n<th>variable_name</th>\n<th>cor_method</th>\n<th>corr_res</th>\n<th>p_res</th>\n<th>significance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>TN</strong></td>\n<td>pearson</td>\n<td>0.5571885</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>TC</strong></td>\n<td>pearson</td>\n<td>0.5712239</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>TS</strong></td>\n<td>pearson</td>\n<td>0.2665453</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>TOC</strong></td>\n<td>pearson</td>\n<td>0.3540337</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Salinity</strong></td>\n<td>pearson</td>\n<td>0.2782537</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>6</td>\n<td>Temperature</td>\n<td>pearson</td>\n<td>0.5856050</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>Dissolved.oxygen</strong></td>\n<td>pearson</td>\n<td>0.4358422</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>8</td>\n<td>Surface.chlorophyll.concentrations</td>\n<td>pearson</td>\n<td>0.2586823</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>9</td>\n<td>pH</td>\n<td>pearson</td>\n<td>0.4498964</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>PAR</strong></td>\n<td>pearson</td>\n<td>0.1712861</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>11</td>\n<td>Density</td>\n<td>pearson</td>\n<td>0.5682679</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td>12</td>\n<td>Turbidity</td>\n<td>pearson</td>\n<td>0.2260436</td>\n<td>0.001</td>\n<td>***</td>\n</tr>\n<tr>\n<td></table></div></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n</li>\n<li><p>环境变量与分类群（taxa）的相关性对分析和推断影响群落结构的因素具有重要意义。在本例中，我们首先进行了差异丰度检验（differential abundance test）和随机森林分析（random forest），得到了重要的属（Genus）。然后利用这些分类单元进行相关性分析。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># first create trans_diff object</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_diff<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> method <span class=\"operator\">=</span> <span class=\"string\">&quot;rf&quot;</span><span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> rf_taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Genus&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># then create trans_env object</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">7</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># calculate correlation</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>use_data <span class=\"operator\">=</span> <span class=\"string\">&quot;other&quot;</span><span class=\"punctuation\">,</span> p_adjust_method <span class=\"operator\">=</span> <span class=\"string\">&quot;fdr&quot;</span><span class=\"punctuation\">,</span> other_taxa <span class=\"operator\">=</span> t2<span class=\"operator\">$</span>res_rf<span class=\"operator\">$</span>Taxa<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">60</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_cor </span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用ggplot2或pheatmap进行可视化</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># default ggplot2 method</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># clustering heatmap; require pheatmap package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span>pheatmap <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4ggplot2.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4ggplot2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"7个环境变量与分类群ggplot2\"></p>\n<p><img src=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4%E7%9B%B8%E5%85%B3%E6%80%A7_pheatmap.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/7%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%88%86%E7%B1%BB%E7%BE%A4%E7%9B%B8%E5%85%B3%E6%80%A7_pheatmap.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"7个环境变量与分类群相关性_pheatmap\"></p>\n<ul>\n<li><p>各组内的环境变量与分类群taxa之间的关系</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate correlations for different groups using parameter by_group</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>by_group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> use_data <span class=\"operator\">=</span> <span class=\"string\">&quot;other&quot;</span><span class=\"punctuation\">,</span> p_adjust_method <span class=\"operator\">=</span> <span class=\"string\">&quot;fdr&quot;</span><span class=\"punctuation\">,</span> other_taxa <span class=\"operator\">=</span> t2<span class=\"operator\">$</span>res_rf<span class=\"operator\">$</span>Taxa<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">60</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_cor</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/correlations_between_environmental_variables_and_60_taxa.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/correlations_between_environmental_variables_and_60_taxa.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"correlations_between_environmental_variables_and_60_taxa\"></p>\n<ul>\n<li><p>环境因子与alpha-多样性之间的关系</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">7</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># use add_abund_table parameter to add the extra data table</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>add_abund_table <span class=\"operator\">=</span> meco_dataset<span class=\"operator\">$</span>alpha_diversity<span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/relationship_between_7_environmental_factors_and_alpha_diversity.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/relationship_between_7_environmental_factors_and_alpha_diversity.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"relationship_between_7_environmental_factors_and_alpha_diversity\"></p>\n<h1 id=\"13-trans-nullmodel-class\"><a href=\"#13-trans-nullmodel-class\" class=\"headerlink\" title=\"13. trans_nullmodel class\"></a><font color=#FF0000 >13. trans_nullmodel class</font></h1><ul>\n<li><p>近几十年来，系统发育分析和空模型（null model）的结合，通过增加系统发育维度（phylogeny dimension），更加有力地促进了生态位和中性（niche and neutral）对群落组装影响的推断[16，17]。trans_nullmodel class提供了一个封装，包括对系统发育信号、beta平均成对系统发育距离（beta mean pairwise phylogenetic distance，betaMPD）、beta平均最近分类单元距离（beta mean nearest taxon distance，betaMNTD）、beta最近分类单元指数（beta nearest taxon index，betaNTI）、beta净相关指数（beta net relatedness index，betaNRI）和基于Bray-Curtis的Raup-Crick（Bray-Curtis-based Raup-Crick，RCbray）的计算。系统发育信号分析的方法基于mantel相关图（mantel correlogram）[18]，与其他方法相比，系统发育信号的变化是直观而清晰的。betaMNTD和betaMPD的算法已经过优化，比picante包中的算法更快[3]。RCbray和betaNTI（或betaNRI）之间的组合可用于推断在特定假设下支配群落装配（community assembly）的每个生态过程（ecological process）的强度[17]。这可以通过函数cal_process()来解析每个推断进程（ecological process）的百分比来实现。<font color=#2196F3 ><strong>我们首先检查系统发育信号：</strong></font></p>\n <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># generate trans_nullmodel object; use 10000 OTUs as example</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_nullmodel<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">,</span> taxa_number <span class=\"operator\">=</span> <span class=\"number\">10000</span><span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># use TOC as the test variable (__报错：Error in cor(as.vector(xdis), ydis, method = method, use = use) : </span></span><br><span class=\"line\">  cov<span class=\"operator\">/</span>cor中有遗漏值__<span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_mantel_corr<span class=\"punctuation\">(</span>use_env <span class=\"operator\">=</span> <span class=\"string\">&quot;TOC&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_mantel_corr</span></span><br><span class=\"line\"><span class=\"comment\"># plot the mantel correlogram(__报错：Error in names(x) &lt;- value : &#x27;names&#x27;属性的长度[4]必需和矢量的长度[0]一样__)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_mantel_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>betaNRI（ses.betampd）用于显示“basal”系统发育转换（phylogenetic turnover）[18]。与betaNTI相比，它能捕获更多与深层系统发育（deep phylogeny）相关的转换信息（turnover information）。值得注意的是，经过几十年的发展，出现了许多空模型（null models）。在trans-nullmodel class中，我们随机化了物种的系统发育相关性。这种洗牌方法（shuffling approach）固定了观察到的物种α-多样性和β-多样性的水平，以探讨观察到的系统发育转换是否与空模型（物种间的系统发育关系是随机的）显著不同。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 运行500次null model</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_ses_betampd<span class=\"punctuation\">(</span>runs<span class=\"operator\">=</span><span class=\"number\">500</span><span class=\"punctuation\">,</span> abundance.weighted <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 返回t1$res_ses_betampd</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>可以使用trans_beta class中的plot_group_distance function绘制betaNRI图。结果表明T20和T21的平均betaNRI 显著高于其它三者，表明T20和T21中的basal phylogenetic turnover是高的。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 将betaNRI矩阵加入到beta_diversity列表中</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">[[</span><span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>res_ses_betampd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用measure &quot;betaNRI&quot;创建trans_beta class</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># transform the distance for each group</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果可视化</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">&lt;-</span> t2<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/betaNRI_all.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/betaNRI_all.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"betaNRI all\"></p>\n<ul>\n<li><p>若要单独的对每个组进行 null model analysis，例如每个组作为一个物种池（species pool），我们可以分别为每个组计算结果。 我们发现，当分别对每个组进行betaNRI 分析时，CW和TW间的mean betaNRI没有显著差异，且二者均显著高于IW ，揭示了在将每个区域视为特定物种库的条件下，CW和TW中变量选择的强度（strength of variable selection）可能相似。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建一个列表用于存放trans_nullmodel的结果</span></span><br><span class=\"line\">sesbeta_each <span class=\"operator\">&lt;-</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">group_col <span class=\"operator\">&lt;-</span> <span class=\"string\">&quot;Site&quot;</span></span><br><span class=\"line\">all_groups <span class=\"operator\">&lt;-</span> unique<span class=\"punctuation\">(</span>meco_dataset<span class=\"operator\">$</span>sample_table<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> group_col<span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 对每个组分别进行计算</span></span><br><span class=\"line\"><span class=\"keyword\">for</span><span class=\"punctuation\">(</span>i <span class=\"keyword\">in</span> all_groups<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\"># like the above operation, but need provide &#x27;group&#x27; and &#x27;select_group&#x27;</span></span><br><span class=\"line\">\ttest <span class=\"operator\">&lt;-</span> trans_nullmodel<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> group_col<span class=\"punctuation\">,</span> select_group <span class=\"operator\">=</span> i<span class=\"punctuation\">,</span> taxa_number <span class=\"operator\">=</span> <span class=\"number\">1000</span><span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data<span class=\"punctuation\">)</span></span><br><span class=\"line\">\ttest<span class=\"operator\">$</span>cal_ses_betampd<span class=\"punctuation\">(</span>runs <span class=\"operator\">=</span> <span class=\"number\">500</span><span class=\"punctuation\">,</span> abundance.weighted <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">\tsesbeta_each<span class=\"punctuation\">[[</span>i<span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> test<span class=\"operator\">$</span>res_ses_betampd</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并结果并重塑（reshape），得到一个对称矩阵（symmetrical matrix）</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>reshape2<span class=\"punctuation\">)</span></span><br><span class=\"line\">test <span class=\"operator\">&lt;-</span> lapply<span class=\"punctuation\">(</span>sesbeta_each<span class=\"punctuation\">,</span> melt<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> do.call<span class=\"punctuation\">(</span>rbind<span class=\"punctuation\">,</span> .<span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> reshape2<span class=\"operator\">::</span>dcast<span class=\"punctuation\">(</span>.<span class=\"punctuation\">,</span> Var1<span class=\"operator\">~</span>Var2<span class=\"punctuation\">,</span> value.var <span class=\"operator\">=</span> <span class=\"string\">&quot;value&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> `row.names&lt;-`<span class=\"punctuation\">(</span>.<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> .<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"operator\">-</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> drop <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如同上述操作</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">[[</span><span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> test</span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;betaNRI&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">&lt;-</span> t2<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"#/images/lujia/betaNRI_individual.jpg\" class=\"lazyload placeholder\" data-srcset=\"#/images/lujia/betaNRI_individual.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"betaNRI individual\"></p>\n<ul>\n<li><p>BetaNTI(ses.betamntd) 可用于指示系统发育的末端转换（ phylogenetic terminal turnover） [17]</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 运行500次null model</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_ses_betamntd<span class=\"punctuation\">(</span>runs<span class=\"operator\">=</span><span class=\"number\">500</span><span class=\"punctuation\">,</span> abundance.weighted <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 返回t1$res_ses_betamntd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将betaNTI矩阵加入到beta_diversity列表中</span></span><br><span class=\"line\">meco_dataset<span class=\"operator\">$</span>beta_diversity<span class=\"punctuation\">[[</span><span class=\"string\">&quot;betaNTI&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">]</span> <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>res_ses_betamntd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用measure &quot;betaNRI&quot;创建trans_beta class</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_beta<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> <span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> measure <span class=\"operator\">=</span> <span class=\"string\">&quot;betaNTI&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># transform the distance for each group</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_group_distance<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果可视化</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ggplot2<span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">&lt;-</span> t2<span class=\"operator\">$</span>plot_group_distance<span class=\"punctuation\">(</span>distance_pair_stat <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">g1 <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"operator\">-</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_hline<span class=\"punctuation\">(</span>yintercept <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>cal_rcbray()功能用于计算RCbray (Bray-Curtis-based Raup-Crick) ，以评估成分转换（compositional turnover）是否主要受漂移控制[19]。我们应用空模型（null model）通过从每个物种池中随机采样个体来模拟物种分布，同时保留物种发生频率（species occurrence frequency）和样本物种丰富度（sample species richness）[18]。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># result stored in t1$res_rcbray</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_rcbray<span class=\"punctuation\">(</span>runs <span class=\"operator\">=</span> <span class=\"number\">1000</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_rcbray</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>作为一个例子，我们还计算了引用文献[17，18]中所示的在群落组装（community assembly）上推断过程（ inferred processes ）所占的比例。在此示例中，具有显着betaNTI值（|βNTI|&gt; 2）的成对比较部分是估计的选择（Selection）造成影响； βNTI&gt; 2代表异构选择（heterogeneous ）； βNTI&lt;-2表示同质选择（homogeneous ）。 RCbray值表征了随机分配（randomization）下观察到的Bray-Curtis和Bray-Curtis期望值之间的偏差大小（magnitude of deviation）。 | RCbray | &gt; 0.95被认为是显着的。 |βNTI| &lt; 2和RCbray &gt; +0.95被视为受散播限制（Dispersal Limitation）与漂移（Drift）相结合的影响。 |βNTI| &lt; 2和RCbray &lt; -0.95被视为均质分散（Homogenizing Dispersal）影响的估计值。 |βNTI| &lt; 2和|RCbray| &lt; 0.95估算了漂移单独作用的影响。</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># use betaNTI and rcbray to evaluate processes</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_process<span class=\"punctuation\">(</span>use_betamntd <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_process</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>res_process</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>process</th>\n<th>percentage</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>variable selection</td>\n<td>0.4341164</td>\n</tr>\n<tr>\n<td>2</td>\n<td>homogeneous selection</td>\n<td>63.6874362</td>\n</tr>\n<tr>\n<td>3</td>\n<td>dispersal limitation</td>\n<td>0.0000000</td>\n</tr>\n<tr>\n<td>4</td>\n<td>homogeneous dispersal</td>\n<td>14.8365679</td>\n</tr>\n<tr>\n<td>5</td>\n<td>drift</td>\n<td>21.0418795</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<h1 id=\"14-trans-network-class\"><a href=\"#14-trans-network-class\" class=\"headerlink\" title=\"14. trans_network class\"></a><font color=#FF0000 >14. trans_network class</font></h1><h2 id=\"correlation-based-network\"><a href=\"#correlation-based-network\" class=\"headerlink\" title=\"correlation-based network\"></a><font color=#FF9800 >correlation-based network</font></h2><ul>\n<li>准备R包并进行计算相关性  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;WGCNA&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>WGCNA<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 以下3选1</span></span><br><span class=\"line\"><span class=\"comment\"># 1. Use R base cor.test, slow</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_network<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> cal_cor <span class=\"operator\">=</span> <span class=\"string\">&quot;base&quot;</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;OTU&quot;</span><span class=\"punctuation\">,</span> filter_thres <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span> cor_method <span class=\"operator\">=</span> <span class=\"string\">&quot;spearman&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_cor_p list; one table: correlation; another: p value</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. SparCC method, require SpiecEasi package</span></span><br><span class=\"line\"><span class=\"comment\"># SparCC is very slow, so consider filtering more species with low abundance</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_network<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> meco_dataset<span class=\"punctuation\">,</span> cal_cor <span class=\"operator\">=</span> <span class=\"string\">&quot;SparCC&quot;</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;OTU&quot;</span><span class=\"punctuation\">,</span> filter_thres <span class=\"operator\">=</span> <span class=\"number\">0.001</span><span class=\"punctuation\">,</span> SparCC_simu_num <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. When the OTU number is large, use R WGCNA package to replace R base to calculate correlations</span></span><br><span class=\"line\"><span class=\"comment\"># require WGCNA package</span></span><br><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_network<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> dataset<span class=\"punctuation\">,</span> cal_cor <span class=\"operator\">=</span> <span class=\"string\">&quot;WGCNA&quot;</span><span class=\"punctuation\">,</span> taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;OTU&quot;</span><span class=\"punctuation\">,</span> filter_thres <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span> cor_method <span class=\"operator\">=</span> <span class=\"string\">&quot;spearman&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"构建网络\"><a href=\"#构建网络\" class=\"headerlink\" title=\"构建网络\"></a><font color=#FF9800 >构建网络</font></h2><ul>\n<li><p>COR_optimization &#x3D; TRUE represent using RMT theory to find the optimized correlation threshold instead of the COR_cut.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># construct network; require igraph package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_network<span class=\"punctuation\">(</span>p_thres <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span> COR_optimization <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_network</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (可选) use arbitrary coefficient threshold to contruct network</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_network<span class=\"punctuation\">(</span>p_thres <span class=\"operator\">=</span> <span class=\"number\">0.01</span><span class=\"punctuation\">,</span> COR_cut <span class=\"operator\">=</span> <span class=\"number\">0.73</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save network</span></span><br><span class=\"line\"><span class=\"comment\"># open the gexf file using Gephi(https://gephi.org/)</span></span><br><span class=\"line\"><span class=\"comment\"># require rgexf package</span></span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;rgexf&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>save_network<span class=\"punctuation\">(</span>filepath <span class=\"operator\">=</span> <span class=\"string\">&quot;network.gexf&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Now, we show the node colors with the Phylum information and the edges colors with the positive and negative correlations. All the data used has been stored in the network.gexf file, including modules classifications, Phylum information and edges classifications.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate network attributes</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_network_attr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_network_attr</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># classify the node; return t1$res_node_type</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_node_type<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_node_type</span></span><br><span class=\"line\"><span class=\"comment\"># we retain the file for the following example in trans_func part</span></span><br><span class=\"line\">network_node_type <span class=\"operator\">&lt;-</span> t1<span class=\"operator\">$</span>res_node_type</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># plot node roles in terms of the within-module connectivity and among-module connectivity</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_taxa_roles<span class=\"punctuation\">(</span>use_type <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># plot node roles with phylum information</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_taxa_roles<span class=\"punctuation\">(</span>use_type <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Now, we show the eigengene analysis of modules. The eigengene of a module, i.e. the first principal component of PCA, represents the main variance of the abundance in the species of the module.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1<span class=\"operator\">$</span>cal_eigen<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_eigen</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>出错了</strong>！Then we perform correlation heatmap to show the relationships between eigengenes and environmental factors.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># create trans_env object like the above operation</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_env<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>dataset <span class=\"operator\">=</span> dataset<span class=\"punctuation\">,</span> add_data <span class=\"operator\">=</span> env_data_16S<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span> <span class=\"number\">4</span><span class=\"operator\">:</span><span class=\"number\">11</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># calculate correlations</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_cor<span class=\"punctuation\">(</span>add_abund_table <span class=\"operator\">=</span> t1<span class=\"operator\">$</span>res_eigen<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># plot the correlation heatmap</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>plot_corr<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>The function cal_sum_links() is used to sum the links (edge) number from one taxa to another or in the same taxa. The function plot_sum_links() is used to show the result from the function cal_sum_links(). This is very useful to fast see how many nodes are connected between different taxa or within one taxa. In terms of “Phylum” level in the tutorial, the function cal_sum_links() sum the linkages number from one Phylum to another Phylum or the linkages in the same Phylum. So the numbers along the outside of the circular plot represent how many edges or linkages are related with the Phylum. For example, in terms of Proteobacteria, there are roughly total 900 edges associated with the OTUs in Proteobacteria, in which roughly 200 edges connect both OTUs in Proteobacteria and roughly 150 edges connect the OTUs from Proteobacteria with the OTUs from Chloroflexi.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devtools<span class=\"operator\">::</span>install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;mattflor/chorddiag&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># calculate the links between or within taxonomic ranks (报错：Error in ecount(network) : 没有&quot;ecount&quot;这个函数)</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_sum_links<span class=\"punctuation\">(</span>taxa_level <span class=\"operator\">=</span> <span class=\"string\">&quot;Phylum&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t1$res_sum_links_pos and t1$res_sum_links_neg</span></span><br><span class=\"line\"><span class=\"comment\"># require chorddiag package</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>plot_sum_links<span class=\"punctuation\">(</span>plot_pos <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> plot_num <span class=\"operator\">=</span> <span class=\"number\">10</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"15-trans-func-class\"><a href=\"#15-trans-func-class\" class=\"headerlink\" title=\"15. trans_func class\"></a><font color=#FF0000 >15. trans_func class</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Identify microbial traits</span></span><br><span class=\"line\"><span class=\"comment\"># create object of trans_func</span></span><br><span class=\"line\">t2 <span class=\"operator\">&lt;-</span> trans_func<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># mapping the taxonomy to the database</span></span><br><span class=\"line\"><span class=\"comment\"># the function can recognize prokaryotes or fungi automatically</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_spe_func<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t2$res_spe_func, 1 represent function exists, 0 represent no or cannot confirmed.</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>The percentages of the OTUs having the same trait can reflect the functional redundancy of this function in the community or the module in the network.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># calculate the percentages of OTUs for each trait in each module of network</span></span><br><span class=\"line\"><span class=\"comment\"># use_community = FALSE represent calculating module, not community, node_type_table provide the module information</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>cal_spe_func_perc<span class=\"punctuation\">(</span>use_community <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> node_type_table <span class=\"operator\">=</span> network_node_type<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return t2$res_spe_func_perc</span></span><br><span class=\"line\"><span class=\"comment\"># we only plot some important traits, so we use the default group list to filter and show the traits.</span></span><br><span class=\"line\">t2<span class=\"operator\">$</span>plot_spe_func_perc<span class=\"punctuation\">(</span>select_samples <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;M&quot;</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">10</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># M represents module, ordered by the nodes number from high to low</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Tax4Fun requires a strict input file demand on the taxonomic information. To analyze the trimmed or changed OTU data in R with Tax4Fun, we provide a link to the Tax4Fun functional prediction.</p>\n  <figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 <span class=\"operator\">&lt;-</span> trans_func<span class=\"operator\">$</span>new<span class=\"punctuation\">(</span>meco_dataset<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># install Tax4Fun package and download SILVA123 ref data from  http://tax4fun.gobics.de/</span></span><br><span class=\"line\">wget https<span class=\"operator\">:</span><span class=\"operator\">/</span><span class=\"operator\">/</span>github.com<span class=\"operator\">/</span>bwemheu<span class=\"operator\">/</span>Tax4Fun2<span class=\"operator\">/</span>releases<span class=\"operator\">/</span>download<span class=\"operator\">/</span><span class=\"number\">1.1</span>.5<span class=\"operator\">/</span>Tax4Fun2_1.1.5.tar.gz</span><br><span class=\"line\">install.packages<span class=\"punctuation\">(</span>pkgs <span class=\"operator\">=</span> <span class=\"string\">&quot;Tax4Fun2_1.1.5.tar.gz&quot;</span><span class=\"punctuation\">,</span> repos <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> source <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># decompress SILVA123; provide path in folderReferenceData as you put</span></span><br><span class=\"line\">t1<span class=\"operator\">$</span>cal_tax4fun<span class=\"punctuation\">(</span>folderReferenceData <span class=\"operator\">=</span> <span class=\"string\">&quot;./SILVA123&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># return two files: t1$tax4fun_KO: KO file; t1$tax4fun_path: pathway file.</span></span><br><span class=\"line\"><span class=\"comment\"># t1$tax4fun_KO$Tax4FunProfile[1:5, 1:2]</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"16-知识点\"><a href=\"#16-知识点\" class=\"headerlink\" title=\"16. 知识点\"></a><font color=#FF0000 >16. 知识点</font></h1><h2 id=\"确定性过程和随机过程\"><a href=\"#确定性过程和随机过程\" class=\"headerlink\" title=\"确定性过程和随机过程\"></a><font color=#FF9800 >确定性过程和随机过程</font></h2><ul>\n<li><p>The term <font color=#2196F3 size=5><b>“deterministic process”</b></font> refers to two types of selective forces, namely, those that lead to either more (i.e. homogeneous selection) or less (i.e. heterogeneous selection) similar structures among communities due to homogeneous and heterogeneous environmental pressures, respectively (Zhou &amp; Ning, 2017).  <font color=#2196F3 size=5><b>确定性过程</b></font>包括两种选择力，即分别导致更加相似（即同质选择）或更少相似（即异质选择）的群落间的结构的同质和异质环境压力。</p>\n</li>\n<li><p>The term<font color=#2196F3 size=5><b> “stochastic process” </b></font>refers to homogenizing dispersal, dispersal limitation (combined with drift) and pure drift, which can obscure the turnover among microbial communities due to high dispersal; low dispersal; and random changes in birth, death and reproduction, respectively (Zhou &amp; Ning, 2017). <font color=#2196F3 size=5><b>随机过程</b></font>是指均匀分散、分散限制（结合漂变）和纯漂变，它们可以通过高度分散、低分散和出生、死亡和繁殖的随机变化来掩盖&#x2F;减弱微生物群落之间的更替。</p>\n</li>\n</ul>\n<p><img src=\"/images/lujia/nullmodel.png\" alt=\"Community assembly processes by Stegen *et al.* https://www.nature.com/articles/ismej201393\n\"></p>\n<ul>\n<li>An NTI of &gt;+2 indicates that the ASVs in a local community are more closely related than expected by chance, suggesting the role of selective pressures (e.g. environmental conditions) in phylogenetic clustering. An NTI of &lt;−2 represents phylogenetic overdispersion, indicating two possible biotic interactions: competition and facilitation. In contrast, a mean NTI across multiple communities that is significantly greater or less than zero indicates phylogenetic clustering or overdispersion, respectively (Zhou &amp; Ning, 2017). NTI &gt;2表明，在一个地方群落中，ASVs的亲缘关系比预期的更为密切，表明选择压力（如环境条件）在系统发育聚类中的作用。NTI &lt;-2表示系统发育过度分散，表明两种可能的生物相互作用：竞争和促进。相反，多个群落间的平均NTI显著大于或小于零，分别表明系统发育聚类或过度分散（Zhou和Ning，2017）。</li>\n<li>βNTI&gt;+2 or &lt;−2 signified heterogeneous selection or homogeneous selection, respectively. βNTI&gt;+2 or &lt;−2 分别指示异质选择和同质选择。</li>\n</ul>\n<h1 id=\"17-参考\"><a href=\"#17-参考\" class=\"headerlink\" title=\"17. 参考\"></a><font color=#FF0000 >17. 参考</font></h1><ul>\n<li><a href=\"https://chiliubio.github.io/microeco/\">https://chiliubio.github.io/microeco/</a></li>\n<li>Zhou, J., &amp; Ning, D. (2017). Stochastic community assembly: Does it matter in microbial ecology? Microbiology and Molecular Biology Reviews, 81(4), e00002–17. <a href=\"https://doi.org/10.1128/MMBR.00002%E2%80%9017\">https://doi.org/10.1128/MMBR.00002‐17</a></li>\n<li><a href=\"http://www.360doc.com/content/20/1223/07/71874948_952966442.shtml\">http://www.360doc.com/content/20/1223/07/71874948_952966442.shtml</a></li>\n</ul>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"}]},{"title":"扩增子分析--计算随机过程和决定性过程比例","slug":"扩增子分析-计算随机过程和决定性过程比例","date":"2021-03-25T08:42:06.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子分析-计算随机过程和决定性过程比例.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>确定性过程（deterministic processes）和随机性过程（stochastic processes)是两个影响微生物群落结构系统发育组装的重要过程，本文介绍计算二者所占比例的方法。</p>\n<span id=\"more\"></span>\n<h1 id=\"1-软件\"><a href=\"#1-软件\" class=\"headerlink\" title=\"1. 软件\"></a><font color=#FF0000 >1. 软件</font></h1><ul>\n<li>NST</li>\n<li>iCAMP</li>\n<li>ape 用于读取进化树文件</li>\n<li>picante</li>\n</ul>\n<h1 id=\"2-文件准备\"><a href=\"#2-文件准备\" class=\"headerlink\" title=\"2. 文件准备\"></a><font color=#FF0000 >2. 文件准备</font></h1><h2 id=\"2-1-Feature-Table\"><a href=\"#2-1-Feature-Table\" class=\"headerlink\" title=\"2.1 Feature Table\"></a><font color=#FF0000 >2.1 Feature Table</font></h2><p>行为OTUs&#x2F;ASVs，列为样本。</p>\n<table>\n<thead>\n<tr>\n<th>TaxonID</th>\n<th>Sample 1</th>\n<th>Sample 2</th>\n<th>Sample 3</th>\n<th>Sample 4</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OTU1</td>\n<td>232.0</td>\n<td>209.0</td>\n<td>349.0</td>\n<td>256.0</td>\n</tr>\n<tr>\n<td>OTU2</td>\n<td>75.0</td>\n<td>35.0</td>\n<td>44.0</td>\n<td>0.0</td>\n</tr>\n<tr>\n<td>OTU3</td>\n<td>237.0</td>\n<td>224.0</td>\n<td>291.0</td>\n<td>353.0</td>\n</tr>\n<tr>\n<td>OTU4</td>\n<td>371.0</td>\n<td>80.0</td>\n<td>319.0</td>\n<td>345.0</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-2-Group-File\"><a href=\"#2-2-Group-File\" class=\"headerlink\" title=\"2.2 Group File\"></a><font color=#FF0000 >2.2 Group File</font></h2><p>该文件描述了所有样本的分组情况，如实验组和对照组，或者其他分组。</p>\n<table>\n<thead>\n<tr>\n<th>Sample_ID</th>\n<th>Group</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Sample 1</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 2</td>\n<td>Group x</td>\n</tr>\n<tr>\n<td>Sample 3</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>Sample 4</td>\n<td>Group y</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-3-Tree-File\"><a href=\"#2-3-Tree-File\" class=\"headerlink\" title=\"2.3 Tree File\"></a><font color=#FF0000 >2.3 Tree File</font></h2><p>包含Feature table中所有OTUs&#x2F;ASVs的系统发育树文件，理想条件下仅包含Feature table中的OTUs&#x2F;ASVs，不过大部分情况下还会包含数据库中的一些物种，在随后的分析中需要去除多余的物种（后续会讲到）。</p>\n<h1 id=\"3-开始分析\"><a href=\"#3-开始分析\" class=\"headerlink\" title=\"3. 开始分析\"></a><font color=#FF0000 >3. 开始分析</font></h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">########################</span></span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># version 20200919</span></span><br><span class=\"line\"><span class=\"comment\"># Step 1. 文件、路径和参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定包含输入文件的目录路径，注意区分Windows和Linux的路径写法</span></span><br><span class=\"line\">wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定结果文件的保存路径</span></span><br><span class=\"line\">save.wd<span class=\"operator\">=</span><span class=\"string\">&quot;/mnt/e/Researches/lujia16S/Analysis_20200907/exported-feature-table_2k_abund22/Raup_Crick/Result2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建文件保存路径</span></span><br><span class=\"line\">dir.create<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span> recursive <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定Feature table（OTU表）的文件名</span></span><br><span class=\"line\">com.file<span class=\"operator\">=</span><span class=\"string\">&quot;feature-table.tsv&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定样本分组文件，每行为一个样本</span></span><br><span class=\"line\">group.file<span class=\"operator\">=</span><span class=\"string\">&quot;treatment.txt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定NWK格式的系统发育树文件</span></span><br><span class=\"line\">tree.file<span class=\"operator\">=</span><span class=\"string\">&quot;tree.nwk&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置并行运算使用的线程数</span></span><br><span class=\"line\">nworker<span class=\"operator\">=</span><span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># randomization time for null model analysis. 真实分析的时候一般设置为1000，如果测试的话可以设20</span></span><br><span class=\"line\">rand.time<span class=\"operator\">=</span><span class=\"number\">999</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出文件的前缀名，随便设置</span></span><br><span class=\"line\">prefix<span class=\"operator\">=</span><span class=\"string\">&quot;Lujia&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 2. 加载R包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 确保已经安装过所需的R包</span></span><br><span class=\"line\"><span class=\"comment\">#install.packages(&quot;NST&quot;) </span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>ape<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>iCAMP<span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>NST<span class=\"punctuation\">)</span> <span class=\"comment\"># need to be NST &gt;=3.0.3</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 3. 加载数据并匹配IDs</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入Feature Table，注意自己文件的列与列之间的分隔符是什么，制表符用sep = &quot;\\t&quot;，逗号用sep = &quot;,&quot;</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>read.table<span class=\"punctuation\">(</span>com.file<span class=\"punctuation\">,</span>header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读入分组文件，同样注意设置分隔符</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span>group.file<span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果tree中的OTUs和Feature Table中的OTUs一一对应，可以直接用下面一个命令读入tree（注意去掉###），否则的话则运行下面LHL加入的3行命令</span></span><br><span class=\"line\"><span class=\"comment\">###tree=ape::read.tree(file = tree.file) # if you have tree</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下3行是LHL加入的</span></span><br><span class=\"line\">phy<span class=\"operator\">&lt;-</span>read.tree<span class=\"punctuation\">(</span>tree.file<span class=\"punctuation\">)</span><span class=\"comment\"># 读入树文件</span></span><br><span class=\"line\">prune_tree<span class=\"operator\">&lt;-</span>prune.sample<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">,</span>phy<span class=\"punctuation\">)</span><span class=\"comment\"># 使树文件和OTU表文件一一对齐</span></span><br><span class=\"line\">tree<span class=\"operator\">=</span>prune_tree <span class=\"comment\"># 此刻的Tree干净了，可用于后续分析而不会报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的样本名称是否与分组文件中的样本名一一对应</span></span><br><span class=\"line\">samp.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>rn.list<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span>group<span class=\"operator\">=</span>group<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span>colSums<span class=\"punctuation\">(</span>comm<span class=\"punctuation\">)</span><span class=\"operator\">&gt;</span><span class=\"number\">0</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">group<span class=\"operator\">=</span>samp.ck<span class=\"operator\">$</span>group</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下命令检测Feature Table中的OTUs名称是否与Tree中的OTUs名一一对应</span></span><br><span class=\"line\">tax.ck<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>match.name<span class=\"punctuation\">(</span>cn.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>tree.list <span class=\"operator\">=</span> <span class=\"built_in\">list</span><span class=\"punctuation\">(</span>tree<span class=\"operator\">=</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"comment\"># if you have tree</span></span><br><span class=\"line\">comm<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>comm</span><br><span class=\"line\">tree<span class=\"operator\">=</span>tax.ck<span class=\"operator\">$</span>tree</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 4. Grouping way and metacommunity seting</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选择分组，如果拥有多种分组方式，每次运行时选择其中的一组。此处选择的时分组文件中的第二列</span></span><br><span class=\"line\">groupi<span class=\"operator\">=</span>group<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>drop<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重新定义输出文件的前缀，以分组的名称来命名，此处以分组文件第二列的表头“Group”为前缀</span></span><br><span class=\"line\">prefixi<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>prefix<span class=\"punctuation\">,</span><span class=\"string\">&quot;.Group&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if treatment and control are from different metacommunities, you may set meta.groupi=groupi，默认为NULL</span></span><br><span class=\"line\"><span class=\"comment\">#meta.groupi=NULL</span></span><br><span class=\"line\">meta.groupi<span class=\"operator\">=</span>groupi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5. taxonomic NST</span></span><br><span class=\"line\"><span class=\"comment\"># Step 5.1 calculate tNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定计算距离矩阵的方法，&quot;jaccard&quot; and &quot;bray&quot; are preferred.</span></span><br><span class=\"line\">dist.method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录运行时间</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入输出目录</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算tNST</span></span><br><span class=\"line\">tnst<span class=\"operator\">=</span>tNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> meta.com<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> dist.method<span class=\"operator\">=</span>dist.method<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> LB<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> null.model<span class=\"operator\">=</span><span class=\"string\">&quot;PF&quot;</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以R data格式保存tNST的输出 </span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnst<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存其他tNST结果到多个文件中</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span> file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span> <span class=\"string\">&quot;.tNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.2 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bootstrapping</span></span><br><span class=\"line\">tnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>tnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存结果</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 5.3 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">tnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>tnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>tnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.tNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Steo 6. phylogenetic NST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.1 phylogentic distance matrix # use bigmemory for big dataset</span></span><br><span class=\"line\"></span><br><span class=\"line\">wd.pd<span class=\"operator\">=</span>paste0<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">,</span><span class=\"string\">&quot;/pdbig&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>dir.exists<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span>dir.create<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>wd.pd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span>file.exists<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.desc&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\"># if already done before, directly use it.</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span><span class=\"built_in\">list</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>tip.label<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> header <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> as.is <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.wd<span class=\"operator\">=</span>wd.pd</span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.desc&quot;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">$</span>pd.name.file<span class=\"operator\">=</span><span class=\"string\">&quot;pd.taxon.name.csv&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"keyword\">else</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  pdbig<span class=\"operator\">=</span>iCAMP<span class=\"operator\">::</span>pdist.big<span class=\"punctuation\">(</span>tree <span class=\"operator\">=</span> tree<span class=\"punctuation\">,</span> wd <span class=\"operator\">=</span> wd.pd<span class=\"punctuation\">,</span> nworker <span class=\"operator\">=</span> nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.2 calculate pNST</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># to count time cost</span></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span>save.wd<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnst<span class=\"operator\">=</span>NST<span class=\"operator\">::</span>pNST<span class=\"punctuation\">(</span>comm<span class=\"operator\">=</span>comm<span class=\"punctuation\">,</span> pd.desc<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.file<span class=\"punctuation\">,</span> pd.wd<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>pd.wd<span class=\"punctuation\">,</span></span><br><span class=\"line\">pd.spname<span class=\"operator\">=</span>pdbig<span class=\"operator\">$</span>tip.label<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> meta.group<span class=\"operator\">=</span>meta.groupi<span class=\"punctuation\">,</span> abundance.weighted<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> output.rand<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> taxo.null.model<span class=\"operator\">=</span><span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> phylo.shuffle<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> exclude.conspecifics<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> SES<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> RC<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># save pNST output in R data format</span></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnst<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.grp<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.index.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.between.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnst<span class=\"operator\">$</span>index.pair.between<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.pairwise.between.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.3 Bootstrapping test</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstbt<span class=\"operator\">=</span>nst.boot<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group<span class=\"operator\">=</span>groupi<span class=\"punctuation\">,</span> rand<span class=\"operator\">=</span>rand.time<span class=\"punctuation\">,</span> trace<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> two.tail<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> out.detail<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> between.group<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> nworker<span class=\"operator\">=</span>nworker<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">save<span class=\"punctuation\">(</span>pnstbt<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.rda&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>summary<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.summary.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstbt<span class=\"operator\">$</span>compare<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.boot.compare.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 6.4 PERMANOVA</span></span><br><span class=\"line\"></span><br><span class=\"line\">t1<span class=\"operator\">=</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pnstpaov<span class=\"operator\">=</span>nst.panova<span class=\"punctuation\">(</span>nst.result<span class=\"operator\">=</span>pnst<span class=\"punctuation\">,</span> group <span class=\"operator\">=</span> groupi<span class=\"punctuation\">,</span> rand <span class=\"operator\">=</span> rand.time<span class=\"punctuation\">,</span> trace <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>pnstpaov<span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> paste0<span class=\"punctuation\">(</span>prefixi<span class=\"punctuation\">,</span><span class=\"string\">&quot;.pNST.PERMANOVA.csv&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>t<span class=\"operator\">=</span>format<span class=\"punctuation\">(</span>Sys.time<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span><span class=\"operator\">-</span>t1<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-结果解读\"><a href=\"#4-结果解读\" class=\"headerlink\" title=\"4. 结果解读\"></a><font color=#FF0000 >4. 结果解读</font></h1><h2 id=\"4-1-确定性过程和随机性过程的相对重要性\"><a href=\"#4-1-确定性过程和随机性过程的相对重要性\" class=\"headerlink\" title=\"4.1 确定性过程和随机性过程的相对重要性\"></a><font color=#FF0000 >4.1 确定性过程和随机性过程的相对重要性</font></h2><ul>\n<li><p>An index, normalized stochasticity ratio (NST), was developed with 50% as the boundary point between more deterministic (&lt;50%) and more stochastic (&gt;50%) assembly. <font color=#2196F3>NST &gt; 50%时Stochastic Processes占主导，而NST &lt; 50%时，Deterministic Processes占主导。</font></p>\n</li>\n<li><p>用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。用显著的偏差(即|β NTI| &gt; 2)来表示确定性过程占主导地位和用小的偏差(即|β NTI| &lt; 2)来表明随机过程占主导地位。同质性和变异性选择应分别造成小于和大于预期的群落更替;βNTI &lt;−2或&gt; + 2进一步解释为表明同质性或变异性选择分别占主导地位;</p>\n</li>\n</ul>\n<h2 id=\"4-2-通过RCbray判断随机过程中各种过程的贡献\"><a href=\"#4-2-通过RCbray判断随机过程中各种过程的贡献\" class=\"headerlink\" title=\"4.2 通过RCbray判断随机过程中各种过程的贡献\"></a><font color=#FF0000 >4.2 通过RCbray判断随机过程中各种过程的贡献</font></h2><p>Modified Raup-Crick index (RCbray) is subsequently calculated by comparing empirically observed Bray-Curtis and simulated null distribution. Thus, according to themodified Raup-Crick index (RCbray), stochastic processes could be classified into 3 ecological processes: 均质分散homogenizing dispersal (RCbray &lt; −0.95), 分散限制dispersal limitation (RCbray &gt; +0.95) and 生态漂变ecological drift (−0.95&lt; RCbray &lt; +0.95) <a href=\"https://doi.org/10.1038/ismej.2012.22\">Stegen et al., 2012</a>;  <a href=\"https://doi.org/10.1038/ismej.2013.93\">Stegen et al., 2013</a>.</p>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"}]},{"title":"扩增子可视化专题","slug":"扩增子可视化专题","date":"2021-09-15T03:23:28.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子可视化专题.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>扩增子分析较常用的软件是QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将QIIME2生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p>\n<h1 id=\"准备数据\"><a href=\"#准备数据\" class=\"headerlink\" title=\"准备数据\"></a>准备数据</h1><ul>\n<li>特征表（Feature table），或者叫做OTU表，本教程中文件名为<strong>feature-table.tsv</strong>。该文件可由QIIME2生成，由biome格式转换而来。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tF01\tF02\tF03\tF04\tF05\tF06\tH2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>6</span><br><span class=\"line\">3733c766539aba5e3e8f964a5ba39048\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">547715c94c5b0c7ba2049658f732397b\t0.0\t0.0\t0.0\t6.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">708c69ff1252447c0709333304cd9bed\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t5.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">344ee69a9e51ffac2811294d3f04833d\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t7.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">d2e467b7867f49c25caaacdea5c7eb43\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t18.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">4adc9b2b0866f620425d07d3ff7ca7e2\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t8.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">0ffcdef70b9c1436126ba32d7a40d961\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t31.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">7170ce6c7520acc3c13189478aea54a8\t53.0\t0.0\t0.0\t0.0\t0.0\t0.0\t37.0\t25.0\t0.0\t0.0\t0.0\t0.0\t23.0\t21.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">b624986630f3d33fbe0a21e66c46d1a5\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t9.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">78305c3f5955043aba7de952c78859c9\t0.0\t0.0\t22.0\t57.0\t73.0\t55.0\t0.0\t0.0\t0.0\t82.0\t73.0\t0.0\t0.0\t0.0\t43.0\t132.0\t82.0\t95.0</span><br><span class=\"line\">60d9992b10f6dd4da4dc53826b7433f5\t0.0\t0.0\t0.0\t0.0\t45.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br><span class=\"line\">33468988848349138af5cb1c23b550f2\t0.0\t2.0\t11.0\t12.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0\t0.0</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>样本元数据（Metadata），本教程中文件名为<strong>sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ID\tSamples\tLayer\tDepth\tDepth2\tLocation\tPosition\tSite</span><br><span class=\"line\">F01\tF01\t0-5\t5\t05 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F02\tF02\t5-9\t10\t10 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F03\tF03\t9-13\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F04\tF04\t13-17\t15\t15 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F05\tF05\t17-22\t20\t20 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">F06\tF06\t22-26\t25\t25 cmbsf\tTurn\tUpstream\tF</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>1\tH2<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>2\tH2<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>3\tH2<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>4\tH2<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>5\tH2<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">H2<span class=\"built_in\">_</span>6\tH2<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tH2</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>1\tI1<span class=\"built_in\">_</span>1\t0-5\t5\t05 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>2\tI1<span class=\"built_in\">_</span>2\t5-10\t10\t10 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>3\tI1<span class=\"built_in\">_</span>3\t10-15\t15\t15 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>4\tI1<span class=\"built_in\">_</span>4\t15-20\t20\t20 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>5\tI1<span class=\"built_in\">_</span>5\t20-25\t25\t25 cmbsf\tLeft\tUpstream\tI1</span><br><span class=\"line\">I1<span class=\"built_in\">_</span>6\tI1<span class=\"built_in\">_</span>6\t25-29\t30\t30 cmbsf\tLeft\tUpstream\tI1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>分类信息，本教程中文件名为<strong>taxonomy.tsv</strong>。该文件可由QIIME2生成。</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Feature ID\tTaxon\tConfidence</span><br><span class=\"line\">9e24eb7a415db9a59586d17d0f49cbea\tArchaea;Asgardarchaeota;Lokiarchaeia\t0.9999999998216045</span><br><span class=\"line\">2a1d71d9fca92f9b3fc8f3126db076d0\tBacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas\t0.9881304182870394</span><br><span class=\"line\">5d89868f1a1db1bc0b153eca96bbf7fd\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999859067</span><br><span class=\"line\">cc957f2e853493d72875a6528ca83435\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae\t0.9999999999854506</span><br><span class=\"line\">5179960239613d4c220e889075c6773e\tArchaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus\t0.9558707678091154</span><br><span class=\"line\">d62ab321b324b106e11961e79384f974\tBacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12\t0.9999999975860316</span><br><span class=\"line\">920aa9728ffb783cbc5721932cadda36\tBacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium\t0.9999939600150409</span><br><span class=\"line\">b5edcefd9280528ee377cb70dea8a6a7\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.99744406884555</span><br><span class=\"line\">43b02d567fe419b94ad063081c7bba58\tBacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium\t0.9999941829048367</span><br><span class=\"line\">0f1be1121dd04bc63b5ec4be0efc09b8\tArchaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon\t0.7884239553020901</span><br><span class=\"line\">430d9115ca79bad01227bcc9c7694cf1\tBacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium\t0.7413321650122459</span><br><span class=\"line\">0bf08973da329747d913d5c261f91944\tBacteria;Aerophobota;Aerophobia;Aerophobales\t1.0000000000000024</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>进化树，本教程中文件名为<strong>tree.nwk</strong>。该文件可由QIIME2生成，Newick格式，是用代表序列构建的系统发育树。</li>\n</ul>\n<hr>\n<h1 id=\"Alpha-diversity\"><a href=\"#Alpha-diversity\" class=\"headerlink\" title=\"Alpha diversity\"></a>Alpha diversity</h1><h2 id=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\"><a href=\"#Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD-whole-tree指数的计算与可视化\" class=\"headerlink\" title=\"Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化\"></a>Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree指数的计算与可视化</h2><h3 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"第一步：计算多样性\"><a href=\"#第一步：计算多样性\" class=\"headerlink\" title=\"第一步：计算多样性\"></a>第一步：计算多样性</h3><p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\">#定义函数</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>picante<span class=\"punctuation\">)</span>       <span class=\"comment\">#picante 包加载时默认同时加载 vegan</span></span><br><span class=\"line\"> </span><br><span class=\"line\">alpha <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree <span class=\"operator\">=</span> <span class=\"literal\">NULL</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"built_in\">exp</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        est <span class=\"operator\">&lt;-</span> estimateR<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Richness <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Chao1 <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        ACE <span class=\"operator\">&lt;-</span> est<span class=\"punctuation\">[</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">        Shannon <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;shannon&#x27;</span><span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        Simpson <span class=\"operator\">&lt;-</span> diversity<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&#x27;simpson&#x27;</span><span class=\"punctuation\">)</span>    <span class=\"comment\">#Gini-Simpson 指数</span></span><br><span class=\"line\">        Pielou <span class=\"operator\">&lt;-</span> Shannon <span class=\"operator\">/</span> <span class=\"built_in\">log</span><span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> base<span class=\"punctuation\">)</span></span><br><span class=\"line\">        goods_coverage <span class=\"operator\">&lt;-</span> 1 <span class=\"operator\">-</span> rowSums<span class=\"punctuation\">(</span>x <span class=\"operator\">==</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span> <span class=\"operator\">/</span> rowSums<span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        result <span class=\"operator\">&lt;-</span> data.frame<span class=\"punctuation\">(</span>Richness<span class=\"punctuation\">,</span> Shannon<span class=\"punctuation\">,</span> Simpson<span class=\"punctuation\">,</span> Pielou<span class=\"punctuation\">,</span> Chao1<span class=\"punctuation\">,</span> ACE<span class=\"punctuation\">,</span> goods_coverage<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span><span class=\"built_in\">is.null</span><span class=\"punctuation\">(</span>tree<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                PD_whole_tree <span class=\"operator\">&lt;-</span> pd<span class=\"punctuation\">(</span>x<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> include.root <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">                <span class=\"built_in\">names</span><span class=\"punctuation\">(</span>PD_whole_tree<span class=\"punctuation\">)</span> <span class=\"operator\">&lt;-</span> <span class=\"string\">&#x27;PD_whole_tree&#x27;</span></span><br><span class=\"line\">                result <span class=\"operator\">&lt;-</span> cbind<span class=\"punctuation\">(</span>result<span class=\"punctuation\">,</span> PD_whole_tree<span class=\"punctuation\">)</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        result</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#加载 OTU 丰度表和进化树文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&#x27;feature-table.tsv&#x27;</span><span class=\"punctuation\">,</span> row.names <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span> sep <span class=\"operator\">=</span> <span class=\"string\">&#x27;\\t&#x27;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> check.names <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\">tree <span class=\"operator\">&lt;-</span> read.tree<span class=\"punctuation\">(</span><span class=\"string\">&#x27;tree.nwk&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\"><span class=\"comment\">##alpha_all &lt;- alpha(otu, base = 2)</span></span><br><span class=\"line\"><span class=\"comment\">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span></span><br><span class=\"line\">alpha_all <span class=\"operator\">&lt;-</span> alpha<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span> tree<span class=\"punctuation\">,</span> base <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#输出保存在本地</span></span><br><span class=\"line\">write.table<span class=\"punctuation\">(</span>alpha_all<span class=\"punctuation\">,</span> <span class=\"string\">&#x27;alpha.txt&#x27;</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span> <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第二步：制图\"><a href=\"#第二步：制图\" class=\"headerlink\" title=\"第二步：制图\"></a>第二步：制图</h3><p>这一步需要在Rstudio中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出7个PDF图形文件。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env R</span></span><br><span class=\"line\"><span class=\"comment\"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载github包安装工具</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检测amplicon包是否安装，没有从源码安装</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"comment\"># 提示升级，选择3 None不升级；升级会容易出现报错</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># library加载包，suppress不显示消息和警告信息</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，根据实际情况设定</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span></span><br><span class=\"line\">metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors <span class=\"operator\">=</span> <span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取第一步中vegan计算的6种alpha多样性指数</span></span><br><span class=\"line\"><span class=\"comment\">#alpha_div = read.table(&quot;alpha.txt&quot;, header=T, row.names=1, sep=&quot;\\t&quot;, comment.char=&quot;&quot;)</span></span><br><span class=\"line\">alpha_div <span class=\"operator\">&lt;-</span> read.delim<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha.txt&quot;</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p1 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Shannon&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##物种丰富度 Richness 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p2 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Richness&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p3 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Simpson&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Chao1 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p4 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Chao1&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ACE 指数</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p5 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;ACE&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Shannon 均匀度（Pielou 均匀度）</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p6 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;Pielou&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##谱系多样性</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>p7 <span class=\"operator\">=</span> alpha_boxplot<span class=\"punctuation\">(</span>alpha_div<span class=\"punctuation\">,</span> index <span class=\"operator\">=</span> <span class=\"string\">&quot;PD_whole_tree&quot;</span><span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID <span class=\"operator\">=</span> <span class=\"string\">&quot;Depth2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_shannon.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p1<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Richness.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p2<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Simpson.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p3<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Chao1.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p4<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_ACE.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p5<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_Pielou.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p6<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ggsave<span class=\"punctuation\">(</span>paste0<span class=\"punctuation\">(</span><span class=\"string\">&quot;alpha_boxplot_PD_whole_tree.pdf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> p7<span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">89</span><span class=\"punctuation\">,</span> height<span class=\"operator\">=</span><span class=\"number\">75</span><span class=\"punctuation\">,</span> units<span class=\"operator\">=</span><span class=\"string\">&quot;mm&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"演示视频\"><a href=\"#演示视频\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=335536606&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h2 id=\"物种多样性条形图的绘制\"><a href=\"#物种多样性条形图的绘制\" class=\"headerlink\" title=\"物种多样性条形图的绘制\"></a>物种多样性条形图的绘制</h2><h3 id=\"输入文件-1\"><a href=\"#输入文件-1\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>处理后的Feature Table</li>\n</ul>\n<p>从QIIME2可视化网站上下载的各level的物种丰度表，此处以level-2（Phylum水平）为例，命名为“level-2.csv”。该文件可以用excel或WPS打开，然后复制所有内容至一个新建的名字为“level-2.txt”的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index\tspecies1\tspecies2\tspecies3\tspecies4</span><br><span class=\"line\">Sample1\t0\t8152\t11\t65</span><br><span class=\"line\">Sample2\t12\t97\t1097\t1315</span><br><span class=\"line\">...</span><br><span class=\"line\">Samplex\t15\t46\t2928\t1011</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>sample-metadata.tsv</li>\n<li>taxonomy.tsv</li>\n</ul>\n<h3 id=\"绘图\"><a href=\"#绘图\" class=\"headerlink\" title=\"绘图\"></a>绘图</h3><p>以下代码在Rstudio中逐步输入运行</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户自己的路径&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;microbiota/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据，特征表和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.txt&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-1\"><a href=\"#演示视频-1\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=633107204&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<hr>\n<h1 id=\"Beta多样性\"><a href=\"#Beta多样性\" class=\"headerlink\" title=\"Beta多样性\"></a>Beta多样性</h1><h2 id=\"NMDS分析及可视化\"><a href=\"#NMDS分析及可视化\" class=\"headerlink\" title=\"NMDS分析及可视化\"></a>NMDS分析及可视化</h2><h3 id=\"输入文件-2\"><a href=\"#输入文件-2\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h3><ul>\n<li>feature-table.tsv</li>\n<li>sample-metadata.tsv</li>\n</ul>\n<h3 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h3><p>在Rstudio中运行如下代码：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;用户的工作目录&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;vegan&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取数据，一份otu.table文件和一份分组信息文件</span></span><br><span class=\"line\">otu <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;feature-table.tsv&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">design <span class=\"operator\">&lt;-</span> read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span>header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span>sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span>row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span>check.names<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据调整为列名是OTU，行名是样本名</span></span><br><span class=\"line\">otu<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 标准化，当然method有很多，可以通过?decostand查看其它method</span></span><br><span class=\"line\">vare.hel<span class=\"operator\">&lt;-</span>decostand<span class=\"punctuation\">(</span>otu<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;hellinger&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 计算Bray-curtis距离矩阵</span></span><br><span class=\"line\">vare.dis <span class=\"operator\">&lt;-</span> vegdist<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>method<span class=\"operator\">=</span><span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用NMDS的方法</span></span><br><span class=\"line\">vare.mds <span class=\"operator\">&lt;-</span> metaMDS<span class=\"punctuation\">(</span>vare.hel<span class=\"punctuation\">,</span>distance <span class=\"operator\">=</span> <span class=\"string\">&quot;bray&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 首先提取前两轴坐标</span></span><br><span class=\"line\">point <span class=\"operator\">=</span> scores<span class=\"punctuation\">(</span>vare.mds<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将分组文件和得分文件合并</span></span><br><span class=\"line\">index <span class=\"operator\">=</span> merge<span class=\"punctuation\">(</span>design<span class=\"punctuation\">,</span> point<span class=\"punctuation\">,</span>by<span class=\"operator\">=</span><span class=\"string\">&quot;row.names&quot;</span><span class=\"punctuation\">,</span><span class=\"built_in\">all</span><span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看Stress值</span></span><br><span class=\"line\"><span class=\"comment\"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span></span><br><span class=\"line\">vare.mds</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span></span><br><span class=\"line\">anosim.result<span class=\"operator\">&lt;-</span>anosim<span class=\"punctuation\">(</span>vare.dis<span class=\"punctuation\">,</span> design<span class=\"operator\">$</span>Depth<span class=\"punctuation\">,</span>permutations <span class=\"operator\">=</span><span class=\"number\">999</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">summary<span class=\"punctuation\">(</span>anosim.result<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"><span class=\"comment\">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span></span><br><span class=\"line\"><span class=\"comment\">#tiff(file=&quot;beta_bray_NMDS.tiff&quot;, res = 300, compression =&quot;none&quot;, width=180,height=140,units= &quot;mm&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在这里我选择输出为PDF，后续可以进一步的编辑</span></span><br><span class=\"line\">pdf<span class=\"punctuation\">(</span>file<span class=\"operator\">=</span><span class=\"string\">&quot;beta_bray_NMDS.pdf&quot;</span><span class=\"punctuation\">,</span> width<span class=\"operator\">=</span><span class=\"number\">180</span><span class=\"punctuation\">,</span>height<span class=\"operator\">=</span><span class=\"number\">140</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开始出图，代码如下：</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;ggplot2&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">p <span class=\"operator\">=</span> ggplot<span class=\"punctuation\">(</span>index<span class=\"punctuation\">,</span> aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> color<span class=\"operator\">=</span>as.factor<span class=\"punctuation\">(</span>Depth<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">      geom_point<span class=\"punctuation\">(</span>size<span class=\"operator\">=</span><span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span></span><br><span class=\"line\">     <span class=\"comment\">#scale_colour_manual(values = c(&quot;red&quot;,&quot;blue&quot;, &quot;green&quot;)) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span></span><br><span class=\"line\">     labs<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS1&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;NMDS2&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> title<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span></span><br><span class=\"line\"></span><br><span class=\"line\">p<span class=\"operator\">+</span>stat_ellipse<span class=\"punctuation\">(</span>type <span class=\"operator\">=</span> <span class=\"string\">&quot;t&quot;</span><span class=\"punctuation\">,</span> linetype <span class=\"operator\">=</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> level <span class=\"operator\">=</span> <span class=\"number\">0.95</span><span class=\"punctuation\">,</span> show.legend <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.25</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;R: &#x27;*0.8036&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.35</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;p: &#x27;*0.001&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">    annotate<span class=\"punctuation\">(</span><span class=\"string\">&quot;text&quot;</span><span class=\"punctuation\">,</span>x<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">2.5</span><span class=\"punctuation\">,</span>y<span class=\"operator\">=</span><span class=\"operator\">-</span><span class=\"number\">1.45</span><span class=\"punctuation\">,</span>parse<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span>size<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span>label<span class=\"operator\">=</span><span class=\"string\">&quot;&#x27;Stress: &#x27;*0.075&quot;</span><span class=\"punctuation\">,</span>family<span class=\"operator\">=</span><span class=\"string\">&quot;serif&quot;</span><span class=\"punctuation\">,</span>fontface<span class=\"operator\">=</span><span class=\"string\">&quot;italic&quot;</span><span class=\"punctuation\">,</span>colour<span class=\"operator\">=</span><span class=\"string\">&quot;darkred&quot;</span><span class=\"punctuation\">,</span>hjust <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> geom_point<span class=\"punctuation\">(</span>aes<span class=\"punctuation\">(</span>x<span class=\"operator\">=</span>NMDS1<span class=\"punctuation\">,</span> y<span class=\"operator\">=</span>NMDS2<span class=\"punctuation\">,</span> shape<span class=\"operator\">=</span>Site<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> size<span class=\"operator\">=</span><span class=\"number\">2</span><span class=\"punctuation\">)</span><span class=\"operator\">+</span></span><br><span class=\"line\">\t<span class=\"comment\">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span></span><br><span class=\"line\">    theme_classic<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dev.off<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"演示视频-2\"><a href=\"#演示视频-2\" class=\"headerlink\" title=\"演示视频\"></a>演示视频</h3><div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=548008577&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"https://github.com/YongxinLiu/MicrobiomeStatPlot\">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li>\n</ul>\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]},{"title":"扩增子系之绘制物种分类堆叠图","slug":"扩增子系之绘制物种分类堆叠图","date":"2021-09-27T09:09:53.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/扩增子系之绘制物种分类堆叠图.json","excerpt":null,"keywords":null,"cover":null,"content":"<p><strong>为何要手绘堆叠图？</strong><br>QIIME2虽然可以生成堆叠图，然而图片只能在网页上查看，无法下载。此外，QIIME2的图有几分丑，且不可个性化修改，因此，手绘最靠谱。手绘当然不是用手画，而是用手敲代码。</p>\n<h1 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h1><ul>\n<li>各级别的物种分布文件，可以直接从QIIME2 生成的taxa_barplot.qzv文件提交至 <a href=\"https://view.qiime2.org/\">https://view.qiime2.org</a> ，随后从网页左上角“CSV”按钮处导出各分类级别的丰度表，但是要删除风度表最后几列的元数据信息，只保留丰度信息，各列之间以逗号分隔，内容如下所示，该文件是LEVEL-2（Phylum）水平的物种丰度分布：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index,Bacteria;Chloroflexi,Bacteria;Planctomycetota,Archaea;Nanoarchaeota,Bacteria;Patescibacteria,Bacteria;Proteobacteria,Bacteria;Actinobacteriota,Archaea;Aenigmarchaeota,Bacteria;Acidobacteriota,Archaea;Altiarchaeota,Bacteria;Firmicutes,Bacteria;Bdellovibrionota,Bacteria;Dependentiae,Bacteria;Spirochaetota,Bacteria;Margulisbacteria,Bacteria;Myxococcota,Archaea;Halobacterota,Archaea;Crenarchaeota,Bacteria;Latescibacterota,Bacteria;NB1-j,Bacteria;Desulfobacterota,Bacteria;Verrucomicrobiota,Archaea;Iainarchaeota,Bacteria;DTB120,Bacteria;Elusimicrobiota,Eukaryota;SAR,Archaea;Asgardarchaeota,Archaea;Euryarchaeota,Bacteria;CK-2C2-2,Bacteria;Sva0485,Archaea;Thermoplasmatota,Bacteria;Bacteroidota,Bacteria;Marinimicrobia (SAR406 clade),Bacteria;MBNT15,Bacteria;Nitrospinota,Bacteria;Zixibacteria,Bacteria;Nitrospirota,Archaea;Micrarchaeota,Bacteria;LCP-89,Bacteria;Armatimonadota,Bacteria;WOR-1,Bacteria;Gemmatimonadota,Bacteria;Fibrobacterota,Bacteria;Calditrichota,Bacteria;Sumerlaeota,Bacteria;Aerophobota,Bacteria;WS1,Bacteria;NKB15,Bacteria;SAR324 clade(Marine group B),Bacteria;Dadabacteria,Bacteria;BHI80-139,Bacteria;Desantisbacteria,Bacteria;Schekmanbacteria,Archaea;Hadarchaeota,Archaea;Hydrothermarchaeota,Bacteria;Caldatribacteriota,Bacteria;TA06,Bacteria;WS2,Eukaryota;Amorphea,Bacteria;Cyanobacteria,Bacteria;Hydrogenedentes,Bacteria;Cloacimonadota,Bacteria;WPS-2,Bacteria;Modulibacteria,Eukaryota;Archaeplastida,Bacteria;10bav-F6,Bacteria;Methylomirabilota,Bacteria;Deferrisomatota,Bacteria;Fusobacteriota,Bacteria;Fermentibacterota,Bacteria;Entotheonellaeota,Eukaryota;Discoba,Bacteria;Campylobacterota,Bacteria;PAUC34f,Bacteria;Poribacteria,Bacteria;AncK6,Bacteria;GN01,Bacteria;Acetothermia,Bacteria;FCPU426</span><br><span class=\"line\">B01,383,1058,157,274,7755,1317,0,1025,0,39,22,16,0,0,71,0,6841,20,633,49,145,0,0,0,247,13,0,0,0,13,1012,0,0,53,0,137,0,0,39,0,271,7,17,4,0,0,0,7,471,0,0,0,0,0,3,0,0,69,3,53,0,0,0,0,0,46,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B02,225,507,98,27,3279,228,0,522,0,10,4,0,0,0,25,0,7995,8,336,6,54,0,0,0,9,4,0,0,0,0,259,0,12,65,0,29,0,0,0,0,163,0,16,0,0,0,0,22,106,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,71,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B03,196,360,246,38,2605,119,0,587,0,8,5,0,0,0,172,0,11619,16,370,11,0,3,0,0,13,0,0,0,0,0,206,5,0,83,8,67,0,0,0,0,130,0,5,0,0,0,0,27,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B04,437,922,636,61,4209,195,0,1051,0,9,5,6,0,0,274,0,14573,22,628,5,88,9,0,0,17,8,0,0,0,26,271,14,0,129,7,95,0,0,0,0,219,0,20,0,0,0,0,84,145,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,467,0,0,0,5,0,0,12,0,0,0,0,0</span><br><span class=\"line\">B05,240,1159,187,26,2929,149,0,778,0,8,0,0,0,0,204,0,10918,26,473,0,20,0,0,7,10,8,0,0,0,0,193,9,0,209,0,96,0,0,2,0,244,3,19,0,0,0,0,131,125,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,532,0,0,0,12,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B06,211,2003,1380,168,2469,188,12,617,3,13,4,15,7,2,196,0,7802,16,383,47,94,0,0,22,7,43,25,0,0,84,223,33,0,244,5,112,0,0,0,0,204,8,28,8,0,0,0,69,105,0,5,0,0,8,0,0,0,0,0,0,0,0,0,0,0,639,0,0,0,9,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B07,231,2607,4129,694,2667,231,20,399,12,36,10,21,37,0,156,0,5611,47,453,76,93,112,0,16,21,187,53,0,0,267,196,73,0,106,0,74,0,0,0,24,169,8,37,6,6,0,5,82,118,0,7,0,0,0,0,0,0,4,0,0,0,0,0,0,0,399,0,0,0,8,0,0,0,0,0,0,0,0</span><br><span class=\"line\">B08,228,2573,4942,604,2084,150,51,507,7,14,0,22,32,2,109,0,6026,28,269,58,156,94,0,31,7,193,21,0,0,264,220,11,4,212,0,67,4,0,0,65,113,3,26,0,0,0,0,81,108,0,0,5,0,0,0,0,0,0,0,13,0,0,0,0,0,468,0,0,0,21,0,0,7,0,0,0,0,0</span><br><span class=\"line\">B09,606,3235,2950,1247,1922,696,52,487,16,21,20,84,12,0,107,0,1559,80,341,478,198,148,0,34,63,131,6,3,9,144,141,30,6,106,13,87,42,0,4,0,205,6,76,5,8,11,8,142,70,9,0,3,0,15,0,0,0,0,0,7,0,0,0,0,0,508,0,0,0,18,0,5,0,0,0,0,0,0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>样本元数据，描述各样本特征的文件，以制表符分隔各列，内容如下：</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ID\tSamples\tLayer\tDepth\tLocation\tPosition\tSite</span><br><span class=\"line\">B01\tB01\t0-1\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B02\tB02\t1-2\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B03\tB03\t2-3\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B04\tB04\t3-4\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B05\tB05\t4-5\t5\tRight\tDownstream\tB</span><br><span class=\"line\">B06\tB06\t5-6\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B07\tB07\t6-7\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B08\tB08\t7-8\t10\tRight\tDownstream\tB</span><br><span class=\"line\">B09\tB09\t8-9\t10\tRight\tDownstream\tB</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><p><strong>建议在Rstudio中运行。</strong></p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先需要安装依赖包“amplicon”，如果没有安装“devtools”需要先安装，命令如下：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;devtools&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">library<span class=\"punctuation\">(</span>devtools<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装依赖包“amplicon”，我对原作者的程序做了些许的优化，所以，可以从我的GitHub进行安装，命令如下：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;amplicon&quot;</span><span class=\"punctuation\">,</span> quietly<span class=\"operator\">=</span><span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install_github<span class=\"punctuation\">(</span><span class=\"string\">&quot;liaochenlanruo/amplicon&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">suppressWarnings<span class=\"punctuation\">(</span>suppressMessages<span class=\"punctuation\">(</span>library<span class=\"punctuation\">(</span>amplicon<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置工作目录，视自己的具体情况而定，工作目录中当包含输入文件：</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&quot;E:/Researches/Xiaqian/NGS/CleanData/ALL/细菌V6V8-1/Analysis_20210624/barplot&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 从文件读取元数据和物种注释</span></span><br><span class=\"line\">metadata<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;sample-metadata.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">taxonomy<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;taxonomy.tsv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 绘制堆叠柱状图，颜色自定义。界水平物种组成表和元数据作为输入，分组列名为Group，显示前4个分类，其余归类为其他(Other)，按丰度排序。</span></span><br><span class=\"line\">otutab1<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-1.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab1<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组，通过“groupID”参数设置分组信息，这里我选择根据站位（Site）分组，用户当根据自己的实际情况来设置。</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ds<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ds2 <span class=\"operator\">=</span> ds <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 出图</span></span><br><span class=\"line\">ds2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>dd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab1<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">4</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dd2 <span class=\"operator\">=</span> dd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">dd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 门水平物种组成表和元数据作为输入，分组列名为Group，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-2.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab2<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>ps<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2 <span class=\"operator\">=</span> ps <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>pd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab2<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pd2 <span class=\"operator\">=</span> pd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">pd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 纲水平物种组成表和元数据作为输入，分组列名为Group，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab3<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-3.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">,</span> <span class=\"built_in\">quote</span><span class=\"operator\">=</span><span class=\"string\">&quot;\\&quot;&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab3<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>cs<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cs2 <span class=\"operator\">=</span> cs <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cs2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>cd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab3<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd2 <span class=\"operator\">=</span> cd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 属水平物种组成表和元数据作为输入，分组列名为Site，显示前19个分类，按丰度排序</span></span><br><span class=\"line\">otutab6<span class=\"operator\">=</span>read.table<span class=\"punctuation\">(</span><span class=\"string\">&quot;level-6.csv&quot;</span><span class=\"punctuation\">,</span> header<span class=\"operator\">=</span><span class=\"built_in\">T</span><span class=\"punctuation\">,</span> row.names<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"punctuation\">,</span> sep<span class=\"operator\">=</span><span class=\"string\">&quot;,&quot;</span><span class=\"punctuation\">,</span> comment.char<span class=\"operator\">=</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> stringsAsFactors<span class=\"operator\">=</span><span class=\"built_in\">F</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">otutab6<span class=\"operator\">=</span>t<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照站位分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>gs<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Site&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs2 <span class=\"operator\">=</span> gs <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#按照深度分组</span></span><br><span class=\"line\"><span class=\"punctuation\">(</span>gd<span class=\"operator\">=</span>tax_stackplot<span class=\"punctuation\">(</span>otutab6<span class=\"punctuation\">,</span> metadata<span class=\"punctuation\">,</span> groupID<span class=\"operator\">=</span><span class=\"string\">&quot;Depth&quot;</span><span class=\"punctuation\">,</span> topN<span class=\"operator\">=</span><span class=\"number\">20</span><span class=\"punctuation\">,</span> style<span class=\"operator\">=</span><span class=\"string\">&quot;sample&quot;</span><span class=\"punctuation\">,</span> sorted<span class=\"operator\">=</span><span class=\"string\">&quot;abundance&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gd2 <span class=\"operator\">=</span> gd <span class=\"operator\">+</span> scale_fill_manual<span class=\"punctuation\">(</span>values <span class=\"operator\">=</span> rev<span class=\"punctuation\">(</span><span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;#1f77b4&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#aec7e8&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff7f0e&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ffbb78&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#2ca02c&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#98df8a&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#d62728&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#ff9896&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9467bd&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c5b0d5&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#8c564b&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c49c94&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#e377c2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#f7b6d2&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#7f7f7f&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#c7c7c7&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#bcbd22&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#dbdb8d&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#17becf&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;#9edae5&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"operator\">+</span> theme<span class=\"punctuation\">(</span>axis.text.x <span class=\"operator\">=</span> element_text<span class=\"punctuation\">(</span>angle <span class=\"operator\">=</span> <span class=\"number\">90</span><span class=\"punctuation\">,</span> hjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">,</span> vjust <span class=\"operator\">=</span> <span class=\"number\">0.5</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\">gd2</span><br></pre></td></tr></table></figure>\n\n<p>最后的图可以在Rstudio中手动导出。</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=378319348&page=\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe></div>\n\n\n<p><font color=\"#FF0000\"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"可视化","path":"api/categories/可视化.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"SY179","path":"api/tags/SY179.json"},{"name":"R语言","path":"api/tags/R语言.json"}]},{"title":"用MaAsLin2包做微生物组多变量线性模型关联分析","slug":"用MaAsLin2包做微生物组多变量线性模型关联分析","date":"2024-07-30T14:41:21.000Z","updated":"2024-07-30T15:07:54.187Z","comments":true,"path":"api/articles/用MaAsLin2包做微生物组多变量线性模型关联分析.json","excerpt":null,"keywords":null,"cover":"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/sigresults_screenshot.png","content":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>MaAsLin 2 是 MaAsLin（微生物组多变量线性模型关联，Microbiome Multivariable Association with Linear Models）的下一代产品。</p>\n<p>MaAsLin 2 是一个全面的 R 语言软件包，用于高效地确定表型、环境、暴露、协变量和微生物组元组学特征之间的多变量关联。MaAsLin 2 依赖于一般线性模型来适应大多数现代流行病学研究设计，包括横断面和纵向研究，以及多种数据探索、标准化和转换方法。</p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span><span class=\"punctuation\">(</span><span class=\"operator\">!</span>requireNamespace<span class=\"punctuation\">(</span><span class=\"string\">&quot;BiocManager&quot;</span><span class=\"punctuation\">,</span> quietly <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">    install.packages<span class=\"punctuation\">(</span><span class=\"string\">&quot;BiocManager&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">BiocManager<span class=\"operator\">::</span>install<span class=\"punctuation\">(</span><span class=\"string\">&quot;Maaslin2&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"微生物组关联检测\"><a href=\"#微生物组关联检测\" class=\"headerlink\" title=\"微生物组关联检测\"></a>微生物组关联检测</h1><h2 id=\"输入文件\"><a href=\"#输入文件\" class=\"headerlink\" title=\"输入文件\"></a>输入文件</h2><h3 id=\"微生物组特征数据或功能数据\"><a href=\"#微生物组特征数据或功能数据\" class=\"headerlink\" title=\"微生物组特征数据或功能数据\"></a>微生物组特征数据或功能数据</h3><ul>\n<li>以制表符分隔列</li>\n<li>行为样本，列为特征（微生物&#x2F;基因&#x2F;功能……）</li>\n</ul>\n<div style=”overflow-x:auto;overflow-y:auto;”>\n<table>\n\n<p>| ID | Bifidobacterium adolescentis | Bifidobacterium bifidum | Bifidobacterium longum | Bifidobacterium pseudocatenulatum | Collinsella aerofaciens | Bacteroides caccae | Bacteroides cellulosilyticus | Bacteroides dorei | Bacteroides eggerthii | Bacteroides faecis | Bacteroides finegoldii | Bacteroides fragilis | Bacteroides intestinalis | Bacteroides massiliensis | Bacteroides ovatus | Bacteroides salyersiae | Bacteroides stercoris | Bacteroides thetaiotaomicron | Bacteroides uniformis | Bacteroides vulgatus | Bacteroides xylanisolvens | Bacteroidales bacterium ph8 | Barnesiella intestinihominis | Coprobacter fastidiosus | Odoribacter splanchnicus | Parabacteroides distasonis | Parabacteroides goldsteinii | Parabacteroides merdae | Parabacteroides unclassified | Paraprevotella clara | Paraprevotella unclassified | Prevotella copri | Alistipes finegoldii | Alistipes onderdonkii | Alistipes putredinis | Alistipes shahii | Alistipes unclassified | Streptococcus salivarius | Clostridium bolteae | Clostridium citroniae | Clostridium clostridioforme | Clostridium hathewayi | Clostridium leptum | Clostridium nexile | Clostridium symbiosum | Flavonifractor plautii | Eubacterium eligens | Eubacterium hallii | Eubacterium rectale | Eubacterium siraeum | Eubacterium sp 3 1 31 | Eubacterium ventriosum | Ruminococcus gnavus | Ruminococcus obeum | Ruminococcus torques | Coprococcus comes | Dorea longicatena | Lachnospiraceae bacterium 1 1 57FAA | Lachnospiraceae bacterium 3 1 46FAA | Roseburia hominis | Roseburia intestinalis | Roseburia inulinivorans | Roseburia unclassified | Oscillibacter unclassified | Peptostreptococcaceae noname unclassified | Faecalibacterium prausnitzii | Ruminococcus bromii | Ruminococcus callidus | Ruminococcus lactaris | Subdoligranulum unclassified | Coprobacillus unclassified | Acidaminococcus unclassified | Dialister invisus | Veillonella atypica | Veillonella dispar | Veillonella parvula | Veillonella unclassified | Burkholderiales bacterium 1 1 47 | Parasutterella excrementihominis | Sutterella wadsworthensis | Bilophila unclassified | Escherichia coli | Escherichia unclassified | Klebsiella pneum |<br>| :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: | :–: |<br>CSM5FZ4M|0|0|0|0|0|2.99e-05|0|0.130632|0|0|0|0|0|0|0.190863|0.0090411|0|0.0199315|0.325812|3.62e-05|0.011119|0|0|0|0|0.0026035|0|0|0.0605912|0|0|0|6.78e-05|0.0041528|0.0587475|0|0|0|3.69e-05|0|7.88e-05|0|0.0008177|0|0|0|0|0.0015772|0|0.0028149|0|0|0.0007802|0.0016194|0.0010076|0.0013645|0.00307|0|0|0|0|0|0|0.0041547|0|0.0936191|0.0071109|0|0|0.0156577|0|0.0287905|0|0|0|0|0|0|0|0|0.0004782|0.0010136|0|0|0|0|0|<br>CSM5MCUO|0.0002803|0|0.0002857|0|0.0002506|0.025743|0.0003977|0.0057939|0|0.0025964|0|0.0062334|0|0|0.0344354|0.0129821|0.0836427|0.0006236|0.0677076|0.169157|0.0009044|0.0024183|0.0195324|0|0.0030421|0|0|0.0026058|0|0.0071178|0.0203598|0|0|0.0034786|0.047193|0.0021057|0|0|6.96e-05|4.3e-06|0|1.94e-05|0|0|0|7.25e-05|0.0745387|0.0001715|0.0377607|0|0|0|0|0.0012169|0.002148|0.0013398|0.0081932|0.0001191|0.0016632|9.11e-05|0.067003|0.0075671|0|0|0.00194|0.160706|0|0|0.0005857|0.0320903|0|0|0|0|0|2.06e-05|4.24e-05|0.000971|0.0086767|0|0.0011601|0.0026399|0|0.0044638|0.000241|0|0|<br>CSM5MCVL|0|0|0|0|0.000644|0|0|3.04e-05|0|0|0|0.260366|0|0|2.46e-05|0|0|0.129383|0|0.314003|0.0232747|0|0|0|0|0|0|0|0.0001241|0|0|0|0|0|0|0|0|0|0.0043222|0|0.0276218|0.0071817|0|0.0012594|0|0.0047196|0|0|0.0145548|0|0|0|7.3e-05|0|0.000822|0|6.43e-05|0|2.08e-05|0.02246|0|0|0|0|0|0.0001213|0|0|0|0|0.0005083|0.0096519|0.0239|0|0|0|0|0|0|0|0|0.0112689|0|0.0138117|0|0|0.0141917|<br>CSM5MCVN|0|0|0|0|7.9e-06|0|0|6.2e-06|0|0|0|0.149041|0|1.25e-05|0|0|0|0.0832982|0|0.423798|0.0164535|0|0|0|0|0|0|0|0.0006701|0|0|0|0|0|0|0|0|0|0.001367|0|0.0884657|0.0005971|0|0.0018467|0|0.0012898|0|0.0002252|0.018187|0|0|0|0|1.57e-05|0|0|0.0053145|0|0.0010537|0.0009666|0|0|0|0|0|0|0|0|0|7.68e-05|2.18e-05|0.122568|0.0224342|0|0|0|0|0|0|0|0|0.0001853|0.0004242|0|0|0|0|<br>CSM5MCW6|0|0|0|0|0|0|0|0.797928|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0.0033702|0.0204998|0|0|0|0|0|0|0|0|0|0|0|0.0387423|0|0.0090233|0|0.0157132|0|0|0|0.0032695|0.0005009|0.0241049|0|0|0|0|0|0.000299|0.0005244|0.001166|0|0|0.0015111|0|0.0298091|0|0.0011846|0|0.0126023|0|0|0|0|0|0.0095345|0|0|0|0|0|0|1.29e-05|0.00037|0.005708|0|0|0|0|0|0|0|0|<br>CSM5MCWC|0|2.31e-05|0.0003162|0|0|1.44e-05|0|3.17e-05|0|0|0|0|0|0|6.6e-05|0|0.0002643|0|0.000198|0.0005533|0|0|0|0|0|0|0|0|0|0|6.9e-05|0|0|0|8.15e-05|0|0|0|0|0|0.0006028|0.0099797|0|0|0|0.0024009|0.0002178|0|0.0001344|0|0|0|0.0098838|0|0.0037154|0|0|0|0|0|0.718226|0|0|0.0040982|0|0.0004805|0|0|0|0.0518636|0.0003928|0|0|0|0|0.13466|0|0|0|0|0|0.0504913|0|0|0|0|0|<br>CSM5MCWE|0|0.00034|0.002193|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0.0348624|0.0070646|0|0|0|0.0021959|0|0|0|0|0|0|0.0397243|0|0.0048|0|0|0|0|0|0.259999|0|0|0.058234|0.0001926|0|0|0|0|0.0386629|0.0003843|0|0|1.01e-05|0|0.311084|0.0066505|0|0|0|0|0.216984|0|0.0002289|0|0|0|<br>CSM5MCWG|0|0|0.0003679|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1.95e-05|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|5.32e-05|0|0|0|0|0|0|0|0|0|0|0|0.806009|0|0.027933|0|0|0|<br>CSM5MCWQ|0|0|0|0|0|8.17e-05|9.64e-05|0.0672288|0|0|0|0.0113786|0|0|0.122942|0.0201914|0.000105|0.0040688|0.217201|0.0008374|2.58e-05|0|0|0|0|0.0004571|0|5.4e-05|0|0|0|0|0.000363|0.0162975|0.114866|0|0|0|0.0001883|0|0.000379|0|0.0001216|0|0.00015|0|0|0.0046789|1.34e-05|0.0197896|0.0001966|0|0.002362|0.0255746|0.004419|0.0085504|0.0325097|0|0|0|0|0|0.0001466|0|0|0.122649|0.0333318|0|0|0.0606285|7.45e-05|0.0412816|0|0|0|0|0|0|0|0|0.0011062|0|0|0|0|0|0|<br>CSM5MCX3|0.0002539|0|0|0|0.0014928|0.0242821|0.0015386|0.0040416|0|0.0044463|0|0.0077786|0|0|0.0336512|0.0175735|0.0701398|0.0011342|0.0465973|0.179288|0.0012624|0.0006817|0.0336377|0|0.0092572|8.4e-06|0|0.0075155|0|0.006469|0.0206797|0|0|0.0048614|0.0298645|0.0034485|0|0|0|0|0|0|0|0|0|0.000124|0.0116151|0.000848|0.0815114|0|0|0|0|0.0018713|0.0099968|0.002291|0.0012411|0|0.0028484|0.0006999|0.0638985|0.0217855|0|0.0021544|0.0010134|0.146862|0|0|0.0020005|0.0256008|0.0003196|0|0|1.15e-05|0|0.0001387|0.0001265|0.0001856|0.0013029|0.0043194|0.0004984|0.0355164|0|0|0.0047487|0|0|<br>CSM5MCXD|0|0|0|0|0|0.0232205|0|0|0|0|0|0.0143431|0|0|0|0|0|0.143841|0.394913|0.0826526|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0.0188117|0.000241|0.0282565|0.000477|0.0030871|0|0|0.0028702|0|0.010184|0|0|7.31e-05|0|0.0004308|0.0023877|0.0188037|0|0.0014947|0|0.0003486|0.0004154|0|0.0081558|0.0127071|0.0512882|0|0.055412|0|0|0.0029844|0.0159726|0|0|0.0525671|0|0|0|6.31e-05|0|0|0|0|0.0010821|0.00017|0|0|0.0308464|0|<br>CSM5MCXH|0|0|1.74e-05|0|1.62e-05|0.0493889|0.0334967|0.0066452|0|0.0021273|0.006606|0|0|0|0.073836|0|0.141228|0.0001597|0.218669|0.220928|0.0001106|0|0|0|0|0.0139203|0|0.0313531|0|0|0|0|0.0139698|0|0|0|0.0128026|0|0.0062217|3.34e-05|0.0001771|7.33e-05|0.002021|0|0|0.0014415|0.0018687|0|0.0198946|0|0|0|0.0007365|0|0.0015047|0|0|0|0|0|0|0.0025246|0|0.0313484|0|0.0538097|0.0017084|0|0.000335|0.0244631|0|0|0|0|0|0|0|0.0010757|0|0|0.0038914|6.67e-05|0.0001379|0|0|0.0064819|3.65e-05|<br>CSM5MCXJ|0|0|0|0|6.32e-05|0.110666|0.0030669|0.0012605|0|0.0043289|0.025877|0|0|0|0.0652867|0|0.160984|0.00038|0.188958|0.178898|8.82e-05|0|0|0|0|0.0092329|0|0.0249501|0|0|0|0|0.0083815|0|0|0|0.0053743|0|0.01529|0.0001308|0.0007721|0.0004701|0.000544|0|3.25e-05|0.0012693|0.0007661|1.38e-05|0.0669666|0|0|0|0.000188|8.5e-06|0.0007501|0|0.0011354|0.0002112|0|0|0|0.0022371|0|0.0205654|0|0.0222816|0.0007051|0|0.0009217|0.0224336|0.00031|0|0|0|0|0|0|0.0019639|6.2e-06|0|0.005775|0|0|0|0|0.0365019|0.0001822|<br>CSM5MCXL|0|0|0.000617|0|0.0003528|0.063139|0.01002|0.0084117|0|0.0027176|0.0281016|0|0|0|0.0590648|0|0.20802|0.0002494|0.0846192|0.22132|0.0001736|0|0|0|0|0.0113662|0|0.0267668|0|0|0|0|0.0115488|0|0|0|0.0104791|0|0.0057873|0.0002057|0.0002102|7.02e-05|0.0004034|0|3.55e-05|0.0030996|0.0012425|4.21e-05|0.0540207|0|0|0|0.0001525|7.78e-05|0.0016108|0|0.0002173|0.0002947|0|0|0|0.0113447|0|0.0184802|0|0.0352906|0.0018624|0|0.0006068|0.0361986|0|0|0|0|0|0|0|0.0035568|3.13e-05|0|0.0041531|0|0|0|0|0.0536769|0.0007823|<br>CSM5MCXN|9e-04|0.0014859|0.0007198|0|0.002489|0.0146816|0|3.21e-05|0|0|0|1.65e-05|0|0|0.0068809|0|0.0574555|0.0057097|0.149509|0.0387855|1.44e-05|0.002242|0|0|0.0036354|0.0080445|0|0.0123431|0|0|0|0|0|0.0035902|0.0433559|0|0|0|0|0|0|0|0.0020454|0|0|0.0013976|0.0029568|0|0.15396|0.0008095|0|0|0|0.0032762|0.0019781|0.0011483|0.0027922|0|0.0015817|0|0|0.0066976|0.0072944|0.0078427|0.000161|0.321688|0.0086032|0|0|0.102004|0|0|0|0|0|0|1.96e-05|0|0|0|0.0002237|4.08e-05|0|0|0.0020167|0|0|<br>CSM5MCXP|0|0|0.0002316|0|0.0002514|0.0661914|0.0034493|0.00995|0|0.0027718|0.0158032|0|0|0|0.065316|0|0.117753|0.000251|0.11232|0.21396|0.0001957|0|0|0|0|0.0065367|0|0.0360476|0|0|0|0|0.0106497|0|0|0|0.0070742|0|0.0080276|0.0001543|0.0004436|0.0003357|0.004853|0|0.0001789|0.0016521|0.0028061|1.46e-05|0.086895|0|0|0|5.58e-05|3.87e-05|0.0020342|0|0.0002271|0.0003383|0|0|0|0.023831|0|0.0253246|0|0.0521722|0.0010222|0|0.0011574|0.0215523|5.72e-05|0|0|0|0|0|2.07e-05|0.0064746|8.72e-05|0|0.0095853|0|0|0|0|0.0730637|0|<br>CSM5MCXR|0|0|0.0053555|0|0.002203|0.0634391|0.0004511|0.008753|0|0.0025878|0.0115833|0|0|0|0.0693183|0|0.150708|0.0001369|0.133928|0.226043|0.0001283|0|0|0|0|0.0035188|0|0.0331136|0|0|0|0|0.0064956|0|0|0|0.0072247|0|0.0178658|0.0007363|0.0012665|0.000151|0.0023947|0|0|0.0023505|0.0002444|0.0002664|0.111735|0|0|0|0.0002708|0.0001855|0.0014546|0|0.0030152|0|0|0|0|0|5.6e-05|0.0197417|0|0.008337|0|0|0.0005999|0.0222451|0.0001573|0|0|0|0|3.92e-05|1.95e-05|0.01271|0.0001372|0|0.0195791|0.0051488|0|0|5.05e-05|0.0240428|0|<br>CSM5MCXT|0|0|0|0|0|0.0547049|0.0761903|0.0002514|0|0.0004569|0|0|0.0016257|0|0.0006004|0|0.0294632|0.0651783|0.0962833|0.223978|0.003561|0|0.0146004|0|0.0098854|0.0391807|0|0.0148714|0|0|0|0|0.0001465|0.0008497|0.0776576|0|0|0.0002193|0.0006841|0|0|0|0|0|0|0.0001764|0.002702|0.0001956|0.0255021|0.110182|0|0.0016848|0|0.0003254|0.0024663|0|0.0003288|0.0029356|0.0001906|0.0007798|0.0098947|0.0033219|0|0.0044086|0|0.0625705|0.0040651|0.0001067|0|0.0336473|0|0|0|0|0|0|6.89e-05|0.0001277|0.0001498|0|0.0016636|0|0|0|0.0006191|0|0|<br>CSM5MCXV|0|0|0|0|0.000168|0.0224246|0.0913569|4.4e-05|0|0.0002177|0|0|0.0032209|0|0.0006096|0|0.0200891|0.0084882|0.0952023|0.25396|0.0002592|0|0.0250507|0|0.0118679|0.0510182|0|0.0241842|0|0|0|0|0.0005007|0.0026391|0.0838137|6.79e-05|0|0.000574|0.0003648|0|0|0|0.0001407|0|0|0.0002713|0|2.25e-05|0.0012788|0.110335|0|0.0003101|1.05e-05|0.0003097|0.0030808|0|0.0004354|0|0.0001854|0.000275|0.0009021|0.0176899|0|0|0|0.099879|0.0043643|0|0|0.0343848|0|0|0|0|0.0001264|0.0001288|0.0006792|0.0006075|0.0003838|0|0.0010182|0|0|0|0.0021091|0|0.0002993|<br>CSM5MCY2|0|0|0|0|9.61e-05|0.0228064|0.107666|0.0001169|0|0.0003104|0|0|0.0036783|0|0.0005609|0|0.0176473|0.0197587|0.0812921|0.261898|0.0005329|0|0.0153278|0|0.0114496|0.0280544|0|0.0184865|0|0|0|0|0.001091|0.0057629|0.111524|0.0106153|0|0.0005536|5.74e-05|0|0|0|0.0007103|0|0|0.0003194|0.003737|0.0003345|0.0146314|0.064322|0|0.0017551|0|0.0002925|0.0021113|0.0003744|0.0006908|0|0.0004224|0.002589|0.0030359|0.00122|0|0.00497|0.000437|0.0925835|0.0041852|0.0001563|0|0.05316|0|0|0|0|5.11e-05|0.0004045|0.000561|0.0009356|0.0005887|0|0.0009486|0.00039|0|0|0.001898|0|0|</p>\n</table>\n</div>\n\n<h3 id=\"元数据\"><a href=\"#元数据\" class=\"headerlink\" title=\"元数据\"></a>元数据</h3><ul>\n<li>以制表符分隔列</li>\n<li>行为样本，列为特征</li>\n</ul>\n<div style=”overflow-x:auto;”>\n<table>\n\n<table>\n<thead>\n<tr>\n<th align=\"center\">ID</th>\n<th align=\"center\">site</th>\n<th align=\"center\">age</th>\n<th align=\"center\">diagnosis</th>\n<th align=\"center\">subject</th>\n<th align=\"center\">antibiotics</th>\n<th align=\"center\">dysbiosis_binary</th>\n<th align=\"center\">dysbiosis</th>\n<th align=\"center\">dysbiosisnonIBD</th>\n<th align=\"center\">dysbiosisUC</th>\n<th align=\"center\">dysbiosisCD</th>\n<th align=\"center\">collection</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">CSM5FZ3N_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3001</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.792314801112388</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ3R_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3001</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.837923415694291</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ3T_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">76</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3002</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">0.924296928419748</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ3V_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3001</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.830400526852384</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ3X_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">76</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3002</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">0.910966992923041</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ3Z_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">76</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3002</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">0.912281677355966</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ42_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">76</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3002</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">0.903049136702093</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ44_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">76</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3002</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">0.87825476936449</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ46_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">76</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3002</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">0.92542872181954</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">6</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ4A_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">47</td>\n<td align=\"center\">UC</td>\n<td align=\"center\">C3004</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.775160480913896</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ4C_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">C3001</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.836244630681399</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ4E_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">UC</td>\n<td align=\"center\">C3003</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.787616535915359</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ4G_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">UC</td>\n<td align=\"center\">C3003</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.68128445477854</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ4K_P</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">UC</td>\n<td align=\"center\">C3003</td>\n<td align=\"center\">Yes</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.717164790084925</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5FZ4M</td>\n<td align=\"center\">Cedars-Sinai</td>\n<td align=\"center\">43</td>\n<td align=\"center\">UC</td>\n<td align=\"center\">C3003</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.761300183426806</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">6</td>\n</tr>\n<tr>\n<td align=\"center\">CSM5LLGB_P</td>\n<td align=\"center\">MGH</td>\n<td align=\"center\">30</td>\n<td align=\"center\">CD</td>\n<td align=\"center\">M2014</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">0.730525895151516</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">No</td>\n<td align=\"center\">8</td>\n</tr>\n</tbody></table>\n</table>\n</div>\n两个文件包含的样本可以不同，分析时只取二者共有的样本。样本顺序也无需一致。\n\n<h3 id=\"读入文件\"><a href=\"#读入文件\" class=\"headerlink\" title=\"读入文件\"></a>读入文件</h3><figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df_input_data <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span>file             <span class=\"operator\">=</span> input_data<span class=\"punctuation\">,</span></span><br><span class=\"line\">                           header           <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_data<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_metadata <span class=\"operator\">=</span> read.table<span class=\"punctuation\">(</span>file             <span class=\"operator\">=</span> input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               header           <span class=\"operator\">=</span> <span class=\"literal\">TRUE</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                               row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                               stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_metadata<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_path <span class=\"operator\">=</span> read.csv<span class=\"punctuation\">(</span><span class=\"string\">&quot;./pathabundance_relab.tsv&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         sep              <span class=\"operator\">=</span> <span class=\"string\">&quot;\\t&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         stringsAsFactors <span class=\"operator\">=</span> <span class=\"literal\">FALSE</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                         row.names        <span class=\"operator\">=</span> <span class=\"number\">1</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">df_input_path<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">5</span><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行MaAsLin-2\"><a href=\"#运行MaAsLin-2\" class=\"headerlink\" title=\"运行MaAsLin 2\"></a>运行MaAsLin 2</h2><p>在MaAsLin中，可以使用几种不同类型的统计模型来进行关联测试（例如简单线性模型、零膨胀模型、基于计数的模型等）。作者在论文中评估了各种模型的优缺点，虽然默认模型通常适用于大多数分析，但在某些情况下，用户可能希望选择不同的模型。这同样适用于多种不同的微生物群落数据类型（taxonomy 或functional profiles）、环境（人类或其他）和测量方式（计数或相对比例），只要使用适当修改过的归一化&#x2F;转换方案即可。</p>\n<p>对于模型选择，如果你的输入是<code>计数数据</code>，那么你可以使用<code>NEGBIN</code>和<code>ZINB</code>模型；而对于<code>非计数数据</code>（如百分比、CPM或相对丰度）的输入，你可以使用<code>LM</code>和<code>CPLM</code>模型。</p>\n<p>在MaAsLin 2实现的归一化方法中，<u>TMM和CSS仅适用于计数数据，并且它们也返回归一化后的计数</u>，这与TSS和CLR不同。因此，如果你的输入是计数数据，你可以使用上述两种归一化方法（即TMM、CSS或NONE（如果数据已经归一化））而无需进一步转换（即transform &#x3D; NONE）。</p>\n<p><u>在非计数模型中，CPLM要求数据为正数</u>。因此，任何产生负值的转换通常都不适用于<code>CPLM</code>。</p>\n<p>由于所有非LM模型都与其与广义线性模型（GLM）的紧密联系而使用固有的对数链接转换，因此建议它们以<code>transform = NONE</code>的方式运行。</p>\n<p>除此之外，<u>LM是唯一能够处理正数和负数（在归一化&#x2F;转换之后）的模型</u>，并且（根据手稿）它通常对参数变化具有更强的鲁棒性（这是非LM模型的典型限制）。关于是否使用LM、CPLM或其他模型，直观上，<u>在存在零值的情况下，<code>CPLM</code>或<code>零膨胀替代模型</code>应该表现更好，但根据我们的基准测试，我们没有证据表明CPLM显著优于LM模型</u>。因此，<b>在选择模型时，应综合考虑数据的特性、研究目的以及模型的适用性和性能</b>。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Model (-m ANALYSIS_METHOD)</th>\n<th align=\"center\">Data type</th>\n<th align=\"center\">Normalization (-n NORMALIZATION)</th>\n<th align=\"center\">Transformation (-t TRANSFORM)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">LM</td>\n<td align=\"center\">count and non-count</td>\n<td align=\"center\">TSS, CLR, NONE</td>\n<td align=\"center\">LOG, LOGIT, AST, NONE</td>\n</tr>\n<tr>\n<td align=\"center\">CPLM</td>\n<td align=\"center\">count and non-count</td>\n<td align=\"center\">TSS, TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n<tr>\n<td align=\"center\">NEGBIN</td>\n<td align=\"center\">count</td>\n<td align=\"center\">TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n<tr>\n<td align=\"center\">ZINB</td>\n<td align=\"center\">count</td>\n<td align=\"center\">TMM, CSS, NONE</td>\n<td align=\"center\">NONE</td>\n</tr>\n</tbody></table>\n<p><strong>注</strong>：通常，还需要考虑用于过滤数据（即流行率和丰度阈值）的阈值，以减少异常值和假阳性。有关此方面的更多详细信息，请参阅MaAsLin 2中的第<a href=\"https://github.com/biobakery/biobakery/wiki/maaslin2#431-prevalence-and-abundance-filtering-in-maaslin2\">4.3.1节“流行率和丰度过滤”</a>。</p>\n<p>以下命令在HMP2数据上运行MaAsLin 2，执行多变量回归模型以测试微生物物种丰度与IBD诊断和<a href=\"https://www.nature.com/articles/s41586-019-1237-9\">菌群失调评分</a>之间的关联（<code>fixed_effects = c(&quot;diagnosis&quot;, &quot;dysbiosis&quot;)</code>）。对于具有超过2个水平的任何分类变量，还需要指定哪个变量应作为参考水平，方法是使用（<code>reference = c(&quot;diagnosis,nonIBD&quot;)</code>）。<strong>注</strong>：<font color=#FF0000>在变量和水平之间添加空格可能会导致使用错误的参考水平</font>。输出将生成在当前工作目录下的名为demo_output的文件夹中（<code>output = &quot;demo_output&quot;</code>）。在此示例中，输入数据已预先进行归一化和过滤，因此我们也将关闭默认的归一化和流行率过滤。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"输出\"><a href=\"#输出\" class=\"headerlink\" title=\"输出\"></a>输出</h2><h3 id=\"重要关联\"><a href=\"#重要关联\" class=\"headerlink\" title=\"重要关联\"></a>重要关联</h3><p>MaAsLin 2最重要的输出之一可能是重要关联的列表。这些关联在<code>significant_results.tsv</code>文件中提供：</p>\n<p><img src=\"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/sigresults_screenshot.png\" class=\"lazyload placeholder\" data-srcset=\"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/sigresults_screenshot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"significant_results.tsv\"></p>\n<p>这些是通过MaAsLin 2显著性阈值的全部关联列表，按照q值递增的顺序排序。列包括：</p>\n<ul>\n<li><p><strong>metadata</strong>：与微生物特征相关联的变量名。</p>\n</li>\n<li><p><strong>feature</strong>：微生物特征（分类群、基因、途径等）。</p>\n</li>\n<li><p><strong>value</strong>：对于分类特征，这是报告系数和关联显著性的具体特征水平。</p>\n</li>\n<li><p><strong>coef</strong>：模型系数值（效应大小）。对于分类变量，系数表示在value中指定的类别与参考类别之间的对比。</p>\n</li>\n<li><p><strong>stderr</strong>：模型的标准误差。</p>\n</li>\n<li><p><strong>N</strong>：用于此关联的模型中样本的总数（例如，因为可以排除缺失值）。</p>\n</li>\n<li><p><strong>N.not.0</strong>：在这些样本中，特征非零的总数。</p>\n</li>\n<li><p><strong>pval</strong>：此关联的名义显著性。</p>\n</li>\n<li><p><strong>qval</strong>：使用p.adjust函数和校正方法（如BH等）计算得到的校正显著性。</p>\n</li>\n<li><p><strong>问题</strong>：如何解释这个表格的第一行？</p>\n</li>\n</ul>\n<p>对于<code>significant_results.tsv</code>中的每个重要关联，MaAsLin 2还会生成可视化图表以供检查（分类变量的箱线图，连续变量的散点图）。这些图表命名为“metadata_name.pdf”。例如，从我们的分析运行中，我们得到了可视化文件<code>dysbiosis.pdf</code>和<code>diagnosis.pdf</code>。</p>\n<p><img src=\"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/scatterplot_screenshot.png\" class=\"lazyload placeholder\" data-srcset=\"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/scatterplot_screenshot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"dysbiosis.pdf\"></p>\n<p><img src=\"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/boxplot_screenshot.png\" class=\"lazyload placeholder\" data-srcset=\"https://raw.githubusercontent.com/biobakery/omnibus-and-maaslin2-rscripts-and-hmp2-data/master/assets/boxplot_screenshot.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"diagnosis.pdf\"></p>\n<h3 id=\"输出文件完整列表\"><a href=\"#输出文件完整列表\" class=\"headerlink\" title=\"输出文件完整列表\"></a>输出文件完整列表</h3><p>MaAsLin 2生成两种类型的输出文件：数据和可视化文件。</p>\n<ul>\n<li><p>数据输出文件</p>\n<ul>\n<li><p>significant_results.tsv</p>\n</li>\n<li><p>all_results.tsv</p>\n<ul>\n<li>与significant_results.tsv格式相同，但包含所有关联结果（而不仅仅是显著的结果）。</li>\n<li>您也可以在R中使用fit_data$results访问此表。</li>\n</ul>\n</li>\n<li><p>residuals.rds</p>\n<ul>\n<li>此文件包含一个包含每个特征残差的数据框。</li>\n</ul>\n</li>\n<li><p>maaslin2.log</p>\n<ul>\n<li>此文件包含运行的所有日志信息。</li>\n<li>它包括所有设置、警告、错误和运行的步骤。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>可视化输出文件</p>\n<ul>\n<li><p>heatmap.pdf</p>\n<ul>\n<li>此文件包含显著关联的热图。</li>\n</ul>\n</li>\n<li><p>[a-z&#x2F;0-9]+.pdf</p>\n<ul>\n<li>为每个显著关联生成一个图表。</li>\n<li>对于连续元数据，使用散点图。</li>\n<li>对于分类数据，使用箱线图。</li>\n<li>绘制的数据点已经过归一化、过滤和转换。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MaAsLin-2在功能谱上的应用\"><a href=\"#MaAsLin-2在功能谱上的应用\" class=\"headerlink\" title=\"MaAsLin 2在功能谱上的应用\"></a>MaAsLin 2在功能谱上的应用</h3><p>如果您的功能表是由HUMAnN生成的，并且已经使用<code>humann_renorm_table</code>脚本进行了归一化，那么您不需要执行任何额外的归一化——测序深度的影响已经被消除（这正是本教程中将使用的）。我们倾向于使用<code>CPM</code>单位，因为我们发现它们更方便，但在建模目的上，它们在数值上与相对丰度是等价的（<code>CPM = RA * 1e6</code>）。</p>\n<p>否则，可使用上述关于模型&#x2F;归一化&#x2F;转换的相同思路。</p>\n<p>在使用MaAsLin 2处理功能谱时的一些其他快速提示：</p>\n<ul>\n<li>为了减少特征数量，通常希望运行未分层的功能特征（或分层特征的过滤子集）。</li>\n<li>可能还想移除与特定分类群高度相关的功能特征（即可能由该微生物贡献），因为这些特征可以通过分类学变化得到更好的解释。</li>\n</ul>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#This can also be done with with the HUMAnN 3 untiliy `humann_split_stratified_table`</span></span><br><span class=\"line\">unstrat_pathways <span class=\"operator\">&lt;-</span><span class=\"keyword\">function</span><span class=\"punctuation\">(</span>dat_path<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  temp <span class=\"operator\">=</span> dat_path<span class=\"punctuation\">[</span><span class=\"operator\">!</span>grepl<span class=\"punctuation\">(</span><span class=\"string\">&quot;\\\\|&quot;</span><span class=\"punctuation\">,</span>rownames<span class=\"punctuation\">(</span>dat_path<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"built_in\">return</span><span class=\"punctuation\">(</span>temp<span class=\"punctuation\">)</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">df_input_path <span class=\"operator\">=</span> unstrat_pathways<span class=\"punctuation\">(</span>df_input_path<span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>在由<a href=\"https://github.com/biobakery/biobakery/wiki/biobakery_workflows\">bioBakery工作流程</a>生成的MetaCyc途径表上运行与上述相同的模型。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_func <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_path<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_functional&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                    fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    min_abundance  <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n<p><strong>注意</strong>：在这里，我们有列中的样本和行中的特征，MaAsLin 2正确地识别了这一点，并且能够匹配样本。</p>\n<p>作者最近还发表了关于使用MaAsLin 2分析宏转录组学数据（MTX）中差异特征的研究，有关该主题的更多信息，请参阅<a href=\"https://academic.oup.com/bioinformatics/article/37/Supplement_1/i34/6319701\">最近的出版物</a>。</p>\n<h1 id=\"高级主题\"><a href=\"#高级主题\" class=\"headerlink\" title=\"高级主题\"></a>高级主题</h1><h2 id=\"交互作用\"><a href=\"#交互作用\" class=\"headerlink\" title=\"交互作用\"></a>交互作用</h2><p>许多统计分析都关注于测试某些变量之间的交互作用。不幸的是，MaAsLin 2目前尚未提供直接的界面来进行此操作。相反，用户需要创建人工交互列作为额外的fixed_effects项。以上面的拟合为例，为了测试诊断与菌群失调之间的交互作用，我可以创建两列额外的数据：CD_dysbiosis和UC_dysbiosis（因为诊断的参考是非IBD）。</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df_input_metadata<span class=\"operator\">$</span>CD_dysbiosis <span class=\"operator\">=</span> <span class=\"punctuation\">(</span>df_input_metadata<span class=\"operator\">$</span>diagnosis <span class=\"operator\">==</span> <span class=\"string\">&quot;CD&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                                 df_input_metadata<span class=\"operator\">$</span>dysbiosis</span><br><span class=\"line\">df_input_metadata<span class=\"operator\">$</span>UC_dysbiosis <span class=\"operator\">=</span> <span class=\"punctuation\">(</span>df_input_metadata<span class=\"operator\">$</span>diagnosis <span class=\"operator\">==</span> <span class=\"string\">&quot;UC&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">*</span></span><br><span class=\"line\">                                 df_input_metadata<span class=\"operator\">$</span>dysbiosis</span><br><span class=\"line\"></span><br><span class=\"line\">fit_data_ixn <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_interaction&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;CD_dysbiosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;UC_dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                        reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"随机效应\"><a href=\"#随机效应\" class=\"headerlink\" title=\"随机效应\"></a>随机效应</h2><p>某些研究自然地将样本观测值“分组”，例如在纵向设计中按受试者分组或在家庭设计中按家庭分组。对于统计分析来说，重要的是要处理属于同一组的样本之间的非独立性。MaAsLin 2 通过 <code>random_effects</code> 参数提供了一个简单的界面来处理这个问题，用户可以在其中指定分组变量来运行混合效应模型。例如，我们注意到 HMP2 是一个纵向设计，其中同一个受试者（列中的 subject）可以有多个样本。因此，我们要求 MaAsLin 2 使用 subject 作为其随机效应分组变量：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data_random <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_random&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           random_effects <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;subject&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你对在纵向研究中测试时间的影响感兴趣，那么在调用 MaAsLin 2 时，时间点变量应该包含在 <code>fixed_effects </code>中。</p>\n<ul>\n<li>问题：直觉上，你能想到为什么解决样本之间的非独立性很重要吗？<ul>\n<li>提示：想象一下一个简单的场景，你有两个受试者，一个病例和一个对照，每个受试者都有两个样本。</li>\n<li>当同一受试者的样本高度独立时，与它们高度相关时，有效样本大小是多少？</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"其他选项\"><a href=\"#其他选项\" class=\"headerlink\" title=\"其他选项\"></a>其他选项</h2><p>MaAsLin 2 提供了许多参数选项，用于不同的数据预处理（规范化、过滤、转换）和其他任务。这些选项的完整列表是：</p>\n<ul>\n<li><p>min_abundance</p>\n<ul>\n<li>每个特征的最小丰度 [ 默认值：0 ]</li>\n</ul>\n</li>\n<li><p>min_prevalence</p>\n<ul>\n<li>以最小丰度检测到一个特征的最小样本百分比 [ 默认值：0.1 ]</li>\n</ul>\n</li>\n<li><p>max_significance</p>\n<ul>\n<li>显著性的 q 值阈值 [ 默认值：0.25 ]</li>\n</ul>\n</li>\n<li><p>normalization</p>\n<ul>\n<li>要应用的规范化方法 [ 默认值：”TSS” ] [ 选项：”TSS”、”CLR”、”CSS”、”NONE”、”TMM” ]</li>\n</ul>\n</li>\n<li><p>transform</p>\n<ul>\n<li>要应用的转换 [ 默认值：”LOG” ] [ 选项：”LOG”、”LOGIT”、”AST”、”NONE” ]</li>\n</ul>\n</li>\n<li><p>analysis_method</p>\n<ul>\n<li>要应用的分析方法 [ 默认值：”LM” ] [ 选项：”LM”、”CPLM”、”ZICP”、”NEGBIN”、”ZINB” ]</li>\n</ul>\n</li>\n<li><p>correction</p>\n<ul>\n<li>计算 q 值的校正方法 [ 默认值：”BH” ]</li>\n</ul>\n</li>\n<li><p>standardize</p>\n<ul>\n<li>应用 z 分数，以便连续元数据在同一尺度上 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>plot_heatmap</p>\n<ul>\n<li>为显著关联生成热图 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>heatmap_first_n</p>\n<ul>\n<li>在热图中，绘制具有显著关联的前 N 个特征 [ 默认值：50 ]</li>\n</ul>\n</li>\n<li><p>plot_scatter</p>\n<ul>\n<li>为显著关联生成散点图 [ 默认值：TRUE ]</li>\n</ul>\n</li>\n<li><p>cores</p>\n<ul>\n<li>并行运行的 R 进程数 [ 默认值：1 ]</li>\n</ul>\n</li>\n<li><p>reference</p>\n<ul>\n<li>用作具有两个以上级别的变量的参考，以“变量,参考”的字符串形式提供，多个变量之间用分号分隔。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MaAsLin-2-中的流行率和丰度过滤\"><a href=\"#MaAsLin-2-中的流行率和丰度过滤\" class=\"headerlink\" title=\"MaAsLin 2 中的流行率和丰度过滤\"></a>MaAsLin 2 中的流行率和丰度过滤</h3><p>通常，只有在某个特征在“足够”多的时间内非零时，测试特征与元数据之间的关联才有意义。“足够”的具体比例可能因研究而异，但 10-50% 的最小流行率阈值并不罕见（高达 70-90% 也是合理的）。由于我们已经在使用一小部分精选的演示数据，我们将使用 <code>min_prevalence = 0.1</code> 来仅测试至少 10% 的非零值的特征。请注意：这是 MaAsLin 2 中的默认参数设置。</p>\n<p>类似地，通常只希望测试在这么多样本中达到最小丰度阈值的特征。默认情况下，MaAsLin 2 会认为任何非零值都是可靠的，如果你已经在数据集中进行了充分的质量控制（QC），那么这样做是合适的。然而，如果你想要进行更多过滤或采取保守态度，你可以设置一个最小丰度阈值，如 <code>min_abundance = 0.0001</code>，以仅测试达到这个（相对）丰度的特征。</p>\n<p>将这些参数组合起来，我们可以使用两者来运行 MaAsLin 2（并且速度会更快！）：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fit_data_filter <span class=\"operator\">=</span> Maaslin2<span class=\"punctuation\">(</span>input_data     <span class=\"operator\">=</span> df_input_data<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           input_metadata <span class=\"operator\">=</span> df_input_metadata<span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           normalization  <span class=\"operator\">=</span> <span class=\"string\">&quot;NONE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           output         <span class=\"operator\">=</span> <span class=\"string\">&quot;demo_output_filter&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">                           fixed_effects  <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;dysbiosis&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           reference      <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;diagnosis,nonIBD&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           random_effects <span class=\"operator\">=</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"string\">&quot;subject&quot;</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           min_prevalence <span class=\"operator\">=</span> <span class=\"number\">0.1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                           min_abundance  <span class=\"operator\">=</span> <span class=\"number\">0.0001</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"命令行\"><a href=\"#命令行\" class=\"headerlink\" title=\"命令行\"></a>命令行</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Maaslin2.R --transform=AST --fixed_effects=<span class=\"string\">&quot;diagnosis,dysbiosis&quot;</span>  /usr/local/lib/R/site-library/Maaslin2/extdata/HMP2_taxonomy.tsv /usr/local/lib/R/site-library/Maaslin2/extdata/HMP2_metadata.tsv demo_output --reference=<span class=\"string\">&quot;diagnosis,nonIBD&quot;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ Maaslin2.R --help</span><br><span class=\"line\">Usage: ./R/Maaslin2.R [options] &lt;data.tsv&gt; &lt;metadata.tsv&gt; &lt;output_folder&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">    -h, --help</span><br><span class=\"line\">        Show this help message and exit</span><br><span class=\"line\"></span><br><span class=\"line\">    -a MIN_ABUNDANCE, --min_abundance=MIN_ABUNDANCE</span><br><span class=\"line\">        The minimum abundance for each feature [ Default: 0 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -p MIN_PREVALENCE, --min_prevalence=MIN_PREVALENCE</span><br><span class=\"line\">        The minimum percent of samples for which a feature </span><br><span class=\"line\">        is detected at minimum abundance [ Default: 0.1 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -s MAX_SIGNIFICANCE, --max_significance=MAX_SIGNIFICANCE</span><br><span class=\"line\">        The q-value threshold for significance [ Default: 0.25 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -n NORMALIZATION, --normalization=NORMALIZATION</span><br><span class=\"line\">        The normalization method to apply [ Default: TSS ]</span><br><span class=\"line\">        [ Choices: TSS, CLR, CSS, NONE, TMM ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -t TRANSFORM, --transform=TRANSFORM</span><br><span class=\"line\">        The transform to apply [ Default: LOG ]</span><br><span class=\"line\">        [ Choices: LOG, LOGIT, AST, NONE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -m ANALYSIS_METHOD, --analysis_method=ANALYSIS_METHOD</span><br><span class=\"line\">        The analysis method to apply [ Default: LM ]</span><br><span class=\"line\">        [ Choices: LM, CPLM, NEGBIN, ZINB ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -r RANDOM_EFFECTS, --random_effects=RANDOM_EFFECTS</span><br><span class=\"line\">        The random effects for the model, comma-delimited</span><br><span class=\"line\">        for multiple effects [ Default: none ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -f FIXED_EFFECTS, --fixed_effects=FIXED_EFFECTS</span><br><span class=\"line\">        The fixed effects for the model, comma-delimited</span><br><span class=\"line\">        for multiple effects [ Default: all ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -c CORRECTION, --correction=CORRECTION</span><br><span class=\"line\">        The correction method for computing the </span><br><span class=\"line\">        q-value [ Default: BH ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -z STANDARDIZE, --standardize=STANDARDIZE</span><br><span class=\"line\">        Apply z-score so continuous metadata are </span><br><span class=\"line\">        on the same scale [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -l PLOT_HEATMAP, --plot_heatmap=PLOT_HEATMAP</span><br><span class=\"line\">        Generate a heatmap for the significant </span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -i HEATMAP_FIRST_N, --heatmap_first_n=HEATMAP_FIRST_N</span><br><span class=\"line\">        In heatmap, plot top N features with significant </span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -o PLOT_SCATTER, --plot_scatter=PLOT_SCATTER</span><br><span class=\"line\">        Generate scatter plots for the significant</span><br><span class=\"line\">        associations [ Default: TRUE ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -e CORES, --cores=CORES</span><br><span class=\"line\">        The number of R processes to run in parallel</span><br><span class=\"line\">        [ Default: 1 ]</span><br><span class=\"line\"></span><br><span class=\"line\">    -r REFERENCE, --reference=&#x27;VARIABLE,REFERENCE&#x27;</span><br><span class=\"line\">        The factor to use as a reference for a </span><br><span class=\"line\">        variable with more than two levels </span><br><span class=\"line\">        provided as a string of &#x27;variable,reference&#x27; </span><br><span class=\"line\">        semi-colon delimited for multiple variables.</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ul>\n<li>Mallick H, Rahnavard A, McIver LJ, Ma S, Zhang Y, Nguyen LH, Tickle TL, Weingart G, Ren B, Schwager EH, Chatterjee S, Thompson KN, Wilkinson JE, Subramanian A, Lu Y, Waldron L, Paulson JN, Franzosa EA, Bravo HC, Huttenhower C (2021). <a href=\"https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1009442\">Multivariable Association Discovery in Population-scale Meta-omics Studies</a>. PLoS Computational Biology, 17(11):e1009442.</li>\n</ul>\n<h1 id=\"加关注\"><a href=\"#加关注\" class=\"headerlink\" title=\"加关注\"></a>加关注</h1><table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/生信之巅公众号.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅微信公众号\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/小程序码.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"生信之巅小程序码\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n","raw":null,"categories":[{"name":"生物信息","path":"api/categories/生物信息.json"}],"tags":[{"name":"扩增子","path":"api/tags/扩增子.json"},{"name":"生信软件","path":"api/tags/生信软件.json"},{"name":"R语言","path":"api/tags/R语言.json"}]}]}