{"name":"ç³»ç»Ÿ","postlist":[{"title":"CentOS 7 å‡çº§ GCC æ•™ç¨‹ï¼ˆä»¥ GCC 9 ä¸ºä¾‹ï¼‰","slug":"CentOS-7-å‡çº§-GCC-æ•™ç¨‹ï¼ˆä»¥-GCC-9-ä¸ºä¾‹ï¼‰","date":"2025-10-19T13:33:35.000Z","updated":"2025-10-19T13:40:18.210Z","comments":true,"path":"api/articles/CentOS-7-å‡çº§-GCC-æ•™ç¨‹ï¼ˆä»¥-GCC-9-ä¸ºä¾‹ï¼‰.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/ç”Ÿä¿¡ä¹‹å·…å…¬ä¼—å·.jpg","content":"<h2 id=\"ä¸€ã€æ•™ç¨‹èƒŒæ™¯\"><a href=\"#ä¸€ã€æ•™ç¨‹èƒŒæ™¯\" class=\"headerlink\" title=\"ä¸€ã€æ•™ç¨‹èƒŒæ™¯\"></a>ä¸€ã€æ•™ç¨‹èƒŒæ™¯</h2><p>CentOS 7 ç³»ç»Ÿé»˜è®¤é¢„è£…çš„ GCC ç‰ˆæœ¬ä¸º <strong>4.8.5</strong>ï¼ˆå‘å¸ƒäº 2015 å¹´ï¼‰ï¼Œè€Œç°ä»£å¼€å‘åœºæ™¯ä¸­ï¼Œè®¸å¤šè½¯ä»¶ï¼ˆå¦‚é«˜ç‰ˆæœ¬ Pythonã€TensorFlowã€C++ 11+ é¡¹ç›®ç­‰ï¼‰å¯¹ GCC ç‰ˆæœ¬è¦æ±‚è¾ƒé«˜ï¼ˆéœ€ 5.4+ åŠä»¥ä¸Šï¼‰ã€‚å› æ­¤éœ€å‡çº§ GCCï¼Œä½†ç›´æ¥è¦†ç›–ç³»ç»Ÿé»˜è®¤ GCC å¯èƒ½å¯¼è‡´ä¾èµ–å†²çªï¼ˆå¦‚ <code>yum</code> å·¥å…·ä¾èµ–æ—§ç‰ˆæœ¬ï¼‰ã€‚</p>\n<p>æœ¬æ•™ç¨‹é‡‡ç”¨ <strong>SCLï¼ˆSoftware Collectionsï¼‰ä»“åº“</strong> æ–¹å¼å‡çº§ï¼Œå¯åœ¨ä¸è¦†ç›–ç³»ç»Ÿé»˜è®¤ GCC çš„å‰æä¸‹ï¼Œå®‰è£…å¹¶ä½¿ç”¨é«˜ç‰ˆæœ¬ GCCï¼ˆä»¥ GCC 9 ä¸ºä¾‹ï¼Œç¨³å®šä¸”å…¼å®¹æ€§å¼ºï¼‰ï¼Œå®‰å…¨ä¸”çµæ´»ã€‚</p>\n<h2 id=\"äºŒã€å‡çº§å‰å‡†å¤‡\"><a href=\"#äºŒã€å‡çº§å‰å‡†å¤‡\" class=\"headerlink\" title=\"äºŒã€å‡çº§å‰å‡†å¤‡\"></a>äºŒã€å‡çº§å‰å‡†å¤‡</h2><p>ç¡®ä¿ç³»ç»Ÿå·²è”ç½‘ï¼Œä¸”æ‹¥æœ‰ <code>root</code> æƒé™ï¼ˆæˆ–ä½¿ç”¨ <code>sudo</code> æƒé™æ‰§è¡Œå‘½ä»¤ï¼‰ã€‚</p>\n<h2 id=\"ä¸‰ã€è¯¦ç»†å‡çº§æ­¥éª¤\"><a href=\"#ä¸‰ã€è¯¦ç»†å‡çº§æ­¥éª¤\" class=\"headerlink\" title=\"ä¸‰ã€è¯¦ç»†å‡çº§æ­¥éª¤\"></a>ä¸‰ã€è¯¦ç»†å‡çº§æ­¥éª¤</h2><h3 id=\"1-å¤‡ä»½åŸæœ‰-YUM-æºï¼ˆå…³é”®ï¼šé˜²æ­¢é…ç½®å‡ºé”™ï¼‰\"><a href=\"#1-å¤‡ä»½åŸæœ‰-YUM-æºï¼ˆå…³é”®ï¼šé˜²æ­¢é…ç½®å‡ºé”™ï¼‰\" class=\"headerlink\" title=\"1. å¤‡ä»½åŸæœ‰ YUM æºï¼ˆå…³é”®ï¼šé˜²æ­¢é…ç½®å‡ºé”™ï¼‰\"></a>1. å¤‡ä»½åŸæœ‰ YUM æºï¼ˆå…³é”®ï¼šé˜²æ­¢é…ç½®å‡ºé”™ï¼‰</h3><p>CentOS 7 åœæ­¢å®˜æ–¹ç»´æŠ¤åï¼Œé»˜è®¤ YUM æºå¯èƒ½å¤±æ•ˆï¼Œä¸”åç»­éœ€æ·»åŠ æ–°ä»“åº“é…ç½®ã€‚å…ˆå¤‡ä»½åŸæœ‰æºæ–‡ä»¶ï¼Œé¿å…è¯¯æ“ä½œåæ— æ³•æ¢å¤ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå¤‡ä»½ç›®å½•</span></span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> -p /etc/yum.repos.d/backup</span><br><span class=\"line\"><span class=\"comment\"># å°†æ‰€æœ‰ .repo æºæ–‡ä»¶ç§»åŠ¨åˆ°å¤‡ä»½ç›®å½•</span></span><br><span class=\"line\">sudo <span class=\"built_in\">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"2-æ·»åŠ -SCL-ä»“åº“é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘æºï¼‰\"><a href=\"#2-æ·»åŠ -SCL-ä»“åº“é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘æºï¼‰\" class=\"headerlink\" title=\"2. æ·»åŠ  SCL ä»“åº“é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘æºï¼‰\"></a>2. æ·»åŠ  SCL ä»“åº“é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘æºï¼‰</h3><p>SCL ä»“åº“æ˜¯å‡çº§ GCC çš„æ ¸å¿ƒï¼Œè¿™é‡Œé€‰æ‹© <strong>é˜¿é‡Œäº‘ SCL æº</strong>ï¼ˆå›½å†…è®¿é—®é€Ÿåº¦å¿«ï¼Œç¨³å®šæ€§é«˜ï¼‰ï¼Œæ‰‹åŠ¨åˆ›å»ºä»“åº“é…ç½®æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç”¨ vi ç¼–è¾‘å™¨åˆ›å»ºå¹¶ç¼–è¾‘ centos-sclo-rh.repo æ–‡ä»¶</span></span><br><span class=\"line\">sudo vi /etc/yum.repos.d/centos-sclo-rh.repo</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“å¼€ç¼–è¾‘å™¨åï¼ŒæŒ‰ <code>i</code> è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œ<strong>å®Œæ•´å¤åˆ¶ä»¥ä¸‹å†…å®¹</strong>ï¼ˆä¸è¦é—æ¼æˆ–ä¿®æ”¹æ ¼å¼ï¼‰ï¼š</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[centos-sclo-rh]</span><br><span class=\"line\">name=CentOS-7 - SCLo rh</span><br><span class=\"line\">baseurl=https://mirrors.aliyun.com/centos/7/sclo/x86_64/rh/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class=\"line\">enabled=1</span><br></pre></td></tr></table></figure>\n\n<p>å¤åˆ¶å®Œæˆåï¼ŒæŒ‰ <code>Esc</code> é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œè¾“å…¥ <code>:wq</code> å¹¶å›è½¦ï¼ˆä¿å­˜å¹¶é€€å‡º vi ç¼–è¾‘å™¨ï¼‰ã€‚</p>\n<h3 id=\"3-æ¸…ç†-YUM-ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜\"><a href=\"#3-æ¸…ç†-YUM-ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜\" class=\"headerlink\" title=\"3. æ¸…ç† YUM ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜\"></a>3. æ¸…ç† YUM ç¼“å­˜å¹¶ç”Ÿæˆæ–°ç¼“å­˜</h3><p>æ–°æ·»åŠ ä»“åº“åï¼Œéœ€æ¸…ç†æ—§ç¼“å­˜ã€åŠ è½½æ–°ä»“åº“çš„åŒ…åˆ—è¡¨ï¼Œç¡®ä¿åç»­å®‰è£…èƒ½æ‰¾åˆ°æ­£ç¡®çš„è½¯ä»¶åŒ…ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¸…ç†æ‰€æœ‰ YUM ç¼“å­˜</span></span><br><span class=\"line\">sudo yum clean all &amp;&amp; </span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆæ–°çš„ç¼“å­˜ï¼ˆä¸‹è½½é˜¿é‡Œäº‘æºçš„åŒ…åˆ—è¡¨ï¼‰</span></span><br><span class=\"line\">sudo yum makecache</span><br></pre></td></tr></table></figure>\n\n<p>æ‰§è¡Œåè€å¿ƒç­‰å¾…ï¼ˆæ—¶é—´å–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰ï¼Œè‹¥æ— æŠ¥é”™åˆ™ç¼“å­˜ç”ŸæˆæˆåŠŸã€‚</p>\n<h3 id=\"4-ï¼ˆå¯é€‰ï¼‰å®‰è£…-SCL-ä»“åº“åŸºç¡€åŒ…\"><a href=\"#4-ï¼ˆå¯é€‰ï¼‰å®‰è£…-SCL-ä»“åº“åŸºç¡€åŒ…\" class=\"headerlink\" title=\"4. ï¼ˆå¯é€‰ï¼‰å®‰è£… SCL ä»“åº“åŸºç¡€åŒ…\"></a>4. ï¼ˆå¯é€‰ï¼‰å®‰è£… SCL ä»“åº“åŸºç¡€åŒ…</h3><p>å¤šæ•°æƒ…å†µä¸‹ï¼Œæ­¥éª¤ 2 æ·»åŠ çš„é…ç½®æ–‡ä»¶å·²è¶³å¤Ÿï¼Œä½†è‹¥åç»­å®‰è£… GCC æ—¶æç¤ºâ€œä»“åº“ä¸å­˜åœ¨â€ï¼Œå¯æ‰§è¡Œæ­¤æ­¥éª¤å®‰è£… SCL ä»“åº“åŸºç¡€åŒ…ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y centos-release-scl</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"5-å®‰è£…é«˜ç‰ˆæœ¬-GCCï¼ˆGCC-9ï¼‰\"><a href=\"#5-å®‰è£…é«˜ç‰ˆæœ¬-GCCï¼ˆGCC-9ï¼‰\" class=\"headerlink\" title=\"5. å®‰è£…é«˜ç‰ˆæœ¬ GCCï¼ˆGCC 9ï¼‰\"></a>5. å®‰è£…é«˜ç‰ˆæœ¬ GCCï¼ˆGCC 9ï¼‰</h3><p>é€šè¿‡ YUM å®‰è£… <code>devtoolset-9</code>ï¼ˆå¯¹åº” GCC 9 ç‰ˆæœ¬ï¼‰ï¼Œå¹¶æ·»åŠ  <code>--nogpgcheck</code> å‚æ•°ï¼ˆè·³è¿‡ GPG å¯†é’¥éªŒè¯ï¼Œå›  CentOS 7 å®˜æ–¹å¯†é’¥æºå·²å¤±æ•ˆï¼Œä¸å½±å“åŒ…å®‰å…¨æ€§ï¼‰ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils --nogpgcheck</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>devtoolset-9-gcc</code>ï¼šGCC 9 æ ¸å¿ƒåŒ…</li>\n<li><code>devtoolset-9-gcc-c++</code>ï¼šC++ ç¼–è¯‘ç»„ä»¶ï¼ˆå¦‚éœ€ç¼–è¯‘ C++ é¡¹ç›®å¿…è£…ï¼‰</li>\n<li><code>devtoolset-9-binutils</code>ï¼šäºŒè¿›åˆ¶å·¥å…·é›†ï¼ˆè¾…åŠ©ç¼–è¯‘ï¼‰</li>\n</ul>\n<p>æ‰§è¡Œåç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦ 50MB ä¸‹è½½é‡ï¼‰ï¼Œæ— æŠ¥é”™åˆ™å®‰è£…æˆåŠŸã€‚</p>\n<h3 id=\"6-å¯ç”¨é«˜ç‰ˆæœ¬-GCC\"><a href=\"#6-å¯ç”¨é«˜ç‰ˆæœ¬-GCC\" class=\"headerlink\" title=\"6. å¯ç”¨é«˜ç‰ˆæœ¬ GCC\"></a>6. å¯ç”¨é«˜ç‰ˆæœ¬ GCC</h3><p>SCL å®‰è£…çš„ GCC ä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œéœ€æ‰‹åŠ¨å¯ç”¨ï¼Œæ”¯æŒ <strong>ä¸´æ—¶å¯ç”¨</strong> å’Œ <strong>æ°¸ä¹…å¯ç”¨</strong>ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š</p>\n<h4 id=\"æ–¹å¼-1ï¼šä¸´æ—¶å¯ç”¨ï¼ˆä»…å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰\"><a href=\"#æ–¹å¼-1ï¼šä¸´æ—¶å¯ç”¨ï¼ˆä»…å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰\" class=\"headerlink\" title=\"æ–¹å¼ 1ï¼šä¸´æ—¶å¯ç”¨ï¼ˆä»…å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰\"></a>æ–¹å¼ 1ï¼šä¸´æ—¶å¯ç”¨ï¼ˆä»…å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰</h4><p>é€‚ç”¨äºâ€œä¸´æ—¶ä½¿ç”¨é«˜ç‰ˆæœ¬ GCCâ€çš„åœºæ™¯ï¼Œå…³é—­ç»ˆç«¯åæ¢å¤é»˜è®¤ GCC 4.8.5ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scl <span class=\"built_in\">enable</span> devtoolset-9 bash</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æ–¹å¼-2ï¼šæ°¸ä¹…å¯ç”¨ï¼ˆæ¨èï¼‰\"><a href=\"#æ–¹å¼-2ï¼šæ°¸ä¹…å¯ç”¨ï¼ˆæ¨èï¼‰\" class=\"headerlink\" title=\"æ–¹å¼ 2ï¼šæ°¸ä¹…å¯ç”¨ï¼ˆæ¨èï¼‰\"></a>æ–¹å¼ 2ï¼šæ°¸ä¹…å¯ç”¨ï¼ˆæ¨èï¼‰</h4><p>è‹¥éœ€æ¯æ¬¡ç™»å½•ç»ˆç«¯éƒ½è‡ªåŠ¨ä½¿ç”¨ GCC 9ï¼Œå¯å°†å¯ç”¨å‘½ä»¤å†™å…¥ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œåˆ†â€œå½“å‰ç”¨æˆ·â€å’Œâ€œå…¨å±€æ‰€æœ‰ç”¨æˆ·â€ä¸¤ç§åœºæ™¯ï¼š</p>\n<h5 id=\"åœºæ™¯-Aï¼šä»…å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆæ¨èæ™®é€šç”¨æˆ·ï¼‰\"><a href=\"#åœºæ™¯-Aï¼šä»…å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆæ¨èæ™®é€šç”¨æˆ·ï¼‰\" class=\"headerlink\" title=\"åœºæ™¯ Aï¼šä»…å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆæ¨èæ™®é€šç”¨æˆ·ï¼‰\"></a>åœºæ™¯ Aï¼šä»…å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆæ¨èæ™®é€šç”¨æˆ·ï¼‰</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†å¯ç”¨å‘½ä»¤å†™å…¥å½“å‰ç”¨æˆ·çš„ .bashrc æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€é‡å¯ç»ˆç«¯ï¼‰</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"åœºæ™¯-Bï¼šå…¨å±€æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆéœ€-root-æƒé™ï¼‰\"><a href=\"#åœºæ™¯-Bï¼šå…¨å±€æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆéœ€-root-æƒé™ï¼‰\" class=\"headerlink\" title=\"åœºæ™¯ Bï¼šå…¨å±€æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆéœ€ root æƒé™ï¼‰\"></a>åœºæ™¯ Bï¼šå…¨å±€æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆéœ€ root æƒé™ï¼‰</h5><p>é€‚ç”¨äºå¤šç”¨æˆ·æœåŠ¡å™¨ï¼Œæ‰€æœ‰ç”¨æˆ·ç™»å½•åå‡ä½¿ç”¨ GCC 9ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼ˆè‹¥å½“å‰é rootï¼‰</span></span><br><span class=\"line\">su root</span><br><span class=\"line\"><span class=\"comment\"># å°†å¯ç”¨å‘½ä»¤å†™å…¥å…¨å±€ç¯å¢ƒå˜é‡æ–‡ä»¶ /etc/profile</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"7-éªŒè¯-GCC-å‡çº§ç»“æœ\"><a href=\"#7-éªŒè¯-GCC-å‡çº§ç»“æœ\" class=\"headerlink\" title=\"7. éªŒè¯ GCC å‡çº§ç»“æœ\"></a>7. éªŒè¯ GCC å‡çº§ç»“æœ</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ GCC ç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯å¦å‡çº§æˆåŠŸï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -v</span><br></pre></td></tr></table></figure>\n\n<p>è‹¥è¾“å‡ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼ˆç‰ˆæœ¬å·ä¸º 9.3.1 åŠä»¥ä¸Šï¼‰ï¼Œåˆ™è¯´æ˜å‡çº§æˆåŠŸï¼š</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Using built-in specs.</span><br><span class=\"line\">COLLECT_GCC=gcc</span><br><span class=\"line\">COLLECT_LTO_WRAPPER=/opt/rh/devtoolset-9/root/usr/libexec/gcc/x86_64-redhat-linux/9/lto-wrapper</span><br><span class=\"line\">Target: x86_64-redhat-linux</span><br><span class=\"line\">Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/opt/rh/devtoolset-9/root/usr --mandir=/opt/rh/devtoolset-9/root/usr/share/man --infodir=/opt/rh/devtoolset-9/root/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --with-default-libstdcxx-abi=gcc4-compatible --enable-plugin --enable-initfini-array --with-isl=/builddir/build/BUILD/gcc-9.3.1-20200408/obj-x86_64-redhat-linux/isl-install --disable-libmpx --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux</span><br><span class=\"line\">Thread model: posix</span><br><span class=\"line\">gcc version 9.3.1 20200408 (Red Hat 9.3.1-2.2.el7) (GCC)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"å››ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹\"><a href=\"#å››ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"å››ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹\"></a>å››ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2><ol>\n<li><p><strong>è‹¥éœ€å®‰è£…å…¶ä»– GCC ç‰ˆæœ¬</strong>ï¼š<br>æœ¬æ•™ç¨‹ä»¥ GCC 9 ä¸ºä¾‹ï¼Œè‹¥éœ€å®‰è£… GCC 10ï¼Œåªéœ€å°†å‘½ä»¤ä¸­çš„ <code>devtoolset-9</code> æ›¿æ¢ä¸º <code>devtoolset-10</code>ï¼ˆå¦‚ <code>devtoolset-10-gcc</code>ï¼‰ï¼Œå…¶ä»–æ­¥éª¤ä¸€è‡´ã€‚</p>\n</li>\n<li><p><strong>ç³»ç»Ÿé»˜è®¤ GCC æœªè¢«è¦†ç›–</strong>ï¼š<br>SCL å®‰è£…çš„ GCC ä½äº <code>/opt/rh/devtoolset-9/root/usr/bin/</code>ï¼Œç³»ç»Ÿé»˜è®¤ GCCï¼ˆ4.8.5ï¼‰ä»åœ¨ <code>/usr/bin/gcc</code>ï¼Œè‹¥éœ€ä¸´æ—¶ä½¿ç”¨æ—§ç‰ˆæœ¬ï¼Œå¯ç›´æ¥æ‰§è¡Œ <code>/usr/bin/gcc -v</code>ã€‚</p>\n</li>\n<li><p><strong>å®‰è£…æ—¶æç¤ºâ€œæ— å¯ç”¨è½¯ä»¶åŒ…â€</strong>ï¼š<br>é‡æ–°æ‰§è¡Œæ­¥éª¤ 3ï¼ˆæ¸…ç†å¹¶ç”Ÿæˆç¼“å­˜ï¼‰ï¼Œæˆ–æ£€æŸ¥æ­¥éª¤ 2 çš„ä»“åº“é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼ˆç¡®ä¿ <code>baseurl</code> æœªå†™é”™ï¼‰ã€‚</p>\n</li>\n</ol>\n<h2 id=\"äº”ã€æ€»ç»“\"><a href=\"#äº”ã€æ€»ç»“\" class=\"headerlink\" title=\"äº”ã€æ€»ç»“\"></a>äº”ã€æ€»ç»“</h2><p>é€šè¿‡æœ¬æ•™ç¨‹ï¼Œå¯åœ¨ CentOS 7 ä¸Šå®‰å…¨å‡çº§ GCC è‡³ 9 ç‰ˆæœ¬ï¼ˆæˆ–æ›´é«˜ï¼‰ï¼Œæ»¡è¶³ç°ä»£è½¯ä»¶å¼€å‘éœ€æ±‚ï¼Œä¸”ä¸å½±å“ç³»ç»ŸåŸæœ‰ä¾èµ–ã€‚è‹¥åç»­éœ€ç¼–è¯‘è½¯ä»¶ï¼ˆå¦‚ Pythonã€C++ é¡¹ç›®ï¼‰ï¼Œç›´æ¥ä½¿ç”¨ <code>gcc</code> æˆ– <code>g++</code> å‘½ä»¤å³å¯è°ƒç”¨é«˜ç‰ˆæœ¬å·¥å…·ã€‚</p>\n<h2 id=\"åŠ å…³æ³¨\"><a href=\"#åŠ å…³æ³¨\" class=\"headerlink\" title=\"åŠ å…³æ³¨\"></a>åŠ å…³æ³¨</h2><p>å…³æ³¨å…¬ä¼—å·â€œç”Ÿä¿¡ä¹‹å·…â€ã€‚</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/ç”Ÿä¿¡ä¹‹å·…å…¬ä¼—å·.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/ç”Ÿä¿¡ä¹‹å·…å…¬ä¼—å·.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"ç”Ÿä¿¡ä¹‹å·…å¾®ä¿¡å…¬ä¼—å·\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/å°ç¨‹åºç .png\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/å°ç¨‹åºç .png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"ç”Ÿä¿¡ä¹‹å·…å°ç¨‹åºç \" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"}]},{"title":"CentOS7.9 Ollama GPU è°ƒç”¨è¡€æ³ªå²ï¼ä»ç¼–è¯‘å¤±è´¥åˆ° Docker éƒ¨ç½²å…¨æ”»ç•¥","slug":"CentOS7.9 Ollama GPU è°ƒç”¨è¡€æ³ªå²ï¼ä»ç¼–è¯‘å¤±è´¥åˆ° Docker éƒ¨ç½²å…¨æ”»ç•¥","date":"2025-12-18T11:18:18.000Z","updated":"2025-12-18T11:21:09.255Z","comments":true,"path":"api/articles/CentOS7.9 Ollama GPU è°ƒç”¨è¡€æ³ªå²ï¼ä»ç¼–è¯‘å¤±è´¥åˆ° Docker éƒ¨ç½²å…¨æ”»ç•¥.json","excerpt":null,"keywords":null,"cover":"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/fef2/fig1.jpg","content":"<p>ğŸ“ä½œä¸º CentOS7.9 è€ç”¨æˆ·ï¼Œæƒ³è·‘ Ollama å¤§æ¨¡å‹å´è¢«ç‹ ç‹ æ‹¿æï¼šglibc ç‰ˆæœ¬ä½ã€ç¼–è¯‘å GPU ä¸è¯†åˆ«ã€è£…äº† CUDA ä¹Ÿç™½æ­â€¦ æŠ˜è…¾ä¸€å‘¨ç»ˆäºæ‰“é€šå…¨æµç¨‹ï¼ŒæŠŠæ¯ä¸ªå‘å’Œè§£å†³æ–¹æ¡ˆéƒ½æ‰’å¾—æ˜æ˜ç™½ç™½ï¼ŒåŒæ¬¾ç¯å¢ƒçš„æœ‹å‹ç›´æ¥æŠ„ä½œä¸šï¼</p>\n<h1 id=\"ğŸš¨-äº‹æƒ…çš„æ¥é¾™å»è„‰ï¼šä»ç¼–è¯‘æˆåŠŸåˆ°-GPU-å¡å£³\"><a href=\"#ğŸš¨-äº‹æƒ…çš„æ¥é¾™å»è„‰ï¼šä»ç¼–è¯‘æˆåŠŸåˆ°-GPU-å¡å£³\" class=\"headerlink\" title=\"ğŸš¨ äº‹æƒ…çš„æ¥é¾™å»è„‰ï¼šä»ç¼–è¯‘æˆåŠŸåˆ° GPU å¡å£³\"></a>ğŸš¨ äº‹æƒ…çš„æ¥é¾™å»è„‰ï¼šä»ç¼–è¯‘æˆåŠŸåˆ° GPU å¡å£³</h1><h2 id=\"é˜¶æ®µ-1ï¼šglibc-å¤ªä½ï¼Œç›´æ¥è£…-Ollama-æ²¡æˆ\"><a href=\"#é˜¶æ®µ-1ï¼šglibc-å¤ªä½ï¼Œç›´æ¥è£…-Ollama-æ²¡æˆ\" class=\"headerlink\" title=\"é˜¶æ®µ 1ï¼šglibc å¤ªä½ï¼Œç›´æ¥è£… Ollama æ²¡æˆ\"></a>é˜¶æ®µ 1ï¼šglibc å¤ªä½ï¼Œç›´æ¥è£… Ollama æ²¡æˆ</h2><p>CentOS7.9 é»˜è®¤ glibc 2.17ï¼Œè€Œ Ollama GPU ç‰ˆè¦æ±‚ glibcâ‰¥2.27ï¼Œå‡çº§ç³»ç»Ÿ glibc æ€•æå´© yumã€bash ç­‰æ ¸å¿ƒå·¥å…·ï¼ˆè¡€çš„æ•™è®­ï¼šåƒä¸‡åˆ«ç¡¬å‡ï¼ï¼‰ã€‚</p>\n<p>æ²¡åŠæ³•åªèƒ½æ›²çº¿æ•‘å›½ â€”â€” ç”¨ Go æ‰‹åŠ¨ç¼–è¯‘ Ollama æºç ï¼Œä¸€é¡¿æ“ä½œåç»ˆäºèƒ½è¿è¡Œï¼Œä½†æ–°é—®é¢˜æ¥äº†ï¼š<strong>æ¨¡å‹ç”Ÿæˆé€Ÿåº¦æ…¢åˆ°ç¦»è°±</strong>ï¼Œnvidia-smi ä¸€çœ‹ï¼ŒGPU åˆ©ç”¨ç‡å§‹ç»ˆ 0%ï¼Œå…¨ç¨‹ CPU åœ¨ç¡¬æ‰›ï¼</p>\n<h2 id=\"é˜¶æ®µ-2ï¼šè£…-CUDA-NCCLï¼Œä¾æ—§æ— æ³•å”¤é†’-GPU\"><a href=\"#é˜¶æ®µ-2ï¼šè£…-CUDA-NCCLï¼Œä¾æ—§æ— æ³•å”¤é†’-GPU\" class=\"headerlink\" title=\"é˜¶æ®µ 2ï¼šè£… CUDA+NCCLï¼Œä¾æ—§æ— æ³•å”¤é†’ GPU\"></a>é˜¶æ®µ 2ï¼šè£… CUDA+NCCLï¼Œä¾æ—§æ— æ³•å”¤é†’ GPU</h2><p>ä»¥ä¸ºæ˜¯ç¼º GPU ä¾èµ–ï¼Œç«é€Ÿå®‰æ’ï¼š</p>\n<ul>\n<li><p>è£…äº† CUDA Toolkit 12.4 Update 1ï¼Œnvcc -V èƒ½çœ‹åˆ°ç‰ˆæœ¬ï¼ˆcentOS 7.9 æœ€é«˜æ”¯æŒ CUDA Toolkit 12.4 Update 1ï¼‰ï¼›</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://developer.download.nvidia.com/compute/cuda/12.4.1/local_installers/cuda-repo-rhel7-12-4-local-12.4.1_550.54.15-1.x86_64.rpm</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> rpm -i cuda-repo-rhel7-12-4-local-12.4.1_550.54.15-1.x86_64.rpm</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> yum clean all</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> yum -y install cuda-toolkit-12-4</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>è¡¥äº† NVIDIA NCCL åº“ï¼Œls &#x2F;usr&#x2F;lib64&#x2F;libnccl.so * ä¹Ÿèƒ½çœ‹åˆ°æ–‡ä»¶ï¼ˆNCCL 2.21.5, for CUDA 12.4, April 3rd, 2024ï¼‰ï¼›</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum-config-manager --add-repo https://developer.download.nvidia.com/compute/cuda/repos/rhel7/x86_64/cuda-rhel7.repo</span><br><span class=\"line\">yum install libnccl-2.21.5-1+cuda12.4 libnccl-devel-2.21.5-1+cuda12.4 libnccl-static-2.21.5-1+cuda12.4</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>é…ç½®äº† LD_LIBRARY_PATHï¼Œé‡å¯ Ollamaâ€¦ ç»“æœè¿˜æ˜¯ CPU åœ¨è·‘ï¼</p>\n</li>\n</ul>\n<p>æ’æŸ¥å‘ç°ï¼šç¼–è¯‘åçš„ Ollama å’Œ CentOS7.9 çš„ glibc ç¯å¢ƒä¸å…¼å®¹ï¼Œå°±ç®—è£…äº† CUDA&#x2F;NCCLï¼Œä¹Ÿæ— æ³•åŠ è½½ GPU é©±åŠ¨é“¾è·¯ â€”â€” è¿™æ‰æ„è¯†åˆ°ï¼Œéš”ç¦»ç¯å¢ƒæ‰æ˜¯å”¯ä¸€å‡ºè·¯ï¼</p>\n<h1 id=\"âœ…-ç ´å±€å…³é”®ï¼šDocker-å›½å†…é•œåƒï¼Œä¸€æ­¥è§£å†³æ‰€æœ‰é—®é¢˜\"><a href=\"#âœ…-ç ´å±€å…³é”®ï¼šDocker-å›½å†…é•œåƒï¼Œä¸€æ­¥è§£å†³æ‰€æœ‰é—®é¢˜\" class=\"headerlink\" title=\"âœ… ç ´å±€å…³é”®ï¼šDocker + å›½å†…é•œåƒï¼Œä¸€æ­¥è§£å†³æ‰€æœ‰é—®é¢˜\"></a>âœ… ç ´å±€å…³é”®ï¼šDocker + å›½å†…é•œåƒï¼Œä¸€æ­¥è§£å†³æ‰€æœ‰é—®é¢˜</h1><p>è¯•è¿‡é˜¿é‡Œäº‘ã€ç½‘æ˜“äº‘é•œåƒï¼Œæ‹‰å– Ollama å®˜æ–¹é•œåƒè¿˜æ˜¯è¶…æ—¶ï¼Œç›´åˆ°å‘ç°ã€Œ<a href=\"https://docker.1ms.run/\">https://docker.1ms.run</a>ã€å›½å†…é•œåƒï¼Œé€Ÿåº¦ç›´æ¥èµ·é£ï¼é…åˆ NVIDIA å®¹å™¨å·¥å…·åŒ…ï¼Œå®Œç¾ç»•å¼€ glibc é™åˆ¶ï¼ŒGPU ç¬é—´è¢«å”¤é†’ï½</p>\n<h2 id=\"Step1ï¼šæ¸…ç†ä¹‹å‰çš„-â€œçƒ‚æ‘Šå­â€ï¼ˆé¿å…å†²çªï¼‰\"><a href=\"#Step1ï¼šæ¸…ç†ä¹‹å‰çš„-â€œçƒ‚æ‘Šå­â€ï¼ˆé¿å…å†²çªï¼‰\" class=\"headerlink\" title=\"Step1ï¼šæ¸…ç†ä¹‹å‰çš„ â€œçƒ‚æ‘Šå­â€ï¼ˆé¿å…å†²çªï¼‰\"></a>Step1ï¼šæ¸…ç†ä¹‹å‰çš„ â€œçƒ‚æ‘Šå­â€ï¼ˆé¿å…å†²çªï¼‰</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢æ‰‹åŠ¨ç¼–è¯‘çš„Ollamaè¿›ç¨‹ï¼ˆé¿å…ç«¯å£å ç”¨ï¼‰</span></span><br><span class=\"line\">pkill -9 ollama</span><br><span class=\"line\">ps -ef | grep ollama | grep -v grep  <span class=\"comment\"># ç¡®è®¤æ— æ®‹ç•™</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¸è½½å¯èƒ½å†²çªçš„æ—§å®¹å™¨ï¼ˆè‹¥ä¹‹å‰è¯•è¿‡Dockerï¼‰</span></span><br><span class=\"line\">docker stop ollama-gpu 2&gt;/dev/null || <span class=\"literal\">true</span></span><br><span class=\"line\">docker <span class=\"built_in\">rm</span> ollama-gpu 2&gt;/dev/null || <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Step2ï¼šé…ç½®-Docker-å›½å†…é•œåƒæºï¼ˆè§£å†³æ‹‰å–è¶…æ—¶ï¼‰\"><a href=\"#Step2ï¼šé…ç½®-Docker-å›½å†…é•œåƒæºï¼ˆè§£å†³æ‹‰å–è¶…æ—¶ï¼‰\" class=\"headerlink\" title=\"Step2ï¼šé…ç½® Docker å›½å†…é•œåƒæºï¼ˆè§£å†³æ‹‰å–è¶…æ—¶ï¼‰\"></a>Step2ï¼šé…ç½® Docker å›½å†…é•œåƒæºï¼ˆè§£å†³æ‹‰å–è¶…æ—¶ï¼‰</h2><p>æ ¸å¿ƒæ˜¯ç”¨ã€Œ<a href=\"https://docker.1ms.run/\">https://docker.1ms.run</a>ã€ï¼Œå›½å†…æ‹‰å– Ollama é•œåƒä¸è¶…æ—¶ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢DockeræœåŠ¡</span></span><br><span class=\"line\">systemctl stop docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å»ºdaemon.jsonï¼ˆé¿å…è¯­æ³•é”™è¯¯ï¼‰</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;registry-mirrors&quot;: [&quot;https://docker.1ms.run&quot;]</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span> &gt; /etc/docker/daemon.json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯JSONè¯­æ³•ï¼ˆæ— è¾“å‡º=æ­£ç¡®ï¼‰</span></span><br><span class=\"line\">python -m json.tool /etc/docker/daemon.json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯Dockerå¹¶éªŒè¯é•œåƒæº</span></span><br><span class=\"line\">systemctl daemon-reload &amp;&amp; systemctl start docker</span><br><span class=\"line\">docker info | grep <span class=\"string\">&quot;Registry Mirrors&quot;</span>  <span class=\"comment\"># è¾“å‡ºå«1ms.runå³ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Step3ï¼šå®‰è£…-NVIDIA-Container-Toolkitï¼ˆGPU-è¯†åˆ«å…³é”®ï¼ï¼‰\"><a href=\"#Step3ï¼šå®‰è£…-NVIDIA-Container-Toolkitï¼ˆGPU-è¯†åˆ«å…³é”®ï¼ï¼‰\" class=\"headerlink\" title=\"Step3ï¼šå®‰è£… NVIDIA Container Toolkitï¼ˆGPU è¯†åˆ«å…³é”®ï¼ï¼‰\"></a>Step3ï¼šå®‰è£… NVIDIA Container Toolkitï¼ˆGPU è¯†åˆ«å…³é”®ï¼ï¼‰</h2><p>è¿™æ˜¯ Docker èƒ½è°ƒç”¨ GPU çš„æ ¸å¿ƒï¼Œä¹‹å‰è¸©å‘å°±æ˜¯æ¼äº†è¿™æ­¥ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ NVIDIAå®˜æ–¹æºï¼ˆé€‚é…CentOS7ï¼‰</span></span><br><span class=\"line\">distribution=$(. /etc/os-release;<span class=\"built_in\">echo</span> $ID<span class=\"variable\">$VERSION_ID</span>)</span><br><span class=\"line\">curl -s -L https://nvidia.github.io/libnvidia-container/<span class=\"variable\">$distribution</span>/libnvidia-container.repo | <span class=\"built_in\">tee</span> /etc/yum.repos.d/nvidia-container-toolkit.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…å·¥å…·åŒ…</span></span><br><span class=\"line\">yum install -y nvidia-container-toolkit-base nvidia-container-toolkit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®Dockerè¯†åˆ«NVIDIAé©±åŠ¨</span></span><br><span class=\"line\">nvidia-ctk runtime configure --runtime=docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯Docker</span></span><br><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Step4ï¼šå¯åŠ¨-Ollama-GPU-å®¹å™¨ï¼ˆé•¿æœŸç¨³å®šè¿è¡Œï¼‰\"><a href=\"#Step4ï¼šå¯åŠ¨-Ollama-GPU-å®¹å™¨ï¼ˆé•¿æœŸç¨³å®šè¿è¡Œï¼‰\" class=\"headerlink\" title=\"Step4ï¼šå¯åŠ¨ Ollama GPU å®¹å™¨ï¼ˆé•¿æœŸç¨³å®šè¿è¡Œï¼‰\"></a>Step4ï¼šå¯åŠ¨ Ollama GPU å®¹å™¨ï¼ˆé•¿æœŸç¨³å®šè¿è¡Œï¼‰</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨å®¹å™¨ï¼ˆå‚æ•°å…¨è§£æï¼Œå°‘ä¸€ä¸ªéƒ½å¯èƒ½å‡ºé—®é¢˜ï¼‰</span></span><br><span class=\"line\">docker run -d \\</span><br><span class=\"line\">  --name ollama-gpu \\</span><br><span class=\"line\">  --restart=always \\  <span class=\"comment\"># æ„å¤–é€€å‡º/æœåŠ¡å™¨é‡å¯è‡ªåŠ¨æ¢å¤</span></span><br><span class=\"line\">  --gpus=all \\        <span class=\"comment\"># å¯ç”¨æ‰€æœ‰GPUï¼ˆæˆ‘è¿™é‡Œæ˜¯4å—L4ï¼‰</span></span><br><span class=\"line\">  -p 0.0.0.0:11434:11434 \\  <span class=\"comment\"># å¯¹å¤–å¼€æ”¾APIï¼Œå¤–éƒ¨å¯è°ƒç”¨</span></span><br><span class=\"line\">  -v /share/public_db/ollama/models:/root/.ollama \\  <span class=\"comment\"># æ¨¡å‹æŒä¹…åŒ–ï¼ˆåˆ å®¹å™¨ä¸ä¸¢æ¨¡å‹ï¼‰</span></span><br><span class=\"line\">  -e OLLAMA_GPU=100 \\  <span class=\"comment\"># 100%ä½¿ç”¨GPUæ˜¾å­˜ï¼ˆå¯æŒ‰éœ€è°ƒï¼‰</span></span><br><span class=\"line\">  -e OLLAMA_HOST=0.0.0.0:11434 \\  <span class=\"comment\"># å…è®¸å¤–éƒ¨è®¿é—®API</span></span><br><span class=\"line\">  docker.1ms.run/ollama/ollama:latest  <span class=\"comment\"># å›½å†…é•œåƒæ‹‰å–ï¼Œä¸è¶…æ—¶</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Step5ï¼šéªŒè¯-GPU-æ˜¯å¦çœŸæ­£è¢«è°ƒç”¨\"><a href=\"#Step5ï¼šéªŒè¯-GPU-æ˜¯å¦çœŸæ­£è¢«è°ƒç”¨\" class=\"headerlink\" title=\"Step5ï¼šéªŒè¯ GPU æ˜¯å¦çœŸæ­£è¢«è°ƒç”¨\"></a>Step5ï¼šéªŒè¯ GPU æ˜¯å¦çœŸæ­£è¢«è°ƒç”¨</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ–°å¼€ç»ˆç«¯ç›‘æ§GPUçŠ¶æ€</span></span><br><span class=\"line\">watch -n 1 nvidia-smi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥å®¹å™¨è¿è¡Œæ¨¡å‹ï¼ˆæµ‹è¯•GPUå ç”¨ï¼‰</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it ollama-gpu ollama run qwen3-vl:32b</span><br></pre></td></tr></table></figure>\n\n<p>æ­¤æ—¶èƒ½çœ‹åˆ° nvidia-smi ä¸­ GPU æ˜¾å­˜ä» 1MiB é£™å‡åˆ°æ•° GBï¼ŒGPU-Utilâ‰¥10%â€”â€” ç»ˆäºä¸æ˜¯ CPU åœ¨ â€œå­¤å†›å¥‹æˆ˜â€ äº†ï¼</p>\n<h1 id=\"ğŸ“¡-API-è°ƒç”¨ç¤ºä¾‹ï¼ˆæœ¬åœ°-è¿œç¨‹éƒ½èƒ½ç”¨ï¼‰\"><a href=\"#ğŸ“¡-API-è°ƒç”¨ç¤ºä¾‹ï¼ˆæœ¬åœ°-è¿œç¨‹éƒ½èƒ½ç”¨ï¼‰\" class=\"headerlink\" title=\"ğŸ“¡ API è°ƒç”¨ç¤ºä¾‹ï¼ˆæœ¬åœ° &#x2F; è¿œç¨‹éƒ½èƒ½ç”¨ï¼‰\"></a>ğŸ“¡ API è°ƒç”¨ç¤ºä¾‹ï¼ˆæœ¬åœ° &#x2F; è¿œç¨‹éƒ½èƒ½ç”¨ï¼‰</h1><p>å®¹å™¨å¯åŠ¨åï¼Œæ— éœ€æ‰‹åŠ¨è¿›å®¹å™¨æ“ä½œï¼Œå¤–éƒ¨ç¨‹åºç›´æ¥é€šè¿‡ HTTP è°ƒç”¨ï¼Œå®Œç¾é›†æˆåˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï½</p>\n<h2 id=\"1-curl-å¿«é€Ÿæµ‹è¯•ï¼ˆæ— éœ€å†™ä»£ç ï¼‰\"><a href=\"#1-curl-å¿«é€Ÿæµ‹è¯•ï¼ˆæ— éœ€å†™ä»£ç ï¼‰\" class=\"headerlink\" title=\"1. curl å¿«é€Ÿæµ‹è¯•ï¼ˆæ— éœ€å†™ä»£ç ï¼‰\"></a>1. curl å¿«é€Ÿæµ‹è¯•ï¼ˆæ— éœ€å†™ä»£ç ï¼‰</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²ä¸‹è½½çš„æ¨¡å‹</span></span><br><span class=\"line\">curl http://ä½ çš„å®¿ä¸»æœºIP:11434/api/tags</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è°ƒç”¨æ¨¡å‹ç”Ÿæˆå†…å®¹ï¼ˆä»¥å†å²æ•…äº‹ä¸ºä¾‹ï¼‰</span></span><br><span class=\"line\">curl http://192.168.1.100:11434/api/generate -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;model&quot;: &quot;qwen3-vl:32b&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;prompt&quot;: &quot;ç”Ÿæˆä¸€ç¯‡å…³äºå®‹æœè‹è½¼çš„å†å²æ•…äº‹ï¼Œé£æ ¼å„¿ç«¥è¶£å‘³ï¼Œ300å­—å·¦å³&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;stream&quot;: false,  # éæµå¼è¿”å›ï¼Œæ–¹ä¾¿ç¨‹åºå¤„ç†</span></span><br><span class=\"line\"><span class=\"string\">  &quot;temperature&quot;: 0.6,  # æ§åˆ¶éšæœºæ€§</span></span><br><span class=\"line\"><span class=\"string\">  &quot;max_tokens&quot;: 1500</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Python-å°è£…ï¼ˆé›†æˆåˆ°é¡¹ç›®ä¸­ï¼‰\"><a href=\"#2-Python-å°è£…ï¼ˆé›†æˆåˆ°é¡¹ç›®ä¸­ï¼‰\" class=\"headerlink\" title=\"2. Python å°è£…ï¼ˆé›†æˆåˆ°é¡¹ç›®ä¸­ï¼‰\"></a>2. Python å°è£…ï¼ˆé›†æˆåˆ°é¡¹ç›®ä¸­ï¼‰</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">OllamaGPUClient</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, host: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;localhost&quot;</span>, port: <span class=\"built_in\">int</span> = <span class=\"number\">11434</span></span>):</span><br><span class=\"line\">        self.base_url = <span class=\"string\">f&quot;http://<span class=\"subst\">&#123;host&#125;</span>:<span class=\"subst\">&#123;port&#125;</span>/api/generate&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">generate_content</span>(<span class=\"params\">self, model: <span class=\"built_in\">str</span>, prompt: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>]:</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            response = requests.post(</span><br><span class=\"line\">                self.base_url,</span><br><span class=\"line\">                json=&#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;model&quot;</span>: model,</span><br><span class=\"line\">                    <span class=\"string\">&quot;prompt&quot;</span>: prompt,</span><br><span class=\"line\">                    <span class=\"string\">&quot;stream&quot;</span>: <span class=\"literal\">False</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;temperature&quot;</span>: <span class=\"number\">0.7</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;max_tokens&quot;</span>: <span class=\"number\">2000</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                timeout=<span class=\"number\">60</span></span><br><span class=\"line\">            )</span><br><span class=\"line\">            response.raise_for_status()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> response.json()[<span class=\"string\">&quot;response&quot;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;è°ƒç”¨å¤±è´¥ï¼š<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class=\"line\">client = OllamaGPUClient(host=<span class=\"string\">&quot;192.168.1.100&quot;</span>)  <span class=\"comment\"># æ›¿æ¢ä¸ºä½ çš„å®¿ä¸»æœºIP</span></span><br><span class=\"line\">result = client.generate_content(</span><br><span class=\"line\">    model=<span class=\"string\">&quot;qwen3-vl:32b&quot;</span>,</span><br><span class=\"line\">    prompt=<span class=\"string\">&quot;è§£é‡Šä»€ä¹ˆæ˜¯é‡å­è®¡ç®—ï¼Œç”¨é€šä¿—çš„è¯­è¨€&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-å®Œæ•´ä¾‹å­\"><a href=\"#3-å®Œæ•´ä¾‹å­\" class=\"headerlink\" title=\"3. å®Œæ•´ä¾‹å­\"></a>3. å®Œæ•´ä¾‹å­</h2><p>å†å²æ•…äº‹Agent</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span>, <span class=\"type\">Dict</span>, <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HistoryStoryAgent</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;å†å²æ•…äº‹ç”ŸæˆAgentï¼Œè°ƒç”¨ollama APIä½¿ç”¨qwen3-vl:32bç”Ÿæˆå†å²æ•…äº‹&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, ollama_host: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;localhost&quot;</span>, ollama_port: <span class=\"built_in\">int</span> = <span class=\"number\">11434</span></span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        åˆå§‹åŒ–Agent</span></span><br><span class=\"line\"><span class=\"string\">        :param ollama_host: ollamaå®¹å™¨æ‰€åœ¨çš„å®¿ä¸»æœºIP/åŸŸå</span></span><br><span class=\"line\"><span class=\"string\">        :param ollama_port: ollama APIç«¯å£ï¼ˆé»˜è®¤11434ï¼‰</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        self.base_url = <span class=\"string\">f&quot;http://<span class=\"subst\">&#123;ollama_host&#125;</span>:<span class=\"subst\">&#123;ollama_port&#125;</span>&quot;</span></span><br><span class=\"line\">        self.model_name = <span class=\"string\">&quot;qwen3-vl:32b&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># æ£€æŸ¥ollamaæœåŠ¡æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\">        self._check_ollama_health()</span><br><span class=\"line\">        <span class=\"comment\"># æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²ä¸‹è½½</span></span><br><span class=\"line\">        self._check_model_exists()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_check_ollama_health</span>(<span class=\"params\">self</span>) -&gt; <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;æ£€æŸ¥ollama APIæœåŠ¡æ˜¯å¦æ­£å¸¸&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            response = requests.get(<span class=\"string\">f&quot;<span class=\"subst\">&#123;self.base_url&#125;</span>/api/tags&quot;</span>, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> response.status_code != <span class=\"number\">200</span>:</span><br><span class=\"line\">                <span class=\"keyword\">raise</span> ConnectionError(<span class=\"string\">f&quot;ollamaæœåŠ¡å¼‚å¸¸ï¼ŒçŠ¶æ€ç ï¼š<span class=\"subst\">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> requests.exceptions.ConnectionError:</span><br><span class=\"line\">            <span class=\"keyword\">raise</span> ConnectionError(</span><br><span class=\"line\">                <span class=\"string\">f&quot;æ— æ³•è¿æ¥åˆ°ollamaæœåŠ¡ï¼Œè¯·æ£€æŸ¥ï¼š\\n&quot;</span></span><br><span class=\"line\">                <span class=\"string\">f&quot;1. ollamaå®¹å™¨æ˜¯å¦è¿è¡Œï¼ˆdocker ps | grep ollama-gpuï¼‰\\n&quot;</span></span><br><span class=\"line\">                <span class=\"string\">f&quot;2. å®¿ä¸»æœºIP/ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆå½“å‰é…ç½®ï¼š<span class=\"subst\">&#123;self.base_url&#125;</span>ï¼‰\\n&quot;</span></span><br><span class=\"line\">                <span class=\"string\">f&quot;3. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾<span class=\"subst\">&#123;self.base_url.split(<span class=\"string\">&#x27;:&#x27;</span>)[-<span class=\"number\">1</span>]&#125;</span>ç«¯å£&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_check_model_exists</span>(<span class=\"params\">self</span>) -&gt; <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;æ£€æŸ¥qwen3-vl:32bæ¨¡å‹æ˜¯å¦å·²ä¸‹è½½&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            response = requests.get(<span class=\"string\">f&quot;<span class=\"subst\">&#123;self.base_url&#125;</span>/api/tags&quot;</span>, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">            models = [m[<span class=\"string\">&quot;name&quot;</span>] <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> response.json()[<span class=\"string\">&quot;models&quot;</span>]]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> self.model_name <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> models:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;âš ï¸ æœªæ£€æµ‹åˆ°<span class=\"subst\">&#123;self.model_name&#125;</span>æ¨¡å‹ï¼Œæ­£åœ¨è‡ªåŠ¨ä¸‹è½½ï¼ˆé¦–æ¬¡ä¸‹è½½å¯èƒ½è€—æ—¶è¾ƒé•¿ï¼‰...&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\"># è°ƒç”¨APIä¸‹è½½æ¨¡å‹</span></span><br><span class=\"line\">                download_resp = requests.post(</span><br><span class=\"line\">                    <span class=\"string\">f&quot;<span class=\"subst\">&#123;self.base_url&#125;</span>/api/pull&quot;</span>,</span><br><span class=\"line\">                    json=&#123;<span class=\"string\">&quot;name&quot;</span>: self.model_name&#125;,</span><br><span class=\"line\">                    stream=<span class=\"literal\">True</span>,</span><br><span class=\"line\">                    timeout=<span class=\"number\">3600</span>  <span class=\"comment\"># ä¸‹è½½è¶…æ—¶è®¾ä¸º1å°æ—¶</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\"># æ‰“å°ä¸‹è½½è¿›åº¦</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> download_resp.iter_lines():</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> line:</span><br><span class=\"line\">                        data = json.loads(line)</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"string\">&quot;status&quot;</span> <span class=\"keyword\">in</span> data:</span><br><span class=\"line\">                            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ä¸‹è½½è¿›åº¦ï¼š<span class=\"subst\">&#123;data[<span class=\"string\">&#x27;status&#x27;</span>]&#125;</span>&quot;</span>, end=<span class=\"string\">&quot;\\r&quot;</span>)</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\nâœ… <span class=\"subst\">&#123;self.model_name&#125;</span>æ¨¡å‹ä¸‹è½½å®Œæˆï¼&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">raise</span> RuntimeError(<span class=\"string\">f&quot;æ£€æŸ¥/ä¸‹è½½æ¨¡å‹å¤±è´¥ï¼š<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">generate_story</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">        self,</span></span><br><span class=\"line\"><span class=\"params\">        topic: <span class=\"built_in\">str</span>,</span></span><br><span class=\"line\"><span class=\"params\">        style: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;é€šä¿—æ˜“æ‡‚&quot;</span>,</span></span><br><span class=\"line\"><span class=\"params\">        length: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;ä¸­ç­‰ï¼ˆ500å­—å·¦å³ï¼‰&quot;</span>,</span></span><br><span class=\"line\"><span class=\"params\">        stream: <span class=\"built_in\">bool</span> = <span class=\"literal\">False</span></span></span><br><span class=\"line\"><span class=\"params\">    </span>) -&gt; <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>]:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        ç”Ÿæˆå†å²æ•…äº‹</span></span><br><span class=\"line\"><span class=\"string\">        :param topic: æ•…äº‹ä¸»é¢˜ï¼ˆå¦‚ï¼šå”æœæç™½ã€ä¸‰å›½èµ¤å£ä¹‹æˆ˜ã€å®‹æœè‹è½¼ï¼‰</span></span><br><span class=\"line\"><span class=\"string\">        :param style: æ•…äº‹é£æ ¼ï¼ˆå¦‚ï¼šé€šä¿—æ˜“æ‡‚ã€æ–‡è¨€æ–‡ã€å„¿ç«¥è¶£å‘³ï¼‰</span></span><br><span class=\"line\"><span class=\"string\">        :param length: æ•…äº‹é•¿åº¦ï¼ˆå¦‚ï¼šç®€çŸ­ï¼ˆ200å­—ï¼‰ã€ä¸­ç­‰ï¼ˆ500å­—ï¼‰ã€è¯¦ç»†ï¼ˆ1000å­—ï¼‰ï¼‰</span></span><br><span class=\"line\"><span class=\"string\">        :param stream: æ˜¯å¦æµå¼è¿”å›ï¼ˆTrue=é€å­—è¾“å‡ºï¼ŒFalse=ä¸€æ¬¡æ€§è¿”å›ï¼‰</span></span><br><span class=\"line\"><span class=\"string\">        :return: ç”Ÿæˆçš„å†å²æ•…äº‹å­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># æ„é€ é«˜è´¨é‡promptï¼ˆå…³é”®ï¼šå¼•å¯¼æ¨¡å‹ç”Ÿæˆç»“æ„åŒ–ã€å‡†ç¡®çš„å†…å®¹ï¼‰</span></span><br><span class=\"line\">        prompt = <span class=\"string\">f&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        è¯·ä½ ä½œä¸ºä¸“ä¸šçš„å†å²è€å¸ˆï¼Œæ ¹æ®ä»¥ä¸‹è¦æ±‚ç”Ÿæˆä¸€ç¯‡å†å²æ•…äº‹ï¼š</span></span><br><span class=\"line\"><span class=\"string\">        1. ä¸»é¢˜ï¼š<span class=\"subst\">&#123;topic&#125;</span></span></span><br><span class=\"line\"><span class=\"string\">        2. é£æ ¼ï¼š<span class=\"subst\">&#123;style&#125;</span></span></span><br><span class=\"line\"><span class=\"string\">        3. é•¿åº¦ï¼š<span class=\"subst\">&#123;length&#125;</span></span></span><br><span class=\"line\"><span class=\"string\">        4. è¾“å‡ºæ ¼å¼ï¼š</span></span><br><span class=\"line\"><span class=\"string\">           - æ ‡é¢˜ï¼š[æ•…äº‹æ ‡é¢˜]</span></span><br><span class=\"line\"><span class=\"string\">           - æ­£æ–‡ï¼š[ç”ŸåŠ¨çš„å†å²æ•…äº‹å†…å®¹ï¼Œç¡®ä¿å²å®å‡†ç¡®ï¼Œé¿å…è™šæ„]</span></span><br><span class=\"line\"><span class=\"string\">           - å…³é”®çŸ¥è¯†ç‚¹ï¼š[åˆ—å‡º1-3ä¸ªä¸æ•…äº‹ç›¸å…³çš„æ ¸å¿ƒå†å²çŸ¥è¯†ç‚¹]</span></span><br><span class=\"line\"><span class=\"string\">        5. è¦æ±‚ï¼šå†…å®¹å‡†ç¡®ã€é€»è¾‘æ¸…æ™°ã€è¯­è¨€æµç•…ï¼Œç¬¦åˆæŒ‡å®šé£æ ¼å’Œé•¿åº¦ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># æ„é€ APIè¯·æ±‚å‚æ•°</span></span><br><span class=\"line\">        payload = &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;model&quot;</span>: self.model_name,</span><br><span class=\"line\">            <span class=\"string\">&quot;prompt&quot;</span>: prompt.strip(),</span><br><span class=\"line\">            <span class=\"string\">&quot;stream&quot;</span>: stream,</span><br><span class=\"line\">            <span class=\"string\">&quot;temperature&quot;</span>: <span class=\"number\">0.7</span>,  <span class=\"comment\"># æ§åˆ¶ç”Ÿæˆéšæœºæ€§ï¼ˆ0=ä¸¥è°¨ï¼Œ1=çµæ´»ï¼‰</span></span><br><span class=\"line\">            <span class=\"string\">&quot;max_tokens&quot;</span>: <span class=\"number\">2000</span>    <span class=\"comment\"># æœ€å¤§ç”Ÿæˆå­—ç¬¦æ•°</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"comment\"># è°ƒç”¨ollama generate API</span></span><br><span class=\"line\">            response = requests.post(</span><br><span class=\"line\">                <span class=\"string\">f&quot;<span class=\"subst\">&#123;self.base_url&#125;</span>/api/generate&quot;</span>,</span><br><span class=\"line\">                json=payload,</span><br><span class=\"line\">                stream=stream,</span><br><span class=\"line\">                timeout=<span class=\"number\">60</span>  <span class=\"comment\"># ç”Ÿæˆè¶…æ—¶è®¾ä¸º60ç§’</span></span><br><span class=\"line\">            )</span><br><span class=\"line\">            response.raise_for_status()  <span class=\"comment\"># æŠ›å‡ºHTTPé”™è¯¯</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># å¤„ç†å“åº”</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> stream:</span><br><span class=\"line\">                <span class=\"comment\"># æµå¼è¿”å›ï¼ˆé€å­—è¾“å‡ºï¼Œé€‚åˆå®æ—¶å±•ç¤ºï¼‰</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\nğŸ“œ æ­£åœ¨ç”Ÿæˆå†å²æ•…äº‹ï¼ˆæµå¼è¾“å‡ºï¼‰ï¼š\\n&quot;</span>)</span><br><span class=\"line\">                story = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> response.iter_lines():</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> line:</span><br><span class=\"line\">                        data = json.loads(line)</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"string\">&quot;response&quot;</span> <span class=\"keyword\">in</span> data:</span><br><span class=\"line\">                            story += data[<span class=\"string\">&quot;response&quot;</span>]</span><br><span class=\"line\">                            <span class=\"built_in\">print</span>(data[<span class=\"string\">&quot;response&quot;</span>], end=<span class=\"string\">&quot;&quot;</span>, flush=<span class=\"literal\">True</span>)</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> data.get(<span class=\"string\">&quot;done&quot;</span>):</span><br><span class=\"line\">                                <span class=\"keyword\">break</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> story</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># éæµå¼è¿”å›ï¼ˆä¸€æ¬¡æ€§è·å–å®Œæ•´ç»“æœï¼‰</span></span><br><span class=\"line\">                result = response.json()</span><br><span class=\"line\">                <span class=\"keyword\">return</span> result[<span class=\"string\">&quot;response&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">except</span> requests.exceptions.Timeout:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;âŒ ç”Ÿæˆè¶…æ—¶ï¼Œè¯·ç¼©çŸ­æ•…äº‹é•¿åº¦æˆ–æ£€æŸ¥æ¨¡å‹å“åº”é€Ÿåº¦&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;âŒ ç”Ÿæˆæ•…äº‹å¤±è´¥ï¼š<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‘½ä»¤è¡Œäº¤äº’å…¥å£</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"comment\"># è§£æå‘½ä»¤è¡Œå‚æ•°</span></span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">&quot;å†å²æ•…äº‹ç”ŸæˆAgent - è°ƒç”¨ollama qwen3-vl:32bæ¨¡å‹&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--host&quot;</span>, default=<span class=\"string\">&quot;localhost&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;ollamaå®¿ä¸»æœºIPï¼ˆé»˜è®¤localhostï¼‰&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--port&quot;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, default=<span class=\"number\">11434</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;ollama APIç«¯å£ï¼ˆé»˜è®¤11434ï¼‰&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--topic&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;å†å²æ•…äº‹ä¸»é¢˜ï¼ˆå¦‚ï¼šå”æœæç™½ã€ä¸‰å›½èµ¤å£ä¹‹æˆ˜ï¼‰&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--style&quot;</span>, default=<span class=\"string\">&quot;é€šä¿—æ˜“æ‡‚&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;æ•…äº‹é£æ ¼ï¼ˆå¦‚ï¼šå„¿ç«¥è¶£å‘³ã€æ–‡è¨€æ–‡ï¼‰&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--length&quot;</span>, default=<span class=\"string\">&quot;ä¸­ç­‰ï¼ˆ500å­—å·¦å³ï¼‰&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;æ•…äº‹é•¿åº¦&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--stream&quot;</span>, action=<span class=\"string\">&quot;store_true&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;æ˜¯å¦æµå¼è¾“å‡ºï¼ˆé»˜è®¤å¦ï¼‰&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># åˆå§‹åŒ–Agentå¹¶ç”Ÿæˆæ•…äº‹</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        agent = HistoryStoryAgent(ollama_host=args.host, ollama_port=args.port)</span><br><span class=\"line\">        story = agent.generate_story(</span><br><span class=\"line\">            topic=args.topic,</span><br><span class=\"line\">            style=args.style,</span><br><span class=\"line\">            length=args.length,</span><br><span class=\"line\">            stream=args.stream</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"keyword\">if</span> story:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\nâœ… å†å²æ•…äº‹ç”Ÿæˆå®Œæˆï¼š\\n&quot;</span> + <span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">50</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(story)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;âŒ Agentåˆå§‹åŒ–å¤±è´¥ï¼š<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>ç”¨æ³•ï¼š</p>\n<ul>\n<li><p>æœ¬æœºè°ƒç”¨</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python history_story_agent.py --topic <span class=\"string\">&quot;å®‹æœè‹è½¼&quot;</span> --stream</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/fef2/fig1.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/fef2/fig1.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"æœ¬åœ°è°ƒç”¨API\"></p>\n</li>\n<li><p>è¿œç¨‹è°ƒç”¨</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ ¹æ®å®é™…æƒ…å†µè®¾ç½®host</span></span><br><span class=\"line\">python history_story_agent.py --host 192.168.0.100 --port 11434 --topic <span class=\"string\">&quot;ä¸‰å›½èµ¤å£ä¹‹æˆ˜&quot;</span> --style <span class=\"string\">&quot;å„¿ç«¥è¶£å‘³&quot;</span> --stream</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/fef2/fig2.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/images/post/fef2/fig2.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"è¿œç¨‹è°ƒç”¨API\"></p>\n</li>\n</ul>\n<h1 id=\"ğŸš«-è¸©è¿‡çš„å‘ï¼ˆé¿å‘æŒ‡å—ï¼ï¼‰\"><a href=\"#ğŸš«-è¸©è¿‡çš„å‘ï¼ˆé¿å‘æŒ‡å—ï¼ï¼‰\" class=\"headerlink\" title=\"ğŸš« è¸©è¿‡çš„å‘ï¼ˆé¿å‘æŒ‡å—ï¼ï¼‰\"></a>ğŸš« è¸©è¿‡çš„å‘ï¼ˆé¿å‘æŒ‡å—ï¼ï¼‰</h1><ol>\n<li><p>å‘ 1ï¼šç¡¬å‡ glibcâ†’ç³»ç»Ÿå´©æºƒ</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šç”¨ Docker éš”ç¦»ç¯å¢ƒï¼Œç»•å¼€ç³»ç»Ÿ glibc é™åˆ¶ï¼Œç»å¯¹å®‰å…¨ï¼</p>\n</li>\n<li><p>å‘ 2ï¼šè£…äº† CUDA&#x2F;NCCL è¿˜æ˜¯ä¸è¯†åˆ« GPU</p>\n<p>åŸå› ï¼šç¼–è¯‘åçš„ Ollama å’Œç³»ç»Ÿç¯å¢ƒä¸å…¼å®¹ï¼Œä¾èµ–é“¾è·¯æ–­è£‚</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šæ”¾å¼ƒæœ¬åœ°ç¼–è¯‘ï¼Œç›´æ¥ç”¨ Docker ç‰ˆ Ollama</p>\n</li>\n<li><p>å‘ 3ï¼šDocker æ‹‰å– Ollama é•œåƒè¶…æ—¶</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šç”¨ã€Œ<a href=\"https://docker.1ms.run/\">https://docker.1ms.run</a>ã€å›½å†…é•œåƒï¼Œé€Ÿåº¦ç§’æ€å®˜æ–¹æº</p>\n</li>\n<li><p>å‘ 4ï¼šDocker å¯åŠ¨åè¿˜æ˜¯ä¸è¯†åˆ« GPU</p>\n<p>åŸå› ï¼šæ²¡è£… NVIDIA Container Toolkitï¼ŒDocker æ— æ³•è°ƒç”¨ GPU é©±åŠ¨</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šæŒ‰ Step3 å®Œæ•´å®‰è£…é…ç½®</p>\n</li>\n<li><p>å‘ 5ï¼šAPI è¿œç¨‹è°ƒç”¨å¤±è´¥</p>\n<p>åŸå› ï¼šå®¹å™¨æ²¡ç»‘å®š 0.0.0.0ï¼Œæˆ–é˜²ç«å¢™æ²¡å¼€æ”¾ç«¯å£</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šå¯åŠ¨å®¹å™¨åŠ <code>-p ``0.0.0.0:11434``:11434</code>ï¼Œå¼€æ”¾ç«¯å£<code>firewall-cmd --add-port=11434/tcp --permanent &amp;&amp; firewall-cmd --reload</code></p>\n</li>\n</ol>\n<h1 id=\"ğŸ¯-æœ€ç»ˆæ•ˆæœ-æ€»ç»“\"><a href=\"#ğŸ¯-æœ€ç»ˆæ•ˆæœ-æ€»ç»“\" class=\"headerlink\" title=\"ğŸ¯ æœ€ç»ˆæ•ˆæœ &amp; æ€»ç»“\"></a>ğŸ¯ æœ€ç»ˆæ•ˆæœ &amp; æ€»ç»“</h1><ul>\n<li><p>4 å— L4 GPU æ»¡è´Ÿè·è¿è¡Œï¼Œqwen3-vl:32b ç”Ÿæˆ 500 å­—å†…å®¹ä»ä¹‹å‰çš„ 30 ç§’â†’ç°åœ¨ 3 ç§’ï¼›</p>\n</li>\n<li><p>å®¹å™¨é•¿æœŸç¨³å®šè¿è¡Œï¼ŒæœåŠ¡å™¨é‡å¯åè‡ªåŠ¨æ¢å¤ï¼Œæ¨¡å‹æŒä¹…åŒ–ä¸é‡å¤ä¸‹è½½ï¼›</p>\n</li>\n<li><p>æœ¬åœ° &#x2F; è¿œç¨‹ç¨‹åºé€šè¿‡ API è½»æ¾è°ƒç”¨ï¼Œå®Œç¾é›†æˆåˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚</p>\n</li>\n</ul>\n<h1 id=\"æ ¸å¿ƒç»“è®º\"><a href=\"#æ ¸å¿ƒç»“è®º\" class=\"headerlink\" title=\"æ ¸å¿ƒç»“è®º\"></a>æ ¸å¿ƒç»“è®º</h1><ol>\n<li><p>CentOS7.9+Ollama GPUï¼šDocker æ˜¯å”¯ä¸€ç¨³å®šè§£ï¼Œåˆ«æŠ˜è…¾æœ¬åœ°ç¼–è¯‘å’Œ glibc å‡çº§ï¼›</p>\n</li>\n<li><p>å›½å†…é•œåƒä¼˜å…ˆé€‰ã€Œ<a href=\"https://docker.1ms.run/\">https://docker.1ms.run</a>ã€ï¼Œè§£å†³ Ollama é•œåƒæ‹‰å–è¶…æ—¶çš„ç—›ç‚¹ï¼›</p>\n</li>\n<li><p>NVIDIA Container Toolkit æ˜¯ GPU è¯†åˆ«çš„ â€œé’¥åŒ™â€ï¼Œå°‘ä¸€æ­¥éƒ½ä¸è¡Œï¼›</p>\n</li>\n<li><p>å®¹å™¨å¯åŠ¨å‚æ•°è¦é…å…¨ï¼š<code>--restart=always</code>+<code>OLLAMA_HOST=``0.0.0.0</code>+ ç«¯å£æ˜ å°„ï¼Œå…¼é¡¾ç¨³å®šæ€§å’Œå¯è®¿é—®æ€§ã€‚</p>\n</li>\n</ol>\n<p>å¦‚æœè¿˜æœ‰å…¶ä»–è¸©å‘ç‚¹ï¼Œæ¬¢è¿è¯„è®ºåŒºäº¤æµï½ ç¥å¤§å®¶éƒ½èƒ½è®© Ollama è·‘æ»¡ GPUï¼Œå‘Šåˆ« CPU æ…¢å¦‚èœ—ç‰›çš„æ—¥å­ï¼</p>\n<p>#Ollama #GPU éƒ¨ç½² #CentOS7 #Docker é¿å‘ #AI å·¥å…· #ç¨‹åºå‘˜æ”»ç•¥ #å¤§æ¨¡å‹éƒ¨ç½²</p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"},{"name":"Ollama","path":"api/tags/Ollama.json"}]},{"title":"åŠ è£… GPU å IB ç½‘å¡ï¼ˆib0ï¼‰æ¶ˆå¤±ï¼ŸCentOS 7.9 è‡ªåŠ¨æ¢å¤æ•™ç¨‹ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰","slug":"CentOS7åŠ è£…GPUåIBç½‘å¡è‡ªåŠ¨æ¢å¤æ•™ç¨‹","date":"2025-12-16T10:18:18.000Z","updated":"2025-12-16T10:36:01.929Z","comments":true,"path":"api/articles/CentOS7åŠ è£…GPUåIBç½‘å¡è‡ªåŠ¨æ¢å¤æ•™ç¨‹.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>åœ¨é›†ç¾¤è¿ç»´ä¸­ï¼ŒIBï¼ˆInfiniBandï¼‰ç½‘å¡æ˜¯é«˜é€Ÿæ•°æ®ä¼ è¾“çš„æ ¸å¿ƒï¼Œä½†å¾ˆå¤šäººé‡åˆ°è¿‡è¿™æ ·çš„å‘ï¼šç»™æœåŠ¡å™¨åŠ è£… GPU æ‰©å±•å¡åï¼ŒåŸæœ¬æ­£å¸¸çš„ ib0 è®¾å¤‡çªç„¶æ¶ˆå¤±ï¼Œæ— æ³•é€šè¿‡ IB äº¤æ¢æœºä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ã€‚æœ¬æ–‡ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œè¯¦ç»†æ‹†è§£é—®é¢˜æ ¹æºï¼Œæä¾›ä¸€æ­¥åˆ°ä½çš„è‡ªåŠ¨ä¿®å¤æ–¹æ¡ˆï¼Œè®© ib0 å¼€æœºå³å¯ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚</p>\n<h1 id=\"ä¸€ã€é—®é¢˜èƒŒæ™¯\"><a href=\"#ä¸€ã€é—®é¢˜èƒŒæ™¯\" class=\"headerlink\" title=\"ä¸€ã€é—®é¢˜èƒŒæ™¯\"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><ul>\n<li><p><strong>ç¯å¢ƒ</strong>ï¼šCentOS 7 æœåŠ¡å™¨ï¼ˆnode1ï¼‰ï¼Œæ­è½½ Mellanox ConnectX ç³»åˆ—åŒæ¨¡ç½‘å¡ï¼ˆæ”¯æŒ IB&#x2F;ETH æ¨¡å¼ï¼‰ï¼ŒåŸæœ¬å·²é…ç½® IB æ¨¡å¼ï¼ˆib0 è®¾å¤‡ï¼‰ï¼Œä¸å…¶ä»–èŠ‚ç‚¹é€šè¿‡ IB äº¤æ¢æœºå®ç° 20.20.20.0&#x2F;24 ç½‘æ®µé«˜é€Ÿé€šä¿¡ã€‚</p>\n</li>\n<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šä¸ºæå‡ç®—åŠ›åŠ è£… GPU æ‰©å±•å¡åï¼Œæ‰§è¡Œ <code>ip link show ib0</code> æç¤º â€œDevice â€˜ib0â€™ does not existâ€ï¼ŒIB ç½‘å¡å¤±æ•ˆã€‚</p>\n</li>\n<li><p><strong>æ ¸å¿ƒéœ€æ±‚</strong>ï¼šæ¢å¤ ib0 è®¾å¤‡ï¼Œä¿æŒ IB ç½‘æ®µï¼ˆ20.20.20.0&#x2F;24ï¼‰è¿é€šæ€§ï¼Œå®ç°å¼€æœºè‡ªåŠ¨é…ç½®ï¼Œä¸å½±å“ GPU æ­£å¸¸å·¥ä½œã€‚</p>\n</li>\n</ul>\n<h1 id=\"äºŒã€é—®é¢˜æ ¹æºæ·±åº¦è§£æ\"><a href=\"#äºŒã€é—®é¢˜æ ¹æºæ·±åº¦è§£æ\" class=\"headerlink\" title=\"äºŒã€é—®é¢˜æ ¹æºæ·±åº¦è§£æ\"></a>äºŒã€é—®é¢˜æ ¹æºæ·±åº¦è§£æ</h1><p>åŠ è£… GPU å IB ç½‘å¡å¤±æ•ˆï¼Œå¹¶éç¡¬ä»¶æŸåï¼Œè€Œæ˜¯<strong>å¤šé‡è¿é”é—®é¢˜</strong>å¯¼è‡´ï¼š</p>\n<ol>\n<li><p><strong>PCIe èµ„æºå†²çª</strong>ï¼šGPU å ç”¨å¤§é‡ PCIe é€šé“ï¼Œå¯èƒ½è§¦å‘ BIOS é‡ç½® PCIe é…ç½®ï¼Œæˆ–å¯¼è‡´ IB ç½‘å¡çš„ PCIe èµ„æºè¢«å ç”¨ï¼Œé©±åŠ¨åŠ è½½å¼‚å¸¸ã€‚</p>\n</li>\n<li><p><strong>MLX_OFED é©±åŠ¨å†²çª</strong>ï¼šæœåŠ¡å™¨åŸæœ¬ä¾èµ– Mellanox å®˜æ–¹ OFED é©±åŠ¨å®ç° IB åŠŸèƒ½ï¼ŒåŠ è£… GPU åï¼Œç³»ç»ŸåŸç”Ÿ RDMA æ¨¡å—ï¼ˆrdma_cm&#x2F;rdma_ucmï¼‰ä¸ OFED é©±åŠ¨å†²çªï¼Œå¯¼è‡´ openibd æœåŠ¡å¯åŠ¨å¤±è´¥ï¼ˆçŠ¶æ€ç  3&#x2F;NOTIMPLEMENTEDï¼‰ï¼Œæ— æ³•åˆå§‹åŒ– IB è®¾å¤‡ã€‚</p>\n</li>\n<li><p><strong>IB æ¨¡å—æœªè‡ªåŠ¨åŠ è½½</strong>ï¼šopenibd æœåŠ¡å¤±æ•ˆåï¼ŒMLX5 IB æ ¸å¿ƒæ¨¡å—ï¼ˆmlx5_ibï¼‰ã€IB åè®®æ¨¡å—ï¼ˆib_ipoib ç­‰ï¼‰æ— æ³•å¼€æœºè‡ªåŠ¨åŠ è½½ï¼ŒIB ç½‘å¡è™½è¢«è¯†åˆ«ä½†æœªç”Ÿæˆ ib0 è®¾å¤‡ã€‚</p>\n</li>\n</ol>\n<h1 id=\"ä¸‰ã€è§£å†³æ–¹æ¡ˆï¼šsystemd-æœåŠ¡å®ç°-ib0-è‡ªåŠ¨åˆå§‹åŒ–\"><a href=\"#ä¸‰ã€è§£å†³æ–¹æ¡ˆï¼šsystemd-æœåŠ¡å®ç°-ib0-è‡ªåŠ¨åˆå§‹åŒ–\" class=\"headerlink\" title=\"ä¸‰ã€è§£å†³æ–¹æ¡ˆï¼šsystemd æœåŠ¡å®ç° ib0 è‡ªåŠ¨åˆå§‹åŒ–\"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆï¼šsystemd æœåŠ¡å®ç° ib0 è‡ªåŠ¨åˆå§‹åŒ–</h1><p>æ— éœ€ä¿®å¤å¤æ‚çš„é©±åŠ¨å†²çªï¼Œä¹Ÿä¸ç”¨æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œé€šè¿‡åˆ›å»º systemd æœåŠ¡ï¼Œå®ç° â€œåŠ è½½æ¨¡å—â†’åˆ›å»º ib0â†’é…ç½® IPâ€ å…¨æµç¨‹è‡ªåŠ¨åŒ–ï¼Œé‡å¯åä¾ç„¶ç”Ÿæ•ˆã€‚</p>\n<h2 id=\"æ­¥éª¤-1ï¼šåˆ›å»º-systemd-æœåŠ¡æ–‡ä»¶\"><a href=\"#æ­¥éª¤-1ï¼šåˆ›å»º-systemd-æœåŠ¡æ–‡ä»¶\" class=\"headerlink\" title=\"æ­¥éª¤ 1ï¼šåˆ›å»º systemd æœåŠ¡æ–‡ä»¶\"></a>æ­¥éª¤ 1ï¼šåˆ›å»º systemd æœåŠ¡æ–‡ä»¶</h2><p>åˆ›å»º<code>ib0-init.service</code>æœåŠ¡ï¼Œé€‚é… CentOS 7 è€ç‰ˆæœ¬è¯­æ³•ï¼Œé¿å…å‚æ•°æŠ¥é”™ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/systemd/system/ib0-init.service</span><br></pre></td></tr></table></figure>\n\n<p>ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼ˆæ ¸å¿ƒå…¼å®¹è€ç‰ˆæœ¬ iproute2ï¼Œæ— <code>parent</code>å‚æ•°ï¼‰ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Initialize IB0 device (CentOS 7 iproute2 compatible)</span><br><span class=\"line\">After=network.target  # ç¡®ä¿ç½‘ç»œæœåŠ¡å¯åŠ¨åå†æ‰§è¡Œ</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=oneshot  # ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¿æŒçŠ¶æ€</span><br><span class=\"line\"># æ ¸å¿ƒå‘½ä»¤ï¼šåŠ è½½IBæ¨¡å—â†’åˆ›å»ºib0â†’å¯ç”¨è®¾å¤‡â†’é…ç½®20ç½‘æ®µIP</span><br><span class=\"line\">ExecStart=/bin/bash -c &quot;modprobe mlx5_ib; modprobe ib_core; modprobe ib_cm; modprobe ib_ipoib; ip link add ib0 type ipoib; ip link set ib0 up; ip addr add 20.20.20.109/24 dev ib0&quot;</span><br><span class=\"line\"># åœæ­¢å‘½ä»¤ï¼šåˆ é™¤ib0â†’å¸è½½æ¨¡å—ï¼ˆå¯é€‰ï¼‰</span><br><span class=\"line\">ExecStop=/bin/bash -c &quot;ip link delete ib0; modprobe -r ib_ipoib ib_cm ib_core mlx5_ib&quot;</span><br><span class=\"line\">RemainAfterExit=yes  # æ‰§è¡Œå®Œåä¿æŒæœåŠ¡æ´»è·ƒçŠ¶æ€</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target  # å¤šç”¨æˆ·æ¨¡å¼ä¸‹ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>è¯´æ˜ï¼š<code>20.20.20.101/24</code> éœ€æ›¿æ¢ä¸ºä½ çš„ IB ç½‘æ®µ IPï¼ˆä¸å…¶ä»–èŠ‚ç‚¹ä¿æŒåŒç½‘æ®µï¼‰ï¼›è‹¥é›†ç¾¤ IB åˆ†åŒºä½¿ç”¨ PKEYï¼ˆå¦‚ 0x8001ï¼‰ï¼Œå¯åœ¨<code>ip link add ib0 type ipoib</code>åæ·»åŠ <code>pkey 0x8001</code>ã€‚</li>\n</ul>\n<h2 id=\"æ­¥éª¤-2ï¼šå¯ç”¨å¹¶å¯åŠ¨æœåŠ¡\"><a href=\"#æ­¥éª¤-2ï¼šå¯ç”¨å¹¶å¯åŠ¨æœåŠ¡\" class=\"headerlink\" title=\"æ­¥éª¤ 2ï¼šå¯ç”¨å¹¶å¯åŠ¨æœåŠ¡\"></a>æ­¥éª¤ 2ï¼šå¯ç”¨å¹¶å¯åŠ¨æœåŠ¡</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># é‡æ–°åŠ è½½systemdé…ç½®ï¼Œè®©æ–°æœåŠ¡ç”Ÿæ•ˆ</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"># è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå…³é”®ï¼é‡å¯åè‡ªåŠ¨æ‰§è¡Œï¼‰</span><br><span class=\"line\">sudo systemctl enable ib0-init.service</span><br><span class=\"line\"></span><br><span class=\"line\"># ç«‹å³å¯åŠ¨æœåŠ¡ï¼Œæ— éœ€é‡å¯</span><br><span class=\"line\">sudo systemctl start ib0-init.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ­¥éª¤-3ï¼šéªŒè¯-ib0-æ˜¯å¦åˆ›å»ºæˆåŠŸ\"><a href=\"#æ­¥éª¤-3ï¼šéªŒè¯-ib0-æ˜¯å¦åˆ›å»ºæˆåŠŸ\" class=\"headerlink\" title=\"æ­¥éª¤ 3ï¼šéªŒè¯ ib0 æ˜¯å¦åˆ›å»ºæˆåŠŸ\"></a>æ­¥éª¤ 3ï¼šéªŒè¯ ib0 æ˜¯å¦åˆ›å»ºæˆåŠŸ</h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¡®è®¤é…ç½®ç”Ÿæ•ˆï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1. æ£€æŸ¥ib0è®¾å¤‡æ˜¯å¦å­˜åœ¨ï¼ˆçŠ¶æ€UPä¸ºæ­£å¸¸ï¼‰</span><br><span class=\"line\">ip link show ib0</span><br><span class=\"line\"># é¢„æœŸè¾“å‡ºï¼š</span><br><span class=\"line\"># 4: ib0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 4096 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">#    link/ib 00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00</span><br><span class=\"line\"></span><br><span class=\"line\"># 2. æ£€æŸ¥IBç½‘æ®µIPæ˜¯å¦é…ç½®æˆåŠŸ</span><br><span class=\"line\">ip addr show ib0 | grep 20.20.20.</span><br><span class=\"line\"># é¢„æœŸè¾“å‡ºï¼šinet 20.20.20.101/24 scope global ib0</span><br><span class=\"line\"></span><br><span class=\"line\"># 3. æµ‹è¯•ä¸å…¶ä»–IBèŠ‚ç‚¹çš„è¿é€šæ€§ï¼ˆå¦‚node2çš„20.20.20.107ï¼‰</span><br><span class=\"line\">ping 20.20.20.107 -c 3</span><br><span class=\"line\"># è¾“å‡ºâ€œ3 packets transmitted, 3 receivedâ€å³ä¸ºè¿é€šæ­£å¸¸</span><br><span class=\"line\"></span><br><span class=\"line\"># 4. éªŒè¯NFSç­‰ä¾èµ–IBçš„æœåŠ¡ï¼ˆè‹¥æœ‰ï¼‰</span><br><span class=\"line\">sudo mount -a</span><br><span class=\"line\">df -h /share  # ç¡®è®¤IBç½‘æ®µNFSæŒ‚è½½æ­£å¸¸</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ­¥éª¤-4ï¼šé‡å¯éªŒè¯æ°¸ä¹…ç”Ÿæ•ˆ\"><a href=\"#æ­¥éª¤-4ï¼šé‡å¯éªŒè¯æ°¸ä¹…ç”Ÿæ•ˆ\" class=\"headerlink\" title=\"æ­¥éª¤ 4ï¼šé‡å¯éªŒè¯æ°¸ä¹…ç”Ÿæ•ˆ\"></a>æ­¥éª¤ 4ï¼šé‡å¯éªŒè¯æ°¸ä¹…ç”Ÿæ•ˆ</h2><p>ä¸ºç¡®ä¿é‡å¯åä¸å¤±æ•ˆï¼Œæ‰§è¡Œé‡å¯æµ‹è¯•ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo reboot</span><br></pre></td></tr></table></figure>\n\n<p>é‡å¯åå†æ¬¡æ‰§è¡Œ<code>ip link show ib0</code>å’Œ<code>ping ``20.20.20.101</code>ï¼Œè‹¥ ib0 å­˜åœ¨ä¸”è¿é€šæ­£å¸¸ï¼Œè¯´æ˜æœåŠ¡é…ç½®æˆåŠŸã€‚</p>\n<h1 id=\"å››ã€å…³é”®è¡¥å……ï¼šé¿å‘æŒ‡å—\"><a href=\"#å››ã€å…³é”®è¡¥å……ï¼šé¿å‘æŒ‡å—\" class=\"headerlink\" title=\"å››ã€å…³é”®è¡¥å……ï¼šé¿å‘æŒ‡å—\"></a>å››ã€å…³é”®è¡¥å……ï¼šé¿å‘æŒ‡å—</h1><ol>\n<li><p><strong>æ¨¡å—åŠ è½½é¡ºåºä¸èƒ½ä¹±</strong>ï¼šå¿…é¡»å…ˆåŠ è½½<code>mlx5_ib</code>ï¼ˆMLX5 ç½‘å¡ä¸“ç”¨ IB æ¨¡å—ï¼‰ï¼Œå†åŠ è½½<code>ib_core</code>ç­‰åè®®æ¨¡å—ï¼Œå¦åˆ™ä¼šå¯¼è‡´è®¾å¤‡åˆ›å»ºå¤±è´¥ã€‚</p>\n</li>\n<li><p><strong>è‹¥ ib0 ä»æœªåˆ›å»º</strong>ï¼š</p>\n</li>\n</ol>\n<ul>\n<li><p>æ‰§è¡Œ<code>ibv_devinfo</code>æ£€æŸ¥ç‰©ç† IB è®¾å¤‡æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚ mlx5_0ï¼‰ï¼Œè‹¥æ— è¾“å‡ºï¼Œéœ€é‡æ–°å®‰è£… Mellanox OFED é©±åŠ¨ï¼ˆå…¼å®¹ GPU é©±åŠ¨ç‰ˆæœ¬ï¼‰ã€‚</p>\n</li>\n<li><p>æ’æŸ¥ IB çº¿ç¼†æ˜¯å¦æ’ç´§ã€IB äº¤æ¢æœºå¯¹åº”ç«¯å£æ˜¯å¦å¯ç”¨ï¼ˆç‰©ç†é“¾è·¯ä¸­æ–­ä¹Ÿä¼šå¯¼è‡´ ib0 åˆ›å»ºå¤±è´¥ï¼‰ã€‚</p>\n</li>\n</ul>\n<ol>\n<li><p><strong>GPU ä¸ IB ç½‘å¡èµ„æºå†²çª</strong>ï¼šè‹¥é‡å¯å GPU å¤±æ•ˆï¼Œéœ€è¿›å…¥ BIOS è°ƒæ•´ PCIe é€šé“åˆ†é…ï¼Œå°† IB ç½‘å¡å’Œ GPU åˆ†é…åˆ°ä¸åŒçš„ PCIe æ ¹å¤åˆä½“ï¼Œé¿å…èµ„æºç«äº‰ã€‚</p>\n</li>\n<li><p><strong>å…œåº•æ–¹æ¡ˆ</strong>ï¼šè‹¥ IB æ¨¡å¼å§‹ç»ˆæ— æ³•æ¢å¤ï¼Œå¯æ²¿ç”¨ä»¥å¤ªç½‘è½¬å‘æ–¹æ¡ˆï¼ˆæ— éœ€ ib0ï¼‰ï¼š</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;20.20.20.0/24 via 10.20.0.1 dev eno1 metric 200&quot; &gt;&gt; /etc/sysconfig/network-scripts/route-eno1</span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl restart network</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"äº”ã€æ€»ç»“\"><a href=\"#äº”ã€æ€»ç»“\" class=\"headerlink\" title=\"äº”ã€æ€»ç»“\"></a>äº”ã€æ€»ç»“</h1><p>åŠ è£… GPU å IB ç½‘å¡å¤±æ•ˆçš„æ ¸å¿ƒæ˜¯ â€œé©±åŠ¨å†²çª + æ¨¡å—æœªè‡ªåŠ¨åŠ è½½â€ï¼Œé€šè¿‡ systemd æœåŠ¡å¯å®Œç¾è§£å†³ï¼šæ— éœ€ä¿®æ”¹ BIOSã€ä¸å¸è½½ GPU é©±åŠ¨ï¼Œä»…éœ€ 3 æ­¥é…ç½®ï¼Œå³å¯å®ç° ib0 å¼€æœºè‡ªåŠ¨åˆ›å»ºã€IP è‡ªåŠ¨é…ç½®ï¼Œæ¢å¤ IB é«˜é€Ÿä¼ è¾“åŠŸèƒ½ã€‚</p>\n<p>è¯¥æ–¹æ¡ˆå·²åœ¨ç”Ÿäº§ç¯å¢ƒéªŒè¯ï¼Œé€‚é… CentOS 7 æ‰€æœ‰ç‰ˆæœ¬ï¼Œå…¼å®¹ Mellanox ConnectX-4&#x2F;5&#x2F;6 ç³»åˆ—ç½‘å¡ã€‚å¦‚æœé‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€äº¤æµï¼Œåˆ†äº«ä½ çš„æ’æŸ¥ç»éªŒï¼</p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"}]},{"title":"ç»ˆç‰ˆå®æµ‹ï¼CentOS 7.9ï¼ˆglibc 2.17ï¼‰å‡çº§ Go 1.24.4 ç¼–è¯‘ Ollama 0.13.3ï¼Œ4 å¼  L4 GPU æ»¡è¡€è¿è¡Œï½","slug":"CentOS7ä¸­Go1.24.4å®‰è£…ä¸Ollama0.13.3æºç ç¼–è¯‘","date":"2025-12-16T11:18:18.000Z","updated":"2025-12-18T11:15:07.448Z","comments":true,"path":"api/articles/CentOS7ä¸­Go1.24.4å®‰è£…ä¸Ollama0.13.3æºç ç¼–è¯‘.json","excerpt":null,"keywords":null,"cover":null,"content":"<p>ğŸ”¥ ä½œä¸ºåšå®ˆ CentOS 7.9 çš„è¿ç»´ &#x2F; å¼€å‘è€…ï¼Œè°æ‡‚å•Šï¼å®˜æ–¹ Ollama äºŒè¿›åˆ¶åŒ…ç›´æ¥æŠ¥é”™ã€ŒGLIBC_2.27 not foundã€ï¼Œè€Œç³»ç»Ÿ glibc 2.17 æ ¹æœ¬æ²¡æ³•å‡çº§ï¼ˆæ€•å´©ç³»ç»Ÿï¼‰ğŸ˜« ä½† 4 å¼  NVIDIA L4 GPUï¼ˆæ€»è®¡ 96GB æ˜¾å­˜ï¼‰ä¸èƒ½æµªè´¹ï¼Œéè¦åœ¨åŸç”Ÿç¯å¢ƒè·‘ Ollama éƒ¨ç½²å¤§æ¨¡å‹ï¼Œäºæ˜¯ç¡¬ç€å¤´çš®èµ° Go ç¼–è¯‘è·¯çº¿ï¼Œè¿‡ç¨‹è¸©éå‘ï¼Œç°åœ¨æ•´ç†æˆä¿å§†çº§æ•™ç¨‹ï¼Œé€ ç¦åŒæ¬¾è€ç³»ç»Ÿç”¨æˆ·ï¼</p>\n<h1 id=\"ğŸ“Œ-æ ¸å¿ƒèƒŒæ™¯ï¼šä¸ºå•¥éè¦è‡ªå·±åŠ¨æ‰‹ï¼Ÿ\"><a href=\"#ğŸ“Œ-æ ¸å¿ƒèƒŒæ™¯ï¼šä¸ºå•¥éè¦è‡ªå·±åŠ¨æ‰‹ï¼Ÿ\" class=\"headerlink\" title=\"ğŸ“Œ æ ¸å¿ƒèƒŒæ™¯ï¼šä¸ºå•¥éè¦è‡ªå·±åŠ¨æ‰‹ï¼Ÿ\"></a>ğŸ“Œ æ ¸å¿ƒèƒŒæ™¯ï¼šä¸ºå•¥éè¦è‡ªå·±åŠ¨æ‰‹ï¼Ÿ</h1><ul>\n<li><p>ç³»ç»Ÿé™åˆ¶ï¼šCentOS 7.9 é»˜è®¤ glibc 2.17ï¼Œå®˜æ–¹ Ollama æ‰€æœ‰ç‰ˆæœ¬éƒ½ä¾èµ– glibcâ‰¥2.27ï¼Œç›´æ¥è¿è¡Œå¿…æŠ¥é”™ï¼›</p>\n</li>\n<li><p>ç¡¬ä»¶åˆšéœ€ï¼š4 å¼  L4 GPU æƒ³æœ€å¤§åŒ–ç®—åŠ›ï¼ŒåŸç”Ÿç¼–è¯‘æ¯” Docker å°‘è™šæ‹ŸåŒ–æŸè€—ï¼Œå¤šå¡å¹¶è¡Œæ›´é«˜æ•ˆã€‚</p>\n</li>\n<li><p>æ— æ›¿ä»£æ–¹æ¡ˆï¼šç¤¾åŒºæ— é€‚é… glibc 2.17 çš„ Ollama é¢„ç¼–è¯‘åŒ…ï¼Œåªèƒ½æºç ç¼–è¯‘å®šåˆ¶ã€‚</p>\n</li>\n</ul>\n<h1 id=\"ğŸ› ï¸-å…¨ç¨‹å®æ“ï¼ˆæŒ‰è‡ªèº«è·¯å¾„è°ƒæ•´ï¼‰\"><a href=\"#ğŸ› ï¸-å…¨ç¨‹å®æ“ï¼ˆæŒ‰è‡ªèº«è·¯å¾„è°ƒæ•´ï¼‰\" class=\"headerlink\" title=\"ğŸ› ï¸ å…¨ç¨‹å®æ“ï¼ˆæŒ‰è‡ªèº«è·¯å¾„è°ƒæ•´ï¼‰\"></a>ğŸ› ï¸ å…¨ç¨‹å®æ“ï¼ˆæŒ‰è‡ªèº«è·¯å¾„è°ƒæ•´ï¼‰</h1><ul>\n<li>ç‰ˆæœ¬é€‰æ‹©ï¼šGo 1.24.4ï¼ˆé€‚é… Ollama 0.13.3ï¼Œå…¼å®¹ glibc 2.17ï¼‰+ Ollama 0.13.3 æºç åŒ…ï¼ˆ<a href=\"https://github.com/ollama/ollama/archive/refs/tags/v0.13.3.tar.gz\">https://github.com/ollama/ollama/archive/refs/tags/v0.13.3.tar.gz</a>ï¼‰ï¼›</li>\n</ul>\n<h2 id=\"1ï¸âƒ£-å‡çº§-Go-åˆ°-1-24-4ï¼ˆç¼–è¯‘-Ollama-çš„å‰æï¼Œä¸åŒç”¨æˆ·è·¯å¾„ä¸åŒï¼ŒåŠ¡å¿…è‡ªæŸ¥ï¼ï¼‰\"><a href=\"#1ï¸âƒ£-å‡çº§-Go-åˆ°-1-24-4ï¼ˆç¼–è¯‘-Ollama-çš„å‰æï¼Œä¸åŒç”¨æˆ·è·¯å¾„ä¸åŒï¼ŒåŠ¡å¿…è‡ªæŸ¥ï¼ï¼‰\" class=\"headerlink\" title=\"1ï¸âƒ£ å‡çº§ Go åˆ° 1.24.4ï¼ˆç¼–è¯‘ Ollama çš„å‰æï¼Œä¸åŒç”¨æˆ·è·¯å¾„ä¸åŒï¼ŒåŠ¡å¿…è‡ªæŸ¥ï¼ï¼‰\"></a>1ï¸âƒ£ å‡çº§ Go åˆ° 1.24.4ï¼ˆç¼–è¯‘ Ollama çš„å‰æï¼Œä¸åŒç”¨æˆ·è·¯å¾„ä¸åŒï¼ŒåŠ¡å¿…è‡ªæŸ¥ï¼ï¼‰</h2><ul>\n<li>å¸è½½æ—§ Goï¼ˆç¤ºä¾‹è·¯å¾„ï¼Œæ›¿æ¢æˆè‡ªå·±çš„ï¼ï¼‰ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">rm</span> -rf /share/opt/go  <span class=\"comment\"># æˆ‘ä¹‹å‰è£…çš„Go 1.18.2è·¯å¾„</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/\\/share\\/opt\\/go\\/bin/d&#x27;</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ä¸‹è½½ Go 1.24.4ï¼ˆé˜¿é‡Œäº‘é•œåƒï¼Œç¨³å®šä¸ç¿»è½¦ï¼‰ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://mirrors.aliyun.com/golang/go1.24.4.linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -C /usr/local -xzf go1.24.4.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>é…ç½® Go ç¯å¢ƒå˜é‡ï¼ˆå…¨å±€ç”Ÿæ•ˆï¼‰ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/profile</span><br></pre></td></tr></table></figure>\n\n<p>æ–°å¢ä»¥ä¸‹å†…å®¹ï¼š</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export GOROOT=/usr/local/go</span><br><span class=\"line\">export PATH=$GOROOT/bin:$PATH</span><br><span class=\"line\">export GOPATH=$HOME/go</span><br><span class=\"line\">export GOPROXY=https://mirrors.aliyun.com/goproxy/,direct  # å›½å†…ä»£ç†é¿å‘</span><br></pre></td></tr></table></figure>\n\n<p>ä¿å­˜å¹¶é€€å‡ºï¼ˆESCï¼Œ shift + ;, wq, å›è½¦ï¼‰ï¼Œä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>éªŒè¯ï¼š<code>go version</code> è¾“å‡º <code>go1.24.4 linux/amd64</code> å³æˆåŠŸã€‚</li>\n</ul>\n<h2 id=\"2ï¸âƒ£-ä¸‹è½½-Ollama-0-13-3-æºç åŒ…ï¼ˆæ— éœ€-gitï¼Œè§£å‹å³ç¼–è¯‘ï¼‰\"><a href=\"#2ï¸âƒ£-ä¸‹è½½-Ollama-0-13-3-æºç åŒ…ï¼ˆæ— éœ€-gitï¼Œè§£å‹å³ç¼–è¯‘ï¼‰\" class=\"headerlink\" title=\"2ï¸âƒ£ ä¸‹è½½ Ollama 0.13.3 æºç åŒ…ï¼ˆæ— éœ€ gitï¼Œè§£å‹å³ç¼–è¯‘ï¼‰\"></a>2ï¸âƒ£ ä¸‹è½½ Ollama 0.13.3 æºç åŒ…ï¼ˆæ— éœ€ gitï¼Œè§£å‹å³ç¼–è¯‘ï¼‰</h2><ul>\n<li><p>ä¸‹è½½æºç ï¼š<code>wget https://github.com/ollama/ollama/archive/refs/tags/v0.13.3.tar.gz</code>ï¼›</p>\n</li>\n<li><p>è§£å‹è¿›å…¥ç›®å½•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf v0.13.3.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># çœ‹æ¸…è§£å‹åçš„ç›®å½•åå†è¿›å…¥</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ollama-0.13.3</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3ï¸âƒ£-ç¼–è¯‘-Ollama-0-13-3ï¼ˆé€‚é…-glibc-2-17-æ ¸å¿ƒå‚æ•°ï¼‰\"><a href=\"#3ï¸âƒ£-ç¼–è¯‘-Ollama-0-13-3ï¼ˆé€‚é…-glibc-2-17-æ ¸å¿ƒå‚æ•°ï¼‰\" class=\"headerlink\" title=\"3ï¸âƒ£ ç¼–è¯‘ Ollama 0.13.3ï¼ˆé€‚é… glibc 2.17 æ ¸å¿ƒå‚æ•°ï¼‰\"></a>3ï¸âƒ£ ç¼–è¯‘ Ollama 0.13.3ï¼ˆé€‚é… glibc 2.17 æ ¸å¿ƒå‚æ•°ï¼‰</h2><ul>\n<li>é…ç½®ç¼–è¯‘ç¯å¢ƒå˜é‡ï¼ˆé™æ€ç¼–è¯‘ï¼Œè§„é¿ glibc ç‰ˆæœ¬é—®é¢˜ï¼‰ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> CGO_ENABLED=1</span><br><span class=\"line\"><span class=\"built_in\">export</span> CGO_CFLAGS=<span class=\"string\">&quot;-D_GLIBCXX_USE_CXX11_ABI=0 -m64 -Wl,--hash-style=gnu -Wl,--as-needed&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> CGO_LDFLAGS=<span class=\"string\">&quot;-lrt -lm -ldl -Wl,--disable-new-dtags -Wl,--rpath=/lib64&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> GOFLAGS=<span class=\"string\">&quot;-buildmode=pie -trimpath&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> CC=<span class=\"string\">&quot;gcc -static-libgcc -static-libstdc++&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>æ‰§è¡Œç¼–è¯‘ï¼ˆ0.13.3 ä¸»å…¥å£åœ¨æ ¹ç›®å½• main.goï¼Œåˆ«å†™é”™ï¼ï¼‰ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go build -ldflags <span class=\"string\">&quot;-s -w -linkmode=external -extldflags &#x27;-static-libgcc -static-libstdc++ -lm -ldl&#x27;&quot;</span> -o ollama ./main.go</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>éªŒè¯ï¼š<code>./ollama --help</code> æ—  GLIBC æŠ¥é”™ï¼Œå°†äºŒè¿›åˆ¶ç§»åˆ°ç³»ç»Ÿè·¯å¾„ï¼š<code>cp ./ollama /usr/local/bin/</code>ï¼Œæˆ–å°†å½“å‰è·¯å¾„åŠ å…¥ç¯å¢ƒå˜é‡ï¼ˆæˆ‘é€‰æ‹©çš„åè€…ï¼š&#x2F;share&#x2F;tools&#x2F;ollama-0.13.3ï¼‰ã€‚</li>\n</ul>\n<h2 id=\"4ï¸âƒ£-é…ç½®å¼€æœºè‡ªå¯ï¼ˆåå°ç¨³è·‘ï¼Œçœå¿ƒï¼ï¼‰\"><a href=\"#4ï¸âƒ£-é…ç½®å¼€æœºè‡ªå¯ï¼ˆåå°ç¨³è·‘ï¼Œçœå¿ƒï¼ï¼‰\" class=\"headerlink\" title=\"4ï¸âƒ£ é…ç½®å¼€æœºè‡ªå¯ï¼ˆåå°ç¨³è·‘ï¼Œçœå¿ƒï¼ï¼‰\"></a>4ï¸âƒ£ é…ç½®å¼€æœºè‡ªå¯ï¼ˆåå°ç¨³è·‘ï¼Œçœå¿ƒï¼ï¼‰</h2><ul>\n<li>åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ï¼š<code>vi /etc/systemd/system/ollama.service</code>ï¼Œå†™å…¥ï¼š</li>\n</ul>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\"></span><br><span class=\"line\">Description=Ollama Service</span><br><span class=\"line\"></span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\"></span><br><span class=\"line\">Type=simple</span><br><span class=\"line\"></span><br><span class=\"line\">User=root</span><br><span class=\"line\"></span><br><span class=\"line\"># ç»‘å®š4å¼ L4 GPUï¼Œå¼€å¯TensorRTåŠ é€Ÿ</span><br><span class=\"line\"></span><br><span class=\"line\">Environment=&quot;CUDA_VISIBLE_DEVICES=0,1,2,3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Environment=&quot;OLLAMA_TENSORRT=1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># è‡ªå®šä¹‰æ¨¡å‹å­˜æ”¾è·¯å¾„ï¼Œé¿å…å æ»¡/root</span><br><span class=\"line\"></span><br><span class=\"line\">Environment=&quot;OLLAMA_MODELS=/share/public_db/ollama/models&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">ExecStart=/share/tools/ollama-0.13.3/ollama serve</span><br><span class=\"line\"></span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\"></span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>ç”Ÿæ•ˆé…ç½®ï¼š<code>systemctl daemon-reload &amp;&amp; systemctl enable --now ollama</code>ï¼›</p>\n</li>\n<li><p>éªŒè¯æœåŠ¡ï¼š<code>systemctl status ollama</code> æ˜¾ç¤º<code>active(running)</code>å³å¯ã€‚</p>\n</li>\n</ul>\n<h2 id=\"5ï¸âƒ£-ç¯å¢ƒå˜é‡-æ¨¡å‹è·¯å¾„ä¼˜åŒ–ï¼ˆé•¿æœŸä½¿ç”¨å¿…å¤‡ï¼‰\"><a href=\"#5ï¸âƒ£-ç¯å¢ƒå˜é‡-æ¨¡å‹è·¯å¾„ä¼˜åŒ–ï¼ˆé•¿æœŸä½¿ç”¨å¿…å¤‡ï¼‰\" class=\"headerlink\" title=\"5ï¸âƒ£ ç¯å¢ƒå˜é‡ + æ¨¡å‹è·¯å¾„ä¼˜åŒ–ï¼ˆé•¿æœŸä½¿ç”¨å¿…å¤‡ï¼‰\"></a>5ï¸âƒ£ ç¯å¢ƒå˜é‡ + æ¨¡å‹è·¯å¾„ä¼˜åŒ–ï¼ˆé•¿æœŸä½¿ç”¨å¿…å¤‡ï¼‰</h2><ul>\n<li>å…¨å±€é…ç½®ï¼ˆ&#x2F;etc&#x2F;profile æ–°å¢ï¼‰ï¼š</li>\n</ul>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export OLLAMA_MODELS=/share/public_db/ollama/models</span><br><span class=\"line\"></span><br><span class=\"line\">export OLLAMA_TENSORRT=1</span><br><span class=\"line\"></span><br><span class=\"line\">export GOPROXY=https://mirrors.aliyun.com/goproxy/,direct</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>ç”Ÿæ•ˆï¼š<code>source /etc/profile</code>ï¼›</p>\n</li>\n<li><p>æ¨¡å‹è·¯å¾„æƒé™ï¼ˆå¿…åšï¼ï¼‰ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /share/public_db/ollama/models</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 755 /share/public_db/ollama/models</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R root:root /share/public_db/ollama/models</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>æµ‹è¯•ï¼š<code>ollama pull llama3:8b</code>ï¼Œæ¨¡å‹è‡ªåŠ¨å­˜åˆ°<code>/share/public_db/ollama/models</code>ï¼ŒéªŒè¯è·¯å¾„ç”Ÿæ•ˆã€‚</li>\n</ul>\n<h1 id=\"âœ…-æœ€ç»ˆæˆæœ\"><a href=\"#âœ…-æœ€ç»ˆæˆæœ\" class=\"headerlink\" title=\"âœ… æœ€ç»ˆæˆæœ\"></a>âœ… æœ€ç»ˆæˆæœ</h1><ul>\n<li><p>ç¯å¢ƒï¼šCentOS 7.9ï¼ˆglibc 2.17ï¼‰+ Go 1.24.4 + Ollama 0.13.3ï¼ˆåŸç”Ÿç¼–è¯‘ï¼‰ï¼›</p>\n</li>\n<li><p>ç¡¬ä»¶ï¼š4 å¼  L4 GPU æ»¡è´Ÿè½½è¿è¡Œï¼Œllama3:70bï¼ˆINT4 é‡åŒ–ï¼‰ï¼›</p>\n</li>\n<li><p>ç¨³å®šæ€§ï¼šå¼€æœºè‡ªå¯æ— æ•…éšœï¼ŒTensorRT åŠ é€ŸåŠ æŒï¼Œå»¶è¿Ÿå¤§å¹…é™ä½ã€‚</p>\n</li>\n</ul>\n<h1 id=\"ğŸš¨-å…³é”®é¿å‘ç‚¹\"><a href=\"#ğŸš¨-å…³é”®é¿å‘ç‚¹\" class=\"headerlink\" title=\"ğŸš¨ å…³é”®é¿å‘ç‚¹\"></a>ğŸš¨ å…³é”®é¿å‘ç‚¹</h1><ol>\n<li><p>Go è·¯å¾„ï¼šä¸åŒç”¨æˆ·å®‰è£…ä½ç½®ä¸åŒï¼Œç”¨<code>which go</code>è‡ªæŸ¥ï¼Œç¡®ä¿ PATH ä¼˜å…ˆæŒ‡å‘ Go 1.24.4ï¼›</p>\n</li>\n<li><p>ç¼–è¯‘è·¯å¾„ï¼šOllama 0.13.3 ä¸»å…¥å£æ˜¯<code>./main.go</code>ï¼Œåˆ«ç”¨<code>./cmd/ollama</code>ï¼ˆæŠ¥ç›®å½•ä¸å­˜åœ¨ï¼‰ï¼›</p>\n</li>\n<li><p>æƒé™ï¼šæ¨¡å‹è·¯å¾„å¿…é¡»æå‰èµ‹æƒï¼Œå¦åˆ™æ‹‰å–æ¨¡å‹æç¤ºæƒé™æ‹’ç»ï¼›</p>\n</li>\n<li><p>åŠ é€Ÿï¼šL4 GPU å¼€å¯ OLLAMA_TENSORRT&#x3D;1ï¼Œæ¨ç†æ•ˆç‡æå‡ 30%+ã€‚</p>\n</li>\n</ol>\n<p>è€ç³»ç»Ÿä¹Ÿèƒ½æ‹¿æå¤§æ¨¡å‹ï¼Go 1.24.4+Ollama 0.13.3 è¿™å¥—ç»„åˆï¼Œå®Œç¾é€‚é… CentOS 7.9ï¼Œ4 å¼  L4 GPU ç»ˆäºç‰©å°½å…¶ç”¨ï½ è½¬å‘ç»™åŒå¤„å¢ƒçš„æœ‹å‹ï¼Œå°‘èµ°å¼¯è·¯ï¼ğŸš€</p>\n<p>#CentOS7 #Ollama0.13.3 #Go1.24.4 #glibc2.17 #æºç ç¼–è¯‘ #NVIDIA L4 #å¤§æ¨¡å‹éƒ¨ç½²</p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"},{"name":"Ollama","path":"api/tags/Ollama.json"}]},{"title":"WSLå®‰è£…Dockeré¿å‘æŒ‡åŒ—","slug":"WSLå®‰è£…Dockeré¿å‘æŒ‡åŒ—","date":"2022-03-10T02:43:42.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/WSLå®‰è£…Dockeré¿å‘æŒ‡åŒ—.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/ç”Ÿä¿¡ä¹‹å·…å…¬ä¼—å·.jpg","content":"<h1 id=\"å‡çº§WSL\"><a href=\"#å‡çº§WSL\" class=\"headerlink\" title=\"å‡çº§WSL\"></a>å‡çº§WSL</h1><ul>\n<li><p>æŸ¥çœ‹å·²å®‰è£…çš„WSLç‰ˆæœ¬(Windows PowerShellä¸­è¿è¡Œ)</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl.exe -l -v</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>  æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>\n  <figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  NAME                   STATE           VERSION</span><br><span class=\"line\">* Ubuntu-20.04           Running         1</span><br><span class=\"line\">  docker-desktop-data    Stopped         2</span><br></pre></td></tr></table></figure>\n<p>  çœ‹åˆ°å®‰è£…çš„ä¸ºWSL1ï¼Œæ®è¯´WSL1ä¸æ”¯æŒDockerï¼Œæ‰€ä»¥æ¢æˆWSL2ï¼Œè‡³äºWSL1 å’ŒWSL2çš„å¼‚åŒå¯å‚è€ƒ<a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions\">æ¯”è¾ƒ WSL 1 å’Œ WSL 2</a>ã€‚</p>\n</li>\n<li><p>å®‰è£…WSL2 (Windows PowerShellä¸­è¿è¡Œ)</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl.exe --set-version ubuntu-20.04 2</span><br></pre></td></tr></table></figure>\n<p>  æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>\n  <figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ­£åœ¨è¿›è¡Œè½¬æ¢ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´...</span><br><span class=\"line\">æœ‰å…³ä¸ WSL 2 çš„ä¸»è¦åŒºåˆ«çš„ä¿¡æ¯ï¼Œè¯·è®¿é—® https://aka.ms/wsl2</span><br><span class=\"line\">è½¬æ¢å®Œæˆã€‚</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"å®‰è£…Docker\"><a href=\"#å®‰è£…Docker\" class=\"headerlink\" title=\"å®‰è£…Docker\"></a>å®‰è£…Docker</h1><p>åœ¨WSLä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove docker docker-engine docker.io</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install apt-transport-https ca-certificates curl software-properties-common</span><br><span class=\"line\">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class=\"line\">sudo apt-key fingerprint 0EBFCD88</span><br><span class=\"line\">sudo add-apt-repository <span class=\"string\">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class=\"subst\">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Rootç”¨æˆ·å¯åŠ¨Docker\"><a href=\"#Rootç”¨æˆ·å¯åŠ¨Docker\" class=\"headerlink\" title=\"Rootç”¨æˆ·å¯åŠ¨Docker\"></a>Rootç”¨æˆ·å¯åŠ¨Docker</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo su</span><br><span class=\"line\"><span class=\"built_in\">export</span> DOCKER_HOST=tcp://localhost:2375</span><br><span class=\"line\">service docker start</span><br></pre></td></tr></table></figure>\n<p>æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* Starting Docker: docker</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"æµ‹è¯•-è¿˜æ˜¯åœ¨rootç”¨æˆ·\"><a href=\"#æµ‹è¯•-è¿˜æ˜¯åœ¨rootç”¨æˆ·\" class=\"headerlink\" title=\"æµ‹è¯•(è¿˜æ˜¯åœ¨rootç”¨æˆ·)\"></a>æµ‹è¯•(è¿˜æ˜¯åœ¨rootç”¨æˆ·)</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker version</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"æŠ¥é”™\"><a href=\"#æŠ¥é”™\" class=\"headerlink\" title=\"æŠ¥é”™\"></a>æŠ¥é”™</h1><p>ä»¥ä¸‹æ˜¯æŠ¥é”™ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Client: Docker Engine - Community</span><br><span class=\"line\"> Version:           20.10.12</span><br><span class=\"line\"> API version:       1.41</span><br><span class=\"line\"> Go version:        go1.16.12</span><br><span class=\"line\"> Git commit:        e91ed57</span><br><span class=\"line\"> Built:             Mon Dec 13 11:45:33 2021</span><br><span class=\"line\"> OS/Arch:           linux/amd64</span><br><span class=\"line\"> Context:           default</span><br><span class=\"line\"> Experimental:      true</span><br><span class=\"line\">Cannot connect to the Docker daemon at tcp://localhost:2375. Is the docker daemon running?</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ä¿®å¤\"><a href=\"#ä¿®å¤\" class=\"headerlink\" title=\"ä¿®å¤\"></a>ä¿®å¤</h1><p><strong>å›åˆ°æ™®é€šç”¨æˆ·è¿è¡Œ</strong></p>\n<ul>\n<li><p>ç¼–è¾‘ç¯å¢ƒå˜é‡</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨æœ€ä¸‹é¢æ·»åŠ ä¸€è¡Œï¼š</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> DOCKER_HOST=<span class=\"string\">&#x27;unix:///var/run/docker.sock&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å†æ¬¡æµ‹è¯•</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker version</span><br></pre></td></tr></table></figure>\n<p>  æ˜¾ç¤ºå¦‚ä¸‹è¡¨æ˜æˆåŠŸï¼š</p>\n  <figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Client: Docker Engine - Community</span><br><span class=\"line\"> Version:           20.10.12</span><br><span class=\"line\"> API version:       1.41</span><br><span class=\"line\"> Go version:        go1.16.12</span><br><span class=\"line\"> Git commit:        e91ed57</span><br><span class=\"line\"> Built:             Mon Dec 13 11:45:33 2021</span><br><span class=\"line\"> OS/Arch:           linux/amd64</span><br><span class=\"line\"> Context:           default</span><br><span class=\"line\"> Experimental:      true</span><br><span class=\"line\"></span><br><span class=\"line\">Server: Docker Engine - Community</span><br><span class=\"line\"> Engine:</span><br><span class=\"line\">  Version:          20.10.12</span><br><span class=\"line\">  API version:      1.41 (minimum version 1.12)</span><br><span class=\"line\">  Go version:       go1.16.12</span><br><span class=\"line\">  Git commit:       459d0df</span><br><span class=\"line\">  Built:            Mon Dec 13 11:43:42 2021</span><br><span class=\"line\">  OS/Arch:          linux/amd64</span><br><span class=\"line\">  Experimental:     false</span><br><span class=\"line\"> containerd:</span><br><span class=\"line\">  Version:          1.4.13</span><br><span class=\"line\">  GitCommit:        9cc61520f4cd876b86e77edfeb88fbcd536d1f9d</span><br><span class=\"line\"> runc:</span><br><span class=\"line\">  Version:          1.0.3</span><br><span class=\"line\">  GitCommit:        v1.0.3-0-gf46b6ba</span><br><span class=\"line\"> docker-init:</span><br><span class=\"line\">  Version:          0.19.0</span><br><span class=\"line\">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h1><ul>\n<li><a href=\"https://blog.csdn.net/qq_44701736/article/details/119411485\">WSLå®‰è£…docker</a></li>\n<li><a href=\"https://www.jianshu.com/p/7c0084fd9003\">Cannot connect to the Docker daemon at tcp:&#x2F;&#x2F;localhost:2375. Is the docker daemon running?</a></li>\n</ul>\n<h1 id=\"ä»£ç è·å–\"><a href=\"#ä»£ç è·å–\" class=\"headerlink\" title=\"ä»£ç è·å–\"></a>ä»£ç è·å–</h1><p>å…³æ³¨å…¬ä¼—å·â€œç”Ÿä¿¡ä¹‹å·…â€ï¼ŒèŠå¤©çª—å£å›å¤â€œâ€è·å–ä¸‹è½½é“¾æ¥ã€‚</p>\n<table align=\"center\"><tr>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/ç”Ÿä¿¡ä¹‹å·…å…¬ä¼—å·.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/ç”Ÿä¿¡ä¹‹å·…å…¬ä¼—å·.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"ç”Ÿä¿¡ä¹‹å·…å¾®ä¿¡å…¬ä¼—å·\" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-right: 0px;margin-bottom: 5px;align: center;\"></td>\n  <td align=\"center\"><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/å°ç¨‹åºç .png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/social/å°ç¨‹åºç .png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"ç”Ÿä¿¡ä¹‹å·…å°ç¨‹åºç \" style=\"width: 100px;height: 100px;vertical-align: -20px;border-radius: 0%;margin-left: 0px;margin-bottom: 5px;align: center\"></td>\n</tr></table>\n\n\n<p><font color=\"#FF0000\"><ruby><b>æ•¬å‘Š</b>ï¼šä½¿ç”¨æ–‡ä¸­è„šæœ¬è¯·å¼•ç”¨æœ¬æ–‡ç½‘å€ï¼Œè¯·å°Šé‡æœ¬äººçš„åŠ³åŠ¨æˆæœï¼Œè°¢è°¢ï¼<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"},{"name":"è™šæ‹Ÿæœº","path":"api/tags/è™šæ‹Ÿæœº.json"}]},{"title":"windows 10 ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ","slug":"windows-10-ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ","date":"2019-03-01T13:53:01.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/windows-10-ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_1.png","content":"<p>å®‰è£…çš„è‹±æ–‡åŸç‰ˆç³»ç»Ÿï¼Œå¯¼è‡´å¤šæ•°ä¸­æ–‡ä¹±ç ï¼Œå³ä¾¿æ˜¯å®‰è£…äº†ä¸­æ–‡è¯­è¨€åŒ…ï¼Œå¦‚æœè®¾ç½®é”™è¯¯ï¼Œä»æ—§æ— æ³•æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡ã€‚</p>\n<span id=\"more\"></span>\n<p>è¿›å…¥æ­£é¢˜ï¼ŒæŒ‰å¦‚å›¾æ‰€ç¤ºä¸€æ­¥æ­¥å®Œæˆè®¾ç½®ï¼Œé‡å¯ç³»ç»Ÿä¾¿å¯è§£å†³é—®é¢˜ã€‚æˆ‘çš„ç³»ç»Ÿæ˜¯18845.1001ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬åº”è¯¥ä¸ä¼šå·®åˆ«å¤ªå¤§ã€‚</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_1.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_1.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"é€šè¿‡å¼€å§‹èœå•è¿›å…¥æ§åˆ¶é¢æ¿\"></p>\n<center>é€šè¿‡å¼€å§‹èœå•è¿›å…¥æ§åˆ¶é¢æ¿</center>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_2.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_2.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"æ—¥æœŸã€æ—¶é—´å’ŒåŒºåŸŸæ ¼å¼è®¾ç½®\"></p>\n<center>æ—¥æœŸã€æ—¶é—´å’ŒåŒºåŸŸæ ¼å¼è®¾ç½®</center>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_3.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_3.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"ä¸‹æ‹‰ç›¸å…³è®¾ç½®\"></p>\n<center>ä¸‹æ‹‰ç›¸å…³è®¾ç½®</center>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_4.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_4.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"é€‰æ‹©åŒºåŸŸ\"></p>\n<center>é€‰æ‹©åŒºåŸŸ</center>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_5.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_5.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"ç®¡ç†-æ›´æ”¹ç³»ç»ŸåŒºåŸŸè®¾ç½®\"></p>\n<center>ç®¡ç†-æ›´æ”¹ç³»ç»ŸåŒºåŸŸè®¾ç½®</center>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_6.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_6.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"è®¾ç½®ä¸ºä¸­æ–‡ï¼Œä¸è¦é€‰æ‹©Betaç‰ˆ\"></p>\n<center>è®¾ç½®ä¸ºä¸­æ–‡ï¼Œä¸è¦é€‰æ‹©Betaç‰ˆ</center>\n\n<p><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_7.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/news/control_panel_7.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"å¤åˆ¶è®¾ç½®\"></p>\n<center>å¤åˆ¶è®¾ç½®</center>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"}]},{"title":"è·å–ä¸‹ä¸€ç‰ˆæœ¬çš„å†…éƒ¨é¢„è§ˆç‰ˆwindowsç³»ç»Ÿ","slug":"è·å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„å†…éƒ¨é¢„è§ˆç‰ˆwindowsç³»ç»Ÿ","date":"2019-02-17T11:19:04.000Z","updated":"2024-03-11T13:07:17.000Z","comments":true,"path":"api/articles/è·å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„å†…éƒ¨é¢„è§ˆç‰ˆwindowsç³»ç»Ÿ.json","excerpt":null,"keywords":null,"cover":"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/skip_user.png","content":"<p>Windowså†…éƒ¨é¢„è§ˆç‰ˆç³»ç»Ÿå¿«é€Ÿé€šé“å·²ç»å…³é—­ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ä»¥è·å–ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„Windowsã€‚</p>\n<span id=\"more\"></span>\n\n<ol>\n<li><p>é¦–å…ˆï¼Œæ‚¨å¿…é¡»å·²ç»æ˜¯Windows Insideræ‰èƒ½åˆ©ç”¨è¿™ä¸€æŠ€å·§ã€‚ å¦‚æœæ‚¨æ˜¯Windows Insiderï¼Œç‚¹å‡»â€œè®¾ç½®â€â†’â€œæ›´æ–°å’Œå®‰å…¨â€â†’â€œWindowsé¢„è§ˆä½“éªŒè®¡åˆ’â€ï¼Œå°†â€œä½ å¸Œæœ›æ¥æ”¶å“ªç±»å†…å®¹â€ä¸€é¡¹è®¾ç½®ä¸ºâ€œè·³åˆ°ä¸‹ä¸€ä¸ªWindowsç‰ˆæœ¬â€ã€‚æ³¨æ„ï¼šè°ƒæ•´å®Œè¯¥é€‰é¡¹æ—¶è¯·ä¿æŒçª—å£ä¸åŠ¨ï¼Œå³ä¸è¦å…³é—­ä¹Ÿä¸è¦åˆ‡æ¢å…¶ä»–é¢æ¿ï¼›</p>\n</li>\n<li><p>å¯åŠ¨æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼ˆç‚¹å‡»å¼€å§‹èœå•å·¦ä¸‹è§’æœç´¢æ¡†ï¼Œè¾“å…¥â€œregeditâ€è¿›å…¥æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼‰ï¼Œ æ‰¾åˆ°ï¼š</p>\n</li>\n</ol>\n<p>HKEY_LOCAL_MACHINE\\SOFTWARE \\Microsoft\\WindowsSelfHost\\UI\\Selection</p>\n<p>åŒå‡»â€œUIContentTypeâ€å¹¶å°†å…¶æ›´æ”¹ä¸ºâ€œSkipâ€ã€‚ ç„¶åï¼Œæ‚¨åº”è¯¥æ‰¾åˆ°â€œUIRingâ€å¹¶å°†å…¶æ›´æ”¹ä¸ºâ€œWIFâ€ã€‚</p>\n<ol start=\"3\">\n<li>ç„¶åæ‰¾åˆ°ï¼š</li>\n</ol>\n<p>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\WindowsSelfHost\\Applicability</p>\n<p>å°†â€œRingâ€çš„å€¼æ”¹ä¸ºâ€œWIFâ€ï¼Œâ€œContent Typeâ€å’ŒContentBackupçš„å€¼æ›´æ”¹ä¸ºâ€œSkipâ€ã€‚</p>\n<ol start=\"4\">\n<li><p>é€€å›â€œWindowsé¢„è§ˆä½“éªŒè®¡åˆ’â€é¢æ¿ï¼Œéšä¾¿ç‚¹å‡»ä¸€ä¸ªæ ‡ç­¾å†åˆ‡æ¢å›æ¥ï¼Œå¦‚æœæ‰“å¼€åä¾æ—§å›ºå®šåœ¨â€œè·³åˆ°ä¸‹ä¸€ä¸ªWindowsç‰ˆæœ¬â€é€‰é¡¹ï¼Œå³ä»£è¡¨ä¸Šè½¦æˆåŠŸï¼<br><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/skip_user.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/skip_user.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"Skipç”¨æˆ·\"></p>\n<center>Skipç”¨æˆ·</center>\n\n</li>\n<li><p>ç‚¹å‡»â€œWindowsæ›´æ–°â€â†’â€œæ£€æŸ¥æ›´æ–°â€ï¼Œè·å–æ–°ç‰ˆæœ¬ç³»ç»Ÿ<br><img src=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/skip_user2.png\" class=\"lazyload placeholder\" data-srcset=\"https://fastly.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/papers/skip_user2.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"Skipç”¨æˆ·çš„æ›´æ–°ç•Œé¢\"></p>\n<center>Skipç”¨æˆ·çš„æ›´æ–°ç•Œé¢</center></li>\n</ol>\n","raw":null,"categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"ç³»ç»Ÿ","path":"api/tags/ç³»ç»Ÿ.json"}]}]}