<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-139249935-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-139249935-1")</script><title>扩增子可视化专题 | 了尘兰若的小坑</title><link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico"><link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css"><link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet"><link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet"><script>var themeModelId="";themeModelId&&localStorage.setItem("modelId",themeModelId)</script><script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script><script>var live2dOpen=eval("true")||!1;live2dOpen||localStorage.setItem("waifu-display",1609323474481)</script><link rel="stylesheet" href="/css/animate.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><link rel="stylesheet" href="/js/shareJs/share.min.css"><style>@media (max-width:992px){#waifu{display:none}}</style><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="了尘兰若的小坑" type="application/atom+xml"></head><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script><body><div id="loader"><link rel="stylesheet" href="/js/loaded/index.css"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>var endLoading=function(){document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading")};window.addEventListener("DOMContentLoaded",endLoading)</script><script>let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }</script><script>function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };</script><script src="/js/swiper/swiper.min.js"></script><script src="/js/swiper/vue-awesome-swiper.js"></script><script src="/js/swiper/swiper.animate1.0.3.min.js"></script><script type="text/javascript">Vue.use(window.VueAwesomeSwiper)</script><script src="/js/vue-typed-js/index.js"></script><script src="/js/vue-seamless-scroll/index.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script><div id="safearea"><main class="main" id="pjax-container"><header class="header" id="navHeader" style="position:fixed;left:0;top:0;z-index:10;width:100%"><div class="header-content"><div class="bars"><div id="appDrawer" class="sidebar-image"><div class="drawer-box-icon"><i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i></div><transition name="fade"><div class="drawer-box_mask" v-cloak style="display:none" v-show="visible" @click.self="cancelDialogDrawer"></div></transition><div class="drawer-box" :class="{'active': visible}"><div class="drawer-box-head bg-color"><img class="drawer-box-head_logo lazyload placeholder" src="/medias/head.jpg" class="lazyload placeholder" data-srcset="/medias/head.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo"><h3 class="drawer-box-head_title">了尘兰若的小坑</h3><h5 class="drawer-box-head_desc">分享微生物生物信息学分析方法，欢迎加入QQ群交流945751012，不接受群内广告！</h5></div><div class="drawer-box-content"><ul class="drawer-box-content_menu"><li class="drawer-box-content_item" style="position:relative"><a href="/" class="drawer-menu-item-link"><i class="fas fa-home" aria-hidden="true"></i> <span class="name">首页</span></a></li><li class="drawer-box-content_item" style="position:relative"><a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(1)"><span><i class="fas fa-archive"></i> <span class="name">归档</span> </span><i class="fas fa-chevron-left arrow" :class="{'icon-rotate': isOpen(1)}" aria-hidden="true"></i></a><ul class="drawer-sub-menu" v-if="isOpen(1)"><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px"></i> <span>Archives</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px"></i> <span>Categories</span></a></li><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px"></i> <span>Tags</span></a></li></ul></li><li class="drawer-box-content_item" style="position:relative"><a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(2)"><span><i class="fas fa-user"></i> <span class="name">关于</span> </span><i class="fas fa-chevron-left arrow" :class="{'icon-rotate': isOpen(2)}" aria-hidden="true"></i></a><ul class="drawer-sub-menu" v-if="isOpen(2)"><li><a href="/about"><i class="fas fa-user-secret" style="margin-top:-20px"></i> <span>About</span></a></li><li><a href="/me"><i class="fas fa-user-md" style="margin-top:-20px"></i> <span>我</span></a></li><li><a href="/skip/box"><i class="fas fa-box-open" style="margin-top:-20px"></i> <span>魔盒</span></a></li></ul></li><li class="drawer-box-content_item" style="position:relative"><a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(3)"><span><i class="fas fa-link"></i> <span class="name">更多</span> </span><i class="fas fa-chevron-left arrow" :class="{'icon-rotate': isOpen(3)}" aria-hidden="true"></i></a><ul class="drawer-sub-menu" v-if="isOpen(3)"><li><a href="/gallery"><i class="fas fa-camera-retro" style="margin-top:-20px"></i> <span>图库</span></a></li><li><a href="/friends"><i class="fas fa-link" style="margin-top:-20px"></i> <span>友情连接</span></a></li></ul></li><li class="drawer-box-content_item" style="position:relative"><a target="_blank" rel="noopener" href="https://liaochenlanruo.gitee.io" class="drawer-menu-item-link"><i class="fas fa-external-link" aria-hidden="true"></i> <span class="name">English</span></a></li><li class="drawer-box-content_item" style="position:relative"><a target="_blank" rel="noopener" href="https://travellings.link/" class="drawer-menu-item-link"><i class="fas fa-subway" aria-hidden="true"></i> <span class="name">开往</span></a></li><li class="drawer-box-content_item"><a target="_blank" rel="noopener" href="http://github.com/liaochenlanruo"><i class="fas fa-github" aria-hidden="true"></i> <span>Github</span></a></li></ul></div></div></div><script>var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })</script></div><div class="blog-title" id="author-avatar"><div class="avatar"><img src="/medias/head.jpg" class="lazyload placeholder" data-srcset="/medias/head.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo"></div><a href="/" class="logo">了尘兰若的小坑</a></div><nav class="navbar"><ul class="menu"><li class="menu-item" style="position:relative"><a href="/" class="menu-item-link" title="首页"><i class="fas fa-home" aria-hidden="true"></i> <span class="name">首页</span></a></li><li class="menu-item" style="position:relative"><a href="javascript:;" class="menu-item-link" title="归档"><i class="fas fa-archive"></i> <span class="name">归档</span> <i class="fas fa-chevron-down arrow" aria-hidden="true"></i></a><ul class="sub-menu"><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px"></i> <span>Archives</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px"></i> <span>Categories</span></a></li><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px"></i> <span>Tags</span></a></li></ul></li><li class="menu-item" style="position:relative"><a href="javascript:;" class="menu-item-link" title="关于"><i class="fas fa-user"></i> <span class="name">关于</span> <i class="fas fa-chevron-down arrow" aria-hidden="true"></i></a><ul class="sub-menu"><li><a href="/about"><i class="fas fa-user-secret" style="margin-top:-20px"></i> <span>About</span></a></li><li><a href="/me"><i class="fas fa-user-md" style="margin-top:-20px"></i> <span>我</span></a></li><li><a href="/skip/box"><i class="fas fa-box-open" style="margin-top:-20px"></i> <span>魔盒</span></a></li></ul></li><li class="menu-item" style="position:relative"><a href="javascript:;" class="menu-item-link" title="更多"><i class="fas fa-link"></i> <span class="name">更多</span> <i class="fas fa-chevron-down arrow" aria-hidden="true"></i></a><ul class="sub-menu"><li><a href="/gallery"><i class="fas fa-camera-retro" style="margin-top:-20px"></i> <span>图库</span></a></li><li><a href="/friends"><i class="fas fa-link" style="margin-top:-20px"></i> <span>友情连接</span></a></li></ul></li><li class="menu-item" style="position:relative"><a target="_blank" rel="noopener" href="https://liaochenlanruo.gitee.io" class="menu-item-link" title="English"><i class="fas fa-external-link" aria-hidden="true"></i> <span class="name">English</span></a></li><li class="menu-item" style="position:relative"><a target="_blank" rel="noopener" href="https://travellings.link/" class="menu-item-link" title="开往"><i class="fas fa-subway" aria-hidden="true"></i> <span class="name">开往</span></a></li></ul><div id="appSearch"><div class="search" @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div><transition name="fade"><div class="message-box_wrapper" style="display:none" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()"><div class="message-box animated bounceInDown"><h2><span><i class="fas fa-search" aria-hidden="true"></i> <span class="title">本地搜索</span> </span><i class="fas fa-times close" pointer style="float:right" aria-hidden="true" @click.self="cancelDialogVisible()"></i></h2><form class="site-search-form"><input type="text" placeholder="请输入关键字" id="local-search-input" @click="getSearchFile()" class="st-search-input" v-model="searchInput"></form><div class="result-wrapper"><div id="local-search-result" class="local-search-result-cls"></div></div></div></div></transition></div><script src="/js/local_search.js"></script><script>var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })</script></nav></div><a target="_blank" rel="noopener" href="http://github.com/liaochenlanruo" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><div id="he-plugin-simple"></div><script>WIDGET={CONFIG:{modules:"012",background:5,tmpColor:"4A4A4A",tmpSize:16,cityColor:"4A4A4A",citySize:16,aqiSize:16,weatherIconSize:24,alertIconSize:18,padding:"10px 10px 10px 10px",shadow:"1",language:"auto",borderRadius:5,fixed:"false",vertical:"middle",horizontal:"center",key:"2784dd3fcb1e4f0f9a9b579bf69641f2"}}</script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script></header><link href="/js/prism/prism-line-numbers.css" rel="stylesheet"><link href="/js/prism/prism-tomorrow.min.css" rel="stylesheet"><style>pre[class*=language-]{overflow-y:hidden}.line-numbers .line-numbers-rows{border:none}</style><div class="bg-dark-floor" style="position:fixed;left:0;top:0;width:100%;height:100%;z-index:-1"></div><div class="post-detail-header" id="thumbnail_canvas" style="background-repeat:no-repeat;background-size:cover;background-position:center center;position:relative;background-image:url(https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/bgs/thumb_55.webp)"><div class="post-detail-header-mask"></div><canvas id="header_canvas" style="position:absolute;bottom:0;pointer-events:none"></canvas><div class="post-detail-header_info-box"><div class="title-box"><span class="title">扩增子可视化专题</span></div><span class="post-detail-header_date"><i class="fas fa-calendar"></i> 发表于：2021-09-15 | </span><span class="post-detail-header_categories"><i class="iconfont iconbookmark1"></i> 分类： <a href="/categories/%E5%8F%AF%E8%A7%86%E5%8C%96/" class="post-detail-header_category">可视化</a></span><div class="post-detail-header_wordcount"><span class="totalcount"><i class="fas fa-file-text-o"></i> 字数统计: 3k | </span><span class="min2read"><i class="fas fa-clock"></i> 阅读时长: 14分钟 | </span><span class="reading"><i class="fas fa-eye"></i> 阅读量：<span id="busuanzi_value_page_pv"></span></span></div></div><script src="/js/bubble/bubble.js"></script></div><div class="row justify-position" style="padding-top:0"><div class="main-content"><article class="post post-detail"><div class="post-content"><p>扩增子分析较常用的软件是 QIIME2，然而其生成的图并不美观，且无法下载，是不可能够达到发表要求的，因此需要我们通过其他方法将 QIIME2 生成的数据结果进行可视化。本文将记录相关的分析方法和示例。</p><h1 id="准备数据"><a class="markdownIt-Anchor" href="#准备数据"></a> 准备数据</h1><ul><li>特征表（Feature table），或者叫做 OTU 表，本教程中文件名为<strong> feature-table.tsv</strong>。该文件可由 QIIME2 生成，由 biome 格式转换而来。</li></ul><pre class="line-numbers language-tex" data-language="tex"><code class="language-tex">	F01	F02	F03	F04	F05	F06	H2_1	H2_2	H2_3	H2_4	H2_5	H2_6	I1_1	I1_2	I1_3	I1_4	I1_5	I1_6
3733c766539aba5e3e8f964a5ba39048	0.0	0.0	0.0	0.0	0.0	0.0	0.0	6.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0
547715c94c5b0c7ba2049658f732397b	0.0	0.0	0.0	6.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0
708c69ff1252447c0709333304cd9bed	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	5.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0
344ee69a9e51ffac2811294d3f04833d	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	7.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0
d2e467b7867f49c25caaacdea5c7eb43	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	18.0	0.0	0.0	0.0	0.0
4adc9b2b0866f620425d07d3ff7ca7e2	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	8.0	0.0	0.0	0.0	0.0
0ffcdef70b9c1436126ba32d7a40d961	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	31.0	0.0	0.0	0.0
7170ce6c7520acc3c13189478aea54a8	53.0	0.0	0.0	0.0	0.0	0.0	37.0	25.0	0.0	0.0	0.0	0.0	23.0	21.0	0.0	0.0	0.0	0.0
b624986630f3d33fbe0a21e66c46d1a5	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	9.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0
78305c3f5955043aba7de952c78859c9	0.0	0.0	22.0	57.0	73.0	55.0	0.0	0.0	0.0	82.0	73.0	0.0	0.0	0.0	43.0	132.0	82.0	95.0
60d9992b10f6dd4da4dc53826b7433f5	0.0	0.0	0.0	0.0	45.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0
33468988848349138af5cb1c23b550f2	0.0	2.0	11.0	12.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0	0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>样本元数据（Metadata），本教程中文件名为<strong> sample-metadata.tsv</strong>。该文件由分析者自己准备，用于描述各个样本的特征。</li></ul><pre class="line-numbers language-tex" data-language="tex"><code class="language-tex">  ID	Samples	Layer	Depth	Depth2	Location	Position	Site
F01	F01	0-5	5	05 cmbsf	Turn	Upstream	F
F02	F02	5-9	10	10 cmbsf	Turn	Upstream	F
F03	F03	9-13	15	15 cmbsf	Turn	Upstream	F
F04	F04	13-17	15	15 cmbsf	Turn	Upstream	F
F05	F05	17-22	20	20 cmbsf	Turn	Upstream	F
F06	F06	22-26	25	25 cmbsf	Turn	Upstream	F
H2_1	H2_1	0-5	5	05 cmbsf	Left	Upstream	H2
H2_2	H2_2	5-10	10	10 cmbsf	Left	Upstream	H2
H2_3	H2_3	10-15	15	15 cmbsf	Left	Upstream	H2
H2_4	H2_4	15-20	20	20 cmbsf	Left	Upstream	H2
H2_5	H2_5	20-25	25	25 cmbsf	Left	Upstream	H2
H2_6	H2_6	25-29	30	30 cmbsf	Left	Upstream	H2
I1_1	I1_1	0-5	5	05 cmbsf	Left	Upstream	I1
I1_2	I1_2	5-10	10	10 cmbsf	Left	Upstream	I1
I1_3	I1_3	10-15	15	15 cmbsf	Left	Upstream	I1
I1_4	I1_4	15-20	20	20 cmbsf	Left	Upstream	I1
I1_5	I1_5	20-25	25	25 cmbsf	Left	Upstream	I1
I1_6	I1_6	25-29	30	30 cmbsf	Left	Upstream	I1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>分类信息，本教程中文件名为<strong> taxonomy.tsv</strong>。该文件可由 QIIME2 生成。</li></ul><pre class="line-numbers language-tex" data-language="tex"><code class="language-tex">Feature ID	Taxon	Confidence
9e24eb7a415db9a59586d17d0f49cbea	Archaea;Asgardarchaeota;Lokiarchaeia	0.9999999998216045
2a1d71d9fca92f9b3fc8f3126db076d0	Bacteria;Proteobacteria;Gammaproteobacteria;Pseudomonadales;Pseudomonadaceae;Pseudomonas	0.9881304182870394
5d89868f1a1db1bc0b153eca96bbf7fd	Archaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae	0.9999999999859067
cc957f2e853493d72875a6528ca83435	Archaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae	0.9999999999854506
5179960239613d4c220e889075c6773e	Archaea;Crenarchaeota;Nitrososphaeria;Nitrosopumilales;Nitrosopumilaceae;Candidatus Nitrosopumilus	0.9558707678091154
d62ab321b324b106e11961e79384f974	Bacteria;Methylomirabilota;Methylomirabilia;Methylomirabilales;Methylomirabilaceae;wb1-A12	0.9999999975860316
920aa9728ffb783cbc5721932cadda36	Bacteria;Aerophobota;Aerophobia;Aerophobales;uncultured bacterium	0.9999939600150409
b5edcefd9280528ee377cb70dea8a6a7	Archaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon	0.99744406884555
43b02d567fe419b94ad063081c7bba58	Bacteria;Planctomycetota;Brocadiae;Brocadiales;Scalinduaceae;Candidatus Scalindua;uncultured bacterium	0.9999941829048367
0f1be1121dd04bc63b5ec4be0efc09b8	Archaea;Asgardarchaeota;Lokiarchaeia;uncultured archaeon	0.7884239553020901
430d9115ca79bad01227bcc9c7694cf1	Bacteria;Proteobacteria;Gammaproteobacteria;Xanthomonadales;Xanthomonadaceae;Thermomonas;uncultured bacterium	0.7413321650122459
0bf08973da329747d913d5c261f91944	Bacteria;Aerophobota;Aerophobia;Aerophobales	1.0000000000000024<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>进化树，本教程中文件名为<strong> tree.nwk</strong>。该文件可由 QIIME2 生成，Newick 格式，是用代表序列构建的系统发育树。</li></ul><hr><h1 id="alpha-diversity"><a class="markdownIt-Anchor" href="#alpha-diversity"></a> Alpha diversity</h1><h2 id="shannon-richness-simpson-chao1-ace-pielou-pd_whole_tree指数的计算与可视化"><a class="markdownIt-Anchor" href="#shannon-richness-simpson-chao1-ace-pielou-pd_whole_tree指数的计算与可视化"></a> Shannon、Richness、Simpson、Chao1、ACE、Pielou、PD_whole_tree 指数的计算与可视化</h2><h3 id="输入文件"><a class="markdownIt-Anchor" href="#输入文件"></a> 输入文件</h3><ul><li>feature-table.tsv</li><li>sample-metadata.tsv</li></ul><h3 id="第一步计算多样性"><a class="markdownIt-Anchor" href="#第一步计算多样性"></a> 第一步：计算多样性</h3><p>将如下代码保存到文件”compute_alpha.R“中，并将程序与输入文件放在同一目录下。在终端中运行命令”Rscript compute_alpha.R“，得到输出文件”alpha.txt“。</p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment">#!/usr/bin/env R</span>
<span class="token comment">#定义函数</span>
library<span class="token punctuation">(</span>picante<span class="token punctuation">)</span>       <span class="token comment">#picante 包加载时默认同时加载 vegan</span>
 
alpha <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> tree <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> base <span class="token operator">=</span> exp<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        est <span class="token operator">&lt;-</span> estimateR<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        Richness <span class="token operator">&lt;-</span> est<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
        Chao1 <span class="token operator">&lt;-</span> est<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
        ACE <span class="token operator">&lt;-</span> est<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
        Shannon <span class="token operator">&lt;-</span> diversity<span class="token punctuation">(</span>x<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">'shannon'</span><span class="token punctuation">,</span> base <span class="token operator">=</span> base<span class="token punctuation">)</span>
        Simpson <span class="token operator">&lt;-</span> diversity<span class="token punctuation">(</span>x<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">'simpson'</span><span class="token punctuation">)</span>    <span class="token comment">#Gini-Simpson 指数</span>
        Pielou <span class="token operator">&lt;-</span> Shannon <span class="token operator">/</span> log<span class="token punctuation">(</span>Richness<span class="token punctuation">,</span> base<span class="token punctuation">)</span>
        goods_coverage <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token operator">-</span> rowSums<span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> rowSums<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        
        result <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>Richness<span class="token punctuation">,</span> Shannon<span class="token punctuation">,</span> Simpson<span class="token punctuation">,</span> Pielou<span class="token punctuation">,</span> Chao1<span class="token punctuation">,</span> ACE<span class="token punctuation">,</span> goods_coverage<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.null<span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                PD_whole_tree <span class="token operator">&lt;-</span> pd<span class="token punctuation">(</span>x<span class="token punctuation">,</span> tree<span class="token punctuation">,</span> include.root <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                names<span class="token punctuation">(</span>PD_whole_tree<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> <span class="token string">'PD_whole_tree'</span>
                result <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>result<span class="token punctuation">,</span> PD_whole_tree<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        result
<span class="token punctuation">&#125;</span>
 
<span class="token comment">#现在直接使用定义好的命令 alpha()，一步得到多种 Alpha 多样性指数</span>
<span class="token comment">#加载 OTU 丰度表和进化树文件</span>
otu <span class="token operator">&lt;-</span> read.delim<span class="token punctuation">(</span><span class="token string">'feature-table.tsv'</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">'\t'</span><span class="token punctuation">,</span> stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> check.names <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
otu <span class="token operator">&lt;-</span> t<span class="token punctuation">(</span>otu<span class="token punctuation">)</span>
tree <span class="token operator">&lt;-</span> read.tree<span class="token punctuation">(</span><span class="token string">'tree.nwk'</span><span class="token punctuation">)</span>
 
<span class="token comment">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span>
<span class="token comment">##alpha_all &lt;- alpha(otu, base = 2)</span>
<span class="token comment">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span>
alpha_all <span class="token operator">&lt;-</span> alpha<span class="token punctuation">(</span>otu<span class="token punctuation">,</span> tree<span class="token punctuation">,</span> base <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
 
<span class="token comment">#输出保存在本地</span>
write.table<span class="token punctuation">(</span>alpha_all<span class="token punctuation">,</span> <span class="token string">'alpha.txt'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> quote <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第二步制图"><a class="markdownIt-Anchor" href="#第二步制图"></a> 第二步：制图</h3><p>这一步需要在 Rstudio 中运行如下命令，在终端里直接运行会报错（莫名其妙），最终输出 7 个 PDF 图形文件。</p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment">#!/usr/bin/env R</span>
<span class="token comment"># 基于github安装包，需要devtools，检测是否存在，不存在则安装</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requireNamespace<span class="token punctuation">(</span><span class="token string">"devtools"</span><span class="token punctuation">,</span> quietly <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    install.packages<span class="token punctuation">(</span><span class="token string">"devtools"</span><span class="token punctuation">)</span>

<span class="token comment"># 加载github包安装工具</span>
library<span class="token punctuation">(</span>devtools<span class="token punctuation">)</span>

<span class="token comment"># 检测amplicon包是否安装，没有从源码安装</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requireNamespace<span class="token punctuation">(</span><span class="token string">"amplicon"</span><span class="token punctuation">,</span> quietly <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    install_github<span class="token punctuation">(</span><span class="token string">"liaochenlanruo/amplicon"</span><span class="token punctuation">)</span>
<span class="token comment"># 提示升级，选择3 None不升级；升级会容易出现报错</span>

<span class="token comment"># library加载包，suppress不显示消息和警告信息</span>
suppressWarnings<span class="token punctuation">(</span>suppressMessages<span class="token punctuation">(</span>library<span class="token punctuation">(</span>amplicon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 设置工作目录，根据实际情况设定</span>
setwd<span class="token punctuation">(</span><span class="token string">"用户自己的工作目录"</span><span class="token punctuation">)</span>

<span class="token comment"># 读取元数据，参数指定包括标题行(TRUE)，列名为1列，制表符分隔，无注释行，不转换为因子类型</span>
metadata <span class="token operator">=</span> read.table<span class="token punctuation">(</span><span class="token string">"sample-metadata.tsv"</span><span class="token punctuation">,</span> header<span class="token operator">=</span>T<span class="token punctuation">,</span> row.names<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> comment.char<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> stringsAsFactors <span class="token operator">=</span> F<span class="token punctuation">)</span>

<span class="token comment"># 读取第一步中vegan计算的6种alpha多样性指数</span>
<span class="token comment">#alpha_div = read.table("alpha.txt", header=T, row.names=1, sep="\t", comment.char="")</span>
alpha_div <span class="token operator">&lt;-</span> read.delim<span class="token punctuation">(</span><span class="token string">"alpha.txt"</span><span class="token punctuation">,</span> quote<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> stringsAsFactors<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制各组香农指数分布，外层()可对保存的图形同时预览</span>
<span class="token punctuation">(</span>p1 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"Shannon"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">##物种丰富度 Richness 指数</span>
<span class="token punctuation">(</span>p2 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"Richness"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span>
<span class="token punctuation">(</span>p3 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"Simpson"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Chao1 指数</span>
<span class="token punctuation">(</span>p4 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"Chao1"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#ACE 指数</span>
<span class="token punctuation">(</span>p5 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"ACE"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#Shannon 均匀度（Pielou 均匀度）</span>
<span class="token punctuation">(</span>p6 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"Pielou"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">##谱系多样性</span>
<span class="token punctuation">(</span>p7 <span class="token operator">=</span> alpha_boxplot<span class="token punctuation">(</span>alpha_div<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token string">"PD_whole_tree"</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID <span class="token operator">=</span> <span class="token string">"Depth2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 保存图片，指定图片为pdf格式方便后期修改，图片宽89毫米，高75毫米</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_shannon.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p1<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_Richness.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p2<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_Simpson.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p3<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_Chao1.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p4<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_ACE.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p5<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_Pielou.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p6<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span>
ggsave<span class="token punctuation">(</span>paste0<span class="token punctuation">(</span><span class="token string">"alpha_boxplot_PD_whole_tree.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p7<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">89</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">75</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"mm"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="演示视频"><a class="markdownIt-Anchor" href="#演示视频"></a> 演示视频</h3><div style="position:relative;width:100%;height:0;padding-bottom:75%"><iframe src="//player.bilibili.com/player.html?aid=335536606&page=" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen style="position:absolute;width:100%;height:100%;left:0;top:0"></iframe></div><hr><h2 id="物种多样性条形图的绘制"><a class="markdownIt-Anchor" href="#物种多样性条形图的绘制"></a> 物种多样性条形图的绘制</h2><h3 id="输入文件-2"><a class="markdownIt-Anchor" href="#输入文件-2"></a> 输入文件</h3><ul><li>处理后的 Feature Table</li></ul><p>从 QIIME2 可视化网站上下载的各 level 的物种丰度表，此处以 level-2（Phylum 水平）为例，命名为 “level-2.csv”。该文件可以用 excel 或 WPS 打开，然后复制所有内容至一个新建的名字为 “level-2.txt” 的文本文档中，删除无关的行或列（如路径），只保留丰度数据，并保存。格式如下：</p><pre class="line-numbers language-tex" data-language="tex"><code class="language-tex">index	species1	species2	species3	species4
Sample1	0	8152	11	65
Sample2	12	97	1097	1315
...
Samplex	15	46	2928	1011<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>sample-metadata.tsv</li><li>taxonomy.tsv</li></ul><h3 id="绘图"><a class="markdownIt-Anchor" href="#绘图"></a> 绘图</h3><p>以下代码在 Rstudio 中逐步输入运行</p><pre class="line-numbers language-r" data-language="r"><code class="language-r">setwd<span class="token punctuation">(</span><span class="token string">"用户自己的路径"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requireNamespace<span class="token punctuation">(</span><span class="token string">"devtools"</span><span class="token punctuation">,</span> quietly<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    install.packages<span class="token punctuation">(</span><span class="token string">"devtools"</span><span class="token punctuation">)</span>
library<span class="token punctuation">(</span>devtools<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requireNamespace<span class="token punctuation">(</span><span class="token string">"amplicon"</span><span class="token punctuation">,</span> quietly<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    install_github<span class="token punctuation">(</span><span class="token string">"microbiota/amplicon"</span><span class="token punctuation">)</span>
suppressWarnings<span class="token punctuation">(</span>suppressMessages<span class="token punctuation">(</span>library<span class="token punctuation">(</span>amplicon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 从文件读取元数据，特征表和物种注释</span>
metadata<span class="token operator">=</span>read.table<span class="token punctuation">(</span><span class="token string">"sample-metadata.tsv"</span><span class="token punctuation">,</span> header<span class="token operator">=</span>T<span class="token punctuation">,</span> row.names<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> comment.char<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> stringsAsFactors<span class="token operator">=</span>F<span class="token punctuation">)</span>

taxonomy<span class="token operator">=</span>read.table<span class="token punctuation">(</span><span class="token string">"taxonomy.tsv"</span><span class="token punctuation">,</span> header<span class="token operator">=</span>T<span class="token punctuation">,</span> row.names<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> comment.char<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> stringsAsFactors<span class="token operator">=</span>F<span class="token punctuation">)</span>

otutab2<span class="token operator">=</span>read.table<span class="token punctuation">(</span><span class="token string">"level-2.txt"</span><span class="token punctuation">,</span> header<span class="token operator">=</span>T<span class="token punctuation">,</span> row.names<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> comment.char<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> stringsAsFactors<span class="token operator">=</span>F<span class="token punctuation">)</span>

<span class="token comment">#堆叠柱状图。以分组均值绘制，展示丰度最高的19个门，其余归类为其他(Other)</span>
<span class="token comment"># 门水平物种组成表和元数据作为输入，分组列名为Group，默认显示前19个分类，按丰度排序</span>
otutab2<span class="token operator">=</span>t<span class="token punctuation">(</span>otutab2<span class="token punctuation">)</span>

<span class="token punctuation">(</span>ps<span class="token operator">=</span>tax_stackplot<span class="token punctuation">(</span>otutab2<span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> groupID<span class="token operator">=</span><span class="token string">"Site"</span><span class="token punctuation">,</span> topN<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"sample"</span><span class="token punctuation">,</span> sorted<span class="token operator">=</span><span class="token string">"abundance"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ps2 <span class="token operator">=</span> ps <span class="token operator">+</span> scale_fill_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> rev<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"#1f77b4"</span><span class="token punctuation">,</span> <span class="token string">"#aec7e8"</span><span class="token punctuation">,</span> <span class="token string">"#ff7f0e"</span><span class="token punctuation">,</span> <span class="token string">"#ffbb78"</span><span class="token punctuation">,</span> <span class="token string">"#2ca02c"</span><span class="token punctuation">,</span> <span class="token string">"#98df8a"</span><span class="token punctuation">,</span> <span class="token string">"#d62728"</span><span class="token punctuation">,</span> <span class="token string">"#ff9896"</span><span class="token punctuation">,</span> <span class="token string">"#9467bd"</span><span class="token punctuation">,</span> <span class="token string">"#c5b0d5"</span><span class="token punctuation">,</span> <span class="token string">"#8c564b"</span><span class="token punctuation">,</span> <span class="token string">"#c49c94"</span><span class="token punctuation">,</span> <span class="token string">"#e377c2"</span><span class="token punctuation">,</span> <span class="token string">"#f7b6d2"</span><span class="token punctuation">,</span> <span class="token string">"#7f7f7f"</span><span class="token punctuation">,</span> <span class="token string">"#c7c7c7"</span><span class="token punctuation">,</span> <span class="token string">"#bcbd22"</span><span class="token punctuation">,</span> <span class="token string">"#dbdb8d"</span><span class="token punctuation">,</span> <span class="token string">"#17becf"</span><span class="token punctuation">,</span> <span class="token string">"#9edae5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> theme<span class="token punctuation">(</span>axis.text.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span>angle <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> vjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ps2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="演示视频-2"><a class="markdownIt-Anchor" href="#演示视频-2"></a> 演示视频</h3><div style="position:relative;width:100%;height:0;padding-bottom:75%"><iframe src="//player.bilibili.com/player.html?aid=633107204&page=" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen style="position:absolute;width:100%;height:100%;left:0;top:0"></iframe></div><hr><h1 id="beta多样性"><a class="markdownIt-Anchor" href="#beta多样性"></a> Beta 多样性</h1><h2 id="nmds分析及可视化"><a class="markdownIt-Anchor" href="#nmds分析及可视化"></a> NMDS 分析及可视化</h2><h3 id="输入文件-3"><a class="markdownIt-Anchor" href="#输入文件-3"></a> 输入文件</h3><ul><li>feature-table.tsv</li><li>sample-metadata.tsv</li></ul><h3 id="分析过程"><a class="markdownIt-Anchor" href="#分析过程"></a> 分析过程</h3><p>在 Rstudio 中运行如下代码：</p><pre class="line-numbers language-r" data-language="r"><code class="language-r">setwd<span class="token punctuation">(</span><span class="token string">"用户的工作目录"</span><span class="token punctuation">)</span>
library<span class="token punctuation">(</span><span class="token string">"vegan"</span><span class="token punctuation">)</span>

<span class="token comment"># 读取数据，一份otu.table文件和一份分组信息文件</span>
otu <span class="token operator">&lt;-</span> read.table<span class="token punctuation">(</span><span class="token string">"feature-table.tsv"</span><span class="token punctuation">,</span>row.names<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> header<span class="token operator">=</span>T<span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span>check.names<span class="token operator">=</span>F<span class="token punctuation">)</span>

design <span class="token operator">&lt;-</span> read.table<span class="token punctuation">(</span><span class="token string">"sample-metadata.tsv"</span><span class="token punctuation">,</span>header<span class="token operator">=</span>T<span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span>row.names<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>check.names<span class="token operator">=</span>F<span class="token punctuation">)</span>

<span class="token comment"># 数据调整为列名是OTU，行名是样本名</span>
otu<span class="token operator">=</span>t<span class="token punctuation">(</span>otu<span class="token punctuation">)</span>

<span class="token comment"># 标准化，当然method有很多，可以通过?decostand查看其它method</span>
vare.hel<span class="token operator">&lt;-</span>decostand<span class="token punctuation">(</span>otu<span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">"hellinger"</span><span class="token punctuation">)</span>

<span class="token comment"># 计算Bray-curtis距离矩阵</span>
vare.dis <span class="token operator">&lt;-</span> vegdist<span class="token punctuation">(</span>vare.hel<span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">"bray"</span><span class="token punctuation">)</span>

<span class="token comment"># 使用NMDS的方法</span>
vare.mds <span class="token operator">&lt;-</span> metaMDS<span class="token punctuation">(</span>vare.hel<span class="token punctuation">,</span>distance <span class="token operator">=</span> <span class="token string">"bray"</span><span class="token punctuation">)</span>

<span class="token comment"># 首先提取前两轴坐标</span>
point <span class="token operator">=</span> scores<span class="token punctuation">(</span>vare.mds<span class="token punctuation">)</span>

<span class="token comment"># 将分组文件和得分文件合并</span>
index <span class="token operator">=</span> merge<span class="token punctuation">(</span>design<span class="token punctuation">,</span> point<span class="token punctuation">,</span>by<span class="token operator">=</span><span class="token string">"row.names"</span><span class="token punctuation">,</span>all<span class="token operator">=</span>F<span class="token punctuation">)</span>

<span class="token comment"># 查看Stress值</span>
<span class="token comment"># Stress值是反映模型合适程度的指标，NMDS会多次打乱数据计算Stress值，直到找到最合适的模型，也就是最低的Stress值；理想状况下，Stress值为0，一般Stress值低于0.1较为合理。</span>
vare.mds

<span class="token comment"># Stress:     0.07498046 #记住这个数字，后面会打印在图中</span>

<span class="token comment"># 显着性检验；anosim本质是基于排名的算法，更加适合NMDS，这里基于元数据中的深度（Depth）计算</span>
anosim.result<span class="token operator">&lt;-</span>anosim<span class="token punctuation">(</span>vare.dis<span class="token punctuation">,</span> design<span class="token operator">$</span>Depth<span class="token punctuation">,</span>permutations <span class="token operator">=</span><span class="token number">999</span><span class="token punctuation">)</span>

summary<span class="token punctuation">(</span>anosim.result<span class="token punctuation">)</span>

<span class="token comment"># ANOSIM statistic R: 0.8036 #记住这个数字，后面会打印在图中</span>
<span class="token comment">#       Significance: 0.001 #记住这个数字，后面会打印在图中</span>

<span class="token comment"># tiff输出图形，适合大部分出版刊物，入门级别分辩率300,18*14的长宽；</span>
<span class="token comment">#tiff(file="beta_bray_NMDS.tiff", res = 300, compression ="none", width=180,height=140,units= "mm")</span>

<span class="token comment"># 在这里我选择输出为PDF，后续可以进一步的编辑</span>
pdf<span class="token punctuation">(</span>file<span class="token operator">=</span><span class="token string">"beta_bray_NMDS.pdf"</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">,</span>height<span class="token operator">=</span><span class="token number">140</span><span class="token punctuation">)</span>

<span class="token comment">#开始出图，代码如下：</span>
library<span class="token punctuation">(</span><span class="token string">"ggplot2"</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> ggplot<span class="token punctuation">(</span>index<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>NMDS1<span class="token punctuation">,</span> y<span class="token operator">=</span>NMDS2<span class="token punctuation">,</span> color<span class="token operator">=</span>as.factor<span class="token punctuation">(</span>Depth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
      geom_point<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span>
     <span class="token comment">#scale_colour_manual(values = c("red","blue", "green")) +#这行代码是用于自定义颜色的，有几个组就用几个颜色，少于3个组的话不支持自定义</span>
     labs<span class="token punctuation">(</span>x<span class="token operator">=</span>paste<span class="token punctuation">(</span><span class="token string">"NMDS1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token operator">=</span>paste<span class="token punctuation">(</span><span class="token string">"NMDS2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>

<span class="token comment">#置信区间当然要加上，有三种方式，线条类型也可以更改。将上面得到的三个指标在图中更换Stress，R，p。</span>

p<span class="token operator">+</span>stat_ellipse<span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"t"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> level <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">,</span> show.legend <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token operator">+</span>
    annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.25</span><span class="token punctuation">,</span>parse<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">"'R: '*0.8036"</span><span class="token punctuation">,</span>family<span class="token operator">=</span><span class="token string">"serif"</span><span class="token punctuation">,</span>fontface<span class="token operator">=</span><span class="token string">"italic"</span><span class="token punctuation">,</span>colour<span class="token operator">=</span><span class="token string">"darkred"</span><span class="token punctuation">,</span>hjust <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>
    annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.35</span><span class="token punctuation">,</span>parse<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">"'p: '*0.001"</span><span class="token punctuation">,</span>family<span class="token operator">=</span><span class="token string">"serif"</span><span class="token punctuation">,</span>fontface<span class="token operator">=</span><span class="token string">"italic"</span><span class="token punctuation">,</span>colour<span class="token operator">=</span><span class="token string">"darkred"</span><span class="token punctuation">,</span>hjust <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>
    annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.45</span><span class="token punctuation">,</span>parse<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">"'Stress: '*0.075"</span><span class="token punctuation">,</span>family<span class="token operator">=</span><span class="token string">"serif"</span><span class="token punctuation">,</span>fontface<span class="token operator">=</span><span class="token string">"italic"</span><span class="token punctuation">,</span>colour<span class="token operator">=</span><span class="token string">"darkred"</span><span class="token punctuation">,</span>hjust <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> geom_point<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>x<span class="token operator">=</span>NMDS1<span class="token punctuation">,</span> y<span class="token operator">=</span>NMDS2<span class="token punctuation">,</span> shape<span class="token operator">=</span>Site<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span>
	<span class="token comment">#scale_shape_manual(values = c(15, 19, 17))+#这行代码是用于自定义形状的，有几个组就用几个形状，少于3个组的话不支持自定义</span>
    theme_classic<span class="token punctuation">(</span><span class="token punctuation">)</span>

dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="演示视频-3"><a class="markdownIt-Anchor" href="#演示视频-3"></a> 演示视频</h3><div style="position:relative;width:100%;height:0;padding-bottom:75%"><iframe src="//player.bilibili.com/player.html?aid=548008577&page=" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen style="position:absolute;width:100%;height:100%;left:0;top:0"></iframe></div><h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1><ul><li><a target="_blank" rel="noopener" href="https://github.com/YongxinLiu/MicrobiomeStatPlot">https://github.com/YongxinLiu/MicrobiomeStatPlot</a></li></ul><p><font color="#FF0000"><ruby><b>敬告</b>：使用文中脚本请引用本文网址，请尊重本人的劳动成果，谢谢！<rt><b>Notice</b>: When you use the scripts in this article, please cite the link of this webpage. Thank you!</rt></ruby></font></p></div><div class="post-tags-categories"><div class="tags"><a href="/tags/SY179/">SY179 </a><a href="/tags/R%E8%AF%AD%E8%A8%80/">R语言 </a><a href="/tags/%E6%89%A9%E5%A2%9E%E5%AD%90/">扩增子</a></div></div><div class="copyright"><ul class="post-copyright"><li class="post-copyright-author"><strong>作者: </strong>Hualin Liu</li><li class="post-copyright-link"><strong>文章链接: </strong><a href="/post/fccc.html" target="_blank" title="扩增子可视化专题">https://www.liaochenlanruo.fun/post/fccc.html</a></li><li class="post-copyright-license"><strong>版权声明: </strong>本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a> 许可协议。转载请注明出处!</li></ul><div></div></div></article><div class="post-nav"><div class="post-nav-prev post-nav-item"><div class="post-nav-img" style="background-size:cover;background-position:center center"><img class="lazyload lazyload placeholder" src="https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/bgs/thumb_79.webp" class="lazyload placeholder" data-srcset="https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/bgs/thumb_79.webp" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt=""></div><a href="/post/baf4.html" class="post-nav-link"><div class="title"><i class="fas fa-angle-left"></i> 上一篇:<div class="title-text">扩增子系之绘制物种分类堆叠图</div></div></a></div><div class="post-nav-next post-nav-item"><div class="post-nav-img" style="background-size:cover;background-position:center center"><img class="lazyload lazyload placeholder" src="https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/bgs/thumb_3.webp" class="lazyload placeholder" data-srcset="https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/custom/bgs/thumb_3.webp" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt=""></div><a href="/post/6e6b.html" class="post-nav-link"><div class="title">下一篇: <i class="fas fa-angle-right"></i><div class="title-text">绘图自定义colors</div></div></a></div></div><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/js/shareJs/social-share.min.js"></script><style>.social-share{margin:20px 0}</style><div id="myComment"><div id="gitment-container"></div></div></div><div class="toc-aside"><div class="toc-main"><div class="toc-aside-title"><i class="fas fa-list-ul" aria-hidden="true"></i><span>本文目录</span><div class="toc-open-close">本文目录</div></div><div class="toc-content"><div class="toc"></div></div></div></div><div id="toc-mobile-btn"><i class="fas fa-list-ul" aria-hidden="true"></i></div><script>function closeToc(init) {
    $(".toc-aside").css({'width': 0, 'padding': 0, 'transition': init ?  'noe' : 'width 0.3s' });
    $(".toc-content").css({'width': 0});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
    $(".main-content").css({'width': '75%', 'margin': '10px auto'});
  };
  function openToc() {
    $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
    $(".toc-aside").css({'width': '300px', 'padding': '0 10px', 'transition': 'width 0.3s'});
    $(".toc-content").css({'width': '300px'});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
  }
  function openBtnClickFn () {
    let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
    let open = eval('' || 'true');
    openOrCloseBtn.click(function() {
      if (open) {
        closeToc();
        open = false;
      } else {
        openToc();
        open = true;
      }
    });
  };
  openBtnClickFn();
  initCloseTocWidth(true);

  function initCloseTocWidth(init) {
    if (window.innerWidth >= 992) {
      let isClose = false;
      isClose && closeToc(init)
    }
  }

  document.addEventListener('pjax:complete', function () {
    $(".toc-aside").css({'transition': 'no'});
  })
  document.addEventListener('pjax:complete', function () {
    openBtnClickFn();
  })</script><script src="/js/wrapImage.js"></script></div><div id="appBgSwiper" style="position:fixed;left:0;top:0;width:100%;height:100%;z-index:-2" :style="{'background-color': bgColor ? bgColor : 'transparent'}"><transition-group tag="ul" :name="names"><li v-for="(image,index) in img" :key="index" v-show="index === mark" class="bg-swiper-box"><img :src="image" class="bg-swiper-img no-lazy"></li></transition-group></div><script>var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})</script><style>.bg-swiper-box{position:absolute;display:block;width:100%;height:100%}.bg-swiper-img{object-fit:cover;width:100%;height:100%}</style><script>function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })</script></main></div><div class="footer bg-color"><div class="footer-main"><div class="link"><a href="/atom.xml" class="social"><i class="fas fa-rss" aria-hidden="true"></i> </a><a href="mailto:liaochenlanruo@webmail.hzau.edu.cn" class="social"><i class="fas fa-envelope" aria-hidden="true"></i> </a><a target="_blank" rel="noopener" href="https://github.com/liaochenlanruo" class="social"><i class="fab fa-github" aria-hidden="true"></i> </a><a href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=549830082" class="social"><i class="fab fa-qq" aria-hidden="true"></i></a></div><div class="footer-copyright"><p>Copyright © 2018 - 2021 <a target="_blank" rel="noopener" href="https://github.com/liaochenlanruo">liaochenlanruo</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a></p></div><span id="busuanzi_container_site_pv"><i class="fas fa-eye" aria-hidden="true"></i>本站总访问量：<span id="busuanzi_value_site_pv"></span> 次 </span><span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="display:none"><i class="fas fa-users" aria-hidden="true"></i>本站访客数：<span id="busuanzi_value_site_uv"></span> 人</span><div class="footer-custom"><div><p><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn">鄂 ICP 备 2021021941 号</a> <img src="https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/logo/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" class="lazyload placeholder" data-srcset="https://cdn.jsdelivr.net/gh/liaochenlanruo/cdn@master/img/logo/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="备案图标"> <a target="_blank" rel="noopener" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011102004725">鄂公网安备 42011102004725 号</a></p></div></div></div></div><div class="dark"><div class="dark-content"><i class="fas fa-moon" aria-hidden="true"></i></div></div><script>$(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })</script><div class="goTop top-btn-color" pointer><i class="fas fa-arrow-up" aria-hidden="true"></i></div><script src="/js/goTop.js"></script><link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><meting-js server="tencent" type="playlist" id="8062553743" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?aea6c1471d6299bdd1c87a0836f18675";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/javascript" size="100" alpha="0.4" zindex="-1" src="/js/ribbon.min.js"></script><script src="/js/utils/index.js"></script><script src="/js/app.js"></script><link href="/js/tocbot/tocbot.css" rel="stylesheet"><script src="/js/tocbot/tocbot.min.js"></script><script>var headerEl = 'h1, h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }</script><style>.is-position-fixed{position:sticky!important;top:74px}.toc-main ul{counter-reset:show-list}.toc-main ul li::before{content:counter(item)".";display:block;position:absolute;left:12px;top:0}</style><script>let setHeaderClass = () => {
    const headerMenuTransparent = true;
    if (!headerMenuTransparent) { return; }
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })</script><script>function loadIssuesJS(){0!=$(".post-detail").find(".issues-api").length&&loadScript("/js/issues/index.js")}$(function(){loadIssuesJS()}),document.addEventListener("pjax:complete",function(){"undefined"==typeof IssuesAPI&&loadIssuesJS()})</script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css"><script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script><script src="/js/clipboard/clipboard.min.js"></script><div id="appCopy"></div><script data-pjax>var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = '复制';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })</script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazyload",threshold:0},window.addEventListener("LazyLoad::Initialized",function(n){window.lazyLoadInstance=n.detail.instance},!1),document.addEventListener("DOMContentLoaded",function(){lazyLoadInstance.update()}),document.addEventListener("pjax:complete",function(){lazyLoadInstance.update()})</script><script type="text/javascript">var utteranceCommon = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceCommon.Theme = 'github-dark';
    } else {
      utteranceCommon.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // 匿名函数，防止污染全局变量
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceCommon.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content 是要插入评论的地方
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceCommon.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })</script><style>.utterances{max-width:inherit!important}</style><script src="/js/cursor/fireworks.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script><script src="/js/pjax@0.2.8/index.js"></script><div class="pjax-animate"><div class="loading-circle"><div id="loader-circle"></div></div><script>window.ShowLoading=function(){$(".loading-circle").css("display","block")},window.HideLoading=function(){$(".loading-circle").css("display","none")}</script><script>document.addEventListener("pjax:complete",function(){window.HideLoading()}),document.addEventListener("pjax:send",function(){window.ShowLoading()}),document.addEventListener("pjax:error",function(){window.HideLoading()})</script></div><script>var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })</script></body></html>